import{C as e,G as t,Tt as n,Yt as r,ct as i,et as a,ht as o,mt as s,nt as c,qt as l,rt as u,xt as d}from"./index-BeHQuFJv.js";var f=class extends l{constructor({callbackSelector:e,cause:t,data:n,extraData:r,sender:a,urls:o}){super(t.shortMessage||`An error occurred while fetching for an offchain result.`,{cause:t,metaMessages:[...t.metaMessages||[],t.metaMessages?.length?``:[],`Offchain Gateway Call:`,o&&[`  Gateway URL(s):`,...o.map(e=>`    ${i(e)}`)],`  Sender: ${a}`,`  Data: ${n}`,`  Callback selector: ${e}`,`  Extra data: ${r}`].flat(),name:`OffchainLookupError`})}},p=class extends l{constructor({result:e,url:t}){super(`Offchain gateway response is malformed. Response data must be a hex value.`,{metaMessages:[`Gateway URL: ${i(t)}`,`Response: ${s(e)}`],name:`OffchainLookupResponseMalformedError`})}},m=class extends l{constructor({sender:e,to:t}){super("Reverted sender address does not match target contract address (`to`).",{metaMessages:[`Contract address: ${t}`,`OffchainLookup sender address: ${e}`],name:`OffchainLookupSenderMismatchError`})}};const h=`0x556f1830`,g={name:`OffchainLookup`,type:`error`,inputs:[{name:`sender`,type:`address`},{name:`urls`,type:`string[]`},{name:`callData`,type:`bytes`},{name:`callbackFunction`,type:`bytes4`},{name:`extraData`,type:`bytes`}]};async function _(r,{blockNumber:i,blockTag:a,data:s,to:l}){let{args:u}=o({data:s,abi:[g]}),[p,h,_,y,b]=u,{ccipRead:x}=r,S=x&&typeof x?.request==`function`?x.request:v;try{if(!e(l,p))throw new m({sender:p,to:l});let{data:o}=await t(r,{blockNumber:i,blockTag:a,data:n([y,d([{type:`bytes`},{type:`bytes`}],[h.includes(`x-batch-gateway:true`)?await c({data:_,ccipRequest:S}):await S({data:_,sender:p,urls:h}),b])]),to:l});return o}catch(e){throw new f({callbackSelector:y,cause:e,data:s,extraData:b,sender:p,urls:h})}}async function v({data:e,sender:t,urls:n}){let i=Error(`An unknown error occurred.`);for(let o=0;o<n.length;o++){let c=n[o],l=c.includes(`{data}`)?`GET`:`POST`,u=l===`POST`?{data:e,sender:t}:void 0,d=l===`POST`?{"Content-Type":`application/json`}:{};try{let n=await fetch(c.replace(`{sender}`,t.toLowerCase()).replace(`{data}`,e),{body:JSON.stringify(u),headers:d,method:l}),o;if(o=n.headers.get(`Content-Type`)?.startsWith(`application/json`)?(await n.json()).data:await n.text(),!n.ok){i=new a({body:u,details:o?.error?s(o.error):n.statusText,headers:n.headers,status:n.status,url:c});continue}if(!r(o)){i=new p({result:o,url:c});continue}return o}catch(e){i=new a({body:u,details:e.message,url:c})}}throw i}export{_ as offchainLookup,h as offchainLookupSignature};