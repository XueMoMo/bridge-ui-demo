const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/secp256k1-H5OphODo.js","assets/index-BeHQuFJv.js","assets/index-BU9e6r_p.css","assets/utils-C3w0p1k9.js","assets/core-C2ho7ETH.js","assets/lit-BezCDHqd.js","assets/ConstantsUtil-BN3mixct.js","assets/SIWXUtil-CYJ0EOLw.js","assets/events-CtKW_jcT.js","assets/ConnectorUtil-BI_fjT8-.js","assets/utils-BsQXckoc.js","assets/index.es-4bRBW2BC.js","assets/index.es-BUf3sY9K.js"])))=>i.map(i=>d[i]);
import{K as e,rn as t}from"./index-BeHQuFJv.js";import{t as n}from"./events-CtKW_jcT.js";import{_ as r,a as i,c as a,d as o,f as s,g as c,h as l,i as u,l as d,m as f,n as p,o as m,p as h,r as g,s as _,t as v,u as y}from"./index.es-BUf3sY9K.js";import{S as b,_ as x,a as S,b as C,d as w,f as T,g as E,i as D,m as O,n as k,o as A,p as j,s as M,t as N,u as P,v as F,x as I,y as L}from"./index.es-4bRBW2BC.js";import{a as R,c as ee,d as te,f as ne,g as re,h as ie,l as ae,n as oe,p as se,t as ce,u as le}from"./utils-C3w0p1k9.js";function ue(e,{strict:t=!0}={}){return!e||typeof e!=`string`?!1:t?/^0x[0-9a-fA-F]*$/.test(e):e.startsWith(`0x`)}function de(e){return ue(e,{strict:!1})?Math.ceil((e.length-2)/2):e.length}const fe=`2.23.2`;var pe={getDocsUrl:({docsBaseUrl:e,docsPath:t=``,docsSlug:n})=>t?`${e??`https://viem.sh`}${t}${n?`#${n}`:``}`:void 0,version:`viem@${fe}`},me=class e extends Error{constructor(t,n={}){let r=(()=>n.cause instanceof e?n.cause.details:n.cause?.message?n.cause.message:n.details)(),i=(()=>n.cause instanceof e&&n.cause.docsPath||n.docsPath)(),a=pe.getDocsUrl?.({...n,docsPath:i}),o=[t||`An error occurred.`,``,...n.metaMessages?[...n.metaMessages,``]:[],...a?[`Docs: ${a}`]:[],...r?[`Details: ${r}`]:[],...pe.version?[`Version: ${pe.version}`]:[]].join(`
`);super(o,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,`details`,{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,`docsPath`,{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,`metaMessages`,{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,`shortMessage`,{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,`version`,{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,`name`,{enumerable:!0,configurable:!0,writable:!0,value:`BaseError`}),this.details=r,this.docsPath=i,this.metaMessages=n.metaMessages,this.name=n.name??this.name,this.shortMessage=t,this.version=fe}walk(e){return he(this,e)}};function he(e,t){return t?.(e)?e:e&&typeof e==`object`&&`cause`in e&&e.cause!==void 0?he(e.cause,t):t?null:e}var ge=class extends me{constructor({size:e,targetSize:t,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:`SizeExceedsPaddingSizeError`})}};function _e(e,{dir:t,size:n=32}={}){return typeof e==`string`?ve(e,{dir:t,size:n}):ye(e,{dir:t,size:n})}function ve(e,{dir:t,size:n=32}={}){if(n===null)return e;let r=e.replace(`0x`,``);if(r.length>n*2)throw new ge({size:Math.ceil(r.length/2),targetSize:n,type:`hex`});return`0x${r[t===`right`?`padEnd`:`padStart`](n*2,`0`)}`}function ye(e,{dir:t,size:n=32}={}){if(n===null)return e;if(e.length>n)throw new ge({size:e.length,targetSize:n,type:`bytes`});let r=new Uint8Array(n);for(let i=0;i<n;i++){let a=t===`right`;r[a?i:n-i-1]=e[a?i:e.length-i-1]}return r}var be=class extends me{constructor({max:e,min:t,signed:n,size:r,value:i}){super(`Number "${i}" is not in safe ${r?`${r*8}-bit ${n?`signed`:`unsigned`} `:``}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:`IntegerOutOfRangeError`})}},xe=class extends me{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:`SizeOverflowError`})}};function Se(e,{size:t}){if(de(e)>t)throw new xe({givenSize:de(e),maxSize:t})}function Ce(e,t={}){let{signed:n}=t;t.size&&Se(e,{size:t.size});let r=BigInt(e);if(!n)return r;let i=(e.length-2)/2;return r<=(1n<<BigInt(i)*8n-1n)-1n?r:r-BigInt(`0x${`f`.padStart(i*2,`f`)}`)-1n}function we(e,t={}){return Number(Ce(e,t))}var Te=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,`0`));function Ee(e,t={}){return typeof e==`number`||typeof e==`bigint`?ke(e,t):typeof e==`string`?je(e,t):typeof e==`boolean`?De(e,t):Oe(e,t)}function De(e,t={}){let n=`0x${Number(e)}`;return typeof t.size==`number`?(Se(n,{size:t.size}),_e(n,{size:t.size})):n}function Oe(e,t={}){let n=``;for(let t=0;t<e.length;t++)n+=Te[e[t]];let r=`0x${n}`;return typeof t.size==`number`?(Se(r,{size:t.size}),_e(r,{dir:`right`,size:t.size})):r}function ke(e,t={}){let{signed:n,size:r}=t,i=BigInt(e),a;r?a=n?(1n<<BigInt(r)*8n-1n)-1n:2n**(BigInt(r)*8n)-1n:typeof e==`number`&&(a=BigInt(2**53-1));let o=typeof a==`bigint`&&n?-a-1n:0;if(a&&i>a||i<o){let t=typeof e==`bigint`?`n`:``;throw new be({max:a?`${a}${t}`:void 0,min:`${o}${t}`,signed:n,size:r,value:`${e}${t}`})}let s=`0x${(n&&i<0?(1n<<BigInt(r*8))+BigInt(i):i).toString(16)}`;return r?_e(s,{size:r}):s}var Ae=new TextEncoder;function je(e,t={}){return Oe(Ae.encode(e),t)}var Me=new TextEncoder;function Ne(e,t={}){return typeof e==`number`||typeof e==`bigint`?Re(e,t):typeof e==`boolean`?Pe(e,t):ue(e)?Le(e,t):ze(e,t)}function Pe(e,t={}){let n=new Uint8Array(1);return n[0]=Number(e),typeof t.size==`number`?(Se(n,{size:t.size}),_e(n,{size:t.size})):n}var Fe={zero:48,nine:57,A:65,F:70,a:97,f:102};function Ie(e){if(e>=Fe.zero&&e<=Fe.nine)return e-Fe.zero;if(e>=Fe.A&&e<=Fe.F)return e-(Fe.A-10);if(e>=Fe.a&&e<=Fe.f)return e-(Fe.a-10)}function Le(e,t={}){let n=e;t.size&&(Se(n,{size:t.size}),n=_e(n,{dir:`right`,size:t.size}));let r=n.slice(2);r.length%2&&(r=`0${r}`);let i=r.length/2,a=new Uint8Array(i);for(let e=0,t=0;e<i;e++){let n=Ie(r.charCodeAt(t++)),i=Ie(r.charCodeAt(t++));if(n===void 0||i===void 0)throw new me(`Invalid byte sequence ("${r[t-2]}${r[t-1]}" in "${r}").`);a[e]=n*16+i}return a}function Re(e,t){return Le(ke(e,t))}function ze(e,t={}){let n=Me.encode(e);return typeof t.size==`number`?(Se(n,{size:t.size}),_e(n,{dir:`right`,size:t.size})):n}var Be=BigInt(2**32-1),Ve=BigInt(32);function He(e,t=!1){return t?{h:Number(e&Be),l:Number(e>>Ve&Be)}:{h:Number(e>>Ve&Be)|0,l:Number(e&Be)|0}}function Ue(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let i=0;i<e.length;i++){let{h:a,l:o}=He(e[i],t);[n[i],r[i]]=[a,o]}return[n,r]}var We=(e,t,n)=>e<<n|t>>>32-n,Ge=(e,t,n)=>t<<n|e>>>32-n,Ke=(e,t,n)=>t<<n-32|e>>>64-n,qe=(e,t,n)=>e<<n-32|t>>>64-n,Je=[],Ye=[],Xe=[],Ze=BigInt(0),Qe=BigInt(1),$e=BigInt(2),et=BigInt(7),tt=BigInt(256),nt=BigInt(113);for(let e=0,t=Qe,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],Je.push(2*(5*r+n)),Ye.push((e+1)*(e+2)/2%64);let i=Ze;for(let e=0;e<7;e++)t=(t<<Qe^(t>>et)*nt)%tt,t&$e&&(i^=Qe<<(Qe<<BigInt(e))-Qe);Xe.push(i)}var[rt,it]=Ue(Xe,!0),at=(e,t,n)=>n>32?Ke(e,t,n):We(e,t,n),ot=(e,t,n)=>n>32?qe(e,t,n):Ge(e,t,n);function st(e,t=24){let n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let t=0;t<10;t++)n[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let r=(t+8)%10,i=(t+2)%10,a=n[i],o=n[i+1],s=at(a,o,1)^n[r],c=ot(a,o,1)^n[r+1];for(let n=0;n<50;n+=10)e[t+n]^=s,e[t+n+1]^=c}let t=e[2],i=e[3];for(let n=0;n<24;n++){let r=Ye[n],a=at(t,i,r),o=ot(t,i,r),s=Je[n];t=e[s],i=e[s+1],e[s]=a,e[s+1]=o}for(let t=0;t<50;t+=10){for(let r=0;r<10;r++)n[r]=e[t+r];for(let r=0;r<10;r++)e[t+r]^=~n[(r+2)%10]&n[(r+4)%10]}e[0]^=rt[r],e[1]^=it[r]}n.fill(0)}var ct=class e extends ce{constructor(e,t,n,r=!1,i=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=r,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,ie(n),0>=this.blockLen||this.blockLen>=200)throw Error(`Sha3 supports only keccak-f1600 function`);this.state=new Uint8Array(200),this.state32=ae(this.state)}keccak(){R||oe(this.state32),st(this.state32,this.rounds),R||oe(this.state32),this.posOut=0,this.pos=0}update(e){se(this);let{blockLen:t,state:n}=this;e=ee(e);let r=e.length;for(let i=0;i<r;){let a=Math.min(t-this.pos,r-i);for(let t=0;t<a;t++)n[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:n,blockLen:r}=this;e[n]^=t,t&128&&n===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){se(this,!1),ne(e),this.finish();let t=this.state,{blockLen:n}=this;for(let r=0,i=e.length;r<i;){this.posOut>=n&&this.keccak();let a=Math.min(n-this.posOut,i-r);e.set(t.subarray(this.posOut,this.posOut+a),r),this.posOut+=a,r+=a}return e}xofInto(e){if(!this.enableXOF)throw Error(`XOF is not possible for this instance`);return this.writeInto(e)}xof(e){return ie(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(re(e,this),this.finished)throw Error(`digest() was already called`);return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){let{blockLen:n,suffix:r,outputLen:i,rounds:a,enableXOF:o}=this;return t||=new e(n,r,i,o,a),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=a,t.suffix=r,t.outputLen=i,t.enableXOF=o,t.destroyed=this.destroyed,t}};const lt=((e,t,n)=>le(()=>new ct(t,e,n)))(1,136,256/8);function ut(e,t){let n=t||`hex`,r=lt(ue(e,{strict:!1})?Ne(e):e);return n===`bytes`?r:Ee(r)}var dt=new class extends Map{constructor(e){super(),Object.defineProperty(this,`maxSize`,{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){let t=super.get(e);return super.has(e)&&t!==void 0&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){let e=this.keys().next().value;e&&this.delete(e)}return this}}(8192);function ft(e,t){if(dt.has(`${e}.${t}`))return dt.get(`${e}.${t}`);let n=t?`${t}${e.toLowerCase()}`:e.substring(2).toLowerCase(),r=ut(ze(n),`bytes`),i=(t?n.substring(`${t}0x`.length):n).split(``);for(let e=0;e<40;e+=2)r[e>>1]>>4>=8&&i[e]&&(i[e]=i[e].toUpperCase()),(r[e>>1]&15)>=8&&i[e+1]&&(i[e+1]=i[e+1].toUpperCase());let a=`0x${i.join(``)}`;return dt.set(`${e}.${t}`,a),a}function pt(e){return ft(`0x${ut(`0x${e.substring(4)}`).substring(26)}`)}async function mt({hash:t,signature:n}){let r=ue(t)?t:Ee(t),{secp256k1:i}=await e(async()=>{let{secp256k1:e}=await import(`./secp256k1-H5OphODo.js`);return{secp256k1:e}},__vite__mapDeps([0,1,2,3]));return`0x${(()=>{if(typeof n==`object`&&`r`in n&&`s`in n){let{r:e,s:t,v:r,yParity:a}=n,o=ht(Number(a??r));return new i.Signature(Ce(e),Ce(t)).addRecoveryBit(o)}let e=ue(n)?n:Ee(n),t=ht(we(`0x${e.slice(130)}`));return i.Signature.fromCompact(e.substring(2,130)).addRecoveryBit(t)})().recoverPublicKey(r.substring(2)).toHex(!1)}`}function ht(e){if(e===0||e===1)return e;if(e===27)return 0;if(e===28)return 1;throw Error(`Invalid yParityOrV value`)}async function gt({hash:e,signature:t}){return pt(await mt({hash:e,signature:t}))}var _t=m(),vt=_(),yt=r();n();function bt(e){if(e.length>=255)throw TypeError(`Alphabet too long`);let t=new Uint8Array(256);for(let e=0;e<t.length;e++)t[e]=255;for(let n=0;n<e.length;n++){let r=e.charAt(n),i=r.charCodeAt(0);if(t[i]!==255)throw TypeError(r+` is ambiguous`);t[i]=n}let n=e.length,r=e.charAt(0),i=Math.log(n)/Math.log(256),a=Math.log(256)/Math.log(n);function o(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError(`Expected Uint8Array`);if(t.length===0)return``;let i=0,o=0,s=0,c=t.length;for(;s!==c&&t[s]===0;)s++,i++;let l=(c-s)*a+1>>>0,u=new Uint8Array(l);for(;s!==c;){let e=t[s],r=0;for(let t=l-1;(e!==0||r<o)&&t!==-1;t--,r++)e+=256*u[t]>>>0,u[t]=e%n>>>0,e=e/n>>>0;if(e!==0)throw Error(`Non-zero carry`);o=r,s++}let d=l-o;for(;d!==l&&u[d]===0;)d++;let f=r.repeat(i);for(;d<l;++d)f+=e.charAt(u[d]);return f}function s(e){if(typeof e!=`string`)throw TypeError(`Expected String`);if(e.length===0)return new Uint8Array;let a=0,o=0,s=0;for(;e[a]===r;)o++,a++;let c=(e.length-a)*i+1>>>0,l=new Uint8Array(c);for(;a<e.length;){let r=e.charCodeAt(a);if(r>255)return;let i=t[r];if(i===255)return;let o=0;for(let e=c-1;(i!==0||o<s)&&e!==-1;e--,o++)i+=n*l[e]>>>0,l[e]=i%256>>>0,i=i/256>>>0;if(i!==0)throw Error(`Non-zero carry`);s=o,a++}let u=c-s;for(;u!==c&&l[u]===0;)u++;let d=new Uint8Array(o+(c-u)),f=o;for(;u!==c;)d[f++]=l[u++];return d}function c(e){let t=s(e);if(t)return t;throw Error(`Non-base`+n+` character`)}return{encode:o,decodeUnsafe:s,decode:c}}var xt=bt(`123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz`),St=`:`;function Ct(e){let[t,n]=e.split(St);return{namespace:t,reference:n}}function wt(e,t=[]){let n=[];return Object.keys(e).forEach(r=>{if(t.length&&!t.includes(r))return;let i=e[r];n.push(...i.accounts)}),n}function Tt(e,t){return e.includes(`:`)?[e]:t.chains||[]}var Et=Object.defineProperty,Dt=Object.defineProperties,Ot=Object.getOwnPropertyDescriptors,kt=Object.getOwnPropertySymbols,At=Object.prototype.hasOwnProperty,jt=Object.prototype.propertyIsEnumerable,Mt=(e,t,n)=>t in e?Et(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Nt=(e,t)=>{for(var n in t||={})At.call(t,n)&&Mt(e,n,t[n]);if(kt)for(var n of kt(t))jt.call(t,n)&&Mt(e,n,t[n]);return e},Pt=(e,t)=>Dt(e,Ot(t)),Ft={reactNative:`react-native`,node:`node`,browser:`browser`,unknown:`unknown`};function It(){return typeof process<`u`&&typeof process.versions<`u`&&typeof process.versions.node<`u`}function Lt(){return!(0,vt.getDocument)()&&!!(0,vt.getNavigator)()&&navigator.product===`ReactNative`}function Rt(){return Lt()&&typeof global<`u`&&typeof(global==null?void 0:global.Platform)<`u`&&(global==null?void 0:global.Platform.OS)===`android`}function zt(){return Lt()&&typeof global<`u`&&typeof(global==null?void 0:global.Platform)<`u`&&(global==null?void 0:global.Platform.OS)===`ios`}function Bt(){return!It()&&!!(0,vt.getNavigator)()&&!!(0,vt.getDocument)()}function Vt(){return Lt()?Ft.reactNative:It()?Ft.node:Bt()?Ft.browser:Ft.unknown}function Ht(){try{return Lt()&&typeof global<`u`&&typeof(global==null?void 0:global.Application)<`u`?global.Application?.applicationId:void 0}catch{return}}function Ut(e,t){let n=new URLSearchParams(e);for(let e of Object.keys(t).sort())if(t.hasOwnProperty(e)){let r=t[e];r!==void 0&&n.set(e,r)}return n.toString()}function Wt(e){var t,n;let r=Gt();try{return e!=null&&e.url&&r.url&&new URL(e.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${e.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),e.url=r.url),(t=e?.icons)!=null&&t.length&&e.icons.length>0&&(e.icons=e.icons.filter(e=>e!==``)),Pt(Nt(Nt({},r),e),{url:e?.url||r.url,name:e?.name||r.name,description:e?.description||r.description,icons:(n=e?.icons)!=null&&n.length&&e.icons.length>0?e.icons:r.icons})}catch(t){return console.warn(`Error populating app metadata`,t),e||r}}function Gt(){return(0,_t.getWindowMetadata)()||{name:``,description:``,url:``,icons:[``]}}function Kt(){if(Vt()===Ft.reactNative&&typeof global<`u`&&typeof(global==null?void 0:global.Platform)<`u`){let{OS:e,Version:t}=global.Platform;return[e,t].join(`-`)}let e=a();if(e===null)return`unknown`;let t=e.os?e.os.replace(` `,``).toLowerCase():`unknown`;return e.type===`browser`?[t,e.name,e.version].join(`-`):[t,e.version].join(`-`)}function qt(){let e=Vt();return e===Ft.browser?[e,(0,vt.getLocation)()?.host||`unknown`].join(`:`):e}function Jt(e,t,n){let r=Kt(),i=qt();return[[e,t].join(`-`),[`js`,n].join(`-`),r,i].join(`/`)}function Yt({protocol:e,version:t,relayUrl:n,sdkVersion:r,auth:i,projectId:a,useOnCloseEvent:o,bundleId:s,packageName:c}){let l=n.split(`?`),u={auth:i,ua:Jt(e,t,r),projectId:a,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:s||void 0},d=Ut(l[1]||``,u);return l[0]+`?`+d}function Xt(e,t){return e.filter(e=>t.includes(e)).length===e.length}function Zt(e){return Object.fromEntries(e.entries())}function Qt(e){return new Map(Object.entries(e))}function $t(e=yt.FIVE_MINUTES,t){let n=(0,yt.toMiliseconds)(e||yt.FIVE_MINUTES),r,i,a,o;return{resolve:e=>{a&&r&&(clearTimeout(a),r(e),o=Promise.resolve(e))},reject:e=>{a&&i&&(clearTimeout(a),i(e))},done:()=>new Promise((e,s)=>{if(o)return e(o);a=setTimeout(()=>{let e=Error(t);o=Promise.reject(e),s(e)},n),r=e,i=s})}}function en(e,t,n){return new Promise(async(r,i)=>{let a=setTimeout(()=>i(Error(n)),t);try{r(await e)}catch(e){i(e)}clearTimeout(a)})}function tn(e,t){if(typeof t==`string`&&t.startsWith(`${e}:`))return t;if(e.toLowerCase()===`topic`){if(typeof t!=`string`)throw Error(`Value must be "string" for expirer target type: topic`);return`topic:${t}`}else if(e.toLowerCase()===`id`){if(typeof t!=`number`)throw Error(`Value must be "number" for expirer target type: id`);return`id:${t}`}throw Error(`Unknown expirer target type: ${e}`)}function nn(e){return tn(`topic`,e)}function rn(e){return tn(`id`,e)}function an(e){let[t,n]=e.split(`:`),r={id:void 0,topic:void 0};if(t===`topic`&&typeof n==`string`)r.topic=n;else if(t===`id`&&Number.isInteger(Number(n)))r.id=Number(n);else throw Error(`Invalid target, expected id:number or topic:string, got ${t}:${n}`);return r}function on(e,t){return(0,yt.fromMiliseconds)((t||Date.now())+(0,yt.toMiliseconds)(e))}function sn(e){return Date.now()>=(0,yt.toMiliseconds)(e)}function z(e,t){return`${e}${t?`:${t}`:``}`}function cn(e=[],t=[]){return[...new Set([...e,...t])]}async function ln({id:e,topic:t,wcDeepLink:n}){var r;try{if(!n)return;let i=(typeof n==`string`?JSON.parse(n):n)?.href;if(typeof i!=`string`)return;let a=un(i,e,t),o=Vt();if(o===Ft.browser){if(!((r=(0,vt.getDocument)())!=null&&r.hasFocus())){console.warn(`Document does not have focus, skipping deeplink.`);return}dn(a)}else o===Ft.reactNative&&typeof(global==null?void 0:global.Linking)<`u`&&await global.Linking.openURL(a)}catch(e){console.error(e)}}function un(e,t,n){let r=`requestId=${t}&sessionTopic=${n}`;e.endsWith(`/`)&&(e=e.slice(0,-1));let i=`${e}`;if(e.startsWith(`https://t.me`)){let t=e.includes(`?`)?`&startapp=`:`?startapp=`;i=`${i}${t}${vn(r,!0)}`}else i=`${i}/wc?${r}`;return i}function dn(e){let t=`_self`;_n()?t=`_top`:(gn()||e.startsWith(`https://`)||e.startsWith(`http://`))&&(t=`_blank`),window.open(e,t,`noreferrer noopener`)}async function fn(e,t){let n=``;try{if(Bt()&&(n=localStorage.getItem(t),n))return n;n=await e.getItem(t)}catch(e){console.error(e)}return n}function pn(e,t){if(!e.includes(t))return null;let n=e.split(/([&,?,=])/);return n[n.indexOf(t)+2]}function mn(){return typeof crypto<`u`&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():`xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx`.replace(/[xy]/gu,e=>{let t=Math.random()*16|0;return(e===`x`?t:t&3|8).toString(16)})}function hn(){return typeof process<`u`&&{}.IS_VITEST===`true`}function gn(){return typeof window<`u`&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function _n(){try{return window.self!==window.top}catch{return!1}}function vn(e,t=!1){let n=Buffer.from(e).toString(`base64`);return t?n.replace(/[=]/g,``):n}function yn(e){return Buffer.from(e,`base64`).toString(`utf-8`)}function bn(e){return new Promise(t=>setTimeout(t,e))}function xn(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`positive integer expected, got `+e)}function Sn(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name===`Uint8Array`}function Cn(e,...t){if(!Sn(e))throw Error(`Uint8Array expected`);if(t.length>0&&!t.includes(e.length))throw Error(`Uint8Array expected of length `+t+`, got length=`+e.length)}function wn(e){if(typeof e!=`function`||typeof e.create!=`function`)throw Error(`Hash should be wrapped by utils.wrapConstructor`);xn(e.outputLen),xn(e.blockLen)}function Tn(e,t=!0){if(e.destroyed)throw Error(`Hash instance has been destroyed`);if(t&&e.finished)throw Error(`Hash#digest() has already been called`)}function En(e,t){Cn(e);let n=t.outputLen;if(e.length<n)throw Error(`digestInto() expects output buffer of length at least `+n)}var Dn=BigInt(2**32-1),On=BigInt(32);function kn(e,t=!1){return t?{h:Number(e&Dn),l:Number(e>>On&Dn)}:{h:Number(e>>On&Dn)|0,l:Number(e&Dn)|0}}function An(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let i=0;i<e.length;i++){let{h:a,l:o}=kn(e[i],t);[n[i],r[i]]=[a,o]}return[n,r]}var jn=(e,t,n)=>e<<n|t>>>32-n,Mn=(e,t,n)=>t<<n|e>>>32-n,Nn=(e,t,n)=>t<<n-32|e>>>64-n,Pn=(e,t,n)=>e<<n-32|t>>>64-n,Fn=typeof globalThis==`object`&&`crypto`in globalThis?globalThis.crypto:void 0;function In(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Ln(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Rn(e,t){return e<<32-t|e>>>t}var zn=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Bn(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function Vn(e){for(let t=0;t<e.length;t++)e[t]=Bn(e[t])}function Hn(e){if(typeof e!=`string`)throw Error(`utf8ToBytes expected string, got `+typeof e);return new Uint8Array(new TextEncoder().encode(e))}function Un(e){return typeof e==`string`&&(e=Hn(e)),Cn(e),e}function Wn(...e){let t=0;for(let n=0;n<e.length;n++){let r=e[n];Cn(r),t+=r.length}let n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){let i=e[t];n.set(i,r),r+=i.length}return n}var Gn=class{clone(){return this._cloneInto()}};function Kn(e){let t=t=>e().update(Un(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function qn(e=32){if(Fn&&typeof Fn.getRandomValues==`function`)return Fn.getRandomValues(new Uint8Array(e));if(Fn&&typeof Fn.randomBytes==`function`)return Fn.randomBytes(e);throw Error(`crypto.getRandomValues must be defined`)}var Jn=[],Yn=[],Xn=[],Zn=BigInt(0),Qn=BigInt(1),$n=BigInt(2),er=BigInt(7),tr=BigInt(256),nr=BigInt(113);for(let e=0,t=Qn,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],Jn.push(2*(5*r+n)),Yn.push((e+1)*(e+2)/2%64);let i=Zn;for(let e=0;e<7;e++)t=(t<<Qn^(t>>er)*nr)%tr,t&$n&&(i^=Qn<<(Qn<<BigInt(e))-Qn);Xn.push(i)}var[rr,ir]=An(Xn,!0),ar=(e,t,n)=>n>32?Nn(e,t,n):jn(e,t,n),or=(e,t,n)=>n>32?Pn(e,t,n):Mn(e,t,n);function sr(e,t=24){let n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let t=0;t<10;t++)n[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let r=(t+8)%10,i=(t+2)%10,a=n[i],o=n[i+1],s=ar(a,o,1)^n[r],c=or(a,o,1)^n[r+1];for(let n=0;n<50;n+=10)e[t+n]^=s,e[t+n+1]^=c}let t=e[2],i=e[3];for(let n=0;n<24;n++){let r=Yn[n],a=ar(t,i,r),o=or(t,i,r),s=Jn[n];t=e[s],i=e[s+1],e[s]=a,e[s+1]=o}for(let t=0;t<50;t+=10){for(let r=0;r<10;r++)n[r]=e[t+r];for(let r=0;r<10;r++)e[t+r]^=~n[(r+2)%10]&n[(r+4)%10]}e[0]^=rr[r],e[1]^=ir[r]}n.fill(0)}var cr=class e extends Gn{constructor(e,t,n,r=!1,i=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=r,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,xn(n),0>=this.blockLen||this.blockLen>=200)throw Error(`Sha3 supports only keccak-f1600 function`);this.state=new Uint8Array(200),this.state32=In(this.state)}keccak(){zn||Vn(this.state32),sr(this.state32,this.rounds),zn||Vn(this.state32),this.posOut=0,this.pos=0}update(e){Tn(this);let{blockLen:t,state:n}=this;e=Un(e);let r=e.length;for(let i=0;i<r;){let a=Math.min(t-this.pos,r-i);for(let t=0;t<a;t++)n[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:n,blockLen:r}=this;e[n]^=t,t&128&&n===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){Tn(this,!1),Cn(e),this.finish();let t=this.state,{blockLen:n}=this;for(let r=0,i=e.length;r<i;){this.posOut>=n&&this.keccak();let a=Math.min(n-this.posOut,i-r);e.set(t.subarray(this.posOut,this.posOut+a),r),this.posOut+=a,r+=a}return e}xofInto(e){if(!this.enableXOF)throw Error(`XOF is not possible for this instance`);return this.writeInto(e)}xof(e){return xn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(En(e,this),this.finished)throw Error(`digest() was already called`);return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){let{blockLen:n,suffix:r,outputLen:i,rounds:a,enableXOF:o}=this;return t||=new e(n,r,i,o,a),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=a,t.suffix=r,t.outputLen=i,t.enableXOF=o,t.destroyed=this.destroyed,t}},lr=((e,t,n)=>Kn(()=>new cr(t,e,n)))(1,136,256/8),ur=`https://rpc.walletconnect.org/v1`;function dr(e){let t=`Ethereum Signed Message:
${e.length}`,n=new TextEncoder().encode(t+e);return`0x`+Buffer.from(lr(n)).toString(`hex`)}async function fr(e,t,n,r,i,a){switch(n.t){case`eip191`:return await pr(e,t,n.s);case`eip1271`:return await mr(e,t,n.s,r,i,a);default:throw Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}async function pr(e,t,n){return(await gt({hash:dr(t),signature:n})).toLowerCase()===e.toLowerCase()}async function mr(e,t,n,r,i,a){let o=Ct(r);if(!o.namespace||!o.reference)throw Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{let o=n.substring(2),s=`0x1626ba7e`+dr(t).substring(2)+`00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000041`+o,{result:c}=await(await fetch(`${a||ur}/?chainId=${r}&projectId=${i}`,{method:`POST`,body:JSON.stringify({id:hr(),jsonrpc:`2.0`,method:`eth_call`,params:[{to:e,data:s},`latest`]})})).json();return c?c.slice(0,10).toLowerCase()===`0x1626ba7e`:!1}catch(e){return console.error(`isValidEip1271Signature: `,e),!1}}function hr(){return Date.now()+Math.floor(Math.random()*1e3)}function gr(e){let t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);let r=n[0];if(r===0)throw Error(`No signatures found`);let i=1+r*64;if(n.length<i)throw Error(`Transaction data too short for claimed signature count`);if(n.length<100)throw Error(`Transaction too short`);let a=Buffer.from(e,`base64`).slice(1,65);return xt.encode(a)}var _r=Object.defineProperty,vr=Object.defineProperties,yr=Object.getOwnPropertyDescriptors,br=Object.getOwnPropertySymbols,xr=Object.prototype.hasOwnProperty,Sr=Object.prototype.propertyIsEnumerable,Cr=(e,t,n)=>t in e?_r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,wr=(e,t)=>{for(var n in t||={})xr.call(t,n)&&Cr(e,n,t[n]);if(br)for(var n of br(t))Sr.call(t,n)&&Cr(e,n,t[n]);return e},Tr=(e,t)=>vr(e,yr(t)),Er=`did:pkh:`,Dr=e=>e?.split(`:`),Or=e=>{let t=e&&Dr(e);if(t)return e.includes(Er)?t[3]:t[1]},kr=e=>{let t=e&&Dr(e);if(t)return t[2]+`:`+t[3]},Ar=e=>{let t=e&&Dr(e);if(t)return t.pop()};async function jr(e){let{cacao:t,projectId:n}=e,{s:r,p:i}=t,a=Mr(i,i.iss);return await fr(Ar(i.iss),a,r,kr(i.iss),n)}var Mr=(e,t)=>{let n=`${e.domain} wants you to sign in with your Ethereum account:`,r=Ar(t);if(!e.aud&&!e.uri)throw Error("Either `aud` or `uri` is required to construct the message");let i=e.statement||void 0,a=`URI: ${e.aud||e.uri}`,o=`Version: ${e.version}`,s=`Chain ID: ${Or(t)}`,c=`Nonce: ${e.nonce}`,l=`Issued At: ${e.iat}`,u=e.exp?`Expiration Time: ${e.exp}`:void 0,d=e.nbf?`Not Before: ${e.nbf}`:void 0,f=e.requestId?`Request ID: ${e.requestId}`:void 0,p=e.resources?`Resources:${e.resources.map(e=>`
- ${e}`).join(``)}`:void 0,m=qr(e.resources);if(m){let e=zr(m);i=Wr(i,e)}return[n,r,``,i,``,a,o,s,c,l,u,d,f,p].filter(e=>e!=null).join(`
`)};function Nr(e){return Buffer.from(JSON.stringify(e)).toString(`base64`)}function Pr(e){return JSON.parse(Buffer.from(e,`base64`).toString(`utf-8`))}function Fr(e){if(!e)throw Error(`No recap provided, value is undefined`);if(!e.att)throw Error("No `att` property found");let t=Object.keys(e.att);if(!(t!=null&&t.length))throw Error("No resources found in `att` property");t.forEach(t=>{let n=e.att[t];if(Array.isArray(n)||typeof n!=`object`)throw Error(`Resource must be an object: ${t}`);if(!Object.keys(n).length)throw Error(`Resource object is empty: ${t}`);Object.keys(n).forEach(e=>{let t=n[e];if(!Array.isArray(t))throw Error(`Ability limits ${e} must be an array of objects, found: ${t}`);if(!t.length)throw Error(`Value of ${e} is empty array, must be an array with objects`);t.forEach(t=>{if(typeof t!=`object`)throw Error(`Ability limits (${e}) must be an array of objects, found: ${t}`)})})})}function Ir(e,t,n,r={}){return n?.sort((e,t)=>e.localeCompare(t)),{att:{[e]:Lr(t,n,r)}}}function Lr(e,t,n={}){t=t?.sort((e,t)=>e.localeCompare(t));let r=t.map(t=>({[`${e}/${t}`]:[n]}));return Object.assign({},...r)}function Rr(e){return Fr(e),`urn:recap:${Nr(e).replace(/=/g,``)}`}function zr(e){let t=Pr(e.replace(`urn:recap:`,``));return Fr(t),t}function Br(e,t,n){return Rr(Ir(e,t,n))}function Vr(e){return e&&e.includes(`urn:recap:`)}function Hr(e,t){return Rr(Ur(zr(e),zr(t)))}function Ur(e,t){Fr(e),Fr(t);let n=Object.keys(e.att).concat(Object.keys(t.att)).sort((e,t)=>e.localeCompare(t)),r={att:{}};return n.forEach(n=>{Object.keys(e.att?.[n]||{}).concat(Object.keys(t.att?.[n]||{})).sort((e,t)=>e.localeCompare(t)).forEach(i=>{r.att[n]=Tr(wr({},r.att[n]),{[i]:e.att[n]?.[i]||t.att[n]?.[i]})})}),r}function Wr(e=``,t){Fr(t);let n=`I further authorize the stated URI to perform the following actions on my behalf: `;if(e.includes(n))return e;let r=[],i=0;Object.keys(t.att).forEach(e=>{let n=Object.keys(t.att[e]).map(e=>({ability:e.split(`/`)[0],action:e.split(`/`)[1]}));n.sort((e,t)=>e.action.localeCompare(t.action));let a={};n.forEach(e=>{a[e.ability]||(a[e.ability]=[]),a[e.ability].push(e.action)});let o=Object.keys(a).map(t=>(i++,`(${i}) '${t}': '${a[t].join(`', '`)}' for '${e}'.`));r.push(o.join(`, `).replace(`.,`,`.`))});let a=`${n}${r.join(` `)}`;return`${e?e+` `:``}${a}`}function Gr(e){let t=zr(e);Fr(t);let n=t.att?.eip155;return n?Object.keys(n).map(e=>e.split(`/`)[1]):[]}function Kr(e){let t=zr(e);Fr(t);let n=[];return Object.values(t.att).forEach(e=>{Object.values(e).forEach(e=>{var t;(t=e?.[0])!=null&&t.chains&&n.push(e[0].chains)})}),[...new Set(n.flat())]}function qr(e){if(!e)return;let t=e?.[e.length-1];return Vr(t)?t:void 0}function Jr(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`positive integer expected, got `+e)}function Yr(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name===`Uint8Array`}function Xr(e,...t){if(!Yr(e))throw Error(`Uint8Array expected`);if(t.length>0&&!t.includes(e.length))throw Error(`Uint8Array expected of length `+t+`, got length=`+e.length)}function Zr(e,t=!0){if(e.destroyed)throw Error(`Hash instance has been destroyed`);if(t&&e.finished)throw Error(`Hash#digest() has already been called`)}function Qr(e,t){Xr(e);let n=t.outputLen;if(e.length<n)throw Error(`digestInto() expects output buffer of length at least `+n)}function $r(e){if(typeof e!=`boolean`)throw Error(`boolean expected, not ${e}`)}var ei=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),ti=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw Error(`Non little-endian hardware is not supported`);function ni(e){if(typeof e!=`string`)throw Error(`string expected`);return new Uint8Array(new TextEncoder().encode(e))}function ri(e){if(typeof e==`string`)e=ni(e);else if(Yr(e))e=ui(e);else throw Error(`Uint8Array expected, got `+typeof e);return e}function ii(e,t){if(typeof t!=`object`||!t)throw Error(`options must be defined`);return Object.assign(e,t)}function ai(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}var oi=(e,t)=>{function n(n,...r){if(Xr(n),e.nonceLength!==void 0){let t=r[0];if(!t)throw Error(`nonce / iv required`);e.varSizeNonce?Xr(t):Xr(t,e.nonceLength)}let i=e.tagLength;i&&r[1]!==void 0&&Xr(r[1]);let a=t(n,...r),o=(e,t)=>{if(t!==void 0){if(e!==2)throw Error(`cipher output not supported`);Xr(t)}},s=!1;return{encrypt(e,t){if(s)throw Error(`cannot encrypt() twice with same key + nonce`);return s=!0,Xr(e),o(a.encrypt.length,t),a.encrypt(e,t)},decrypt(e,t){if(Xr(e),i&&e.length<i)throw Error(`invalid ciphertext length: smaller than tagLength=`+i);return o(a.decrypt.length,t),a.decrypt(e,t)}}}return Object.assign(n,e),n};function si(e,t,n=!0){if(t===void 0)return new Uint8Array(e);if(t.length!==e)throw Error(`invalid output length, expected `+e+`, got: `+t.length);if(n&&!li(t))throw Error(`invalid output, must be aligned`);return t}function ci(e,t,n,r){if(typeof e.setBigUint64==`function`)return e.setBigUint64(t,n,r);let i=BigInt(32),a=BigInt(4294967295),o=Number(n>>i&a),s=Number(n&a),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,s,r)}function li(e){return e.byteOffset%4==0}function ui(e){return Uint8Array.from(e)}function di(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}var fi=e=>Uint8Array.from(e.split(``).map(e=>e.charCodeAt(0))),pi=fi(`expand 16-byte k`),mi=fi(`expand 32-byte k`),hi=ei(pi),gi=ei(mi);function B(e,t){return e<<t|e>>>32-t}function _i(e){return e.byteOffset%4==0}var vi=64,yi=16,bi=2**32-1,xi=new Uint32Array;function Si(e,t,n,r,i,a,o,s){let c=i.length,l=new Uint8Array(vi),u=ei(l),d=_i(i)&&_i(a),f=d?ei(i):xi,p=d?ei(a):xi;for(let m=0;m<c;o++){if(e(t,n,r,u,o,s),o>=bi)throw Error(`arx: counter overflow`);let h=Math.min(vi,c-m);if(d&&h===vi){let e=m/4;if(m%4!=0)throw Error(`arx: invalid block position`);for(let t=0,n;t<yi;t++)n=e+t,p[n]=f[n]^u[t];m+=vi;continue}for(let e=0,t;e<h;e++)t=m+e,a[t]=i[t]^l[e];m+=h}}function Ci(e,t){let{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:a,rounds:o}=ii({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!=`function`)throw Error(`core must be a function`);return Jr(i),Jr(o),$r(a),$r(n),(t,s,c,l,u=0)=>{Xr(t),Xr(s),Xr(c);let d=c.length;if(l===void 0&&(l=new Uint8Array(d)),Xr(l),Jr(u),u<0||u>=bi)throw Error(`arx: counter overflow`);if(l.length<d)throw Error(`arx: output (${l.length}) is shorter than data (${d})`);let f=[],p=t.length,m,h;if(p===32)f.push(m=ui(t)),h=gi;else if(p===16&&n)m=new Uint8Array(32),m.set(t),m.set(t,16),h=hi,f.push(m);else throw Error(`arx: invalid 32-byte key, got length=${p}`);_i(s)||f.push(s=ui(s));let g=ei(m);if(r){if(s.length!==24)throw Error(`arx: extended nonce must be 24 bytes`);r(h,g,ei(s.subarray(0,16)),g),s=s.subarray(16)}let _=16-i;if(_!==s.length)throw Error(`arx: nonce must be ${_} or 16 bytes`);if(_!==12){let e=new Uint8Array(12);e.set(s,a?0:12-s.length),s=e,f.push(s)}let v=ei(s);return Si(e,h,g,v,c,l,u,o),di(...f),l}}var wi=(e,t)=>e[t++]&255|(e[t++]&255)<<8,Ti=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=ri(e),Xr(e,32);let t=wi(e,0),n=wi(e,2),r=wi(e,4),i=wi(e,6),a=wi(e,8),o=wi(e,10),s=wi(e,12),c=wi(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|r<<6)&7939,this.r[3]=(r>>>7|i<<9)&8191,this.r[4]=(i>>>4|a<<12)&255,this.r[5]=a>>>1&8190,this.r[6]=(a>>>14|o<<2)&8191,this.r[7]=(o>>>11|s<<5)&8065,this.r[8]=(s>>>8|c<<8)&8191,this.r[9]=c>>>5&127;for(let t=0;t<8;t++)this.pad[t]=wi(e,16+2*t)}process(e,t,n=!1){let r=n?0:2048,{h:i,r:a}=this,o=a[0],s=a[1],c=a[2],l=a[3],u=a[4],d=a[5],f=a[6],p=a[7],m=a[8],h=a[9],g=wi(e,t+0),_=wi(e,t+2),v=wi(e,t+4),y=wi(e,t+6),b=wi(e,t+8),x=wi(e,t+10),S=wi(e,t+12),C=wi(e,t+14),w=i[0]+(g&8191),T=i[1]+((g>>>13|_<<3)&8191),E=i[2]+((_>>>10|v<<6)&8191),D=i[3]+((v>>>7|y<<9)&8191),O=i[4]+((y>>>4|b<<12)&8191),k=i[5]+(b>>>1&8191),A=i[6]+((b>>>14|x<<2)&8191),j=i[7]+((x>>>11|S<<5)&8191),M=i[8]+((S>>>8|C<<8)&8191),N=i[9]+(C>>>5|r),P=0,F=P+w*o+T*(5*h)+E*(5*m)+D*(5*p)+O*(5*f);P=F>>>13,F&=8191,F+=k*(5*d)+A*(5*u)+j*(5*l)+M*(5*c)+N*(5*s),P+=F>>>13,F&=8191;let I=P+w*s+T*o+E*(5*h)+D*(5*m)+O*(5*p);P=I>>>13,I&=8191,I+=k*(5*f)+A*(5*d)+j*(5*u)+M*(5*l)+N*(5*c),P+=I>>>13,I&=8191;let L=P+w*c+T*s+E*o+D*(5*h)+O*(5*m);P=L>>>13,L&=8191,L+=k*(5*p)+A*(5*f)+j*(5*d)+M*(5*u)+N*(5*l),P+=L>>>13,L&=8191;let R=P+w*l+T*c+E*s+D*o+O*(5*h);P=R>>>13,R&=8191,R+=k*(5*m)+A*(5*p)+j*(5*f)+M*(5*d)+N*(5*u),P+=R>>>13,R&=8191;let ee=P+w*u+T*l+E*c+D*s+O*o;P=ee>>>13,ee&=8191,ee+=k*(5*h)+A*(5*m)+j*(5*p)+M*(5*f)+N*(5*d),P+=ee>>>13,ee&=8191;let te=P+w*d+T*u+E*l+D*c+O*s;P=te>>>13,te&=8191,te+=k*o+A*(5*h)+j*(5*m)+M*(5*p)+N*(5*f),P+=te>>>13,te&=8191;let ne=P+w*f+T*d+E*u+D*l+O*c;P=ne>>>13,ne&=8191,ne+=k*s+A*o+j*(5*h)+M*(5*m)+N*(5*p),P+=ne>>>13,ne&=8191;let re=P+w*p+T*f+E*d+D*u+O*l;P=re>>>13,re&=8191,re+=k*c+A*s+j*o+M*(5*h)+N*(5*m),P+=re>>>13,re&=8191;let ie=P+w*m+T*p+E*f+D*d+O*u;P=ie>>>13,ie&=8191,ie+=k*l+A*c+j*s+M*o+N*(5*h),P+=ie>>>13,ie&=8191;let ae=P+w*h+T*m+E*p+D*f+O*d;P=ae>>>13,ae&=8191,ae+=k*u+A*l+j*c+M*s+N*o,P+=ae>>>13,ae&=8191,P=(P<<2)+P|0,P=P+F|0,F=P&8191,P>>>=13,I+=P,i[0]=F,i[1]=I,i[2]=L,i[3]=R,i[4]=ee,i[5]=te,i[6]=ne,i[7]=re,i[8]=ie,i[9]=ae}finalize(){let{h:e,pad:t}=this,n=new Uint16Array(10),r=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=r,r=e[t]>>>13,e[t]&=8191;e[0]+=r*5,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,n[0]=e[0]+5,r=n[0]>>>13,n[0]&=8191;for(let t=1;t<10;t++)n[t]=e[t]+r,r=n[t]>>>13,n[t]&=8191;n[9]-=8192;let i=(r^1)-1;for(let e=0;e<10;e++)n[e]&=i;i=~i;for(let t=0;t<10;t++)e[t]=e[t]&i|n[t];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let a=e[0]+t[0];e[0]=a&65535;for(let n=1;n<8;n++)a=(e[n]+t[n]|0)+(a>>>16)|0,e[n]=a&65535;di(n)}update(e){Zr(this);let{buffer:t,blockLen:n}=this;e=ri(e);let r=e.length;for(let i=0;i<r;){let a=Math.min(n-this.pos,r-i);if(a===n){for(;n<=r-i;i+=n)this.process(e,i);continue}t.set(e.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){di(this.h,this.r,this.buffer,this.pad)}digestInto(e){Zr(this),Qr(e,this),this.finished=!0;let{buffer:t,h:n}=this,{pos:r}=this;if(r){for(t[r++]=1;r<16;r++)t[r]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let t=0;t<8;t++)e[i++]=n[t]>>>0,e[i++]=n[t]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}};function Ei(e){let t=(t,n)=>e(n).update(ri(t)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=t=>e(t),t}var Di=Ei(e=>new Ti(e));function Oi(e,t,n,r,i,a=20){let o=e[0],s=e[1],c=e[2],l=e[3],u=t[0],d=t[1],f=t[2],p=t[3],m=t[4],h=t[5],g=t[6],_=t[7],v=i,y=n[0],b=n[1],x=n[2],S=o,C=s,w=c,T=l,E=u,D=d,O=f,k=p,A=m,j=h,M=g,N=_,P=v,F=y,I=b,L=x;for(let e=0;e<a;e+=2)S=S+E|0,P=B(P^S,16),A=A+P|0,E=B(E^A,12),S=S+E|0,P=B(P^S,8),A=A+P|0,E=B(E^A,7),C=C+D|0,F=B(F^C,16),j=j+F|0,D=B(D^j,12),C=C+D|0,F=B(F^C,8),j=j+F|0,D=B(D^j,7),w=w+O|0,I=B(I^w,16),M=M+I|0,O=B(O^M,12),w=w+O|0,I=B(I^w,8),M=M+I|0,O=B(O^M,7),T=T+k|0,L=B(L^T,16),N=N+L|0,k=B(k^N,12),T=T+k|0,L=B(L^T,8),N=N+L|0,k=B(k^N,7),S=S+D|0,L=B(L^S,16),M=M+L|0,D=B(D^M,12),S=S+D|0,L=B(L^S,8),M=M+L|0,D=B(D^M,7),C=C+O|0,P=B(P^C,16),N=N+P|0,O=B(O^N,12),C=C+O|0,P=B(P^C,8),N=N+P|0,O=B(O^N,7),w=w+k|0,F=B(F^w,16),A=A+F|0,k=B(k^A,12),w=w+k|0,F=B(F^w,8),A=A+F|0,k=B(k^A,7),T=T+E|0,I=B(I^T,16),j=j+I|0,E=B(E^j,12),T=T+E|0,I=B(I^T,8),j=j+I|0,E=B(E^j,7);let R=0;r[R++]=o+S|0,r[R++]=s+C|0,r[R++]=c+w|0,r[R++]=l+T|0,r[R++]=u+E|0,r[R++]=d+D|0,r[R++]=f+O|0,r[R++]=p+k|0,r[R++]=m+A|0,r[R++]=h+j|0,r[R++]=g+M|0,r[R++]=_+N|0,r[R++]=v+P|0,r[R++]=y+F|0,r[R++]=b+I|0,r[R++]=x+L|0}var ki=Ci(Oi,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Ai=new Uint8Array(16),ji=(e,t)=>{e.update(t);let n=t.length%16;n&&e.update(Ai.subarray(n))},Mi=new Uint8Array(32);function Ni(e,t,n,r,i){let a=e(t,n,Mi),o=Di.create(a);i&&ji(o,i),ji(o,r);let s=new Uint8Array(16),c=ti(s);ci(c,0,BigInt(i?i.length:0),!0),ci(c,8,BigInt(r.length),!0),o.update(s);let l=o.digest();return di(a,s),l}var Pi=oi({blockSize:64,nonceLength:12,tagLength:16},(e=>(t,n,r)=>({encrypt(i,a){let o=i.length;a=si(o+16,a,!1),a.set(i);let s=a.subarray(0,-16);e(t,n,s,s,1);let c=Ni(e,t,n,s,r);return a.set(c,o),di(c),a},decrypt(i,a){a=si(i.length-16,a,!1);let o=i.subarray(0,-16),s=i.subarray(-16),c=Ni(e,t,n,o,r);if(!ai(s,c))throw Error(`invalid tag`);return a.set(i.subarray(0,-16)),e(t,n,a,a,1),di(c),a}}))(ki)),Fi=class extends Gn{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,wn(e);let n=Un(t);if(this.iHash=e.create(),typeof this.iHash.update!=`function`)throw Error(`Expected instance of class which extends utils.Hash`);this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return Tn(this),this.iHash.update(e),this}digestInto(e){Tn(this),Cn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});let{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:a,outputLen:o}=this;return e=e,e.finished=r,e.destroyed=i,e.blockLen=a,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Ii=(e,t,n)=>new Fi(e,t).update(n).digest();Ii.create=(e,t)=>new Fi(e,t);function Li(e,t,n){return wn(e),n===void 0&&(n=new Uint8Array(e.outputLen)),Ii(e,Un(n),Un(t))}var Ri=new Uint8Array([0]),zi=new Uint8Array;function Bi(e,t,n,r=32){if(wn(e),xn(r),r>255*e.outputLen)throw Error(`Length should be <= 255*HashLen`);let i=Math.ceil(r/e.outputLen);n===void 0&&(n=zi);let a=new Uint8Array(i*e.outputLen),o=Ii.create(e,t),s=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let t=0;t<i;t++)Ri[0]=t+1,s.update(t===0?zi:c).update(n).update(Ri).digestInto(c),a.set(c,e.outputLen*t),o._cloneInto(s);return o.destroy(),s.destroy(),c.fill(0),Ri.fill(0),a.slice(0,r)}var Vi=(e,t,n,r,i)=>Bi(e,Li(e,t,n),r,i);function Hi(e,t,n,r){if(typeof e.setBigUint64==`function`)return e.setBigUint64(t,n,r);let i=BigInt(32),a=BigInt(4294967295),o=Number(n>>i&a),s=Number(n&a),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,s,r)}function Ui(e,t,n){return e&t^~e&n}function Wi(e,t,n){return e&t^e&n^t&n}var Gi=class extends Gn{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ln(this.buffer)}update(e){Tn(this);let{view:t,buffer:n,blockLen:r}=this;e=Un(e);let i=e.length;for(let a=0;a<i;){let o=Math.min(r-this.pos,i-a);if(o===r){let t=Ln(e);for(;r<=i-a;a+=r)this.process(t,a);continue}n.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Tn(this),En(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:i}=this,{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>r-a&&(this.process(n,0),a=0);for(let e=a;e<r;e++)t[e]=0;Hi(n,r-8,BigInt(this.length*8),i),this.process(n,0);let o=Ln(e),s=this.outputLen;if(s%4)throw Error(`_sha2: outputLen should be aligned to 32bit`);let c=s/4,l=this.get();if(c>l.length)throw Error(`_sha2: outputLen bigger than state`);for(let e=0;e<c;e++)o.setUint32(4*e,l[e],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||=new this.constructor,e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:i,destroyed:a,pos:o}=this;return e.length=r,e.pos=o,e.finished=i,e.destroyed=a,r%t&&e.buffer.set(n),e}},Ki=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),qi=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ji=new Uint32Array(64),Yi=class extends Gi{constructor(){super(64,32,8,!1),this.A=qi[0]|0,this.B=qi[1]|0,this.C=qi[2]|0,this.D=qi[3]|0,this.E=qi[4]|0,this.F=qi[5]|0,this.G=qi[6]|0,this.H=qi[7]|0}get(){let{A:e,B:t,C:n,D:r,E:i,F:a,G:o,H:s}=this;return[e,t,n,r,i,a,o,s]}set(e,t,n,r,i,a,o,s){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=i|0,this.F=a|0,this.G=o|0,this.H=s|0}process(e,t){for(let n=0;n<16;n++,t+=4)Ji[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=Ji[e-15],n=Ji[e-2],r=Rn(t,7)^Rn(t,18)^t>>>3;Ji[e]=(Rn(n,17)^Rn(n,19)^n>>>10)+Ji[e-7]+r+Ji[e-16]|0}let{A:n,B:r,C:i,D:a,E:o,F:s,G:c,H:l}=this;for(let e=0;e<64;e++){let t=Rn(o,6)^Rn(o,11)^Rn(o,25),u=l+t+Ui(o,s,c)+Ki[e]+Ji[e]|0,d=(Rn(n,2)^Rn(n,13)^Rn(n,22))+Wi(n,r,i)|0;l=c,c=s,s=o,o=a+u|0,a=i,i=r,r=n,n=u+d|0}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,a=a+this.D|0,o=o+this.E|0,s=s+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,i,a,o,s,c,l)}roundClean(){Ji.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},Xi=Kn(()=>new Yi),Zi=BigInt(0),Qi=BigInt(1),$i=BigInt(2);function ea(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name===`Uint8Array`}function ta(e){if(!ea(e))throw Error(`Uint8Array expected`)}function na(e,t){if(typeof t!=`boolean`)throw Error(e+` boolean expected, got `+t)}var ra=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,`0`));function ia(e){ta(e);let t=``;for(let n=0;n<e.length;n++)t+=ra[e[n]];return t}function aa(e){let t=e.toString(16);return t.length&1?`0`+t:t}function oa(e){if(typeof e!=`string`)throw Error(`hex string expected, got `+typeof e);return e===``?Zi:BigInt(`0x`+e)}var sa={_0:48,_9:57,A:65,F:70,a:97,f:102};function ca(e){if(e>=sa._0&&e<=sa._9)return e-sa._0;if(e>=sa.A&&e<=sa.F)return e-(sa.A-10);if(e>=sa.a&&e<=sa.f)return e-(sa.a-10)}function la(e){if(typeof e!=`string`)throw Error(`hex string expected, got `+typeof e);let t=e.length,n=t/2;if(t%2)throw Error(`hex string expected, got unpadded hex of length `+t);let r=new Uint8Array(n);for(let t=0,i=0;t<n;t++,i+=2){let n=ca(e.charCodeAt(i)),a=ca(e.charCodeAt(i+1));if(n===void 0||a===void 0){let t=e[i]+e[i+1];throw Error(`hex string expected, got non-hex character "`+t+`" at index `+i)}r[t]=n*16+a}return r}function ua(e){return oa(ia(e))}function da(e){return ta(e),oa(ia(Uint8Array.from(e).reverse()))}function fa(e,t){return la(e.toString(16).padStart(t*2,`0`))}function pa(e,t){return fa(e,t).reverse()}function ma(e){return la(aa(e))}function ha(e,t,n){let r;if(typeof t==`string`)try{r=la(t)}catch(t){throw Error(e+` must be hex string or Uint8Array, cause: `+t)}else if(ea(t))r=Uint8Array.from(t);else throw Error(e+` must be hex string or Uint8Array`);let i=r.length;if(typeof n==`number`&&i!==n)throw Error(e+` of length `+n+` expected, got `+i);return r}function ga(...e){let t=0;for(let n=0;n<e.length;n++){let r=e[n];ta(r),t+=r.length}let n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){let i=e[t];n.set(i,r),r+=i.length}return n}function _a(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}function va(e){if(typeof e!=`string`)throw Error(`string expected`);return new Uint8Array(new TextEncoder().encode(e))}var ya=e=>typeof e==`bigint`&&Zi<=e;function ba(e,t,n){return ya(e)&&ya(t)&&ya(n)&&t<=e&&e<n}function xa(e,t,n,r){if(!ba(t,n,r))throw Error(`expected valid `+e+`: `+n+` <= n < `+r+`, got `+t)}function Sa(e){let t;for(t=0;e>Zi;e>>=Qi,t+=1);return t}function Ca(e,t){return e>>BigInt(t)&Qi}function wa(e,t,n){return e|(n?Qi:Zi)<<BigInt(t)}var Ta=e=>($i<<BigInt(e-1))-Qi,Ea=e=>new Uint8Array(e),Da=e=>Uint8Array.from(e);function Oa(e,t,n){if(typeof e!=`number`||e<2)throw Error(`hashLen must be a number`);if(typeof t!=`number`||t<2)throw Error(`qByteLen must be a number`);if(typeof n!=`function`)throw Error(`hmacFn must be a function`);let r=Ea(e),i=Ea(e),a=0,o=()=>{r.fill(1),i.fill(0),a=0},s=(...e)=>n(i,r,...e),c=(e=Ea())=>{i=s(Da([0]),e),r=s(),e.length!==0&&(i=s(Da([1]),e),r=s())},l=()=>{if(a++>=1e3)throw Error(`drbg: tried 1000 values`);let e=0,n=[];for(;e<t;){r=s();let t=r.slice();n.push(t),e+=r.length}return ga(...n)};return(e,t)=>{o(),c(e);let n;for(;!(n=t(l()));)c();return o(),n}}var ka={bigint:e=>typeof e==`bigint`,function:e=>typeof e==`function`,boolean:e=>typeof e==`boolean`,string:e=>typeof e==`string`,stringOrUint8Array:e=>typeof e==`string`||ea(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e==`function`&&Number.isSafeInteger(e.outputLen)};function Aa(e,t,n={}){let r=(t,n,r)=>{let i=ka[n];if(typeof i!=`function`)throw Error(`invalid validator function`);let a=e[t];if(!(r&&a===void 0)&&!i(a,e))throw Error(`param `+String(t)+` is invalid. Expected `+n+`, got `+a)};for(let[e,n]of Object.entries(t))r(e,n,!1);for(let[e,t]of Object.entries(n))r(e,t,!0);return e}var ja=()=>{throw Error(`not implemented`)};function Ma(e){let t=new WeakMap;return(n,...r)=>{let i=t.get(n);if(i!==void 0)return i;let a=e(n,...r);return t.set(n,a),a}}var Na=Object.freeze({__proto__:null,isBytes:ea,abytes:ta,abool:na,bytesToHex:ia,numberToHexUnpadded:aa,hexToNumber:oa,hexToBytes:la,bytesToNumberBE:ua,bytesToNumberLE:da,numberToBytesBE:fa,numberToBytesLE:pa,numberToVarBytesBE:ma,ensureBytes:ha,concatBytes:ga,equalBytes:_a,utf8ToBytes:va,inRange:ba,aInRange:xa,bitLen:Sa,bitGet:Ca,bitSet:wa,bitMask:Ta,createHmacDrbg:Oa,validateObject:Aa,notImplemented:ja,memoized:Ma}),Pa=BigInt(0),Fa=BigInt(1),Ia=BigInt(2),La=BigInt(3),Ra=BigInt(4),za=BigInt(5),Ba=BigInt(8);function Va(e,t){let n=e%t;return n>=Pa?n:t+n}function Ha(e,t,n){if(t<Pa)throw Error(`invalid exponent, negatives unsupported`);if(n<=Pa)throw Error(`invalid modulus`);if(n===Fa)return Pa;let r=Fa;for(;t>Pa;)t&Fa&&(r=r*e%n),e=e*e%n,t>>=Fa;return r}function Ua(e,t,n){let r=e;for(;t-- >Pa;)r*=r,r%=n;return r}function Wa(e,t){if(e===Pa)throw Error(`invert: expected non-zero number`);if(t<=Pa)throw Error(`invert: expected positive modulus, got `+t);let n=Va(e,t),r=t,i=Pa,a=Fa;for(;n!==Pa;){let e=r/n,t=r%n,o=i-a*e;r=n,n=t,i=a,a=o}if(r!==Fa)throw Error(`invert: does not exist`);return Va(i,t)}function Ga(e){let t=(e-Fa)/Ia,n,r,i;for(n=e-Fa,r=0;n%Ia===Pa;n/=Ia,r++);for(i=Ia;i<e&&Ha(i,t,e)!==e-Fa;i++)if(i>1e3)throw Error(`Cannot find square root: likely non-prime P`);if(r===1){let t=(e+Fa)/Ra;return function(e,n){let r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw Error(`Cannot find square root`);return r}}let a=(n+Fa)/Ia;return function(e,o){if(e.pow(o,t)===e.neg(e.ONE))throw Error(`Cannot find square root`);let s=r,c=e.pow(e.mul(e.ONE,i),n),l=e.pow(o,a),u=e.pow(o,n);for(;!e.eql(u,e.ONE);){if(e.eql(u,e.ZERO))return e.ZERO;let t=1;for(let n=e.sqr(u);t<s&&!e.eql(n,e.ONE);t++)n=e.sqr(n);let n=e.pow(c,Fa<<BigInt(s-t-1));c=e.sqr(n),l=e.mul(l,n),u=e.mul(u,c),s=t}return l}}function Ka(e){if(e%Ra===La){let t=(e+Fa)/Ra;return function(e,n){let r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw Error(`Cannot find square root`);return r}}if(e%Ba===za){let t=(e-za)/Ba;return function(e,n){let r=e.mul(n,Ia),i=e.pow(r,t),a=e.mul(n,i),o=e.mul(e.mul(a,Ia),i),s=e.mul(a,e.sub(o,e.ONE));if(!e.eql(e.sqr(s),n))throw Error(`Cannot find square root`);return s}}return Ga(e)}var qa=[`create`,`isValid`,`is0`,`neg`,`inv`,`sqrt`,`sqr`,`eql`,`add`,`sub`,`mul`,`pow`,`div`,`addN`,`subN`,`mulN`,`sqrN`];function Ja(e){return Aa(e,qa.reduce((e,t)=>(e[t]=`function`,e),{ORDER:`bigint`,MASK:`bigint`,BYTES:`isSafeInteger`,BITS:`isSafeInteger`}))}function Ya(e,t,n){if(n<Pa)throw Error(`invalid exponent, negatives unsupported`);if(n===Pa)return e.ONE;if(n===Fa)return t;let r=e.ONE,i=t;for(;n>Pa;)n&Fa&&(r=e.mul(r,i)),i=e.sqr(i),n>>=Fa;return r}function Xa(e,t){let n=Array(t.length),r=t.reduce((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r)),e.ONE),i=e.inv(r);return t.reduceRight((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r)),i),n}function Za(e,t){let n=t===void 0?e.toString(2).length:t;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function Qa(e,t,n=!1,r={}){if(e<=Pa)throw Error(`invalid field: expected ORDER > 0, got `+e);let{nBitLength:i,nByteLength:a}=Za(e,t);if(a>2048)throw Error(`invalid field: expected ORDER of <= 2048 bytes`);let o,s=Object.freeze({ORDER:e,isLE:n,BITS:i,BYTES:a,MASK:Ta(i),ZERO:Pa,ONE:Fa,create:t=>Va(t,e),isValid:t=>{if(typeof t!=`bigint`)throw Error(`invalid field element: expected bigint, got `+typeof t);return Pa<=t&&t<e},is0:e=>e===Pa,isOdd:e=>(e&Fa)===Fa,neg:t=>Va(-t,e),eql:(e,t)=>e===t,sqr:t=>Va(t*t,e),add:(t,n)=>Va(t+n,e),sub:(t,n)=>Va(t-n,e),mul:(t,n)=>Va(t*n,e),pow:(e,t)=>Ya(s,e,t),div:(t,n)=>Va(t*Wa(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>Wa(t,e),sqrt:r.sqrt||(t=>(o||=Ka(e),o(s,t))),invertBatch:e=>Xa(s,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?pa(e,a):fa(e,a),fromBytes:e=>{if(e.length!==a)throw Error(`Field.fromBytes: expected `+a+` bytes, got `+e.length);return n?da(e):ua(e)}});return Object.freeze(s)}function $a(e){if(typeof e!=`bigint`)throw Error(`field order must be bigint`);let t=e.toString(2).length;return Math.ceil(t/8)}function eo(e){let t=$a(e);return t+Math.ceil(t/2)}function to(e,t,n=!1){let r=e.length,i=$a(t),a=eo(t);if(r<16||r<a||r>1024)throw Error(`expected `+a+`-1024 bytes of input, got `+r);let o=Va(n?da(e):ua(e),t-Fa)+Fa;return n?pa(o,i):fa(o,i)}var no=BigInt(0),ro=BigInt(1);function io(e,t){let n=t.negate();return e?n:t}function ao(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error(`invalid window size, expected [1..`+t+`], got W=`+e)}function oo(e,t){return ao(e,t),{windows:Math.ceil(t/e)+1,windowSize:2**(e-1)}}function so(e,t){if(!Array.isArray(e))throw Error(`array expected`);e.forEach((e,n)=>{if(!(e instanceof t))throw Error(`invalid point at index `+n)})}function co(e,t){if(!Array.isArray(e))throw Error(`array of scalars expected`);e.forEach((e,n)=>{if(!t.isValid(e))throw Error(`invalid scalar at index `+n)})}var lo=new WeakMap,uo=new WeakMap;function fo(e){return uo.get(e)||1}function po(e,t){return{constTimeNegate:io,hasPrecomputes(e){return fo(e)!==1},unsafeLadder(t,n,r=e.ZERO){let i=t;for(;n>no;)n&ro&&(r=r.add(i)),i=i.double(),n>>=ro;return r},precomputeWindow(e,n){let{windows:r,windowSize:i}=oo(n,t),a=[],o=e,s=o;for(let e=0;e<r;e++){s=o,a.push(s);for(let e=1;e<i;e++)s=s.add(o),a.push(s);o=s.double()}return a},wNAF(n,r,i){let{windows:a,windowSize:o}=oo(n,t),s=e.ZERO,c=e.BASE,l=BigInt(2**n-1),u=2**n,d=BigInt(n);for(let e=0;e<a;e++){let t=e*o,n=Number(i&l);i>>=d,n>o&&(n-=u,i+=ro);let a=t,f=t+Math.abs(n)-1,p=e%2!=0,m=n<0;n===0?c=c.add(io(p,r[a])):s=s.add(io(m,r[f]))}return{p:s,f:c}},wNAFUnsafe(n,r,i,a=e.ZERO){let{windows:o,windowSize:s}=oo(n,t),c=BigInt(2**n-1),l=2**n,u=BigInt(n);for(let e=0;e<o;e++){let t=e*s;if(i===no)break;let n=Number(i&c);if(i>>=u,n>s&&(n-=l,i+=ro),n===0)continue;let o=r[t+Math.abs(n)-1];n<0&&(o=o.negate()),a=a.add(o)}return a},getPrecomputes(e,t,n){let r=lo.get(t);return r||(r=this.precomputeWindow(t,e),e!==1&&lo.set(t,n(r))),r},wNAFCached(e,t,n){let r=fo(e);return this.wNAF(r,this.getPrecomputes(r,e,n),t)},wNAFCachedUnsafe(e,t,n,r){let i=fo(e);return i===1?this.unsafeLadder(e,t,r):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),t,r)},setWindowSize(e,n){ao(n,t),uo.set(e,n),lo.delete(e)}}}function mo(e,t,n,r){if(so(n,e),co(r,t),n.length!==r.length)throw Error(`arrays of points and scalars must have equal length`);let i=e.ZERO,a=Sa(BigInt(n.length)),o=a>12?a-3:a>4?a-2:a?2:1,s=(1<<o)-1,c=Array(s+1).fill(i),l=Math.floor((t.BITS-1)/o)*o,u=i;for(let e=l;e>=0;e-=o){c.fill(i);for(let t=0;t<r.length;t++){let i=r[t],a=Number(i>>BigInt(e)&BigInt(s));c[a]=c[a].add(n[t])}let t=i;for(let e=c.length-1,n=i;e>0;e--)n=n.add(c[e]),t=t.add(n);if(u=u.add(t),e!==0)for(let e=0;e<o;e++)u=u.double()}return u}function ho(e){return Ja(e.Fp),Aa(e,{n:`bigint`,h:`bigint`,Gx:`field`,Gy:`field`},{nBitLength:`isSafeInteger`,nByteLength:`isSafeInteger`}),Object.freeze({...Za(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}var go=BigInt(0),_o=BigInt(1);function vo(e){return Aa(e,{a:`bigint`},{montgomeryBits:`isSafeInteger`,nByteLength:`isSafeInteger`,adjustScalarBytes:`function`,domain:`function`,powPminus2:`function`,Gu:`bigint`}),Object.freeze({...e})}function yo(e){let t=vo(e),{P:n}=t,r=e=>Va(e,n),i=t.montgomeryBits,a=Math.ceil(i/8),o=t.nByteLength,s=t.adjustScalarBytes||(e=>e),c=t.powPminus2||(e=>Ha(e,n-BigInt(2),n));function l(e,t,n){let i=r(e*(t-n));return t=r(t-i),n=r(n+i),[t,n]}let u=(t.a-BigInt(2))/BigInt(4);function d(e,t){xa(`u`,e,go,n),xa(`scalar`,t,go,n);let a=t,o=e,s=_o,d=go,f=e,p=_o,m=go,h;for(let e=BigInt(i-1);e>=go;e--){let t=a>>e&_o;m^=t,h=l(m,s,f),s=h[0],f=h[1],h=l(m,d,p),d=h[0],p=h[1],m=t;let n=s+d,i=r(n*n),c=s-d,g=r(c*c),_=i-g,v=f+p,y=r((f-p)*n),b=r(v*c),x=y+b,S=y-b;f=r(x*x),p=r(o*r(S*S)),s=r(i*g),d=r(_*(i+r(u*_)))}h=l(m,s,f),s=h[0],f=h[1],h=l(m,d,p),d=h[0],p=h[1];let g=c(d);return r(s*g)}function f(e){return pa(r(e),a)}function p(e){let t=ha(`u coordinate`,e,a);return o===32&&(t[31]&=127),da(t)}function m(e){let t=ha(`scalar`,e),n=t.length;if(n!==a&&n!==o){let e=``+a+` or `+o;throw Error(`invalid scalar, expected `+e+` bytes, got `+n)}return da(s(t))}function h(e,t){let n=d(p(t),m(e));if(n===go)throw Error(`invalid private or public key received`);return f(n)}let g=f(t.Gu);function _(e){return h(e,g)}return{scalarMult:h,scalarMultBase:_,getSharedSecret:(e,t)=>h(e,t),getPublicKey:e=>_(e),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:g}}var bo=BigInt(`57896044618658097711785492504343953926634992332820282019728792003956564819949`),xo=BigInt(1),So=BigInt(2),Co=BigInt(3),wo=BigInt(5);function To(e){let t=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),a=bo,o=e*e%a*e%a,s=Ua(Ua(o,So,a)*o%a,xo,a)*e%a,c=Ua(s,wo,a)*s%a,l=Ua(c,t,a)*c%a,u=Ua(l,n,a)*l%a,d=Ua(u,r,a)*u%a;return{pow_p_5_8:Ua(Ua(Ua(Ua(d,i,a)*d%a,i,a)*d%a,t,a)*c%a,So,a)*e%a,b2:o}}function Eo(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var Do=yo({P:bo,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{let t=bo,{pow_p_5_8:n,b2:r}=To(e);return Va(Ua(n,Co,t)*r,t)},adjustScalarBytes:Eo,randomBytes:qn});function Oo(e){e.lowS!==void 0&&na(`lowS`,e.lowS),e.prehash!==void 0&&na(`prehash`,e.prehash)}function ko(e){let t=ho(e);Aa(t,{a:`field`,b:`field`},{allowedPrivateKeyLengths:`array`,wrapPrivateKey:`boolean`,isTorsionFree:`function`,clearCofactor:`function`,allowInfinityPoint:`boolean`,fromBytes:`function`,toBytes:`function`});let{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw Error(`invalid endomorphism, can only be defined for Koblitz curves that have a=0`);if(typeof n!=`object`||typeof n.beta!=`bigint`||typeof n.splitScalar!=`function`)throw Error(`invalid endomorphism, expected beta: bigint and splitScalar: function`)}return Object.freeze({...t})}var{bytesToNumberBE:Ao,hexToBytes:jo}=Na,Mo={Err:class extends Error{constructor(e=``){super(e)}},_tlv:{encode:(e,t)=>{let{Err:n}=Mo;if(e<0||e>256)throw new n(`tlv.encode: wrong tag`);if(t.length&1)throw new n(`tlv.encode: unpadded data`);let r=t.length/2,i=aa(r);if(i.length/2&128)throw new n(`tlv.encode: long form length too big`);let a=r>127?aa(i.length/2|128):``;return aa(e)+a+i+t},decode(e,t){let{Err:n}=Mo,r=0;if(e<0||e>256)throw new n(`tlv.encode: wrong tag`);if(t.length<2||t[r++]!==e)throw new n(`tlv.decode: wrong tlv`);let i=t[r++],a=!!(i&128),o=0;if(!a)o=i;else{let e=i&127;if(!e)throw new n(`tlv.decode(long): indefinite length not supported`);if(e>4)throw new n(`tlv.decode(long): byte length is too big`);let a=t.subarray(r,r+e);if(a.length!==e)throw new n(`tlv.decode: length bytes not complete`);if(a[0]===0)throw new n(`tlv.decode(long): zero leftmost byte`);for(let e of a)o=o<<8|e;if(r+=e,o<128)throw new n(`tlv.decode(long): not minimal encoding`)}let s=t.subarray(r,r+o);if(s.length!==o)throw new n(`tlv.decode: wrong value length`);return{v:s,l:t.subarray(r+o)}}},_int:{encode(e){let{Err:t}=Mo;if(e<No)throw new t(`integer: negative integers are not allowed`);let n=aa(e);if(Number.parseInt(n[0],16)&8&&(n=`00`+n),n.length&1)throw new t(`unexpected DER parsing assertion: unpadded hex`);return n},decode(e){let{Err:t}=Mo;if(e[0]&128)throw new t(`invalid signature integer: negative`);if(e[0]===0&&!(e[1]&128))throw new t(`invalid signature integer: unnecessary leading zero`);return Ao(e)}},toSig(e){let{Err:t,_int:n,_tlv:r}=Mo,i=typeof e==`string`?jo(e):e;ta(i);let{v:a,l:o}=r.decode(48,i);if(o.length)throw new t(`invalid signature: left bytes after parsing`);let{v:s,l:c}=r.decode(2,a),{v:l,l:u}=r.decode(2,c);if(u.length)throw new t(`invalid signature: left bytes after parsing`);return{r:n.decode(s),s:n.decode(l)}},hexFromSig(e){let{_tlv:t,_int:n}=Mo,r=t.encode(2,n.encode(e.r))+t.encode(2,n.encode(e.s));return t.encode(48,r)}},No=BigInt(0),Po=BigInt(1),Fo=BigInt(3);function Io(e){let t=ko(e),{Fp:n}=t,r=Qa(t.n,t.nBitLength),i=t.toBytes||((e,t,r)=>{let i=t.toAffine();return ga(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),a=t.fromBytes||(e=>{let t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function o(e){let{a:r,b:i}=t,a=n.sqr(e),o=n.mul(a,e);return n.add(n.add(o,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),o(t.Gx)))throw Error(`bad generator point: equation left != right`);function s(e){return ba(e,Po,t.n)}function c(e){let{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:a}=t;if(n&&typeof e!=`bigint`){if(ea(e)&&(e=ia(e)),typeof e!=`string`||!n.includes(e.length))throw Error(`invalid private key`);e=e.padStart(r*2,`0`)}let o;try{o=typeof e==`bigint`?e:ua(ha(`private key`,e,r))}catch{throw Error(`invalid private key, expected hex or `+r+` bytes, got `+typeof e)}return i&&(o=Va(o,a)),xa(`private key`,o,Po,a),o}function l(e){if(!(e instanceof f))throw Error(`ProjectivePoint expected`)}let u=Ma((e,t)=>{let{px:r,py:i,pz:a}=e;if(n.eql(a,n.ONE))return{x:r,y:i};let o=e.is0();t??=o?n.ONE:n.inv(a);let s=n.mul(r,t),c=n.mul(i,t),l=n.mul(a,t);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(l,n.ONE))throw Error(`invZ was invalid`);return{x:s,y:c}}),d=Ma(e=>{if(e.is0()){if(t.allowInfinityPoint&&!n.is0(e.py))return;throw Error(`bad point: ZERO`)}let{x:r,y:i}=e.toAffine();if(!n.isValid(r)||!n.isValid(i))throw Error(`bad point: x or y not FE`);let a=n.sqr(i),s=o(r);if(!n.eql(a,s))throw Error(`bad point: equation left != right`);if(!e.isTorsionFree())throw Error(`bad point: not in prime-order subgroup`);return!0});class f{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,e==null||!n.isValid(e))throw Error(`x required`);if(t==null||!n.isValid(t))throw Error(`y required`);if(r==null||!n.isValid(r))throw Error(`z required`);Object.freeze(this)}static fromAffine(e){let{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw Error(`invalid affine point`);if(e instanceof f)throw Error(`projective point not allowed`);let i=e=>n.eql(e,n.ZERO);return i(t)&&i(r)?f.ZERO:new f(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){let t=n.invertBatch(e.map(e=>e.pz));return e.map((e,n)=>e.toAffine(t[n])).map(f.fromAffine)}static fromHex(e){let t=f.fromAffine(a(ha(`pointHex`,e)));return t.assertValidity(),t}static fromPrivateKey(e){return f.BASE.multiply(c(e))}static msm(e,t){return mo(f,r,e,t)}_setWindowSize(e){m.setWindowSize(this,e)}assertValidity(){d(this)}hasEvenY(){let{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw Error(`Field doesn't support isOdd`)}equals(e){l(e);let{px:t,py:r,pz:i}=this,{px:a,py:o,pz:s}=e,c=n.eql(n.mul(t,s),n.mul(a,i)),u=n.eql(n.mul(r,s),n.mul(o,i));return c&&u}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){let{a:e,b:r}=t,i=n.mul(r,Fo),{px:a,py:o,pz:s}=this,c=n.ZERO,l=n.ZERO,u=n.ZERO,d=n.mul(a,a),p=n.mul(o,o),m=n.mul(s,s),h=n.mul(a,o);return h=n.add(h,h),u=n.mul(a,s),u=n.add(u,u),c=n.mul(e,u),l=n.mul(i,m),l=n.add(c,l),c=n.sub(p,l),l=n.add(p,l),l=n.mul(c,l),c=n.mul(h,c),u=n.mul(i,u),m=n.mul(e,m),h=n.sub(d,m),h=n.mul(e,h),h=n.add(h,u),u=n.add(d,d),d=n.add(u,d),d=n.add(d,m),d=n.mul(d,h),l=n.add(l,d),m=n.mul(o,s),m=n.add(m,m),d=n.mul(m,h),c=n.sub(c,d),u=n.mul(m,p),u=n.add(u,u),u=n.add(u,u),new f(c,l,u)}add(e){l(e);let{px:r,py:i,pz:a}=this,{px:o,py:s,pz:c}=e,u=n.ZERO,d=n.ZERO,p=n.ZERO,m=t.a,h=n.mul(t.b,Fo),g=n.mul(r,o),_=n.mul(i,s),v=n.mul(a,c),y=n.add(r,i),b=n.add(o,s);y=n.mul(y,b),b=n.add(g,_),y=n.sub(y,b),b=n.add(r,a);let x=n.add(o,c);return b=n.mul(b,x),x=n.add(g,v),b=n.sub(b,x),x=n.add(i,a),u=n.add(s,c),x=n.mul(x,u),u=n.add(_,v),x=n.sub(x,u),p=n.mul(m,b),u=n.mul(h,v),p=n.add(u,p),u=n.sub(_,p),p=n.add(_,p),d=n.mul(u,p),_=n.add(g,g),_=n.add(_,g),v=n.mul(m,v),b=n.mul(h,b),_=n.add(_,v),v=n.sub(g,v),v=n.mul(m,v),b=n.add(b,v),g=n.mul(_,b),d=n.add(d,g),g=n.mul(x,b),u=n.mul(y,u),u=n.sub(u,g),g=n.mul(y,_),p=n.mul(x,p),p=n.add(p,g),new f(u,d,p)}subtract(e){return this.add(e.negate())}is0(){return this.equals(f.ZERO)}wNAF(e){return m.wNAFCached(this,e,f.normalizeZ)}multiplyUnsafe(e){let{endo:r,n:i}=t;xa(`scalar`,e,No,i);let a=f.ZERO;if(e===No)return a;if(this.is0()||e===Po)return this;if(!r||m.hasPrecomputes(this))return m.wNAFCachedUnsafe(this,e,f.normalizeZ);let{k1neg:o,k1:s,k2neg:c,k2:l}=r.splitScalar(e),u=a,d=a,p=this;for(;s>No||l>No;)s&Po&&(u=u.add(p)),l&Po&&(d=d.add(p)),p=p.double(),s>>=Po,l>>=Po;return o&&(u=u.negate()),c&&(d=d.negate()),d=new f(n.mul(d.px,r.beta),d.py,d.pz),u.add(d)}multiply(e){let{endo:r,n:i}=t;xa(`scalar`,e,Po,i);let a,o;if(r){let{k1neg:t,k1:i,k2neg:s,k2:c}=r.splitScalar(e),{p:l,f:u}=this.wNAF(i),{p:d,f:p}=this.wNAF(c);l=m.constTimeNegate(t,l),d=m.constTimeNegate(s,d),d=new f(n.mul(d.px,r.beta),d.py,d.pz),a=l.add(d),o=u.add(p)}else{let{p:t,f:n}=this.wNAF(e);a=t,o=n}return f.normalizeZ([a,o])[0]}multiplyAndAddUnsafe(e,t,n){let r=f.BASE,i=(e,t)=>t===No||t===Po||!e.equals(r)?e.multiplyUnsafe(t):e.multiply(t),a=i(this,t).add(i(e,n));return a.is0()?void 0:a}toAffine(e){return u(this,e)}isTorsionFree(){let{h:e,isTorsionFree:n}=t;if(e===Po)return!0;if(n)return n(f,this);throw Error(`isTorsionFree() has not been declared for the elliptic curve`)}clearCofactor(){let{h:e,clearCofactor:n}=t;return e===Po?this:n?n(f,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return na(`isCompressed`,e),this.assertValidity(),i(f,this,e)}toHex(e=!0){return na(`isCompressed`,e),ia(this.toRawBytes(e))}}f.BASE=new f(t.Gx,t.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);let p=t.nBitLength,m=po(f,t.endo?Math.ceil(p/2):p);return{CURVE:t,ProjectivePoint:f,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:s}}function Lo(e){let t=ho(e);return Aa(t,{hash:`hash`,hmac:`function`,randomBytes:`function`},{bits2int:`function`,bits2int_modN:`function`,lowS:`boolean`}),Object.freeze({lowS:!0,...t})}function Ro(e){let t=Lo(e),{Fp:n,n:r}=t,i=n.BYTES+1,a=2*n.BYTES+1;function o(e){return Va(e,r)}function s(e){return Wa(e,r)}let{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:d}=Io({...t,toBytes(e,t,r){let i=t.toAffine(),a=n.toBytes(i.x),o=ga;return na(`isCompressed`,r),r?o(Uint8Array.from([t.hasEvenY()?2:3]),a):o(Uint8Array.from([4]),a,n.toBytes(i.y))},fromBytes(e){let t=e.length,r=e[0],o=e.subarray(1);if(t===i&&(r===2||r===3)){let e=ua(o);if(!ba(e,Po,n.ORDER))throw Error(`Point is not on curve`);let t=u(e),i;try{i=n.sqrt(t)}catch(e){let t=e instanceof Error?`: `+e.message:``;throw Error(`Point is not on curve`+t)}let a=(i&Po)===Po;return(r&1)==1!==a&&(i=n.neg(i)),{x:e,y:i}}else if(t===a&&r===4)return{x:n.fromBytes(o.subarray(0,n.BYTES)),y:n.fromBytes(o.subarray(n.BYTES,2*n.BYTES))};else{let e=i,n=a;throw Error(`invalid Point, expected length of `+e+`, or uncompressed `+n+`, got `+t)}}}),f=e=>ia(fa(e,t.nByteLength));function p(e){return e>r>>Po}function m(e){return p(e)?o(-e):e}let h=(e,t,n)=>ua(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){let n=t.nByteLength;return e=ha(`compactSignature`,e,n*2),new g(h(e,0,n),h(e,n,2*n))}static fromDER(e){let{r:t,s:n}=Mo.toSig(ha(`DER`,e));return new g(t,n)}assertValidity(){xa(`r`,this.r,Po,r),xa(`s`,this.s,Po,r)}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){let{r,s:i,recovery:a}=this,l=S(ha(`msgHash`,e));if(a==null||![0,1,2,3].includes(a))throw Error(`recovery id invalid`);let u=a===2||a===3?r+t.n:r;if(u>=n.ORDER)throw Error(`recovery id 2 or 3 invalid`);let d=a&1?`03`:`02`,p=c.fromHex(d+f(u)),m=s(u),h=o(-l*m),g=o(i*m),_=c.BASE.multiplyAndAddUnsafe(p,h,g);if(!_)throw Error(`point at infinify`);return _.assertValidity(),_}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return la(this.toDERHex())}toDERHex(){return Mo.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return la(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}let _={isValidPrivateKey(e){try{return l(e),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{let e=eo(t.n);return to(t.randomBytes(e),t.n)},precompute(e=8,t=c.BASE){return t._setWindowSize(e),t.multiply(BigInt(3)),t}};function v(e,t=!0){return c.fromPrivateKey(e).toRawBytes(t)}function y(e){let t=ea(e),n=typeof e==`string`,r=(t||n)&&e.length;return t?r===i||r===a:n?r===2*i||r===2*a:e instanceof c}function b(e,t,n=!0){if(y(e))throw Error(`first arg must be private key`);if(!y(t))throw Error(`second arg must be public key`);return c.fromHex(t).multiply(l(e)).toRawBytes(n)}let x=t.bits2int||function(e){if(e.length>8192)throw Error(`input is too large`);let n=ua(e),r=e.length*8-t.nBitLength;return r>0?n>>BigInt(r):n},S=t.bits2int_modN||function(e){return o(x(e))},C=Ta(t.nBitLength);function w(e){return xa(`num < 2^`+t.nBitLength,e,No,C),fa(e,t.nByteLength)}function T(e,r,i=E){if([`recovered`,`canonical`].some(e=>e in i))throw Error(`sign() legacy options not supported`);let{hash:a,randomBytes:u}=t,{lowS:f,prehash:h,extraEntropy:_}=i;f??=!0,e=ha(`msgHash`,e),Oo(i),h&&(e=ha(`prehashed msgHash`,a(e)));let v=S(e),y=l(r),b=[w(y),w(v)];if(_!=null&&_!==!1){let e=_===!0?u(n.BYTES):_;b.push(ha(`extraEntropy`,e))}let C=ga(...b),T=v;function D(e){let t=x(e);if(!d(t))return;let n=s(t),r=c.BASE.multiply(t).toAffine(),i=o(r.x);if(i===No)return;let a=o(n*o(T+i*y));if(a===No)return;let l=(r.x===i?0:2)|Number(r.y&Po),u=a;return f&&p(a)&&(u=m(a),l^=1),new g(i,u,l)}return{seed:C,k2sig:D}}let E={lowS:t.lowS,prehash:!1},D={lowS:t.lowS,prehash:!1};function O(e,n,r=E){let{seed:i,k2sig:a}=T(e,n,r),o=t;return Oa(o.hash.outputLen,o.nByteLength,o.hmac)(i,a)}c.BASE._setWindowSize(8);function k(e,n,r,i=D){let a=e;n=ha(`msgHash`,n),r=ha(`publicKey`,r);let{lowS:l,prehash:u,format:d}=i;if(Oo(i),`strict`in i)throw Error(`options.strict was renamed to lowS`);if(d!==void 0&&d!==`compact`&&d!==`der`)throw Error(`format must be compact or der`);let f=typeof a==`string`||ea(a),p=!f&&!d&&typeof a==`object`&&!!a&&typeof a.r==`bigint`&&typeof a.s==`bigint`;if(!f&&!p)throw Error(`invalid signature, expected Uint8Array, hex string or Signature instance`);let m,h;try{if(p&&(m=new g(a.r,a.s)),f){try{d!==`compact`&&(m=g.fromDER(a))}catch(e){if(!(e instanceof Mo.Err))throw e}!m&&d!==`der`&&(m=g.fromCompact(a))}h=c.fromHex(r)}catch{return!1}if(!m||l&&m.hasHighS())return!1;u&&(n=t.hash(n));let{r:_,s:v}=m,y=S(n),b=s(v),x=o(y*b),C=o(_*b),w=c.BASE.multiplyAndAddUnsafe(h,x,C)?.toAffine();return w?o(w.x)===_:!1}return{CURVE:t,getPublicKey:v,getSharedSecret:b,sign:O,verify:k,ProjectivePoint:c,Signature:g,utils:_}}function zo(e){return{hash:e,hmac:(t,...n)=>Ii(e,t,Wn(...n)),randomBytes:qn}}function Bo(e,t){let n=t=>Ro({...e,...zo(t)});return{...n(t),create:n}}var Vo=Qa(BigInt(`0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff`)),Ho=Bo({a:Vo.create(BigInt(`-3`)),b:BigInt(`0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b`),Fp:Vo,n:BigInt(`0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551`),Gx:BigInt(`0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296`),Gy:BigInt(`0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5`),h:BigInt(1),lowS:!1},Xi),Uo=`base10`,Wo=`base16`,Go=`base64pad`,Ko=`base64url`,qo=`utf8`,Jo=0,Yo=1,Xo=12,Zo=32;function Qo(){let e=Do.utils.randomPrivateKey(),t=Do.getPublicKey(e);return{privateKey:g(e,Wo),publicKey:g(t,Wo)}}function $o(){return g(qn(Zo),Wo)}function es(e,t){return g(Vi(Xi,Do.getSharedSecret(u(e,Wo),u(t,Wo)),void 0,void 0,Zo),Wo)}function ts(e){return g(Xi(u(e,Wo)),Wo)}function ns(e){return g(Xi(u(e,qo)),Wo)}function rs(e){return u(`${e}`,Uo)}function is(e){return Number(g(e,Uo))}function as(e){return e.replace(/\+/g,`-`).replace(/\//g,`_`).replace(/=/g,``)}function os(e){let t=e.replace(/-/g,`+`).replace(/_/g,`/`),n=(4-t.length%4)%4;return t+`=`.repeat(n)}function ss(e){let t=rs(typeof e.type<`u`?e.type:0);if(is(t)===1&&typeof e.senderPublicKey>`u`)throw Error(`Missing sender public key for type 1 envelope`);let n=typeof e.senderPublicKey<`u`?u(e.senderPublicKey,Wo):void 0,r=typeof e.iv<`u`?u(e.iv,Wo):qn(Xo),i=ds({type:t,sealed:Pi(u(e.symKey,Wo),r).encrypt(u(e.message,qo)),iv:r,senderPublicKey:n});return e.encoding===`base64url`?as(i):i}function cs(e){let t=u(e.symKey,Wo),{sealed:n,iv:r}=fs({encoded:e.encoded,encoding:e.encoding}),i=Pi(t,r).decrypt(n);if(i===null)throw Error(`Failed to decrypt`);return g(i,qo)}function ls(e,t){let n=rs(2),r=qn(Xo),i=ds({type:n,sealed:u(e,qo),iv:r});return t===`base64url`?as(i):i}function us(e,t){let{sealed:n}=fs({encoded:e,encoding:t});return g(n,qo)}function ds(e){if(is(e.type)===2)return g(i([e.type,e.sealed]),Go);if(is(e.type)===1){if(typeof e.senderPublicKey>`u`)throw Error(`Missing sender public key for type 1 envelope`);return g(i([e.type,e.senderPublicKey,e.iv,e.sealed]),Go)}return g(i([e.type,e.iv,e.sealed]),Go)}function fs(e){let t=u((e.encoding||`base64pad`)===`base64url`?os(e.encoded):e.encoded,Go),n=t.slice(Jo,Yo),r=Yo;if(is(n)===1){let e=r+Zo,i=e+Xo,a=t.slice(r,e),o=t.slice(e,i);return{type:n,sealed:t.slice(i),iv:o,senderPublicKey:a}}if(is(n)===2)return{type:n,sealed:t.slice(r),iv:qn(Xo)};let i=r+Xo,a=t.slice(r,i);return{type:n,sealed:t.slice(i),iv:a}}function ps(e,t){let n=fs({encoded:e,encoding:t?.encoding});return ms({type:is(n.type),senderPublicKey:typeof n.senderPublicKey<`u`?g(n.senderPublicKey,Wo):void 0,receiverPublicKey:t?.receiverPublicKey})}function ms(e){let t=e?.type||0;if(t===1){if(typeof e?.senderPublicKey>`u`)throw Error(`missing sender public key`);if(typeof e?.receiverPublicKey>`u`)throw Error(`missing receiver public key`)}return{type:t,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function hs(e){return e.type===1&&typeof e.senderPublicKey==`string`&&typeof e.receiverPublicKey==`string`}function gs(e){return e.type===2}function _s(e){let t=Buffer.from(e.x,`base64`),n=Buffer.from(e.y,`base64`);return i([new Uint8Array([4]),t,n])}function vs(e,t){let[n,r,a]=e.split(`.`),o=Buffer.from(os(a),`base64`);if(o.length!==64)throw Error(`Invalid signature length`);let c=o.slice(0,32),l=o.slice(32,64),u=Xi(`${n}.${r}`),d=_s(t);if(!Ho.verify(i([c,l]),u,d))throw Error(`Invalid signature`);return s(e).payload}function ys(e){return e?.relay||{protocol:`irn`}}function bs(e){let t=p[e];if(typeof t>`u`)throw Error(`Relay Protocol not supported: ${e}`);return t}function xs(e,t=`-`){let n={},r=`relay`+t;return Object.keys(e).forEach(t=>{if(t.startsWith(r)){let i=t.replace(r,``);n[i]=e[t]}}),n}function Ss(e){if(!e.includes(`wc:`)){let t=yn(e);t!=null&&t.includes(`wc:`)&&(e=t)}e=e.includes(`wc://`)?e.replace(`wc://`,``):e,e=e.includes(`wc:`)?e.replace(`wc:`,``):e;let t=e.indexOf(`:`),n=e.indexOf(`?`)===-1?void 0:e.indexOf(`?`),r=e.substring(0,t),i=e.substring(t+1,n).split(`@`),a=typeof n<`u`?e.substring(n):``,o=new URLSearchParams(a),s={};o.forEach((e,t)=>{s[t]=e});let c=typeof s.methods==`string`?s.methods.split(`,`):void 0;return{protocol:r,topic:Cs(i[0]),version:parseInt(i[1],10),symKey:s.symKey,relay:xs(s),methods:c,expiryTimestamp:s.expiryTimestamp?parseInt(s.expiryTimestamp,10):void 0}}function Cs(e){return e.startsWith(`//`)?e.substring(2):e}function ws(e,t=`-`){let n={};return Object.keys(e).forEach(r=>{let i=r,a=`relay`+t+i;e[i]&&(n[a]=e[i])}),n}function Ts(e){let t=new URLSearchParams,n=ws(e.relay);Object.keys(n).sort().forEach(e=>{t.set(e,n[e])}),t.set(`symKey`,e.symKey),e.expiryTimestamp&&t.set(`expiryTimestamp`,e.expiryTimestamp.toString()),e.methods&&t.set(`methods`,e.methods.join(`,`));let r=t.toString();return`${e.protocol}:${e.topic}@${e.version}?${r}`}function Es(e,t,n){return`${e}?wc_ev=${n}&topic=${t}`}var Ds=Object.defineProperty,Os=Object.defineProperties,ks=Object.getOwnPropertyDescriptors,As=Object.getOwnPropertySymbols,js=Object.prototype.hasOwnProperty,Ms=Object.prototype.propertyIsEnumerable,Ns=(e,t,n)=>t in e?Ds(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ps=(e,t)=>{for(var n in t||={})js.call(t,n)&&Ns(e,n,t[n]);if(As)for(var n of As(t))Ms.call(t,n)&&Ns(e,n,t[n]);return e},Fs=(e,t)=>Os(e,ks(t));function Is(e){let t=[];return e.forEach(e=>{let[n,r]=e.split(`:`);t.push(`${n}:${r}`)}),t}function Ls(e){let t=[];return Object.values(e).forEach(e=>{t.push(...Is(e.accounts))}),t}function Rs(e,t){let n=[];return Object.values(e).forEach(e=>{Is(e.accounts).includes(t)&&n.push(...e.methods)}),n}function zs(e,t){let n=[];return Object.values(e).forEach(e=>{Is(e.accounts).includes(t)&&n.push(...e.events)}),n}function Bs(e){return e.includes(`:`)}function Vs(e){return Bs(e)?e.split(`:`)[0]:e}function Hs(e){let t={};if(!Ys(e))return t;for(let[n,r]of Object.entries(e)){let e=Bs(n)?[n]:r.chains,i=r.methods||[],a=r.events||[],o=Vs(n);t[o]=Fs(Ps({},t[o]),{chains:cn(e,t[o]?.chains),methods:cn(i,t[o]?.methods),events:cn(a,t[o]?.events)})}return t}function Us(e){let t={};return e?.forEach(e=>{var n;let[r,i]=e.split(`:`);t[r]||(t[r]={accounts:[],chains:[],events:[],methods:[]}),t[r].accounts.push(e),(n=t[r].chains)==null||n.push(`${r}:${i}`)}),t}function Ws(e,t){t=t.map(e=>e.replace(`did:pkh:`,``));let n=Us(t);for(let[t,r]of Object.entries(n))r.methods?r.methods=cn(r.methods,e):r.methods=e,r.events=[`chainChanged`,`accountsChanged`];return n}function Gs(e,t){let n=Hs(e),r=Hs(t),i={},a=Object.keys(n).concat(Object.keys(r));for(let e of a)i[e]={chains:cn(n[e]?.chains,r[e]?.chains),methods:cn(n[e]?.methods,r[e]?.methods),events:cn(n[e]?.events,r[e]?.events)};return i}var Ks={INVALID_METHOD:{message:`Invalid method.`,code:1001},INVALID_EVENT:{message:`Invalid event.`,code:1002},INVALID_UPDATE_REQUEST:{message:`Invalid update request.`,code:1003},INVALID_EXTEND_REQUEST:{message:`Invalid extend request.`,code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:`Invalid session settle request.`,code:1005},UNAUTHORIZED_METHOD:{message:`Unauthorized method.`,code:3001},UNAUTHORIZED_EVENT:{message:`Unauthorized event.`,code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:`Unauthorized update request.`,code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:`Unauthorized extend request.`,code:3004},USER_REJECTED:{message:`User rejected.`,code:5e3},USER_REJECTED_CHAINS:{message:`User rejected chains.`,code:5001},USER_REJECTED_METHODS:{message:`User rejected methods.`,code:5002},USER_REJECTED_EVENTS:{message:`User rejected events.`,code:5003},UNSUPPORTED_CHAINS:{message:`Unsupported chains.`,code:5100},UNSUPPORTED_METHODS:{message:`Unsupported methods.`,code:5101},UNSUPPORTED_EVENTS:{message:`Unsupported events.`,code:5102},UNSUPPORTED_ACCOUNTS:{message:`Unsupported accounts.`,code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:`Unsupported namespace key.`,code:5104},USER_DISCONNECTED:{message:`User disconnected.`,code:6e3},SESSION_SETTLEMENT_FAILED:{message:`Session settlement failed.`,code:7e3},WC_METHOD_UNSUPPORTED:{message:`Unsupported wc_ method.`,code:10001}},qs={NOT_INITIALIZED:{message:`Not initialized.`,code:1},NO_MATCHING_KEY:{message:`No matching key.`,code:2},RESTORE_WILL_OVERRIDE:{message:`Restore will override.`,code:3},RESUBSCRIBED:{message:`Resubscribed.`,code:4},MISSING_OR_INVALID:{message:`Missing or invalid.`,code:5},EXPIRED:{message:`Expired.`,code:6},UNKNOWN_TYPE:{message:`Unknown type.`,code:7},MISMATCHED_TOPIC:{message:`Mismatched topic.`,code:8},NON_CONFORMING_NAMESPACES:{message:`Non conforming namespaces.`,code:9}};function V(e,t){let{message:n,code:r}=qs[e];return{message:t?`${n} ${t}`:n,code:r}}function H(e,t){let{message:n,code:r}=Ks[e];return{message:t?`${n} ${t}`:n,code:r}}function Js(e,t){return Array.isArray(e)?typeof t<`u`&&e.length?e.every(t):!0:!1}function Ys(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function Xs(e){return typeof e>`u`}function Zs(e,t){return t&&Xs(e)?!0:typeof e==`string`&&!!e.trim().length}function Qs(e,t){return t&&Xs(e)?!0:typeof e==`number`&&!isNaN(e)}function $s(e,t){let{requiredNamespaces:n}=t,r=Object.keys(e.namespaces),i=Object.keys(n),a=!0;return Xt(i,r)?(r.forEach(t=>{let{accounts:r,methods:i,events:o}=e.namespaces[t],s=Is(r),c=n[t];(!Xt(Tt(t,c),s)||!Xt(c.methods,i)||!Xt(c.events,o))&&(a=!1)}),a):!1}function ec(e){return Zs(e,!1)&&e.includes(`:`)?e.split(`:`).length===2:!1}function tc(e){if(Zs(e,!1)&&e.includes(`:`)){let t=e.split(`:`);if(t.length===3){let e=t[0]+`:`+t[1];return!!t[2]&&ec(e)}}return!1}function nc(e){function t(e){try{return typeof new URL(e)<`u`}catch{return!1}}try{if(Zs(e,!1))return t(e)?!0:t(yn(e))}catch{}return!1}function rc(e){return e?.proposer?.publicKey}function ic(e){return e?.topic}function ac(e,t){let n=null;return Zs(e?.publicKey,!1)||(n=V(`MISSING_OR_INVALID`,`${t} controller public key should be a string`)),n}function oc(e){let t=!0;return Js(e)?e.length&&(t=e.every(e=>Zs(e,!1))):t=!1,t}function sc(e,t,n){let r=null;return Js(t)&&t.length?t.forEach(e=>{r||ec(e)||(r=H(`UNSUPPORTED_CHAINS`,`${n}, chain ${e} should be a string and conform to "namespace:chainId" format`))}):ec(e)||(r=H(`UNSUPPORTED_CHAINS`,`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function cc(e,t,n){let r=null;return Object.entries(e).forEach(([e,i])=>{if(r)return;let a=sc(e,Tt(e,i),`${t} ${n}`);a&&(r=a)}),r}function lc(e,t){let n=null;return Js(e)?e.forEach(e=>{n||tc(e)||(n=H(`UNSUPPORTED_ACCOUNTS`,`${t}, account ${e} should be a string and conform to "namespace:chainId:address" format`))}):n=H(`UNSUPPORTED_ACCOUNTS`,`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function uc(e,t){let n=null;return Object.values(e).forEach(e=>{if(n)return;let r=lc(e?.accounts,`${t} namespace`);r&&(n=r)}),n}function dc(e,t){let n=null;return oc(e?.methods)?oc(e?.events)||(n=H(`UNSUPPORTED_EVENTS`,`${t}, events should be an array of strings or empty array for no events`)):n=H(`UNSUPPORTED_METHODS`,`${t}, methods should be an array of strings or empty array for no methods`),n}function fc(e,t){let n=null;return Object.values(e).forEach(e=>{if(n)return;let r=dc(e,`${t}, namespace`);r&&(n=r)}),n}function pc(e,t,n){let r=null;if(e&&Ys(e)){let i=fc(e,t);i&&(r=i);let a=cc(e,t,n);a&&(r=a)}else r=V(`MISSING_OR_INVALID`,`${t}, ${n} should be an object with data`);return r}function mc(e,t){let n=null;if(e&&Ys(e)){let r=fc(e,t);r&&(n=r);let i=uc(e,t);i&&(n=i)}else n=V(`MISSING_OR_INVALID`,`${t}, namespaces should be an object with data`);return n}function hc(e){return Zs(e.protocol,!0)}function gc(e,t){let n=!1;return t&&!e?n=!0:e&&Js(e)&&e.length&&e.forEach(e=>{n=hc(e)}),n}function _c(e){return typeof e==`number`}function vc(e){return typeof e<`u`&&!0}function yc(e){return!(!e||typeof e!=`object`||!e.code||!Qs(e.code,!1)||!e.message||!Zs(e.message,!1))}function bc(e){return!(Xs(e)||!Zs(e.method,!1))}function xc(e){return!(Xs(e)||Xs(e.result)&&Xs(e.error)||!Qs(e.id,!1)||!Zs(e.jsonrpc,!1))}function Sc(e){return!(Xs(e)||!Zs(e.name,!1))}function Cc(e,t){return!(!ec(t)||!Ls(e).includes(t))}function wc(e,t,n){return Zs(n,!1)?Rs(e,t).includes(n):!1}function Tc(e,t,n){return Zs(n,!1)?zs(e,t).includes(n):!1}function Ec(e,t,n){let r=null,i=Dc(e),a=kc(t),o=Object.keys(i),s=Object.keys(a),c=Oc(Object.keys(e)),l=Oc(Object.keys(t)),u=c.filter(e=>!l.includes(e));return u.length&&(r=V(`NON_CONFORMING_NAMESPACES`,`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(t).toString()}`)),Xt(o,s)||(r=V(`NON_CONFORMING_NAMESPACES`,`${n} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${s.toString()}`)),Object.keys(t).forEach(e=>{if(!e.includes(`:`)||r)return;let i=Is(t[e].accounts);i.includes(e)||(r=V(`NON_CONFORMING_NAMESPACES`,`${n} namespaces accounts don't satisfy namespace accounts for ${e}
        Required: ${e}
        Approved: ${i.toString()}`))}),o.forEach(e=>{r||(Xt(i[e].methods,a[e].methods)?Xt(i[e].events,a[e].events)||(r=V(`NON_CONFORMING_NAMESPACES`,`${n} namespaces events don't satisfy namespace events for ${e}`)):r=V(`NON_CONFORMING_NAMESPACES`,`${n} namespaces methods don't satisfy namespace methods for ${e}`))}),r}function Dc(e){let t={};return Object.keys(e).forEach(n=>{var r;n.includes(`:`)?t[n]=e[n]:(r=e[n].chains)==null||r.forEach(r=>{t[r]={methods:e[n].methods,events:e[n].events}})}),t}function Oc(e){return[...new Set(e.map(e=>e.includes(`:`)?e.split(`:`)[0]:e))]}function kc(e){let t={};return Object.keys(e).forEach(n=>{n.includes(`:`)?t[n]=e[n]:Is(e[n].accounts)?.forEach(r=>{t[r]={accounts:e[n].accounts.filter(e=>e.includes(`${r}:`)),methods:e[n].methods,events:e[n].events}})}),t}function Ac(e,t){return Qs(e,!1)&&e<=t.max&&e>=t.min}function jc(){let e=Vt();return new Promise(t=>{switch(e){case Ft.browser:t(Mc());break;case Ft.reactNative:t(Nc());break;case Ft.node:t(Pc());break;default:t(!0)}})}function Mc(){return Bt()&&navigator?.onLine}async function Nc(){return Lt()&&typeof global<`u`&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function Pc(){return!0}function Fc(e){switch(Vt()){case Ft.browser:Ic(e);break;case Ft.reactNative:Lc(e);break;case Ft.node:break}}function Ic(e){!Lt()&&Bt()&&(window.addEventListener(`online`,()=>e(!0)),window.addEventListener(`offline`,()=>e(!1)))}function Lc(e){Lt()&&typeof global<`u`&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(t=>e(t?.isConnected))}function Rc(){return Bt()&&(0,vt.getDocument)()?(0,vt.getDocument)()?.visibilityState===`visible`:!0}var zc={},Bc=class{static get(e){return zc[e]}static set(e,t){zc[e]=t}static delete(e){delete zc[e]}},Vc=Object.defineProperty,Hc=(e,t,n)=>t in e?Vc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Uc=(e,t,n)=>Hc(e,typeof t==`symbol`?t:t+``,n),Wc=class extends c{constructor(e){super(),this.opts=e,Uc(this,`protocol`,`wc`),Uc(this,`version`,2)}},Gc=Object.defineProperty,Kc=(e,t,n)=>t in e?Gc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,qc=(e,t,n)=>Kc(e,typeof t==`symbol`?t:t+``,n),Jc=class extends c{constructor(e,t){super(),this.core=e,this.logger=t,qc(this,`records`,new Map)}},Yc=class{constructor(e,t){this.logger=e,this.core=t}},Xc=class extends c{constructor(e,t){super(),this.relayer=e,this.logger=t}},Zc=class extends c{constructor(e){super()}},Qc=class{constructor(e,t,n,r){this.core=e,this.logger=t,this.name=n}},$c=class extends c{constructor(e,t){super(),this.relayer=e,this.logger=t}},el=class extends c{constructor(e,t){super(),this.core=e,this.logger=t}},tl=class{constructor(e,t,n){this.core=e,this.logger=t,this.store=n}},nl=class{constructor(e,t){this.projectId=e,this.logger=t}},rl=class{constructor(e,t,n){this.core=e,this.logger=t,this.telemetryEnabled=n}},il=Object.defineProperty,al=(e,t,n)=>t in e?il(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ol=(e,t,n)=>al(e,typeof t==`symbol`?t:t+``,n),sl=class{constructor(e){this.opts=e,ol(this,`protocol`,`wc`),ol(this,`version`,2)}},cl=class{constructor(e){this.client=e}},ll=t(n()),U=r(),ul=_(),dl=`core`,fl=`wc@2:${dl}:`,pl={name:dl,logger:`error`},ml={database:`:memory:`},hl=`crypto`,gl=`client_ed25519_seed`,_l=U.ONE_DAY,vl=`keychain`,yl=`messages`,bl=U.SIX_HOURS,xl=`publisher`,Sl=`relayer`,Cl={message:`relayer_message`,message_ack:`relayer_message_ack`,connect:`relayer_connect`,disconnect:`relayer_disconnect`,error:`relayer_error`,connection_stalled:`relayer_connection_stalled`,transport_closed:`relayer_transport_closed`,publish:`relayer_publish`},wl={payload:`payload`,connect:`connect`,disconnect:`disconnect`,error:`error`},Tl=`2.21.1`,W={link_mode:`link_mode`,relay:`relay`},El={inbound:`inbound`,outbound:`outbound`},Dl=`WALLETCONNECT_CLIENT_ID`,Ol={created:`subscription_created`,deleted:`subscription_deleted`,expired:`subscription_expired`,disabled:`subscription_disabled`,sync:`subscription_sync`,resubscribed:`subscription_resubscribed`};U.THIRTY_DAYS;var kl=`subscription`;U.FIVE_SECONDS*1e3;var Al=`pairing`;U.THIRTY_DAYS;var jl={wc_pairingDelete:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:U.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:U.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:U.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:U.ONE_DAY,prompt:!1,tag:0},res:{ttl:U.ONE_DAY,prompt:!1,tag:0}}},Ml={create:`pairing_create`,expire:`pairing_expire`,delete:`pairing_delete`,ping:`pairing_ping`},Nl={created:`history_created`,updated:`history_updated`,deleted:`history_deleted`,sync:`history_sync`},Pl=`history`,Fl=`expirer`,Il={created:`expirer_created`,deleted:`expirer_deleted`,expired:`expirer_expired`,sync:`expirer_sync`};U.ONE_DAY;var Ll=`verify-api`,Rl=`https://verify.walletconnect.com`,zl=`https://verify.walletconnect.org`,Bl=`${zl}/v3`,Vl=[Rl,zl],Hl=`echo`,Ul=`https://echo.walletconnect.com`,Wl={pairing_started:`pairing_started`,pairing_uri_validation_success:`pairing_uri_validation_success`,pairing_uri_not_expired:`pairing_uri_not_expired`,store_new_pairing:`store_new_pairing`,subscribing_pairing_topic:`subscribing_pairing_topic`,subscribe_pairing_topic_success:`subscribe_pairing_topic_success`,existing_pairing:`existing_pairing`,pairing_not_expired:`pairing_not_expired`,emit_inactive_pairing:`emit_inactive_pairing`,emit_session_proposal:`emit_session_proposal`,subscribing_to_pairing_topic:`subscribing_to_pairing_topic`},Gl={no_wss_connection:`no_wss_connection`,no_internet_connection:`no_internet_connection`,malformed_pairing_uri:`malformed_pairing_uri`,active_pairing_already_exists:`active_pairing_already_exists`,subscribe_pairing_topic_failure:`subscribe_pairing_topic_failure`,pairing_expired:`pairing_expired`,proposal_expired:`proposal_expired`,proposal_listener_not_found:`proposal_listener_not_found`},Kl={session_approve_started:`session_approve_started`,proposal_not_expired:`proposal_not_expired`,session_namespaces_validation_success:`session_namespaces_validation_success`,create_session_topic:`create_session_topic`,subscribing_session_topic:`subscribing_session_topic`,subscribe_session_topic_success:`subscribe_session_topic_success`,publishing_session_approve:`publishing_session_approve`,session_approve_publish_success:`session_approve_publish_success`,store_session:`store_session`,publishing_session_settle:`publishing_session_settle`,session_settle_publish_success:`session_settle_publish_success`},ql={no_internet_connection:`no_internet_connection`,no_wss_connection:`no_wss_connection`,proposal_expired:`proposal_expired`,subscribe_session_topic_failure:`subscribe_session_topic_failure`,session_approve_publish_failure:`session_approve_publish_failure`,session_settle_publish_failure:`session_settle_publish_failure`,session_approve_namespace_validation_failure:`session_approve_namespace_validation_failure`,proposal_not_found:`proposal_not_found`},Jl={authenticated_session_approve_started:`authenticated_session_approve_started`,authenticated_session_not_expired:`authenticated_session_not_expired`,chains_caip2_compliant:`chains_caip2_compliant`,chains_evm_compliant:`chains_evm_compliant`,create_authenticated_session_topic:`create_authenticated_session_topic`,cacaos_verified:`cacaos_verified`,store_authenticated_session:`store_authenticated_session`,subscribing_authenticated_session_topic:`subscribing_authenticated_session_topic`,subscribe_authenticated_session_topic_success:`subscribe_authenticated_session_topic_success`,publishing_authenticated_session_approve:`publishing_authenticated_session_approve`,authenticated_session_approve_publish_success:`authenticated_session_approve_publish_success`},Yl={no_internet_connection:`no_internet_connection`,no_wss_connection:`no_wss_connection`,missing_session_authenticate_request:`missing_session_authenticate_request`,session_authenticate_request_expired:`session_authenticate_request_expired`,chains_caip2_compliant_failure:`chains_caip2_compliant_failure`,chains_evm_compliant_failure:`chains_evm_compliant_failure`,invalid_cacao:`invalid_cacao`,subscribe_authenticated_session_topic_failure:`subscribe_authenticated_session_topic_failure`,authenticated_session_approve_publish_failure:`authenticated_session_approve_publish_failure`,authenticated_session_pending_request_not_found:`authenticated_session_pending_request_not_found`},Xl=.1,Zl=`event-client`,Ql=`https://pulse.walletconnect.org/batch`;function $l(e,t){if(e.length>=255)throw TypeError(`Alphabet too long`);for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var a=e.charAt(i),o=a.charCodeAt(0);if(n[o]!==255)throw TypeError(a+` is ambiguous`);n[o]=i}var s=e.length,c=e.charAt(0),l=Math.log(s)/Math.log(256),u=Math.log(256)/Math.log(s);function d(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError(`Expected Uint8Array`);if(t.length===0)return``;for(var n=0,r=0,i=0,a=t.length;i!==a&&t[i]===0;)i++,n++;for(var o=(a-i)*u+1>>>0,l=new Uint8Array(o);i!==a;){for(var d=t[i],f=0,p=o-1;(d!==0||f<r)&&p!==-1;p--,f++)d+=256*l[p]>>>0,l[p]=d%s>>>0,d=d/s>>>0;if(d!==0)throw Error(`Non-zero carry`);r=f,i++}for(var m=o-r;m!==o&&l[m]===0;)m++;for(var h=c.repeat(n);m<o;++m)h+=e.charAt(l[m]);return h}function f(e){if(typeof e!=`string`)throw TypeError(`Expected String`);if(e.length===0)return new Uint8Array;var t=0;if(e[t]!==` `){for(var r=0,i=0;e[t]===c;)r++,t++;for(var a=(e.length-t)*l+1>>>0,o=new Uint8Array(a);e[t];){var u=n[e.charCodeAt(t)];if(u===255)return;for(var d=0,f=a-1;(u!==0||d<i)&&f!==-1;f--,d++)u+=s*o[f]>>>0,o[f]=u%256>>>0,u=u/256>>>0;if(u!==0)throw Error(`Non-zero carry`);i=d,t++}if(e[t]!==` `){for(var p=a-i;p!==a&&o[p]===0;)p++;for(var m=new Uint8Array(r+(a-p)),h=r;p!==a;)m[h++]=o[p++];return m}}}function p(e){var n=f(e);if(n)return n;throw Error(`Non-${t} character`)}return{encode:d,decodeUnsafe:f,decode:p}}var eu=$l,tu=e=>{if(e instanceof Uint8Array&&e.constructor.name===`Uint8Array`)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error(`Unknown type, must be binary type`)},nu=e=>new TextEncoder().encode(e),ru=e=>new TextDecoder().decode(e),iu=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error(`Unknown type, must be binary type`)}},au=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw Error(`Invalid prefix character`);this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e==`string`){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error(`Can only multibase decode strings`)}or(e){return su(this,e)}},ou=class{constructor(e){this.decoders=e}or(e){return su(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},su=(e,t)=>new ou({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}}),cu=class{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new iu(e,t,n),this.decoder=new au(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},lu=({name:e,prefix:t,encode:n,decode:r})=>new cu(e,t,n,r),uu=({prefix:e,name:t,alphabet:n})=>{let{encode:r,decode:i}=eu(n,t);return lu({prefix:e,name:t,encode:r,decode:e=>tu(i(e))})},du=(e,t,n,r)=>{let i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let a=e.length;for(;e[a-1]===`=`;)--a;let o=new Uint8Array(a*n/8|0),s=0,c=0,l=0;for(let t=0;t<a;++t){let a=i[e[t]];if(a===void 0)throw SyntaxError(`Non-${r} character`);c=c<<n|a,s+=n,s>=8&&(s-=8,o[l++]=255&c>>s)}if(s>=n||255&c<<8-s)throw SyntaxError(`Unexpected end of data`);return o},fu=(e,t,n)=>{let r=t[t.length-1]===`=`,i=(1<<n)-1,a=``,o=0,s=0;for(let r=0;r<e.length;++r)for(s=s<<8|e[r],o+=8;o>n;)o-=n,a+=t[i&s>>o];if(o&&(a+=t[i&s<<n-o]),r)for(;a.length*n&7;)a+=`=`;return a},pu=({name:e,prefix:t,bitsPerChar:n,alphabet:r})=>lu({prefix:t,name:e,encode(e){return fu(e,r,n)},decode(t){return du(t,r,n,e)}}),mu=lu({prefix:`\0`,name:`identity`,encode:e=>ru(e),decode:e=>nu(e)}),hu=Object.freeze({__proto__:null,identity:mu}),gu=pu({prefix:`0`,name:`base2`,alphabet:`01`,bitsPerChar:1}),_u=Object.freeze({__proto__:null,base2:gu}),vu=pu({prefix:`7`,name:`base8`,alphabet:`01234567`,bitsPerChar:3}),yu=Object.freeze({__proto__:null,base8:vu}),bu=uu({prefix:`9`,name:`base10`,alphabet:`0123456789`}),xu=Object.freeze({__proto__:null,base10:bu}),Su=pu({prefix:`f`,name:`base16`,alphabet:`0123456789abcdef`,bitsPerChar:4}),Cu=pu({prefix:`F`,name:`base16upper`,alphabet:`0123456789ABCDEF`,bitsPerChar:4}),wu=Object.freeze({__proto__:null,base16:Su,base16upper:Cu}),Tu=pu({prefix:`b`,name:`base32`,alphabet:`abcdefghijklmnopqrstuvwxyz234567`,bitsPerChar:5}),Eu=pu({prefix:`B`,name:`base32upper`,alphabet:`ABCDEFGHIJKLMNOPQRSTUVWXYZ234567`,bitsPerChar:5}),Du=pu({prefix:`c`,name:`base32pad`,alphabet:`abcdefghijklmnopqrstuvwxyz234567=`,bitsPerChar:5}),Ou=pu({prefix:`C`,name:`base32padupper`,alphabet:`ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=`,bitsPerChar:5}),ku=pu({prefix:`v`,name:`base32hex`,alphabet:`0123456789abcdefghijklmnopqrstuv`,bitsPerChar:5}),Au=pu({prefix:`V`,name:`base32hexupper`,alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUV`,bitsPerChar:5}),ju=pu({prefix:`t`,name:`base32hexpad`,alphabet:`0123456789abcdefghijklmnopqrstuv=`,bitsPerChar:5}),Mu=pu({prefix:`T`,name:`base32hexpadupper`,alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUV=`,bitsPerChar:5}),Nu=pu({prefix:`h`,name:`base32z`,alphabet:`ybndrfg8ejkmcpqxot1uwisza345h769`,bitsPerChar:5}),Pu=Object.freeze({__proto__:null,base32:Tu,base32upper:Eu,base32pad:Du,base32padupper:Ou,base32hex:ku,base32hexupper:Au,base32hexpad:ju,base32hexpadupper:Mu,base32z:Nu}),Fu=uu({prefix:`k`,name:`base36`,alphabet:`0123456789abcdefghijklmnopqrstuvwxyz`}),Iu=uu({prefix:`K`,name:`base36upper`,alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ`}),Lu=Object.freeze({__proto__:null,base36:Fu,base36upper:Iu}),Ru=uu({name:`base58btc`,prefix:`z`,alphabet:`123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz`}),zu=uu({name:`base58flickr`,prefix:`Z`,alphabet:`123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ`}),Bu=Object.freeze({__proto__:null,base58btc:Ru,base58flickr:zu}),Vu=pu({prefix:`m`,name:`base64`,alphabet:`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`,bitsPerChar:6}),Hu=pu({prefix:`M`,name:`base64pad`,alphabet:`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=`,bitsPerChar:6}),Uu=pu({prefix:`u`,name:`base64url`,alphabet:`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_`,bitsPerChar:6}),Wu=pu({prefix:`U`,name:`base64urlpad`,alphabet:`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=`,bitsPerChar:6}),Gu=Object.freeze({__proto__:null,base64:Vu,base64pad:Hu,base64url:Uu,base64urlpad:Wu}),Ku=Array.from(``),qu=Ku.reduce((e,t,n)=>(e[n]=t,e),[]),Ju=Ku.reduce((e,t,n)=>(e[t.codePointAt(0)]=n,e),[]);function Yu(e){return e.reduce((e,t)=>(e+=qu[t],e),``)}function Xu(e){let t=[];for(let n of e){let e=Ju[n.codePointAt(0)];if(e===void 0)throw Error(`Non-base256emoji character: ${n}`);t.push(e)}return new Uint8Array(t)}var Zu=lu({prefix:``,name:`base256emoji`,encode:Yu,decode:Xu}),Qu=Object.freeze({__proto__:null,base256emoji:Zu}),$u=rd,ed=128,td=-128,nd=2**31;function rd(e,t,n){t||=[],n||=0;for(var r=n;e>=nd;)t[n++]=e&255|ed,e/=128;for(;e&td;)t[n++]=e&255|ed,e>>>=7;return t[n]=e|0,rd.bytes=n-r+1,t}var id=sd,ad=128,od=127;function sd(e,t){var n=0,t=t||0,r=0,i=t,a,o=e.length;do{if(i>=o)throw sd.bytes=0,RangeError(`Could not decode varint`);a=e[i++],n+=r<28?(a&od)<<r:(a&od)*2**r,r+=7}while(a>=ad);return sd.bytes=i-t,n}var cd=2**7,ld=2**14,ud=2**21,dd=2**28,fd=2**35,pd=2**42,md=2**49,hd=2**56,gd=2**63,_d={encode:$u,decode:id,encodingLength:function(e){return e<cd?1:e<ld?2:e<ud?3:e<dd?4:e<fd?5:e<pd?6:e<md?7:e<hd?8:e<gd?9:10}},vd=(e,t,n=0)=>(_d.encode(e,t,n),t),yd=e=>_d.encodingLength(e),bd=(e,t)=>{let n=t.byteLength,r=yd(e),i=r+yd(n),a=new Uint8Array(i+n);return vd(e,a,0),vd(n,a,r),a.set(t,i),new xd(e,n,t,a)},xd=class{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}},Sd=({name:e,code:t,encode:n})=>new Cd(e,t,n),Cd=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?bd(this.code,t):t.then(e=>bd(this.code,e))}else throw Error(`Unknown type, must be binary type`)}},wd=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Td=Sd({name:`sha2-256`,code:18,encode:wd(`SHA-256`)}),Ed=Sd({name:`sha2-512`,code:19,encode:wd(`SHA-512`)}),Dd=Object.freeze({__proto__:null,sha256:Td,sha512:Ed}),Od=0,kd=`identity`,Ad=tu,jd={code:Od,name:kd,encode:Ad,digest:e=>bd(Od,Ad(e))},Md=Object.freeze({__proto__:null,identity:jd});new TextEncoder,new TextDecoder;var Nd={...hu,..._u,...yu,...xu,...wu,...Pu,...Lu,...Bu,...Gu,...Qu};({...Dd,...Md});function Pd(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}function Fd(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}var Id=Fd(`utf8`,`u`,e=>`u`+new TextDecoder(`utf8`).decode(e),e=>new TextEncoder().encode(e.substring(1))),Ld=Fd(`ascii`,`a`,e=>{let t=`a`;for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},e=>{e=e.substring(1);let t=Pd(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}),Rd={utf8:Id,"utf-8":Id,hex:Nd.base16,latin1:Ld,ascii:Ld,binary:Ld,...Nd};function zd(e,t=`utf8`){let n=Rd[t];if(!n)throw Error(`Unsupported encoding "${t}"`);return(t===`utf8`||t===`utf-8`)&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e,`utf8`):n.decoder.decode(`${n.prefix}${e}`)}var Bd=Object.defineProperty,Vd=(e,t,n)=>t in e?Bd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Hd=(e,t,n)=>Vd(e,typeof t==`symbol`?t:t+``,n),Ud=class{constructor(e,t){this.core=e,this.logger=t,Hd(this,`keychain`,new Map),Hd(this,`name`,vl),Hd(this,`version`,`0.3`),Hd(this,`initialized`,!1),Hd(this,`storagePrefix`,fl),Hd(this,`init`,async()=>{if(!this.initialized){let e=await this.getKeyChain();typeof e<`u`&&(this.keychain=e),this.initialized=!0}}),Hd(this,`has`,e=>(this.isInitialized(),this.keychain.has(e))),Hd(this,`set`,async(e,t)=>{this.isInitialized(),this.keychain.set(e,t),await this.persist()}),Hd(this,`get`,e=>{this.isInitialized();let t=this.keychain.get(e);if(typeof t>`u`){let{message:t}=V(`NO_MATCHING_KEY`,`${this.name}: ${e}`);throw Error(t)}return t}),Hd(this,`del`,async e=>{this.isInitialized(),this.keychain.delete(e),await this.persist()}),this.core=e,this.logger=x(t,this.name)}get context(){return C(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+`//`+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Zt(e))}async getKeyChain(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<`u`?Qt(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}},Wd=Object.defineProperty,Gd=(e,t,n)=>t in e?Wd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Kd=(e,t,n)=>Gd(e,typeof t==`symbol`?t:t+``,n),qd=class{constructor(e,t,n){this.core=e,this.logger=t,Kd(this,`name`,hl),Kd(this,`keychain`),Kd(this,`randomSessionIdentifier`,$o()),Kd(this,`initialized`,!1),Kd(this,`init`,async()=>{this.initialized||=(await this.keychain.init(),!0)}),Kd(this,`hasKeys`,e=>(this.isInitialized(),this.keychain.has(e))),Kd(this,`getClientId`,async()=>(this.isInitialized(),y(d(await this.getClientSeed()).publicKey))),Kd(this,`generateKeyPair`,()=>{this.isInitialized();let e=Qo();return this.setPrivateKey(e.publicKey,e.privateKey)}),Kd(this,`signJWT`,async e=>{this.isInitialized();let t=d(await this.getClientSeed()),n=this.randomSessionIdentifier;return await o(n,e,_l,t)}),Kd(this,`generateSharedKey`,(e,t,n)=>{this.isInitialized();let r=es(this.getPrivateKey(e),t);return this.setSymKey(r,n)}),Kd(this,`setSymKey`,async(e,t)=>{this.isInitialized();let n=t||ts(e);return await this.keychain.set(n,e),n}),Kd(this,`deleteKeyPair`,async e=>{this.isInitialized(),await this.keychain.del(e)}),Kd(this,`deleteSymKey`,async e=>{this.isInitialized(),await this.keychain.del(e)}),Kd(this,`encode`,async(e,t,n)=>{this.isInitialized();let r=ms(n),i=b(t);if(gs(r))return ls(i,n?.encoding);if(hs(r)){let t=r.senderPublicKey,n=r.receiverPublicKey;e=await this.generateSharedKey(t,n)}let a=this.getSymKey(e),{type:o,senderPublicKey:s}=r;return ss({type:o,symKey:a,message:i,senderPublicKey:s,encoding:n?.encoding})}),Kd(this,`decode`,async(e,t,n)=>{this.isInitialized();let r=ps(t,n);if(gs(r))return I(us(t,n?.encoding));if(hs(r)){let t=r.receiverPublicKey,n=r.senderPublicKey;e=await this.generateSharedKey(t,n)}try{return I(cs({symKey:this.getSymKey(e),encoded:t,encoding:n?.encoding}))}catch(t){this.logger.error(`Failed to decode message from topic: '${e}', clientId: '${await this.getClientId()}'`),this.logger.error(t)}}),Kd(this,`getPayloadType`,(e,t=Go)=>is(fs({encoded:e,encoding:t}).type)),Kd(this,`getPayloadSenderPublicKey`,(e,t=Go)=>{let n=fs({encoded:e,encoding:t});return n.senderPublicKey?g(n.senderPublicKey,Wo):void 0}),this.core=e,this.logger=x(t,this.name),this.keychain=n||new Ud(this.core,this.logger)}get context(){return C(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e=``;try{e=this.keychain.get(gl)}catch{e=$o(),await this.keychain.set(gl,e)}return zd(e,`base16`)}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}},Jd=Object.defineProperty,Yd=Object.defineProperties,Xd=Object.getOwnPropertyDescriptors,Zd=Object.getOwnPropertySymbols,Qd=Object.prototype.hasOwnProperty,$d=Object.prototype.propertyIsEnumerable,ef=(e,t,n)=>t in e?Jd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tf=(e,t)=>{for(var n in t||={})Qd.call(t,n)&&ef(e,n,t[n]);if(Zd)for(var n of Zd(t))$d.call(t,n)&&ef(e,n,t[n]);return e},nf=(e,t)=>Yd(e,Xd(t)),rf=(e,t,n)=>ef(e,typeof t==`symbol`?t:t+``,n),af=class extends Yc{constructor(e,t){super(e,t),this.logger=e,this.core=t,rf(this,`messages`,new Map),rf(this,`messagesWithoutClientAck`,new Map),rf(this,`name`,yl),rf(this,`version`,`0.3`),rf(this,`initialized`,!1),rf(this,`storagePrefix`,fl),rf(this,`init`,async()=>{if(!this.initialized){this.logger.trace(`Initialized`);try{let e=await this.getRelayerMessages();typeof e<`u`&&(this.messages=e);let t=await this.getRelayerMessagesWithoutClientAck();typeof t<`u`&&(this.messagesWithoutClientAck=t),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:`method`,method:`restore`,size:this.messages.size})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}finally{this.initialized=!0}}}),rf(this,`set`,async(e,t,n)=>{this.isInitialized();let r=ns(t),i=this.messages.get(e);if(typeof i>`u`&&(i={}),typeof i[r]<`u`)return r;if(i[r]=t,this.messages.set(e,i),n===El.inbound){let n=this.messagesWithoutClientAck.get(e)||{};this.messagesWithoutClientAck.set(e,nf(tf({},n),{[r]:t}))}return await this.persist(),r}),rf(this,`get`,e=>{this.isInitialized();let t=this.messages.get(e);return typeof t>`u`&&(t={}),t}),rf(this,`getWithoutAck`,e=>{this.isInitialized();let t={};for(let n of e){let e=this.messagesWithoutClientAck.get(n)||{};t[n]=Object.values(e)}return t}),rf(this,`has`,(e,t)=>(this.isInitialized(),typeof this.get(e)[ns(t)]<`u`)),rf(this,`ack`,async(e,t)=>{this.isInitialized();let n=this.messagesWithoutClientAck.get(e);if(typeof n>`u`)return;let r=ns(t);delete n[r],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(e):this.messagesWithoutClientAck.set(e,n),await this.persist()}),rf(this,`del`,async e=>{this.isInitialized(),this.messages.delete(e),this.messagesWithoutClientAck.delete(e),await this.persist()}),this.logger=x(e,this.name),this.core=t}get context(){return C(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+`//`+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+`//`+this.name+`_withoutClientAck`}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Zt(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Zt(e))}async getRelayerMessages(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<`u`?Qt(e):void 0}async getRelayerMessagesWithoutClientAck(){let e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<`u`?Qt(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}},of=Object.defineProperty,sf=Object.defineProperties,cf=Object.getOwnPropertyDescriptors,lf=Object.getOwnPropertySymbols,uf=Object.prototype.hasOwnProperty,df=Object.prototype.propertyIsEnumerable,ff=(e,t,n)=>t in e?of(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,pf=(e,t)=>{for(var n in t||={})uf.call(t,n)&&ff(e,n,t[n]);if(lf)for(var n of lf(t))df.call(t,n)&&ff(e,n,t[n]);return e},mf=(e,t)=>sf(e,cf(t)),hf=(e,t,n)=>ff(e,typeof t==`symbol`?t:t+``,n),gf=class extends Xc{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,hf(this,`events`,new ll.EventEmitter),hf(this,`name`,xl),hf(this,`queue`,new Map),hf(this,`publishTimeout`,(0,U.toMiliseconds)(U.ONE_MINUTE)),hf(this,`initialPublishTimeout`,(0,U.toMiliseconds)(U.ONE_SECOND*15)),hf(this,`needsTransportRestart`,!1),hf(this,`publish`,async(e,t,n)=>{var r;this.logger.debug(`Publishing Payload`),this.logger.trace({type:`method`,method:`publish`,params:{topic:e,message:t,opts:n}});let i=n?.ttl||bl,a=ys(n),o=n?.prompt||!1,s=n?.tag||0,c=n?.id||j().toString(),l={topic:e,message:t,opts:{ttl:i,relay:a,prompt:o,tag:s,id:c,attestation:n?.attestation,tvf:n?.tvf}},u=`Failed to publish payload, please try again. id:${c} tag:${s}`;try{let r=new Promise(async r=>{let a=({id:e})=>{l.opts.id===e&&(this.removeRequestFromQueue(e),this.relayer.events.removeListener(Cl.publish,a),r(l))};this.relayer.events.on(Cl.publish,a);let u=en(new Promise((r,a)=>{this.rpcPublish({topic:e,message:t,ttl:i,prompt:o,tag:s,id:c,attestation:n?.attestation,tvf:n?.tvf}).then(r).catch(e=>{this.logger.warn(e,e?.message),a(e)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${c} tag:${s}`);try{await u,this.events.removeListener(Cl.publish,a)}catch(e){this.queue.set(c,mf(pf({},l),{attempt:1})),this.logger.warn(e,e?.message)}});this.logger.trace({type:`method`,method:`publish`,params:{id:c,topic:e,message:t,opts:n}}),await en(r,this.publishTimeout,u)}catch(e){if(this.logger.debug(`Failed to Publish Payload`),this.logger.error(e),(r=n?.internal)!=null&&r.throwOnFailedPublish)throw e}finally{this.queue.delete(c)}}),hf(this,`on`,(e,t)=>{this.events.on(e,t)}),hf(this,`once`,(e,t)=>{this.events.once(e,t)}),hf(this,`off`,(e,t)=>{this.events.off(e,t)}),hf(this,`removeListener`,(e,t)=>{this.events.removeListener(e,t)}),this.relayer=e,this.logger=x(t,this.name),this.registerEventListeners()}get context(){return C(this.logger)}async rpcPublish(e){var t,n;let{topic:r,message:i,ttl:a=bl,prompt:o,tag:s,id:c,attestation:l,tvf:u}=e,d={method:bs(ys().protocol).publish,params:pf({topic:r,message:i,ttl:a,prompt:o,tag:s,attestation:l},u),id:c};Xs(d.params?.prompt)&&((t=d.params)==null||delete t.prompt),Xs(d.params?.tag)&&((n=d.params)==null||delete n.tag),this.logger.debug(`Outgoing Relay Payload`),this.logger.trace({type:`message`,direction:`outgoing`,request:d});let f=await this.relayer.request(d);return this.relayer.events.emit(Cl.publish,e),this.logger.debug(`Successfully Published Payload`),f}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{let n=e.attempt+1;this.queue.set(t,mf(pf({},e),{attempt:n}));let{topic:r,message:i,opts:a,attestation:o}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${n}`),await this.rpcPublish(mf(pf({},e),{topic:r,message:i,ttl:a.ttl,prompt:a.prompt,tag:a.tag,id:a.id,attestation:o,tvf:a.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(l.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Cl.connection_stalled);return}this.checkQueue()}),this.relayer.on(Cl.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}},_f=Object.defineProperty,vf=(e,t,n)=>t in e?_f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,yf=(e,t,n)=>vf(e,typeof t==`symbol`?t:t+``,n),bf=class{constructor(){yf(this,`map`,new Map),yf(this,`set`,(e,t)=>{let n=this.get(e);this.exists(e,t)||this.map.set(e,[...n,t])}),yf(this,`get`,e=>this.map.get(e)||[]),yf(this,`exists`,(e,t)=>this.get(e).includes(t)),yf(this,`delete`,(e,t)=>{if(typeof t>`u`){this.map.delete(e);return}if(!this.map.has(e))return;let n=this.get(e);if(!this.exists(e,t))return;let r=n.filter(e=>e!==t);if(!r.length){this.map.delete(e);return}this.map.set(e,r)}),yf(this,`clear`,()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}},xf=Object.defineProperty,Sf=Object.defineProperties,Cf=Object.getOwnPropertyDescriptors,wf=Object.getOwnPropertySymbols,Tf=Object.prototype.hasOwnProperty,Ef=Object.prototype.propertyIsEnumerable,Df=(e,t,n)=>t in e?xf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Of=(e,t)=>{for(var n in t||={})Tf.call(t,n)&&Df(e,n,t[n]);if(wf)for(var n of wf(t))Ef.call(t,n)&&Df(e,n,t[n]);return e},kf=(e,t)=>Sf(e,Cf(t)),G=(e,t,n)=>Df(e,typeof t==`symbol`?t:t+``,n),Af=class extends $c{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,G(this,`subscriptions`,new Map),G(this,`topicMap`,new bf),G(this,`events`,new ll.EventEmitter),G(this,`name`,kl),G(this,`version`,`0.3`),G(this,`pending`,new Map),G(this,`cached`,[]),G(this,`initialized`,!1),G(this,`storagePrefix`,fl),G(this,`subscribeTimeout`,(0,U.toMiliseconds)(U.ONE_MINUTE)),G(this,`initialSubscribeTimeout`,(0,U.toMiliseconds)(U.ONE_SECOND*15)),G(this,`clientId`),G(this,`batchSubscribeTopicsLimit`,500),G(this,`init`,async()=>{this.initialized||(this.logger.trace(`Initialized`),this.registerEventListeners(),await this.restore()),this.initialized=!0}),G(this,`subscribe`,async(e,t)=>{this.isInitialized(),this.logger.debug(`Subscribing Topic`),this.logger.trace({type:`method`,method:`subscribe`,params:{topic:e,opts:t}});try{let n=ys(t),r={topic:e,relay:n,transportType:t?.transportType};this.pending.set(e,r);let i=await this.rpcSubscribe(e,n,t);return typeof i==`string`&&(this.onSubscribe(i,r),this.logger.debug(`Successfully Subscribed Topic`),this.logger.trace({type:`method`,method:`subscribe`,params:{topic:e,opts:t}})),i}catch(e){throw this.logger.debug(`Failed to Subscribe Topic`),this.logger.error(e),e}}),G(this,`unsubscribe`,async(e,t)=>{this.isInitialized(),typeof t?.id<`u`?await this.unsubscribeById(e,t.id,t):await this.unsubscribeByTopic(e,t)}),G(this,`isSubscribed`,e=>new Promise(t=>{t(this.topicMap.topics.includes(e))})),G(this,`isKnownTopic`,e=>new Promise(t=>{t(this.topicMap.topics.includes(e)||this.pending.has(e)||this.cached.some(t=>t.topic===e))})),G(this,`on`,(e,t)=>{this.events.on(e,t)}),G(this,`once`,(e,t)=>{this.events.once(e,t)}),G(this,`off`,(e,t)=>{this.events.off(e,t)}),G(this,`removeListener`,(e,t)=>{this.events.removeListener(e,t)}),G(this,`start`,async()=>{await this.onConnect()}),G(this,`stop`,async()=>{await this.onDisconnect()}),G(this,`restart`,async()=>{await this.restore(),await this.onRestart()}),G(this,`checkPending`,async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;let e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}),G(this,`registerEventListeners`,()=>{this.relayer.core.heartbeat.on(l.pulse,async()=>{await this.checkPending()}),this.events.on(Ol.created,async e=>{let t=Ol.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,data:e}),await this.persist()}),this.events.on(Ol.deleted,async e=>{let t=Ol.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,data:e}),await this.persist()})}),this.relayer=e,this.logger=x(t,this.name),this.clientId=``}get context(){return C(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+`//`+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let n=!1;try{n=this.getSubscription(e).topic===t}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){let n=this.topicMap.get(e);await Promise.all(n.map(async n=>await this.unsubscribeById(e,n,t)))}async unsubscribeById(e,t,n){this.logger.debug(`Unsubscribing Topic`),this.logger.trace({type:`method`,method:`unsubscribe`,params:{topic:e,id:t,opts:n}});try{let r=ys(n);await this.restartToComplete({topic:e,id:t,relay:r}),await this.rpcUnsubscribe(e,t,r);let i=H(`USER_DISCONNECTED`,`${this.name}, ${e}`);await this.onUnsubscribe(e,t,i),this.logger.debug(`Successfully Unsubscribed Topic`),this.logger.trace({type:`method`,method:`unsubscribe`,params:{topic:e,id:t,opts:n}})}catch(e){throw this.logger.debug(`Failed to Unsubscribe Topic`),this.logger.error(e),e}}async rpcSubscribe(e,t,n){(!n||n?.transportType===W.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});let r={method:bs(t.protocol).subscribe,params:{topic:e}};this.logger.debug(`Outgoing Relay Payload`),this.logger.trace({type:`payload`,direction:`outgoing`,request:r});let i=n?.internal?.throwOnFailedPublish;try{let t=await this.getSubscriptionId(e);if(n?.transportType===W.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(r).catch(e=>this.logger.warn(e))},(0,U.toMiliseconds)(U.ONE_SECOND)),t;let a=await en(new Promise(async t=>{let n=r=>{r.topic===e&&(this.events.removeListener(Ol.created,n),t(r.id))};this.events.on(Ol.created,n);try{let i=await en(new Promise((e,t)=>{this.relayer.request(r).catch(e=>{this.logger.warn(e,e?.message),t(e)}).then(e)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Ol.created,n),t(i)}catch{}}),this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!a&&i)throw Error(`Subscribing to ${e} failed, please try again`);return a?t:null}catch(e){if(this.logger.debug(`Outgoing Relay Subscribe Payload stalled`),this.relayer.events.emit(Cl.connection_stalled),i)throw e}return null}async rpcBatchSubscribe(e){if(!e.length)return;let t=e[0].relay,n={method:bs(t.protocol).batchSubscribe,params:{topics:e.map(e=>e.topic)}};this.logger.debug(`Outgoing Relay Payload`),this.logger.trace({type:`payload`,direction:`outgoing`,request:n});try{await await en(new Promise(e=>{this.relayer.request(n).catch(e=>this.logger.warn(e)).then(e)}),this.subscribeTimeout,`rpcBatchSubscribe failed, please try again`)}catch{this.relayer.events.emit(Cl.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;let t=e[0].relay,n={method:bs(t.protocol).batchFetchMessages,params:{topics:e.map(e=>e.topic)}};this.logger.debug(`Outgoing Relay Payload`),this.logger.trace({type:`payload`,direction:`outgoing`,request:n});let r;try{r=await await en(new Promise((e,t)=>{this.relayer.request(n).catch(e=>{this.logger.warn(e),t(e)}).then(e)}),this.subscribeTimeout,`rpcBatchFetchMessages failed, please try again`)}catch{this.relayer.events.emit(Cl.connection_stalled)}return r}rpcUnsubscribe(e,t,n){let r={method:bs(n.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug(`Outgoing Relay Payload`),this.logger.trace({type:`payload`,direction:`outgoing`,request:r}),this.relayer.request(r)}onSubscribe(e,t){this.setSubscription(e,kf(Of({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(e=>{this.setSubscription(e.id,Of({},e)),this.pending.delete(e.topic)})}async onUnsubscribe(e,t,n){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug(`Setting subscription`),this.logger.trace({type:`method`,method:`setSubscription`,id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,Of({},t)),this.topicMap.set(t.topic,e),this.events.emit(Ol.created,t)}getSubscription(e){this.logger.debug(`Getting subscription`),this.logger.trace({type:`method`,method:`getSubscription`,id:e});let t=this.subscriptions.get(e);if(!t){let{message:t}=V(`NO_MATCHING_KEY`,`${this.name}: ${e}`);throw Error(t)}return t}deleteSubscription(e,t){this.logger.debug(`Deleting subscription`),this.logger.trace({type:`method`,method:`deleteSubscription`,id:e,reason:t});let n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(Ol.deleted,kf(Of({},n),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ol.sync)}async onRestart(){if(this.cached.length){let e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<t;n++){let t=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(t)}}this.events.emit(Ol.resubscribed)}async restore(){try{let e=await this.getRelayerSubscriptions();if(typeof e>`u`||!e.length)return;if(this.subscriptions.size){let{message:e}=V(`RESTORE_WILL_OVERRIDE`,this.name);throw this.logger.error(e),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:`method`,method:`restore`,subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async e=>kf(Of({},e),{id:await this.getSubscriptionId(e.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await bn((0,U.toMiliseconds)(U.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||=await this.relayer.core.crypto.getClientId(),this.clientId}async getSubscriptionId(e){return ns(e+await this.getClientId())}},jf=Object.defineProperty,Mf=Object.getOwnPropertySymbols,Nf=Object.prototype.hasOwnProperty,Pf=Object.prototype.propertyIsEnumerable,Ff=(e,t,n)=>t in e?jf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,If=(e,t)=>{for(var n in t||={})Nf.call(t,n)&&Ff(e,n,t[n]);if(Mf)for(var n of Mf(t))Pf.call(t,n)&&Ff(e,n,t[n]);return e},K=(e,t,n)=>Ff(e,typeof t==`symbol`?t:t+``,n),Lf=class extends Zc{constructor(e){super(e),K(this,`protocol`,`wc`),K(this,`version`,2),K(this,`core`),K(this,`logger`),K(this,`events`,new ll.EventEmitter),K(this,`provider`),K(this,`messages`),K(this,`subscriber`),K(this,`publisher`),K(this,`name`,Sl),K(this,`transportExplicitlyClosed`,!1),K(this,`initialized`,!1),K(this,`connectionAttemptInProgress`,!1),K(this,`relayUrl`),K(this,`projectId`),K(this,`packageName`),K(this,`bundleId`),K(this,`hasExperiencedNetworkDisruption`,!1),K(this,`pingTimeout`),K(this,`heartBeatTimeout`,(0,U.toMiliseconds)(U.THIRTY_SECONDS+U.FIVE_SECONDS)),K(this,`reconnectTimeout`),K(this,`connectPromise`),K(this,`reconnectInProgress`,!1),K(this,`requestsInFlight`,[]),K(this,`connectTimeout`,(0,U.toMiliseconds)(U.ONE_SECOND*15)),K(this,`request`,async e=>{this.logger.debug(`Publishing Request Payload`);let t=e.id||j().toString();await this.toEstablishConnection();try{this.logger.trace({id:t,method:e.method,topic:e.params?.topic},`relayer.request - publishing...`);let n=`${t}:${e.params?.tag||``}`;this.requestsInFlight.push(n);let r=await this.provider.request(e);return this.requestsInFlight=this.requestsInFlight.filter(e=>e!==n),r}catch(e){throw this.logger.debug(`Failed to Publish Request: ${t}`),e}}),K(this,`resetPingTimeout`,()=>{It()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var e,t;try{this.logger.debug({},`pingTimeout: Connection stalled, terminating...`),(t=(e=this.provider?.connection?.socket)?.terminate)==null||t.call(e)}catch(e){this.logger.warn(e,e?.message)}},this.heartBeatTimeout))}),K(this,`onPayloadHandler`,e=>{this.onProviderPayload(e),this.resetPingTimeout()}),K(this,`onConnectHandler`,()=>{this.logger.warn({},`Relayer connected `),this.startPingTimeout(),this.events.emit(Cl.connect)}),K(this,`onDisconnectHandler`,()=>{this.logger.warn({},`Relayer disconnected `),this.requestsInFlight=[],this.onProviderDisconnect()}),K(this,`onProviderErrorHandler`,e=>{this.logger.fatal(`Fatal socket error: ${e.message}`),this.events.emit(Cl.error,e),this.logger.fatal(`Fatal socket error received, closing transport`),this.transportClose()}),K(this,`registerProviderListeners`,()=>{this.provider.on(wl.payload,this.onPayloadHandler),this.provider.on(wl.connect,this.onConnectHandler),this.provider.on(wl.disconnect,this.onDisconnectHandler),this.provider.on(wl.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<`u`&&typeof e.logger!=`string`?x(e.logger,this.name):(0,F.default)(L({level:e.logger||`error`})),this.messages=new af(this.logger,e.core),this.subscriber=new Af(this,this.logger),this.publisher=new gf(this,this.logger),this.relayUrl=e?.relayUrl||`wss://relay.walletconnect.org`,this.projectId=e.projectId,Rt()?this.packageName=Ht():zt()&&(this.bundleId=Ht()),this.provider={}}async init(){if(this.logger.trace(`Initialized`),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}}get context(){return C(this.logger)}get connected(){return this.provider?.connection?.socket?.readyState===1||!1}get connecting(){return this.provider?.connection?.socket?.readyState===0||this.connectPromise!==void 0||!1}async publish(e,t,n){this.isInitialized(),await this.publisher.publish(e,t,n),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:W.relay},El.outbound)}async subscribe(e,t){this.isInitialized(),(!(t!=null&&t.transportType)||t?.transportType===`relay`)&&await this.toEstablishConnection();let n=typeof t?.internal?.throwOnFailedPublish>`u`?!0:t?.internal?.throwOnFailedPublish,r=this.subscriber.topicMap.get(e)?.[0]||``,i,a=t=>{t.topic===e&&(this.subscriber.off(Ol.created,a),i())};return await Promise.all([new Promise(e=>{i=e,this.subscriber.on(Ol.created,a)}),new Promise(async(i,a)=>{r=await this.subscriber.subscribe(e,If({internal:{throwOnFailedPublish:n}},t)).catch(e=>{n&&a(e)})||r,i()})]),r}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await en(this.provider.disconnect(),2e3,`provider.disconnect()`).catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn(`Starting WS connection skipped because the client has no topics to work with.`);return}if(this.connectPromise?(this.logger.debug({},`Waiting for existing connection attempt to resolve...`),await this.connectPromise,this.logger.debug({},`Existing connection attempt resolved`)):(this.connectPromise=new Promise(async(t,n)=>{await this.connect(e).then(t).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},`Restarting transport...`),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await jc())throw Error(`No internet connection detected. Please restart your network and try again.`)}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace(`Batch message events is empty. Ignoring...`);return}let t=e.sort((e,t)=>e.publishedAt-t.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(let e of t)try{await this.onMessageEvent(e)}catch(e){this.logger.warn(e,`Error while processing batch message event: `+e?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){let{topic:n}=e;if(!t.sessionExists){let e={topic:n,expiry:on(U.FIVE_MINUTES),relay:{protocol:`irn`},active:!1};await this.core.pairing.pairings.set(n,e)}this.events.emit(Cl.message,e),await this.recordMessageEvent(e,El.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(e,t)=>{let n=()=>{t(Error(`Connection interrupted while trying to subscribe`))};this.provider.once(wl.disconnect,n),await en(new Promise((e,t)=>{this.provider.connect().then(e).catch(t)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(e=>{t(e)}).finally(()=>{this.provider.off(wl.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(e,t)=>{let n=()=>{t(Error(`Connection interrupted while trying to subscribe`))};this.provider.once(wl.disconnect,n),await this.subscriber.start().then(e).catch(t).finally(()=>{this.provider.off(wl.disconnect,n)})}),this.hasExperiencedNetworkDisruption=!1,e()})}catch(e){await this.subscriber.stop();let t=e;this.logger.warn({},t.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(e=>setTimeout(e,(0,U.toMiliseconds)(t*1))),t++}}startPingTimeout(){var e,t;if(It())try{(e=this.provider?.connection)!=null&&e.socket&&((t=this.provider?.connection?.socket)==null||t.on(`ping`,()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(e){this.logger.warn(e,e?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new k(new v(Yt({sdkVersion:Tl,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){let{topic:n,message:r}=e;await this.messages.set(n,r,t)}async shouldIgnoreMessageEvent(e){let{topic:t,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;let r=this.messages.has(t,n);return r&&this.logger.warn(`Ignoring duplicate message: ${n}`),r}async onProviderPayload(e){if(this.logger.debug(`Incoming Relay Payload`),this.logger.trace({type:`payload`,direction:`incoming`,payload:e}),S(e)){if(!e.method.endsWith(`_subscription`))return;let t=e.params,{topic:n,message:r,publishedAt:i,attestation:a}=t.data,o={topic:n,message:r,publishedAt:i,transportType:W.relay,attestation:a};this.logger.debug(`Emitting Relayer Payload`),this.logger.trace(If({type:`event`,event:t.id},o)),this.events.emit(t.id,o),await this.acknowledgePayload(e),await this.onMessageEvent(o)}else A(e)&&this.events.emit(Cl.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,El.inbound),this.events.emit(Cl.message,e))}async acknowledgePayload(e){let t=T(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(wl.payload,this.onPayloadHandler),this.provider.off(wl.connect,this.onConnectHandler),this.provider.off(wl.disconnect,this.onDisconnectHandler),this.provider.off(wl.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await jc();Fc(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(e=>this.logger.error(e,e?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(l.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&Rc())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(Cl.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,U.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}};function Rf(){}function zf(e){if(!e||typeof e!=`object`)return!1;let t=Object.getPrototypeOf(e);return t===null||t===Object.prototype||Object.getPrototypeOf(t)===null?Object.prototype.toString.call(e)===`[object Object]`:!1}function Bf(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function Vf(e){return e==null?e===void 0?`[object Undefined]`:`[object Null]`:Object.prototype.toString.call(e)}var Hf=`[object RegExp]`,Uf=`[object String]`,Wf=`[object Number]`,Gf=`[object Boolean]`,Kf=`[object Arguments]`,qf=`[object Symbol]`,Jf=`[object Date]`,Yf=`[object Map]`,Xf=`[object Set]`,Zf=`[object Array]`,Qf=`[object Function]`,$f=`[object ArrayBuffer]`,ep=`[object Object]`,tp=`[object Error]`,np=`[object DataView]`,rp=`[object Uint8Array]`,ip=`[object Uint8ClampedArray]`,ap=`[object Uint16Array]`,op=`[object Uint32Array]`,sp=`[object BigUint64Array]`,cp=`[object Int8Array]`,lp=`[object Int16Array]`,up=`[object Int32Array]`,dp=`[object BigInt64Array]`,fp=`[object Float32Array]`,pp=`[object Float64Array]`;function mp(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}function hp(e,t,n){return gp(e,t,void 0,void 0,void 0,void 0,n)}function gp(e,t,n,r,i,a,o){let s=o(e,t,n,r,i,a);if(s!==void 0)return s;if(typeof e==typeof t)switch(typeof e){case`bigint`:case`string`:case`boolean`:case`symbol`:case`undefined`:return e===t;case`number`:return e===t||Object.is(e,t);case`function`:return e===t;case`object`:return _p(e,t,a,o)}return _p(e,t,a,o)}function _p(e,t,n,r){if(Object.is(e,t))return!0;let i=Vf(e),a=Vf(t);if(i===Kf&&(i=ep),a===Kf&&(a=ep),i!==a)return!1;switch(i){case Uf:return e.toString()===t.toString();case Wf:return mp(e.valueOf(),t.valueOf());case Gf:case Jf:case qf:return Object.is(e.valueOf(),t.valueOf());case Hf:return e.source===t.source&&e.flags===t.flags;case Qf:return e===t}n??=new Map;let o=n.get(e),s=n.get(t);if(o!=null&&s!=null)return o===t;n.set(e,t),n.set(t,e);try{switch(i){case Yf:if(e.size!==t.size)return!1;for(let[i,a]of e.entries())if(!t.has(i)||!gp(a,t.get(i),i,e,t,n,r))return!1;return!0;case Xf:{if(e.size!==t.size)return!1;let i=Array.from(e.values()),a=Array.from(t.values());for(let o=0;o<i.length;o++){let s=i[o],c=a.findIndex(i=>gp(s,i,void 0,e,t,n,r));if(c===-1)return!1;a.splice(c,1)}return!0}case Zf:case rp:case ip:case ap:case op:case sp:case cp:case lp:case up:case dp:case fp:case pp:if(typeof Buffer<`u`&&Buffer.isBuffer(e)!==Buffer.isBuffer(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!gp(e[i],t[i],i,e,t,n,r))return!1;return!0;case $f:return e.byteLength===t.byteLength?_p(new Uint8Array(e),new Uint8Array(t),n,r):!1;case np:return e.byteLength!==t.byteLength||e.byteOffset!==t.byteOffset?!1:_p(new Uint8Array(e),new Uint8Array(t),n,r);case tp:return e.name===t.name&&e.message===t.message;case ep:{if(!(_p(e.constructor,t.constructor,n,r)||zf(e)&&zf(t)))return!1;let i=[...Object.keys(e),...Bf(e)],a=[...Object.keys(t),...Bf(t)];if(i.length!==a.length)return!1;for(let a=0;a<i.length;a++){let o=i[a],s=e[o];if(!Object.hasOwn(t,o))return!1;let c=t[o];if(!gp(s,c,o,e,t,n,r))return!1}return!0}default:return!1}}finally{n.delete(e),n.delete(t)}}function vp(e,t){return hp(e,t,Rf)}var yp=Object.defineProperty,bp=Object.getOwnPropertySymbols,xp=Object.prototype.hasOwnProperty,Sp=Object.prototype.propertyIsEnumerable,Cp=(e,t,n)=>t in e?yp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,wp=(e,t)=>{for(var n in t||={})xp.call(t,n)&&Cp(e,n,t[n]);if(bp)for(var n of bp(t))Sp.call(t,n)&&Cp(e,n,t[n]);return e},Tp=(e,t,n)=>Cp(e,typeof t==`symbol`?t:t+``,n),Ep=class extends Qc{constructor(e,t,n,r=fl,i=void 0){super(e,t,n,r),this.core=e,this.logger=t,this.name=n,Tp(this,`map`,new Map),Tp(this,`version`,`0.3`),Tp(this,`cached`,[]),Tp(this,`initialized`,!1),Tp(this,`getKey`),Tp(this,`storagePrefix`,fl),Tp(this,`recentlyDeleted`,[]),Tp(this,`recentlyDeletedLimit`,200),Tp(this,`init`,async()=>{this.initialized||=(this.logger.trace(`Initialized`),await this.restore(),this.cached.forEach(e=>{this.getKey&&e!==null&&!Xs(e)?this.map.set(this.getKey(e),e):rc(e)?this.map.set(e.id,e):ic(e)&&this.map.set(e.topic,e)}),this.cached=[],!0)}),Tp(this,`set`,async(e,t)=>{this.isInitialized(),this.map.has(e)?await this.update(e,t):(this.logger.debug(`Setting value`),this.logger.trace({type:`method`,method:`set`,key:e,value:t}),this.map.set(e,t),await this.persist())}),Tp(this,`get`,e=>(this.isInitialized(),this.logger.debug(`Getting value`),this.logger.trace({type:`method`,method:`get`,key:e}),this.getData(e))),Tp(this,`getAll`,e=>(this.isInitialized(),e?this.values.filter(t=>Object.keys(e).every(n=>vp(t[n],e[n]))):this.values)),Tp(this,`update`,async(e,t)=>{this.isInitialized(),this.logger.debug(`Updating value`),this.logger.trace({type:`method`,method:`update`,key:e,update:t});let n=wp(wp({},this.getData(e)),t);this.map.set(e,n),await this.persist()}),Tp(this,`delete`,async(e,t)=>{this.isInitialized(),this.map.has(e)&&(this.logger.debug(`Deleting value`),this.logger.trace({type:`method`,method:`delete`,key:e,reason:t}),this.map.delete(e),this.addToRecentlyDeleted(e),await this.persist())}),this.logger=x(t,this.name),this.storagePrefix=r,this.getKey=i}get context(){return C(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+`//`+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){let t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){let{message:t}=V(`MISSING_OR_INVALID`,`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(t),Error(t)}let{message:t}=V(`NO_MATCHING_KEY`,`${this.name}: ${e}`);throw this.logger.error(t),Error(t)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{let e=await this.getDataStore();if(typeof e>`u`||!e.length)return;if(this.map.size){let{message:e}=V(`RESTORE_WILL_OVERRIDE`,this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:`method`,method:`restore`,value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}},Dp=Object.defineProperty,Op=(e,t,n)=>t in e?Dp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,q=(e,t,n)=>Op(e,typeof t==`symbol`?t:t+``,n),kp=class{constructor(e,t){this.core=e,this.logger=t,q(this,`name`,Al),q(this,`version`,`0.3`),q(this,`events`,new ll.default),q(this,`pairings`),q(this,`initialized`,!1),q(this,`storagePrefix`,fl),q(this,`ignoredPayloadTypes`,[1]),q(this,`registeredMethods`,[]),q(this,`init`,async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace(`Initialized`))}),q(this,`register`,({methods:e})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...e])]}),q(this,`create`,async e=>{this.isInitialized();let t=$o(),n=await this.core.crypto.setSymKey(t),r=on(U.FIVE_MINUTES),i={protocol:`irn`},a={topic:n,expiry:r,relay:i,active:!1,methods:e?.methods},o=Ts({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:t,relay:i,expiryTimestamp:r,methods:e?.methods});return this.events.emit(Ml.create,a),this.core.expirer.set(n,r),await this.pairings.set(n,a),await this.core.relayer.subscribe(n,{transportType:e?.transportType}),{topic:n,uri:o}}),q(this,`pair`,async e=>{this.isInitialized();let t=this.core.eventClient.createEvent({properties:{topic:e?.uri,trace:[Wl.pairing_started]}});this.isValidPair(e,t);let{topic:n,symKey:r,relay:i,expiryTimestamp:a,methods:o}=Ss(e.uri);t.props.properties.topic=n,t.addTrace(Wl.pairing_uri_validation_success),t.addTrace(Wl.pairing_uri_not_expired);let s;if(this.pairings.keys.includes(n)){if(s=this.pairings.get(n),t.addTrace(Wl.existing_pairing),s.active)throw t.setError(Gl.active_pairing_already_exists),Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);t.addTrace(Wl.pairing_not_expired)}let c=a||on(U.FIVE_MINUTES),l={topic:n,relay:i,expiry:c,active:!1,methods:o};this.core.expirer.set(n,c),await this.pairings.set(n,l),t.addTrace(Wl.store_new_pairing),e.activatePairing&&await this.activate({topic:n}),this.events.emit(Ml.create,l),t.addTrace(Wl.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(r,n),t.addTrace(Wl.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{t.setError(Gl.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:i})}catch(e){throw t.setError(Gl.subscribe_pairing_topic_failure),e}return t.addTrace(Wl.subscribe_pairing_topic_success),l}),q(this,`activate`,async({topic:e})=>{this.isInitialized();let t=on(U.FIVE_MINUTES);this.core.expirer.set(e,t),await this.pairings.update(e,{active:!0,expiry:t})}),q(this,`ping`,async e=>{this.isInitialized(),await this.isValidPing(e),this.logger.warn(`ping() is deprecated and will be removed in the next major release.`);let{topic:t}=e;if(this.pairings.keys.includes(t)){let e=await this.sendRequest(t,`wc_pairingPing`,{}),{done:n,resolve:r,reject:i}=$t();this.events.once(z(`pairing_ping`,e),({error:e})=>{e?i(e):r()}),await n()}}),q(this,`updateExpiry`,async({topic:e,expiry:t})=>{this.isInitialized(),await this.pairings.update(e,{expiry:t})}),q(this,`updateMetadata`,async({topic:e,metadata:t})=>{this.isInitialized(),await this.pairings.update(e,{peerMetadata:t})}),q(this,`getPairings`,()=>(this.isInitialized(),this.pairings.values)),q(this,`disconnect`,async e=>{this.isInitialized(),await this.isValidDisconnect(e);let{topic:t}=e;this.pairings.keys.includes(t)&&(await this.sendRequest(t,`wc_pairingDelete`,H(`USER_DISCONNECTED`)),await this.deletePairing(t))}),q(this,`formatUriFromPairing`,e=>{this.isInitialized();let{topic:t,relay:n,expiry:r,methods:i}=e,a=this.core.crypto.keychain.get(t);return Ts({protocol:this.core.protocol,version:this.core.version,topic:t,symKey:a,relay:n,expiryTimestamp:r,methods:i})}),q(this,`sendRequest`,async(e,t,n)=>{let r=w(t,n),i=await this.core.crypto.encode(e,r),a=jl[t].req;return this.core.history.set(e,r),this.core.relayer.publish(e,i,a),r.id}),q(this,`sendResult`,async(e,t,n)=>{let r=T(e,n),i=await this.core.crypto.encode(t,r),a=jl[(await this.core.history.get(t,e)).request.method].res;await this.core.relayer.publish(t,i,a),await this.core.history.resolve(r)}),q(this,`sendError`,async(e,t,n)=>{let r=P(e,n),i=await this.core.crypto.encode(t,r),a=(await this.core.history.get(t,e)).request.method,o=jl[a]?jl[a].res:jl.unregistered_method.res;await this.core.relayer.publish(t,i,o),await this.core.history.resolve(r)}),q(this,`deletePairing`,async(e,t)=>{await this.core.relayer.unsubscribe(e),await Promise.all([this.pairings.delete(e,H(`USER_DISCONNECTED`)),this.core.crypto.deleteSymKey(e),t?Promise.resolve():this.core.expirer.del(e)])}),q(this,`cleanup`,async()=>{let e=this.pairings.getAll().filter(e=>sn(e.expiry));await Promise.all(e.map(e=>this.deletePairing(e.topic)))}),q(this,`onRelayEventRequest`,async e=>{let{topic:t,payload:n}=e;switch(n.method){case`wc_pairingPing`:return await this.onPairingPingRequest(t,n);case`wc_pairingDelete`:return await this.onPairingDeleteRequest(t,n);default:return await this.onUnknownRpcMethodRequest(t,n)}}),q(this,`onRelayEventResponse`,async e=>{let{topic:t,payload:n}=e,r=(await this.core.history.get(t,n.id)).request.method;switch(r){case`wc_pairingPing`:return this.onPairingPingResponse(t,n);default:return this.onUnknownRpcMethodResponse(r)}}),q(this,`onPairingPingRequest`,async(e,t)=>{let{id:n}=t;try{this.isValidPing({topic:e}),await this.sendResult(n,e,!0),this.events.emit(Ml.ping,{id:n,topic:e})}catch(t){await this.sendError(n,e,t),this.logger.error(t)}}),q(this,`onPairingPingResponse`,(e,t)=>{let{id:n}=t;setTimeout(()=>{M(t)?this.events.emit(z(`pairing_ping`,n),{}):D(t)&&this.events.emit(z(`pairing_ping`,n),{error:t.error})},500)}),q(this,`onPairingDeleteRequest`,async(e,t)=>{let{id:n}=t;try{this.isValidDisconnect({topic:e}),await this.deletePairing(e),this.events.emit(Ml.delete,{id:n,topic:e})}catch(t){await this.sendError(n,e,t),this.logger.error(t)}}),q(this,`onUnknownRpcMethodRequest`,async(e,t)=>{let{id:n,method:r}=t;try{if(this.registeredMethods.includes(r))return;let t=H(`WC_METHOD_UNSUPPORTED`,r);await this.sendError(n,e,t),this.logger.error(t)}catch(t){await this.sendError(n,e,t),this.logger.error(t)}}),q(this,`onUnknownRpcMethodResponse`,e=>{this.registeredMethods.includes(e)||this.logger.error(H(`WC_METHOD_UNSUPPORTED`,e))}),q(this,`isValidPair`,(e,t)=>{var n;if(!vc(e)){let{message:n}=V(`MISSING_OR_INVALID`,`pair() params: ${e}`);throw t.setError(Gl.malformed_pairing_uri),Error(n)}if(!nc(e.uri)){let{message:n}=V(`MISSING_OR_INVALID`,`pair() uri: ${e.uri}`);throw t.setError(Gl.malformed_pairing_uri),Error(n)}let r=Ss(e?.uri);if(!((n=r?.relay)!=null&&n.protocol)){let{message:e}=V(`MISSING_OR_INVALID`,`pair() uri#relay-protocol`);throw t.setError(Gl.malformed_pairing_uri),Error(e)}if(!(r!=null&&r.symKey)){let{message:e}=V(`MISSING_OR_INVALID`,`pair() uri#symKey`);throw t.setError(Gl.malformed_pairing_uri),Error(e)}if(r!=null&&r.expiryTimestamp&&(0,U.toMiliseconds)(r?.expiryTimestamp)<Date.now()){t.setError(Gl.pairing_expired);let{message:e}=V(`EXPIRED`,`pair() URI has expired. Please try again with a new connection URI.`);throw Error(e)}}),q(this,`isValidPing`,async e=>{if(!vc(e)){let{message:t}=V(`MISSING_OR_INVALID`,`ping() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidPairingTopic(t)}),q(this,`isValidDisconnect`,async e=>{if(!vc(e)){let{message:t}=V(`MISSING_OR_INVALID`,`disconnect() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidPairingTopic(t)}),q(this,`isValidPairingTopic`,async e=>{if(!Zs(e,!1)){let{message:t}=V(`MISSING_OR_INVALID`,`pairing topic should be a string: ${e}`);throw Error(t)}if(!this.pairings.keys.includes(e)){let{message:t}=V(`NO_MATCHING_KEY`,`pairing topic doesn't exist: ${e}`);throw Error(t)}if(sn(this.pairings.get(e).expiry)){await this.deletePairing(e);let{message:t}=V(`EXPIRED`,`pairing topic: ${e}`);throw Error(t)}}),this.core=e,this.logger=x(t,this.name),this.pairings=new Ep(this.core,this.logger,this.name,this.storagePrefix)}get context(){return C(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}registerRelayerEvents(){this.core.relayer.on(Cl.message,async e=>{let{topic:t,message:n,transportType:r}=e;if(this.pairings.keys.includes(t)&&r!==W.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{let e=await this.core.crypto.decode(t,n);S(e)?(this.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e})):A(e)&&(await this.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e}),this.core.history.delete(t,e.id)),await this.core.relayer.messages.ack(t,n)}catch(e){this.logger.error(e)}})}registerExpirerEvents(){this.core.expirer.on(Il.expired,async e=>{let{topic:t}=an(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(Ml.expire,{topic:t}))})}},Ap=Object.defineProperty,jp=(e,t,n)=>t in e?Ap(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Mp=(e,t,n)=>jp(e,typeof t==`symbol`?t:t+``,n),Np=class extends Jc{constructor(e,t){super(e,t),this.core=e,this.logger=t,Mp(this,`records`,new Map),Mp(this,`events`,new ll.EventEmitter),Mp(this,`name`,Pl),Mp(this,`version`,`0.3`),Mp(this,`cached`,[]),Mp(this,`initialized`,!1),Mp(this,`storagePrefix`,fl),Mp(this,`init`,async()=>{this.initialized||=(this.logger.trace(`Initialized`),await this.restore(),this.cached.forEach(e=>this.records.set(e.id,e)),this.cached=[],this.registerEventListeners(),!0)}),Mp(this,`set`,(e,t,n)=>{if(this.isInitialized(),this.logger.debug(`Setting JSON-RPC request history record`),this.logger.trace({type:`method`,method:`set`,topic:e,request:t,chainId:n}),this.records.has(t.id))return;let r={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:n,expiry:on(U.THIRTY_DAYS)};this.records.set(r.id,r),this.persist(),this.events.emit(Nl.created,r)}),Mp(this,`resolve`,async e=>{if(this.isInitialized(),this.logger.debug(`Updating JSON-RPC response history record`),this.logger.trace({type:`method`,method:`update`,response:e}),!this.records.has(e.id))return;let t=await this.getRecord(e.id);typeof t.response>`u`&&(t.response=D(e)?{error:e.error}:{result:e.result},this.records.set(t.id,t),this.persist(),this.events.emit(Nl.updated,t))}),Mp(this,`get`,async(e,t)=>(this.isInitialized(),this.logger.debug(`Getting record`),this.logger.trace({type:`method`,method:`get`,topic:e,id:t}),await this.getRecord(t))),Mp(this,`delete`,(e,t)=>{this.isInitialized(),this.logger.debug(`Deleting record`),this.logger.trace({type:`method`,method:`delete`,id:t}),this.values.forEach(n=>{if(n.topic===e){if(typeof t<`u`&&n.id!==t)return;this.records.delete(n.id),this.events.emit(Nl.deleted,n)}}),this.persist()}),Mp(this,`exists`,async(e,t)=>(this.isInitialized(),this.records.has(t)?(await this.getRecord(t)).topic===e:!1)),Mp(this,`on`,(e,t)=>{this.events.on(e,t)}),Mp(this,`once`,(e,t)=>{this.events.once(e,t)}),Mp(this,`off`,(e,t)=>{this.events.off(e,t)}),Mp(this,`removeListener`,(e,t)=>{this.events.removeListener(e,t)}),this.logger=x(t,this.name)}get context(){return C(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+`//`+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(t=>{if(typeof t.response<`u`)return;let n={topic:t.topic,request:w(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();let t=this.records.get(e);if(!t){let{message:t}=V(`NO_MATCHING_KEY`,`${this.name}: ${e}`);throw Error(t)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Nl.sync)}async restore(){try{let e=await this.getJsonRpcRecords();if(typeof e>`u`||!e.length)return;if(this.records.size){let{message:e}=V(`RESTORE_WILL_OVERRIDE`,this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:`method`,method:`restore`,records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Nl.created,e=>{let t=Nl.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,record:e})}),this.events.on(Nl.updated,e=>{let t=Nl.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,record:e})}),this.events.on(Nl.deleted,e=>{let t=Nl.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,record:e})}),this.core.heartbeat.on(l.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{(0,U.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(Nl.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}},Pp=Object.defineProperty,Fp=(e,t,n)=>t in e?Pp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ip=(e,t,n)=>Fp(e,typeof t==`symbol`?t:t+``,n),Lp=class extends el{constructor(e,t){super(e,t),this.core=e,this.logger=t,Ip(this,`expirations`,new Map),Ip(this,`events`,new ll.EventEmitter),Ip(this,`name`,Fl),Ip(this,`version`,`0.3`),Ip(this,`cached`,[]),Ip(this,`initialized`,!1),Ip(this,`storagePrefix`,fl),Ip(this,`init`,async()=>{this.initialized||=(this.logger.trace(`Initialized`),await this.restore(),this.cached.forEach(e=>this.expirations.set(e.target,e)),this.cached=[],this.registerEventListeners(),!0)}),Ip(this,`has`,e=>{try{let t=this.formatTarget(e);return typeof this.getExpiration(t)<`u`}catch{return!1}}),Ip(this,`set`,(e,t)=>{this.isInitialized();let n=this.formatTarget(e),r={target:n,expiry:t};this.expirations.set(n,r),this.checkExpiry(n,r),this.events.emit(Il.created,{target:n,expiration:r})}),Ip(this,`get`,e=>{this.isInitialized();let t=this.formatTarget(e);return this.getExpiration(t)}),Ip(this,`del`,e=>{if(this.isInitialized(),this.has(e)){let t=this.formatTarget(e),n=this.getExpiration(t);this.expirations.delete(t),this.events.emit(Il.deleted,{target:t,expiration:n})}}),Ip(this,`on`,(e,t)=>{this.events.on(e,t)}),Ip(this,`once`,(e,t)=>{this.events.once(e,t)}),Ip(this,`off`,(e,t)=>{this.events.off(e,t)}),Ip(this,`removeListener`,(e,t)=>{this.events.removeListener(e,t)}),this.logger=x(t,this.name)}get context(){return C(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+`//`+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e==`string`)return nn(e);if(typeof e==`number`)return rn(e);let{message:t}=V(`UNKNOWN_TYPE`,`Target type: ${typeof e}`);throw Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Il.sync)}async restore(){try{let e=await this.getExpirations();if(typeof e>`u`||!e.length)return;if(this.expirations.size){let{message:e}=V(`RESTORE_WILL_OVERRIDE`,this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:`method`,method:`restore`,expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){let t=this.expirations.get(e);if(!t){let{message:t}=V(`NO_MATCHING_KEY`,`${this.name}: ${e}`);throw this.logger.warn(t),Error(t)}return t}checkExpiry(e,t){let{expiry:n}=t;(0,U.toMiliseconds)(n)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Il.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(l.pulse,()=>this.checkExpirations()),this.events.on(Il.created,e=>{let t=Il.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,data:e}),this.persist()}),this.events.on(Il.expired,e=>{let t=Il.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,data:e}),this.persist()}),this.events.on(Il.deleted,e=>{let t=Il.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}},Rp=Object.defineProperty,zp=(e,t,n)=>t in e?Rp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Bp=(e,t,n)=>zp(e,typeof t==`symbol`?t:t+``,n),Vp=class extends tl{constructor(e,t,n){super(e,t,n),this.core=e,this.logger=t,this.store=n,Bp(this,`name`,Ll),Bp(this,`abortController`),Bp(this,`isDevEnv`),Bp(this,`verifyUrlV3`,Bl),Bp(this,`storagePrefix`,fl),Bp(this,`version`,2),Bp(this,`publicKey`),Bp(this,`fetchPromise`),Bp(this,`init`,async()=>{this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,U.toMiliseconds)(this.publicKey?.expiresAt)<Date.now()&&(this.logger.debug(`verify v2 public key expired`),await this.removePublicKey()))}),Bp(this,`register`,async e=>{if(!Bt()||this.isDevEnv)return;let t=window.location.origin,{id:n,decryptedId:r}=e,i=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${t}&id=${n}&decryptedId=${r}`;try{let e=(0,ul.getDocument)(),t=this.startAbortTimer(U.ONE_SECOND*5),r=await new Promise((r,a)=>{let o=()=>{window.removeEventListener(`message`,l),e.body.removeChild(c),a(`attestation aborted`)};this.abortController.signal.addEventListener(`abort`,o);let c=e.createElement(`iframe`);c.src=i,c.style.display=`none`,c.addEventListener(`error`,o,{signal:this.abortController.signal});let l=i=>{if(i.data&&typeof i.data==`string`)try{let a=JSON.parse(i.data);if(a.type===`verify_attestation`){if(s(a.attestation).payload.id!==n)return;clearInterval(t),e.body.removeChild(c),this.abortController.signal.removeEventListener(`abort`,o),window.removeEventListener(`message`,l),r(a.attestation===null?``:a.attestation)}}catch(e){this.logger.warn(e)}};e.body.appendChild(c),window.addEventListener(`message`,l,{signal:this.abortController.signal})});return this.logger.debug(`jwt attestation`,r),r}catch(e){this.logger.warn(e)}return``}),Bp(this,`resolve`,async e=>{if(this.isDevEnv)return``;let{attestationId:t,hash:n,encryptedId:r}=e;if(t===``){this.logger.debug(`resolve: attestationId is empty, skipping`);return}if(t){if(s(t).payload.id!==r)return;let e=await this.isValidJwtAttestation(t);if(e){if(!e.isVerified){this.logger.warn(`resolve: jwt attestation: origin url not verified`);return}return e}}if(!n)return;let i=this.getVerifyUrl(e?.verifyUrl);return this.fetchAttestation(n,i)}),Bp(this,`fetchAttestation`,async(e,t)=>{this.logger.debug(`resolving attestation: ${e} from url: ${t}`);let n=this.startAbortTimer(U.ONE_SECOND*5),r=await fetch(`${t}/attestation/${e}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(n),r.status===200?await r.json():void 0}),Bp(this,`getVerifyUrl`,e=>{let t=e||`https://verify.walletconnect.org`;return Vl.includes(t)||(this.logger.info(`verify url: ${t}, not included in trusted list, assigning default: https://verify.walletconnect.org`),t=`https://verify.walletconnect.org`),t}),Bp(this,`fetchPublicKey`,async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let e=this.startAbortTimer(U.FIVE_SECONDS),t=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(e),await t.json()}catch(e){this.logger.warn(e)}}),Bp(this,`persistPublicKey`,async e=>{this.logger.debug(`persisting public key to local storage`,e),await this.store.setItem(this.storeKey,e),this.publicKey=e}),Bp(this,`removePublicKey`,async()=>{this.logger.debug(`removing verify v2 public key from storage`),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Bp(this,`isValidJwtAttestation`,async e=>{let t=await this.getPublicKey();try{if(t)return this.validateAttestation(e,t)}catch(e){this.logger.error(e),this.logger.warn(`error validating attestation`)}let n=await this.fetchAndPersistPublicKey();try{if(n)return this.validateAttestation(e,n)}catch(e){this.logger.error(e),this.logger.warn(`error validating attestation`)}}),Bp(this,`getPublicKey`,async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Bp(this,`fetchAndPersistPublicKey`,async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async e=>{let t=await this.fetchPublicKey();t&&(await this.persistPublicKey(t),e(t))});let e=await this.fetchPromise;return this.fetchPromise=void 0,e}),Bp(this,`validateAttestation`,(e,t)=>{let n=vs(e,t.publicKey),r={hasExpired:(0,U.toMiliseconds)(n.exp)<Date.now(),payload:n};if(r.hasExpired)throw this.logger.warn(`resolve: jwt attestation expired`),Error(`JWT attestation expired`);return{origin:r.payload.origin,isScam:r.payload.isScam,isVerified:r.payload.isVerified}}),this.logger=x(t,this.name),this.abortController=new AbortController,this.isDevEnv=hn(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+`//verify:public:key`}get context(){return C(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,U.toMiliseconds)(e))}},Hp=Object.defineProperty,Up=(e,t,n)=>t in e?Hp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Wp=(e,t,n)=>Up(e,typeof t==`symbol`?t:t+``,n),Gp=class extends nl{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,Wp(this,`context`,Hl),Wp(this,`registerDeviceToken`,async e=>{let{clientId:t,token:n,notificationType:r,enableEncrypted:i=!1}=e,a=`${Ul}/${this.projectId}/clients`;await fetch(a,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({client_id:t,type:r,token:n,always_raw:i})})}),this.logger=x(t,this.context)}},Kp=Object.defineProperty,qp=Object.getOwnPropertySymbols,Jp=Object.prototype.hasOwnProperty,Yp=Object.prototype.propertyIsEnumerable,Xp=(e,t,n)=>t in e?Kp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Zp=(e,t)=>{for(var n in t||={})Jp.call(t,n)&&Xp(e,n,t[n]);if(qp)for(var n of qp(t))Yp.call(t,n)&&Xp(e,n,t[n]);return e},Qp=(e,t,n)=>Xp(e,typeof t==`symbol`?t:t+``,n),$p=class extends rl{constructor(e,t,n=!0){super(e,t,n),this.core=e,this.logger=t,Qp(this,`context`,Zl),Qp(this,`storagePrefix`,fl),Qp(this,`storageVersion`,Xl),Qp(this,`events`,new Map),Qp(this,`shouldPersist`,!1),Qp(this,`init`,async()=>{if(!hn())try{let e={eventId:mn(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:`INIT`,type:``,properties:{client_id:await this.core.crypto.getClientId(),user_agent:Jt(this.core.relayer.protocol,this.core.relayer.version,Tl)}}};await this.sendEvent([e])}catch(e){this.logger.warn(e)}}),Qp(this,`createEvent`,e=>{let{event:t=`ERROR`,type:n=``,properties:{topic:r,trace:i}}=e,a=mn(),o=this.core.projectId||``,s=Zp({eventId:a,timestamp:Date.now(),props:{event:t,type:n,properties:{topic:r,trace:i}},bundleId:o,domain:this.getAppDomain()},this.setMethods(a));return this.telemetryEnabled&&(this.events.set(a,s),this.shouldPersist=!0),s}),Qp(this,`getEvent`,e=>{let{eventId:t,topic:n}=e;if(t)return this.events.get(t);let r=Array.from(this.events.values()).find(e=>e.props.properties.topic===n);if(r)return Zp(Zp({},r),this.setMethods(r.eventId))}),Qp(this,`deleteEvent`,e=>{let{eventId:t}=e;this.events.delete(t),this.shouldPersist=!0}),Qp(this,`setEventListeners`,()=>{this.core.heartbeat.on(l.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(e=>{(0,U.fromMiliseconds)(Date.now())-(0,U.fromMiliseconds)(e.timestamp)>86400&&(this.events.delete(e.eventId),this.shouldPersist=!0)})})}),Qp(this,`setMethods`,e=>({addTrace:t=>this.addTrace(e,t),setError:t=>this.setError(e,t)})),Qp(this,`addTrace`,(e,t)=>{let n=this.events.get(e);n&&(n.props.properties.trace.push(t),this.events.set(e,n),this.shouldPersist=!0)}),Qp(this,`setError`,(e,t)=>{let n=this.events.get(e);n&&(n.props.type=t,n.timestamp=Date.now(),this.events.set(e,n),this.shouldPersist=!0)}),Qp(this,`persist`,async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Qp(this,`restore`,async()=>{try{let e=await this.core.storage.getItem(this.storageKey)||[];if(!e.length)return;e.forEach(e=>{this.events.set(e.eventId,Zp(Zp({},e),this.setMethods(e.eventId)))})}catch(e){this.logger.warn(e)}}),Qp(this,`submit`,async()=>{if(!this.telemetryEnabled||this.events.size===0)return;let e=[];for(let[t,n]of this.events)n.props.type&&e.push(n);if(e.length!==0)try{if((await this.sendEvent(e)).ok)for(let t of e)this.events.delete(t.eventId),this.shouldPersist=!0}catch(e){this.logger.warn(e)}}),Qp(this,`sendEvent`,async e=>{let t=this.getAppDomain()?``:`&sp=desktop`;return await fetch(`${Ql}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Tl}${t}`,{method:`POST`,body:JSON.stringify(e)})}),Qp(this,`getAppDomain`,()=>Gt().url),this.logger=x(t,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+`//`+this.context}},em=Object.defineProperty,tm=Object.getOwnPropertySymbols,nm=Object.prototype.hasOwnProperty,rm=Object.prototype.propertyIsEnumerable,im=(e,t,n)=>t in e?em(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,am=(e,t)=>{for(var n in t||={})nm.call(t,n)&&im(e,n,t[n]);if(tm)for(var n of tm(t))rm.call(t,n)&&im(e,n,t[n]);return e},J=(e,t,n)=>im(e,typeof t==`symbol`?t:t+``,n),om=class e extends Wc{constructor(e){var t;super(e),J(this,`protocol`,`wc`),J(this,`version`,2),J(this,`name`,dl),J(this,`relayUrl`),J(this,`projectId`),J(this,`customStoragePrefix`),J(this,`events`,new ll.EventEmitter),J(this,`logger`),J(this,`heartbeat`),J(this,`relayer`),J(this,`crypto`),J(this,`storage`),J(this,`history`),J(this,`expirer`),J(this,`pairing`),J(this,`verify`),J(this,`echoClient`),J(this,`linkModeSupportedApps`),J(this,`eventClient`),J(this,`initialized`,!1),J(this,`logChunkController`),J(this,`on`,(e,t)=>this.events.on(e,t)),J(this,`once`,(e,t)=>this.events.once(e,t)),J(this,`off`,(e,t)=>this.events.off(e,t)),J(this,`removeListener`,(e,t)=>this.events.removeListener(e,t)),J(this,`dispatchEnvelope`,({topic:e,message:t,sessionExists:n})=>{if(!e||!t)return;let r={topic:e,message:t,publishedAt:Date.now(),transportType:W.link_mode};this.relayer.onLinkMessageEvent(r,{sessionExists:n})});let n=this.getGlobalCore(e?.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(e){console.warn(`Failed to copy global core`,e)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||`wss://relay.walletconnect.org`,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:``;let{logger:r,chunkLoggerController:i}=E({opts:L({level:typeof e?.logger==`string`&&e.logger?e.logger:pl.logger,name:dl}),maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=i,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var e,t;(e=this.logChunkController)!=null&&e.downloadLogsBlobInBrowser&&((t=this.logChunkController)==null||t.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=x(r,this.name),this.heartbeat=new f,this.crypto=new qd(this,this.logger,e?.keychain),this.history=new Np(this,this.logger),this.expirer=new Lp(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new h(am(am({},ml),e?.storageOptions)),this.relayer=new Lf({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new kp(this,this.logger),this.verify=new Vp(this,this.logger,this.storage),this.echoClient=new Gp(this.projectId||``,this.logger),this.linkModeSupportedApps=[],this.eventClient=new $p(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(t){let n=new e(t);await n.initialize();let r=await n.crypto.getClientId();return await n.storage.setItem(Dl,r),n}get context(){return C(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){return this.logChunkController?.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(`WALLETCONNECT_LINK_MODE_APPS`,this.linkModeSupportedApps))}async initialize(){this.logger.trace(`Initialized`);try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(`WALLETCONNECT_LINK_MODE_APPS`)||[],this.initialized=!0,this.logger.info(`Core Initialization Success`)}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=``){try{if(this.isGlobalCoreDisabled())return;let t=`_walletConnectCore_${e}`,n=`${t}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[t]}catch(e){console.warn(`Failed to get global WalletConnect core`,e);return}}setGlobalCore(e){try{if(this.isGlobalCoreDisabled())return;let t=`_walletConnectCore_${e.opts?.customStoragePrefix||``}`;globalThis[t]=e}catch(e){console.warn(`Failed to set global WalletConnect core`,e)}}isGlobalCoreDisabled(){try{return typeof process<`u`&&{}.DISABLE_GLOBAL_CORE===`true`}catch{return!0}}},Y=r(),sm=t(n()),cm=`client`,lm=`wc@2:${cm}:`,um={name:cm,logger:`error`,controller:!1,relayUrl:`wss://relay.walletconnect.org`},dm=`WALLETCONNECT_DEEPLINK_CHOICE`,fm=`proposal`;Y.THIRTY_DAYS;var pm=`Proposal expired`,mm=`session`,hm=Y.SEVEN_DAYS,gm=`engine`,_m={wc_sessionPropose:{req:{ttl:Y.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Y.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Y.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Y.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Y.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Y.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Y.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Y.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Y.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Y.ONE_DAY,prompt:!1,tag:1114},res:{ttl:Y.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:Y.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:Y.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1119}}},vm={min:Y.FIVE_MINUTES,max:Y.SEVEN_DAYS},ym={idle:`IDLE`,active:`ACTIVE`},bm={eth_sendTransaction:{key:``},eth_sendRawTransaction:{key:``},wallet_sendCalls:{key:``},solana_signTransaction:{key:`signature`},solana_signAllTransactions:{key:`transactions`},solana_signAndSendTransaction:{key:`signature`}},xm=`request`,Sm=[`wc_sessionPropose`,`wc_sessionRequest`,`wc_authRequest`,`wc_sessionAuthenticate`],Cm=`auth`,wm=`authKeys`,Tm=`pairingTopics`,Em=`requests`,Dm=`wc@1.5:${Cm}:`,Om=`${Dm}:PUB_KEY`,km=Object.defineProperty,Am=Object.defineProperties,jm=Object.getOwnPropertyDescriptors,Mm=Object.getOwnPropertySymbols,Nm=Object.prototype.hasOwnProperty,Pm=Object.prototype.propertyIsEnumerable,Fm=(e,t,n)=>t in e?km(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,X=(e,t)=>{for(var n in t||={})Nm.call(t,n)&&Fm(e,n,t[n]);if(Mm)for(var n of Mm(t))Pm.call(t,n)&&Fm(e,n,t[n]);return e},Im=(e,t)=>Am(e,jm(t)),Z=(e,t,n)=>Fm(e,typeof t==`symbol`?t:t+``,n),Lm=class extends cl{constructor(e){super(e),Z(this,`name`,gm),Z(this,`events`,new sm.default),Z(this,`initialized`,!1),Z(this,`requestQueue`,{state:ym.idle,queue:[]}),Z(this,`sessionRequestQueue`,{state:ym.idle,queue:[]}),Z(this,`requestQueueDelay`,Y.ONE_SECOND),Z(this,`expectedPairingMethodMap`,new Map),Z(this,`recentlyDeletedMap`,new Map),Z(this,`recentlyDeletedLimit`,200),Z(this,`relayMessageCache`,[]),Z(this,`pendingSessions`,new Map),Z(this,`init`,async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(_m)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,Y.toMiliseconds)(this.requestQueueDelay)))}),Z(this,`connect`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let t=Im(X({},e),{requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}});await this.isValidConnect(t),t.optionalNamespaces=Gs(t.requiredNamespaces,t.optionalNamespaces),t.requiredNamespaces={};let{pairingTopic:n,requiredNamespaces:r,optionalNamespaces:i,sessionProperties:a,scopedProperties:o,relays:s}=t,c=n,l,u=!1;try{if(c){let e=this.client.core.pairing.pairings.get(c);this.client.logger.warn(`connect() with existing pairing topic is deprecated and will be removed in the next major release.`),u=e.active}}catch(e){throw this.client.logger.error(`connect() -> pairing.get(${c}) failed`),e}if(!c||!u){let{topic:e,uri:t}=await this.client.core.pairing.create();c=e,l=t}if(!c){let{message:e}=V(`NO_MATCHING_KEY`,`connect() pairing topic: ${c}`);throw Error(e)}let d=await this.client.core.crypto.generateKeyPair(),f=_m.wc_sessionPropose.req.ttl||Y.FIVE_MINUTES,p=on(f),m=Im(X(X({requiredNamespaces:r,optionalNamespaces:i,relays:s??[{protocol:`irn`}],proposer:{publicKey:d,metadata:this.client.metadata},expiryTimestamp:p,pairingTopic:c},a&&{sessionProperties:a}),o&&{scopedProperties:o}),{id:O()}),h=z(`session_connect`,m.id),{reject:g,resolve:_,done:v}=$t(f,pm),y=({id:e})=>{e===m.id&&(this.client.events.off(`proposal_expire`,y),this.pendingSessions.delete(m.id),this.events.emit(h,{error:{message:`Proposal expired`,code:0}}))};return this.client.events.on(`proposal_expire`,y),this.events.once(h,({error:e,session:t})=>{this.client.events.off(`proposal_expire`,y),e?g(e):t&&_(t)}),await this.sendRequest({topic:c,method:`wc_sessionPropose`,params:m,throwOnFailedPublish:!0,clientRpcId:m.id}),await this.setProposal(m.id,m),{uri:l,approval:v}}),Z(this,`pair`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(e)}catch(e){throw this.client.logger.error(`pair() failed`),e}}),Z(this,`approve`,async e=>{let t=this.client.core.eventClient.createEvent({properties:{topic:(e?.id)?.toString(),trace:[Kl.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(e){throw t.setError(ql.no_internet_connection),e}try{await this.isValidProposalId(e?.id)}catch(n){throw this.client.logger.error(`approve() -> proposal.get(${e?.id}) failed`),t.setError(ql.proposal_not_found),n}try{await this.isValidApprove(e)}catch(e){throw this.client.logger.error(`approve() -> isValidApprove() failed`),t.setError(ql.session_approve_namespace_validation_failure),e}let{id:n,relayProtocol:r,namespaces:i,sessionProperties:a,scopedProperties:o,sessionConfig:s}=e,c=this.client.proposal.get(n);this.client.core.eventClient.deleteEvent({eventId:t.eventId});let{pairingTopic:l,proposer:u,requiredNamespaces:d,optionalNamespaces:f}=c,p=this.client.core.eventClient?.getEvent({topic:l});p||=this.client.core.eventClient?.createEvent({type:Kl.session_approve_started,properties:{topic:l,trace:[Kl.session_approve_started,Kl.session_namespaces_validation_success]}});let m=await this.client.core.crypto.generateKeyPair(),h=u.publicKey,g=await this.client.core.crypto.generateSharedKey(m,h),_=X(X(X({relay:{protocol:r??`irn`},namespaces:i,controller:{publicKey:m,metadata:this.client.metadata},expiry:on(hm)},a&&{sessionProperties:a}),o&&{scopedProperties:o}),s&&{sessionConfig:s}),v=W.relay;p.addTrace(Kl.subscribing_session_topic);try{await this.client.core.relayer.subscribe(g,{transportType:v})}catch(e){throw p.setError(ql.subscribe_session_topic_failure),e}p.addTrace(Kl.subscribe_session_topic_success);let y=Im(X({},_),{topic:g,requiredNamespaces:d,optionalNamespaces:f,pairingTopic:l,acknowledged:!1,self:_.controller,peer:{publicKey:u.publicKey,metadata:u.metadata},controller:m,transportType:W.relay});await this.client.session.set(g,y),p.addTrace(Kl.store_session);try{p.addTrace(Kl.publishing_session_settle),await this.sendRequest({topic:g,method:`wc_sessionSettle`,params:_,throwOnFailedPublish:!0}).catch(e=>{throw p?.setError(ql.session_settle_publish_failure),e}),p.addTrace(Kl.session_settle_publish_success),p.addTrace(Kl.publishing_session_approve),await this.sendResult({id:n,topic:l,result:{relay:{protocol:r??`irn`},responderPublicKey:m},throwOnFailedPublish:!0}).catch(e=>{throw p?.setError(ql.session_approve_publish_failure),e}),p.addTrace(Kl.session_approve_publish_success)}catch(e){throw this.client.logger.error(e),this.client.session.delete(g,H(`USER_DISCONNECTED`)),await this.client.core.relayer.unsubscribe(g),e}return this.client.core.eventClient.deleteEvent({eventId:p.eventId}),await this.client.core.pairing.updateMetadata({topic:l,metadata:u.metadata}),await this.client.proposal.delete(n,H(`USER_DISCONNECTED`)),await this.client.core.pairing.activate({topic:l}),await this.setExpiry(g,on(hm)),{topic:g,acknowledged:()=>Promise.resolve(this.client.session.get(g))}}),Z(this,`reject`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(e)}catch(e){throw this.client.logger.error(`reject() -> isValidReject() failed`),e}let{id:t,reason:n}=e,r;try{r=this.client.proposal.get(t).pairingTopic}catch(e){throw this.client.logger.error(`reject() -> proposal.get(${t}) failed`),e}r&&(await this.sendError({id:t,topic:r,error:n,rpcOpts:_m.wc_sessionPropose.reject}),await this.client.proposal.delete(t,H(`USER_DISCONNECTED`)))}),Z(this,`update`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(e)}catch(e){throw this.client.logger.error(`update() -> isValidUpdate() failed`),e}let{topic:t,namespaces:n}=e,{done:r,resolve:i,reject:a}=$t(),o=O(),s=j().toString(),c=this.client.session.get(t).namespaces;return this.events.once(z(`session_update`,o),({error:e})=>{e?a(e):i()}),await this.client.session.update(t,{namespaces:n}),await this.sendRequest({topic:t,method:`wc_sessionUpdate`,params:{namespaces:n},throwOnFailedPublish:!0,clientRpcId:o,relayRpcId:s}).catch(e=>{this.client.logger.error(e),this.client.session.update(t,{namespaces:c}),a(e)}),{acknowledged:r}}),Z(this,`extend`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(e)}catch(e){throw this.client.logger.error(`extend() -> isValidExtend() failed`),e}let{topic:t}=e,n=O(),{done:r,resolve:i,reject:a}=$t();return this.events.once(z(`session_extend`,n),({error:e})=>{e?a(e):i()}),await this.setExpiry(t,on(hm)),this.sendRequest({topic:t,method:`wc_sessionExtend`,params:{},clientRpcId:n,throwOnFailedPublish:!0}).catch(e=>{a(e)}),{acknowledged:r}}),Z(this,`request`,async e=>{this.isInitialized();try{await this.isValidRequest(e)}catch(e){throw this.client.logger.error(`request() -> isValidRequest() failed`),e}let{chainId:t,request:n,topic:r,expiry:i=_m.wc_sessionRequest.req.ttl}=e,a=this.client.session.get(r);a?.transportType===W.relay&&await this.confirmOnlineStateOrThrow();let o=O(),s=j().toString(),{done:c,resolve:l,reject:u}=$t(i,`Request expired. Please try again.`);this.events.once(z(`session_request`,o),({error:e,result:t})=>{e?u(e):l(t)});let d=`wc_sessionRequest`,f=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(f)return await this.sendRequest({clientRpcId:o,relayRpcId:s,topic:r,method:d,params:{request:Im(X({},n),{expiryTimestamp:on(i)}),chainId:t},expiry:i,throwOnFailedPublish:!0,appLink:f}).catch(e=>u(e)),this.client.events.emit(`session_request_sent`,{topic:r,request:n,chainId:t,id:o}),await c();let p={request:Im(X({},n),{expiryTimestamp:on(i)}),chainId:t},m=this.shouldSetTVF(d,p);return await Promise.all([new Promise(async e=>{await this.sendRequest(X({clientRpcId:o,relayRpcId:s,topic:r,method:d,params:p,expiry:i,throwOnFailedPublish:!0},m&&{tvf:this.getTVFParams(o,p)})).catch(e=>u(e)),this.client.events.emit(`session_request_sent`,{topic:r,request:n,chainId:t,id:o}),e()}),new Promise(async e=>{var t;(t=a.sessionConfig)!=null&&t.disableDeepLink||await ln({id:o,topic:r,wcDeepLink:await fn(this.client.core.storage,dm)}),e()}),c()]).then(e=>e[2])}),Z(this,`respond`,async e=>{this.isInitialized(),await this.isValidRespond(e);let{topic:t,response:n}=e,{id:r}=n,i=this.client.session.get(t);i.transportType===W.relay&&await this.confirmOnlineStateOrThrow();let a=this.getAppLinkIfEnabled(i.peer.metadata,i.transportType);M(n)?await this.sendResult({id:r,topic:t,result:n.result,throwOnFailedPublish:!0,appLink:a}):D(n)&&await this.sendError({id:r,topic:t,error:n.error,appLink:a}),this.cleanupAfterResponse(e)}),Z(this,`ping`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(e)}catch(e){throw this.client.logger.error(`ping() -> isValidPing() failed`),e}let{topic:t}=e;if(this.client.session.keys.includes(t)){let e=O(),n=j().toString(),{done:r,resolve:i,reject:a}=$t();this.events.once(z(`session_ping`,e),({error:e})=>{e?a(e):i()}),await Promise.all([this.sendRequest({topic:t,method:`wc_sessionPing`,params:{},throwOnFailedPublish:!0,clientRpcId:e,relayRpcId:n}),r()])}else this.client.core.pairing.pairings.keys.includes(t)&&(this.client.logger.warn(`ping() on pairing topic is deprecated and will be removed in the next major release.`),await this.client.core.pairing.ping({topic:t}))}),Z(this,`emit`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(e);let{topic:t,event:n,chainId:r}=e,i=j().toString(),a=O();await this.sendRequest({topic:t,method:`wc_sessionEvent`,params:{event:n,chainId:r},throwOnFailedPublish:!0,relayRpcId:i,clientRpcId:a})}),Z(this,`disconnect`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(e);let{topic:t}=e;if(this.client.session.keys.includes(t))await this.sendRequest({topic:t,method:`wc_sessionDelete`,params:H(`USER_DISCONNECTED`),throwOnFailedPublish:!0}),await this.deleteSession({topic:t,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(t))await this.client.core.pairing.disconnect({topic:t});else{let{message:e}=V(`MISMATCHED_TOPIC`,`Session or pairing topic not found: ${t}`);throw Error(e)}}),Z(this,`find`,e=>(this.isInitialized(),this.client.session.getAll().filter(t=>$s(t,e)))),Z(this,`getPendingSessionRequests`,()=>this.client.pendingRequest.getAll()),Z(this,`authenticate`,async(e,t)=>{this.isInitialized(),this.isValidAuthenticate(e);let n=t&&this.client.core.linkModeSupportedApps.includes(t)&&this.client.metadata.redirect?.linkMode,r=n?W.link_mode:W.relay;r===W.relay&&await this.confirmOnlineStateOrThrow();let{chains:i,statement:a=``,uri:o,domain:s,nonce:c,type:l,exp:u,nbf:d,methods:f=[],expiry:p}=e,m=[...e.resources||[]],{topic:h,uri:g}=await this.client.core.pairing.create({methods:[`wc_sessionAuthenticate`],transportType:r});this.client.logger.info({message:`Generated new pairing`,pairing:{topic:h,uri:g}});let _=await this.client.core.crypto.generateKeyPair(),v=ts(_);if(await Promise.all([this.client.auth.authKeys.set(Om,{responseTopic:v,publicKey:_}),this.client.auth.pairingTopics.set(v,{topic:v,pairingTopic:h})]),await this.client.core.relayer.subscribe(v,{transportType:r}),this.client.logger.info(`sending request to new pairing topic: ${h}`),f.length>0){let{namespace:e}=Ct(i[0]),t=Br(e,`request`,f);qr(m)&&(t=Hr(t,m.pop())),m.push(t)}let y=p&&p>_m.wc_sessionAuthenticate.req.ttl?p:_m.wc_sessionAuthenticate.req.ttl,b={authPayload:{type:l??`caip122`,chains:i,statement:a,aud:o,domain:s,version:`1`,nonce:c,iat:new Date().toISOString(),exp:u,nbf:d,resources:m},requester:{publicKey:_,metadata:this.client.metadata},expiryTimestamp:on(y)},x={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:i,methods:[...new Set([`personal_sign`,...f])],events:[`chainChanged`,`accountsChanged`]}},relays:[{protocol:`irn`}],pairingTopic:h,proposer:{publicKey:_,metadata:this.client.metadata},expiryTimestamp:on(_m.wc_sessionPropose.req.ttl),id:O()},{done:S,resolve:C,reject:T}=$t(y,`Request expired`),E=O(),D=z(`session_connect`,x.id),k=z(`session_request`,E),A=async({error:e,session:t})=>{this.events.off(k,j),e?T(e):t&&C({session:t})},j=async e=>{var n,i,a;if(await this.deletePendingAuthRequest(E,{message:`fulfilled`,code:0}),e.error){let t=H(`WC_METHOD_UNSUPPORTED`,`wc_sessionAuthenticate`);return e.error.code===t.code?void 0:(this.events.off(D,A),T(e.error.message))}await this.deleteProposal(x.id),this.events.off(D,A);let{cacaos:o,responder:s}=e.result,c=[],l=[];for(let e of o){await jr({cacao:e,projectId:this.client.core.projectId})||(this.client.logger.error(e,`Signature verification failed`),T(H(`SESSION_SETTLEMENT_FAILED`,`Signature verification failed`)));let{p:t}=e,n=qr(t.resources),r=[kr(t.iss)],i=Ar(t.iss);if(n){let e=Gr(n),t=Kr(n);c.push(...e),r.push(...t)}for(let e of r)l.push(`${e}:${i}`)}let u=await this.client.core.crypto.generateSharedKey(_,s.publicKey),d;c.length>0&&(d={topic:u,acknowledged:!0,self:{publicKey:_,metadata:this.client.metadata},peer:s,controller:s.publicKey,expiry:on(hm),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:`irn`},pairingTopic:h,namespaces:Ws([...new Set(c)],[...new Set(l)]),transportType:r},await this.client.core.relayer.subscribe(u,{transportType:r}),await this.client.session.set(u,d),h&&await this.client.core.pairing.updateMetadata({topic:h,metadata:s.metadata}),d=this.client.session.get(u)),(n=this.client.metadata.redirect)!=null&&n.linkMode&&(i=s.metadata.redirect)!=null&&i.linkMode&&(a=s.metadata.redirect)!=null&&a.universal&&t&&(this.client.core.addLinkModeSupportedApp(s.metadata.redirect.universal),this.client.session.update(u,{transportType:W.link_mode})),C({auths:o,session:d})};this.events.once(D,A),this.events.once(k,j);let M;try{if(n){let e=w(`wc_sessionAuthenticate`,b,E);this.client.core.history.set(h,e),M=Es(t,h,await this.client.core.crypto.encode(``,e,{type:2,encoding:Ko}))}else await Promise.all([this.sendRequest({topic:h,method:`wc_sessionAuthenticate`,params:b,expiry:e.expiry,throwOnFailedPublish:!0,clientRpcId:E}),this.sendRequest({topic:h,method:`wc_sessionPropose`,params:x,expiry:_m.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:x.id})])}catch(e){throw this.events.off(D,A),this.events.off(k,j),e}return await this.setProposal(x.id,x),await this.setAuthRequest(E,{request:Im(X({},b),{verifyContext:{}}),pairingTopic:h,transportType:r}),{uri:M??g,response:S}}),Z(this,`approveSessionAuthenticate`,async e=>{let{id:t,auths:n}=e,r=this.client.core.eventClient.createEvent({properties:{topic:t.toString(),trace:[Jl.authenticated_session_approve_started]}});try{this.isInitialized()}catch(e){throw r.setError(Yl.no_internet_connection),e}let i=this.getPendingAuthRequest(t);if(!i)throw r.setError(Yl.authenticated_session_pending_request_not_found),Error(`Could not find pending auth request with id ${t}`);let a=i.transportType||W.relay;a===W.relay&&await this.confirmOnlineStateOrThrow();let o=i.requester.publicKey,s=await this.client.core.crypto.generateKeyPair(),c=ts(o),l={type:1,receiverPublicKey:o,senderPublicKey:s},u=[],d=[];for(let e of n){if(!await jr({cacao:e,projectId:this.client.core.projectId})){r.setError(Yl.invalid_cacao);let e=H(`SESSION_SETTLEMENT_FAILED`,`Signature verification failed`);throw await this.sendError({id:t,topic:c,error:e,encodeOpts:l}),Error(e.message)}r.addTrace(Jl.cacaos_verified);let{p:n}=e,i=qr(n.resources),a=[kr(n.iss)],o=Ar(n.iss);if(i){let e=Gr(i),t=Kr(i);u.push(...e),a.push(...t)}for(let e of a)d.push(`${e}:${o}`)}let f=await this.client.core.crypto.generateSharedKey(s,o);r.addTrace(Jl.create_authenticated_session_topic);let p;if(u?.length>0){p={topic:f,acknowledged:!0,self:{publicKey:s,metadata:this.client.metadata},peer:{publicKey:o,metadata:i.requester.metadata},controller:o,expiry:on(hm),authentication:n,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:`irn`},pairingTopic:i.pairingTopic,namespaces:Ws([...new Set(u)],[...new Set(d)]),transportType:a},r.addTrace(Jl.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(f,{transportType:a})}catch(e){throw r.setError(Yl.subscribe_authenticated_session_topic_failure),e}r.addTrace(Jl.subscribe_authenticated_session_topic_success),await this.client.session.set(f,p),r.addTrace(Jl.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:i.pairingTopic,metadata:i.requester.metadata})}r.addTrace(Jl.publishing_authenticated_session_approve);try{await this.sendResult({topic:c,id:t,result:{cacaos:n,responder:{publicKey:s,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(i.requester.metadata,a)})}catch(e){throw r.setError(Yl.authenticated_session_approve_publish_failure),e}return await this.client.auth.requests.delete(t,{message:`fulfilled`,code:0}),await this.client.core.pairing.activate({topic:i.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:r.eventId}),{session:p}}),Z(this,`rejectSessionAuthenticate`,async e=>{this.isInitialized();let{id:t,reason:n}=e,r=this.getPendingAuthRequest(t);if(!r)throw Error(`Could not find pending auth request with id ${t}`);r.transportType===W.relay&&await this.confirmOnlineStateOrThrow();let i=r.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),o=ts(i),s={type:1,receiverPublicKey:i,senderPublicKey:a};await this.sendError({id:t,topic:o,error:n,encodeOpts:s,rpcOpts:_m.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(r.requester.metadata,r.transportType)}),await this.client.auth.requests.delete(t,{message:`rejected`,code:0}),await this.client.proposal.delete(t,H(`USER_DISCONNECTED`))}),Z(this,`formatAuthMessage`,e=>{this.isInitialized();let{request:t,iss:n}=e;return Mr(t,n)}),Z(this,`processRelayMessageCache`,()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{let e=this.relayMessageCache.shift();e&&await this.onRelayMessage(e)}catch(e){this.client.logger.error(e)}},50)}),Z(this,`cleanupDuplicatePairings`,async e=>{if(e.pairingTopic)try{let t=this.client.core.pairing.pairings.get(e.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(n=>n.peerMetadata?.url&&n.peerMetadata?.url===e.peer.metadata.url&&n.topic&&n.topic!==t.topic);if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(e=>this.client.core.pairing.disconnect({topic:e.topic}))),this.client.logger.info(`Duplicate pairings clean up finished`)}catch(e){this.client.logger.error(e)}}),Z(this,`deleteSession`,async e=>{let{topic:t,expirerHasDeleted:n=!1,emitEvent:r=!0,id:i=0}=e,{self:a}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),await this.client.session.delete(t,H(`USER_DISCONNECTED`)),this.addToRecentlyDeleted(t,`session`),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(t)&&await this.client.core.crypto.deleteSymKey(t),n||this.client.core.expirer.del(t),this.client.core.storage.removeItem(dm).catch(e=>this.client.logger.warn(e)),this.getPendingSessionRequests().forEach(e=>{e.topic===t&&this.deletePendingSessionRequest(e.id,H(`USER_DISCONNECTED`))}),t===this.sessionRequestQueue.queue[0]?.topic&&(this.sessionRequestQueue.state=ym.idle),r&&this.client.events.emit(`session_delete`,{id:i,topic:t})}),Z(this,`deleteProposal`,async(e,t)=>{if(t)try{let t=this.client.proposal.get(e);this.client.core.eventClient.getEvent({topic:t.pairingTopic})?.setError(ql.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(e,H(`USER_DISCONNECTED`)),t?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,`proposal`)}),Z(this,`deletePendingSessionRequest`,async(e,t,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(e,t),n?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,`request`),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(t=>t.id!==e),n&&(this.sessionRequestQueue.state=ym.idle,this.client.events.emit(`session_request_expire`,{id:e}))}),Z(this,`deletePendingAuthRequest`,async(e,t,n=!1)=>{await Promise.all([this.client.auth.requests.delete(e,t),n?Promise.resolve():this.client.core.expirer.del(e)])}),Z(this,`setExpiry`,async(e,t)=>{this.client.session.keys.includes(e)&&(this.client.core.expirer.set(e,t),await this.client.session.update(e,{expiry:t}))}),Z(this,`setProposal`,async(e,t)=>{this.client.core.expirer.set(e,on(_m.wc_sessionPropose.req.ttl)),await this.client.proposal.set(e,t)}),Z(this,`setAuthRequest`,async(e,t)=>{let{request:n,pairingTopic:r,transportType:i=W.relay}=t;this.client.core.expirer.set(e,n.expiryTimestamp),await this.client.auth.requests.set(e,{authPayload:n.authPayload,requester:n.requester,expiryTimestamp:n.expiryTimestamp,id:e,pairingTopic:r,verifyContext:n.verifyContext,transportType:i})}),Z(this,`setPendingSessionRequest`,async e=>{let{id:t,topic:n,params:r,verifyContext:i}=e,a=r.request.expiryTimestamp||on(_m.wc_sessionRequest.req.ttl);this.client.core.expirer.set(t,a),await this.client.pendingRequest.set(t,{id:t,topic:n,params:r,verifyContext:i})}),Z(this,`sendRequest`,async e=>{let{topic:t,method:n,params:r,expiry:i,relayRpcId:a,clientRpcId:o,throwOnFailedPublish:s,appLink:c,tvf:l}=e,u=w(n,r,o),d,f=!!c;try{let e=f?Ko:Go;d=await this.client.core.crypto.encode(t,u,{encoding:e})}catch(e){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${t} failed`),e}let p;if(Sm.includes(n)){let e=ns(JSON.stringify(u)),t=ns(d);p=await this.client.core.verify.register({id:t,decryptedId:e})}let m=_m[n].req;if(m.attestation=p,i&&(m.ttl=i),a&&(m.id=a),this.client.core.history.set(t,u),f){let e=Es(c,t,d);await global.Linking.openURL(e,this.client.name)}else{let e=_m[n].req;i&&(e.ttl=i),a&&(e.id=a),e.tvf=Im(X({},l),{correlationId:u.id}),s?(e.internal=Im(X({},e.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(t,d,e)):this.client.core.relayer.publish(t,d,e).catch(e=>this.client.logger.error(e))}return u.id}),Z(this,`sendResult`,async e=>{let{id:t,topic:n,result:r,throwOnFailedPublish:i,encodeOpts:a,appLink:o}=e,s=T(t,r),c,l=o&&typeof(global==null?void 0:global.Linking)<`u`;try{let e=l?Ko:Go;c=await this.client.core.crypto.encode(n,s,Im(X({},a||{}),{encoding:e}))}catch(e){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${n} failed`),e}let u,d;try{u=await this.client.core.history.get(n,t);let e=u.request;try{this.shouldSetTVF(e.method,e.params)&&(d=this.getTVFParams(t,e.params,r))}catch(e){this.client.logger.warn(`sendResult() -> getTVFParams() failed`,e)}}catch(e){throw this.client.logger.error(`sendResult() -> history.get(${n}, ${t}) failed`),e}if(l){let e=Es(o,n,c);await global.Linking.openURL(e,this.client.name)}else{let e=_m[u.request.method].res;e.tvf=Im(X({},d),{correlationId:t}),i?(e.internal=Im(X({},e.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,c,e)):this.client.core.relayer.publish(n,c,e).catch(e=>this.client.logger.error(e))}await this.client.core.history.resolve(s)}),Z(this,`sendError`,async e=>{let{id:t,topic:n,error:r,encodeOpts:i,rpcOpts:a,appLink:o}=e,s=P(t,r),c,l=o&&typeof(global==null?void 0:global.Linking)<`u`;try{let e=l?Ko:Go;c=await this.client.core.crypto.encode(n,s,Im(X({},i||{}),{encoding:e}))}catch(e){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${n} failed`),e}let u;try{u=await this.client.core.history.get(n,t)}catch(e){throw this.client.logger.error(`sendError() -> history.get(${n}, ${t}) failed`),e}if(l){let e=Es(o,n,c);await global.Linking.openURL(e,this.client.name)}else{let e=u.request.method,t=a||_m[e].res;this.client.core.relayer.publish(n,c,t)}await this.client.core.history.resolve(s)}),Z(this,`cleanup`,async()=>{let e=[],t=[];this.client.session.getAll().forEach(t=>{let n=!1;sn(t.expiry)&&(n=!0),this.client.core.crypto.keychain.has(t.topic)||(n=!0),n&&e.push(t.topic)}),this.client.proposal.getAll().forEach(e=>{sn(e.expiryTimestamp)&&t.push(e.id)}),await Promise.all([...e.map(e=>this.deleteSession({topic:e})),...t.map(e=>this.deleteProposal(e))])}),Z(this,`onProviderMessageEvent`,async e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):await this.onRelayMessage(e)}),Z(this,`onRelayEventRequest`,async e=>{this.requestQueue.queue.push(e),await this.processRequestsQueue()}),Z(this,`processRequestsQueue`,async()=>{if(this.requestQueue.state===ym.active){this.client.logger.info(`Request queue already active, skipping...`);return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ym.active;let e=this.requestQueue.queue.shift();if(e)try{await this.processRequest(e)}catch(e){this.client.logger.warn(e)}}this.requestQueue.state=ym.idle}),Z(this,`processRequest`,async e=>{let{topic:t,payload:n,attestation:r,transportType:i,encryptedId:a}=e,o=n.method;if(!this.shouldIgnorePairingRequest({topic:t,requestMethod:o}))switch(o){case`wc_sessionPropose`:return await this.onSessionProposeRequest({topic:t,payload:n,attestation:r,encryptedId:a});case`wc_sessionSettle`:return await this.onSessionSettleRequest(t,n);case`wc_sessionUpdate`:return await this.onSessionUpdateRequest(t,n);case`wc_sessionExtend`:return await this.onSessionExtendRequest(t,n);case`wc_sessionPing`:return await this.onSessionPingRequest(t,n);case`wc_sessionDelete`:return await this.onSessionDeleteRequest(t,n);case`wc_sessionRequest`:return await this.onSessionRequest({topic:t,payload:n,attestation:r,encryptedId:a,transportType:i});case`wc_sessionEvent`:return await this.onSessionEventRequest(t,n);case`wc_sessionAuthenticate`:return await this.onSessionAuthenticateRequest({topic:t,payload:n,attestation:r,encryptedId:a,transportType:i});default:return this.client.logger.info(`Unsupported request method ${o}`)}}),Z(this,`onRelayEventResponse`,async e=>{let{topic:t,payload:n,transportType:r}=e,i=(await this.client.core.history.get(t,n.id)).request.method;switch(i){case`wc_sessionPropose`:return this.onSessionProposeResponse(t,n,r);case`wc_sessionSettle`:return this.onSessionSettleResponse(t,n);case`wc_sessionUpdate`:return this.onSessionUpdateResponse(t,n);case`wc_sessionExtend`:return this.onSessionExtendResponse(t,n);case`wc_sessionPing`:return this.onSessionPingResponse(t,n);case`wc_sessionRequest`:return this.onSessionRequestResponse(t,n);case`wc_sessionAuthenticate`:return this.onSessionAuthenticateResponse(t,n);default:return this.client.logger.info(`Unsupported response method ${i}`)}}),Z(this,`onRelayEventUnknownPayload`,e=>{let{topic:t}=e,{message:n}=V(`MISSING_OR_INVALID`,`Decoded payload on topic ${t} is not identifiable as a JSON-RPC request or a response.`);throw Error(n)}),Z(this,`shouldIgnorePairingRequest`,e=>{let{topic:t,requestMethod:n}=e,r=this.expectedPairingMethodMap.get(t);return!r||r.includes(n)?!1:!!(r.includes(`wc_sessionAuthenticate`)&&this.client.events.listenerCount(`session_authenticate`)>0)}),Z(this,`onSessionProposeRequest`,async e=>{let{topic:t,payload:n,attestation:r,encryptedId:i}=e,{params:a,id:o}=n;try{let e=this.client.core.eventClient.getEvent({topic:t});this.client.events.listenerCount(`session_proposal`)===0&&(console.warn(`No listener for session_proposal event`),e?.setError(Gl.proposal_listener_not_found)),this.isValidConnect(X({},n.params));let s=X({id:o,pairingTopic:t,expiryTimestamp:a.expiryTimestamp||on(_m.wc_sessionPropose.req.ttl)},a);await this.setProposal(o,s);let c=await this.getVerifyContext({attestationId:r,hash:ns(JSON.stringify(n)),encryptedId:i,metadata:s.proposer.metadata});e?.addTrace(Wl.emit_session_proposal),this.client.events.emit(`session_proposal`,{id:o,params:s,verifyContext:c})}catch(e){await this.sendError({id:o,topic:t,error:e,rpcOpts:_m.wc_sessionPropose.autoReject}),this.client.logger.error(e)}}),Z(this,`onSessionProposeResponse`,async(e,t,n)=>{let{id:r}=t;if(M(t)){let{result:i}=t;this.client.logger.trace({type:`method`,method:`onSessionProposeResponse`,result:i});let a=this.client.proposal.get(r);this.client.logger.trace({type:`method`,method:`onSessionProposeResponse`,proposal:a});let o=a.proposer.publicKey;this.client.logger.trace({type:`method`,method:`onSessionProposeResponse`,selfPublicKey:o});let s=i.responderPublicKey;this.client.logger.trace({type:`method`,method:`onSessionProposeResponse`,peerPublicKey:s});let c=await this.client.core.crypto.generateSharedKey(o,s);this.pendingSessions.set(r,{sessionTopic:c,pairingTopic:e,proposalId:r,publicKey:o});let l=await this.client.core.relayer.subscribe(c,{transportType:n});this.client.logger.trace({type:`method`,method:`onSessionProposeResponse`,subscriptionId:l}),await this.client.core.pairing.activate({topic:e})}else if(D(t)){await this.client.proposal.delete(r,H(`USER_DISCONNECTED`));let e=z(`session_connect`,r);if(this.events.listenerCount(e)===0)throw Error(`emitting ${e} without any listeners, 954`);this.events.emit(e,{error:t.error})}}),Z(this,`onSessionSettleRequest`,async(e,t)=>{let{id:n,params:r}=t;try{this.isValidSessionSettleRequest(r);let{relay:n,controller:i,expiry:a,namespaces:o,sessionProperties:s,scopedProperties:c,sessionConfig:l}=t.params,u=[...this.pendingSessions.values()].find(t=>t.sessionTopic===e);if(!u)return this.client.logger.error(`Pending session not found for topic ${e}`);let d=this.client.proposal.get(u.proposalId),f=Im(X(X(X({topic:e,relay:n,expiry:a,namespaces:o,acknowledged:!0,pairingTopic:u.pairingTopic,requiredNamespaces:d.requiredNamespaces,optionalNamespaces:d.optionalNamespaces,controller:i.publicKey,self:{publicKey:u.publicKey,metadata:this.client.metadata},peer:{publicKey:i.publicKey,metadata:i.metadata}},s&&{sessionProperties:s}),c&&{scopedProperties:c}),l&&{sessionConfig:l}),{transportType:W.relay});await this.client.session.set(f.topic,f),await this.setExpiry(f.topic,f.expiry),await this.client.core.pairing.updateMetadata({topic:u.pairingTopic,metadata:f.peer.metadata}),this.client.events.emit(`session_connect`,{session:f}),this.events.emit(z(`session_connect`,u.proposalId),{session:f}),this.pendingSessions.delete(u.proposalId),this.deleteProposal(u.proposalId,!1),this.cleanupDuplicatePairings(f),await this.sendResult({id:t.id,topic:e,result:!0,throwOnFailedPublish:!0})}catch(t){await this.sendError({id:n,topic:e,error:t}),this.client.logger.error(t)}}),Z(this,`onSessionSettleResponse`,async(e,t)=>{let{id:n}=t;M(t)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(z(`session_approve`,n),{})):D(t)&&(await this.client.session.delete(e,H(`USER_DISCONNECTED`)),this.events.emit(z(`session_approve`,n),{error:t.error}))}),Z(this,`onSessionUpdateRequest`,async(e,t)=>{let{params:n,id:r}=t;try{let t=`${e}_session_update`,i=Bc.get(t);if(i&&this.isRequestOutOfSync(i,r)){this.client.logger.warn(`Discarding out of sync request - ${r}`),this.sendError({id:r,topic:e,error:H(`INVALID_UPDATE_REQUEST`)});return}this.isValidUpdate(X({topic:e},n));try{Bc.set(t,r),await this.client.session.update(e,{namespaces:n.namespaces}),await this.sendResult({id:r,topic:e,result:!0,throwOnFailedPublish:!0})}catch(e){throw Bc.delete(t),e}this.client.events.emit(`session_update`,{id:r,topic:e,params:n})}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),Z(this,`isRequestOutOfSync`,(e,t)=>t.toString().slice(0,-3)<e.toString().slice(0,-3)),Z(this,`onSessionUpdateResponse`,(e,t)=>{let{id:n}=t,r=z(`session_update`,n);if(this.events.listenerCount(r)===0)throw Error(`emitting ${r} without any listeners`);M(t)?this.events.emit(z(`session_update`,n),{}):D(t)&&this.events.emit(z(`session_update`,n),{error:t.error})}),Z(this,`onSessionExtendRequest`,async(e,t)=>{let{id:n}=t;try{this.isValidExtend({topic:e}),await this.setExpiry(e,on(hm)),await this.sendResult({id:n,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit(`session_extend`,{id:n,topic:e})}catch(t){await this.sendError({id:n,topic:e,error:t}),this.client.logger.error(t)}}),Z(this,`onSessionExtendResponse`,(e,t)=>{let{id:n}=t,r=z(`session_extend`,n);if(this.events.listenerCount(r)===0)throw Error(`emitting ${r} without any listeners`);M(t)?this.events.emit(z(`session_extend`,n),{}):D(t)&&this.events.emit(z(`session_extend`,n),{error:t.error})}),Z(this,`onSessionPingRequest`,async(e,t)=>{let{id:n}=t;try{this.isValidPing({topic:e}),await this.sendResult({id:n,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit(`session_ping`,{id:n,topic:e})}catch(t){await this.sendError({id:n,topic:e,error:t}),this.client.logger.error(t)}}),Z(this,`onSessionPingResponse`,(e,t)=>{let{id:n}=t,r=z(`session_ping`,n);setTimeout(()=>{if(this.events.listenerCount(r)===0)throw Error(`emitting ${r} without any listeners 2176`);M(t)?this.events.emit(z(`session_ping`,n),{}):D(t)&&this.events.emit(z(`session_ping`,n),{error:t.error})},500)}),Z(this,`onSessionDeleteRequest`,async(e,t)=>{let{id:n}=t;try{this.isValidDisconnect({topic:e,reason:t.params}),Promise.all([new Promise(t=>{this.client.core.relayer.once(Cl.publish,async()=>{t(await this.deleteSession({topic:e,id:n}))})}),this.sendResult({id:n,topic:e,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:e,error:H(`USER_DISCONNECTED`)})]).catch(e=>this.client.logger.error(e))}catch(e){this.client.logger.error(e)}}),Z(this,`onSessionRequest`,async e=>{var t,n;let{topic:r,payload:i,attestation:a,encryptedId:o,transportType:s}=e,{id:c,params:l}=i;try{await this.isValidRequest(X({topic:r},l));let e=this.client.session.get(r),i={id:c,topic:r,params:l,verifyContext:await this.getVerifyContext({attestationId:a,hash:ns(JSON.stringify(w(`wc_sessionRequest`,l,c))),encryptedId:o,metadata:e.peer.metadata,transportType:s})};await this.setPendingSessionRequest(i),s===W.link_mode&&(t=e.peer.metadata.redirect)!=null&&t.universal&&this.client.core.addLinkModeSupportedApp(e.peer.metadata.redirect?.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(i):(this.addSessionRequestToSessionRequestQueue(i),this.processSessionRequestQueue())}catch(e){await this.sendError({id:c,topic:r,error:e}),this.client.logger.error(e)}}),Z(this,`onSessionRequestResponse`,(e,t)=>{let{id:n}=t,r=z(`session_request`,n);if(this.events.listenerCount(r)===0)throw Error(`emitting ${r} without any listeners`);M(t)?this.events.emit(z(`session_request`,n),{result:t.result}):D(t)&&this.events.emit(z(`session_request`,n),{error:t.error})}),Z(this,`onSessionEventRequest`,async(e,t)=>{let{id:n,params:r}=t;try{let t=`${e}_session_event_${r.event.name}`,i=Bc.get(t);if(i&&this.isRequestOutOfSync(i,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(X({topic:e},r)),this.client.events.emit(`session_event`,{id:n,topic:e,params:r}),Bc.set(t,n)}catch(t){await this.sendError({id:n,topic:e,error:t}),this.client.logger.error(t)}}),Z(this,`onSessionAuthenticateResponse`,(e,t)=>{let{id:n}=t;this.client.logger.trace({type:`method`,method:`onSessionAuthenticateResponse`,topic:e,payload:t}),M(t)?this.events.emit(z(`session_request`,n),{result:t.result}):D(t)&&this.events.emit(z(`session_request`,n),{error:t.error})}),Z(this,`onSessionAuthenticateRequest`,async e=>{var t;let{topic:n,payload:r,attestation:i,encryptedId:a,transportType:o}=e;try{let{requester:e,authPayload:s,expiryTimestamp:c}=r.params,l=await this.getVerifyContext({attestationId:i,hash:ns(JSON.stringify(r)),encryptedId:a,metadata:e.metadata,transportType:o}),u={requester:e,pairingTopic:n,id:r.id,authPayload:s,verifyContext:l,expiryTimestamp:c};await this.setAuthRequest(r.id,{request:u,pairingTopic:n,transportType:o}),o===W.link_mode&&(t=e.metadata.redirect)!=null&&t.universal&&this.client.core.addLinkModeSupportedApp(e.metadata.redirect.universal),this.client.events.emit(`session_authenticate`,{topic:n,params:r.params,id:r.id,verifyContext:l})}catch(e){this.client.logger.error(e);let t=r.params.requester.publicKey,i=await this.client.core.crypto.generateKeyPair(),a=this.getAppLinkIfEnabled(r.params.requester.metadata,o),s={type:1,receiverPublicKey:t,senderPublicKey:i};await this.sendError({id:r.id,topic:n,error:e,encodeOpts:s,rpcOpts:_m.wc_sessionAuthenticate.autoReject,appLink:a})}}),Z(this,`addSessionRequestToSessionRequestQueue`,e=>{this.sessionRequestQueue.queue.push(e)}),Z(this,`cleanupAfterResponse`,e=>{this.deletePendingSessionRequest(e.response.id,{message:`fulfilled`,code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ym.idle,this.processSessionRequestQueue()},(0,Y.toMiliseconds)(this.requestQueueDelay))}),Z(this,`cleanupPendingSentRequestsForTopic`,({topic:e,error:t})=>{let n=this.client.core.history.pending;n.length>0&&n.filter(t=>t.topic===e&&t.request.method===`wc_sessionRequest`).forEach(e=>{let n=e.request.id,r=z(`session_request`,n);if(this.events.listenerCount(r)===0)throw Error(`emitting ${r} without any listeners`);this.events.emit(z(`session_request`,e.request.id),{error:t})})}),Z(this,`processSessionRequestQueue`,()=>{if(this.sessionRequestQueue.state===ym.active){this.client.logger.info(`session request queue is already active.`);return}let e=this.sessionRequestQueue.queue[0];if(!e){this.client.logger.info(`session request queue is empty.`);return}try{this.sessionRequestQueue.state=ym.active,this.emitSessionRequest(e)}catch(e){this.client.logger.error(e)}}),Z(this,`emitSessionRequest`,e=>{this.client.events.emit(`session_request`,e)}),Z(this,`onPairingCreated`,e=>{if(e.methods&&this.expectedPairingMethodMap.set(e.topic,e.methods),e.active)return;let t=this.client.proposal.getAll().find(t=>t.pairingTopic===e.topic);t&&this.onSessionProposeRequest({topic:e.topic,payload:w(`wc_sessionPropose`,Im(X({},t),{requiredNamespaces:t.requiredNamespaces,optionalNamespaces:t.optionalNamespaces,relays:t.relays,proposer:t.proposer,sessionProperties:t.sessionProperties,scopedProperties:t.scopedProperties}),t.id)})}),Z(this,`isValidConnect`,async e=>{if(!vc(e)){let{message:t}=V(`MISSING_OR_INVALID`,`connect() params: ${JSON.stringify(e)}`);throw Error(t)}let{pairingTopic:t,requiredNamespaces:n,optionalNamespaces:r,sessionProperties:i,scopedProperties:a,relays:o}=e;if(Xs(t)||await this.isValidPairingTopic(t),!gc(o,!0)){let{message:e}=V(`MISSING_OR_INVALID`,`connect() relays: ${o}`);throw Error(e)}if(!Xs(n)&&Ys(n)!==0){let e=`requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces`;[`fatal`,`error`,`silent`].includes(this.client.logger.level)?console.warn(e):this.client.logger.warn(e),this.validateNamespaces(n,`requiredNamespaces`)}if(!Xs(r)&&Ys(r)!==0&&this.validateNamespaces(r,`optionalNamespaces`),Xs(i)||this.validateSessionProps(i,`sessionProperties`),!Xs(a)){this.validateSessionProps(a,`scopedProperties`);let e=Object.keys(n||{}).concat(Object.keys(r||{}));if(!Object.keys(a).every(t=>e.includes(t)))throw Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(e)}`)}}),Z(this,`validateNamespaces`,(e,t)=>{let n=pc(e,`connect()`,t);if(n)throw Error(n.message)}),Z(this,`isValidApprove`,async e=>{if(!vc(e))throw Error(V(`MISSING_OR_INVALID`,`approve() params: ${e}`).message);let{id:t,namespaces:n,relayProtocol:r,sessionProperties:i,scopedProperties:a}=e;this.checkRecentlyDeleted(t),await this.isValidProposalId(t);let o=this.client.proposal.get(t),s=mc(n,`approve()`);if(s)throw Error(s.message);let c=Ec(o.requiredNamespaces,n,`approve()`);if(c)throw Error(c.message);if(!Zs(r,!0)){let{message:e}=V(`MISSING_OR_INVALID`,`approve() relayProtocol: ${r}`);throw Error(e)}if(Xs(i)||this.validateSessionProps(i,`sessionProperties`),!Xs(a)){this.validateSessionProps(a,`scopedProperties`);let e=new Set(Object.keys(n));if(!Object.keys(a).every(t=>e.has(t)))throw Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(e).join(`, `)}`)}}),Z(this,`isValidReject`,async e=>{if(!vc(e)){let{message:t}=V(`MISSING_OR_INVALID`,`reject() params: ${e}`);throw Error(t)}let{id:t,reason:n}=e;if(this.checkRecentlyDeleted(t),await this.isValidProposalId(t),!yc(n)){let{message:e}=V(`MISSING_OR_INVALID`,`reject() reason: ${JSON.stringify(n)}`);throw Error(e)}}),Z(this,`isValidSessionSettleRequest`,e=>{if(!vc(e)){let{message:t}=V(`MISSING_OR_INVALID`,`onSessionSettleRequest() params: ${e}`);throw Error(t)}let{relay:t,controller:n,namespaces:r,expiry:i}=e;if(!hc(t)){let{message:e}=V(`MISSING_OR_INVALID`,`onSessionSettleRequest() relay protocol should be a string`);throw Error(e)}let a=ac(n,`onSessionSettleRequest()`);if(a)throw Error(a.message);let o=mc(r,`onSessionSettleRequest()`);if(o)throw Error(o.message);if(sn(i)){let{message:e}=V(`EXPIRED`,`onSessionSettleRequest()`);throw Error(e)}}),Z(this,`isValidUpdate`,async e=>{if(!vc(e)){let{message:t}=V(`MISSING_OR_INVALID`,`update() params: ${e}`);throw Error(t)}let{topic:t,namespaces:n}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);let r=this.client.session.get(t),i=mc(n,`update()`);if(i)throw Error(i.message);let a=Ec(r.requiredNamespaces,n,`update()`);if(a)throw Error(a.message)}),Z(this,`isValidExtend`,async e=>{if(!vc(e)){let{message:t}=V(`MISSING_OR_INVALID`,`extend() params: ${e}`);throw Error(t)}let{topic:t}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t)}),Z(this,`isValidRequest`,async e=>{if(!vc(e)){let{message:t}=V(`MISSING_OR_INVALID`,`request() params: ${e}`);throw Error(t)}let{topic:t,request:n,chainId:r,expiry:i}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);let{namespaces:a}=this.client.session.get(t);if(!Cc(a,r)){let{message:e}=V(`MISSING_OR_INVALID`,`request() chainId: ${r}`);throw Error(e)}if(!bc(n)){let{message:e}=V(`MISSING_OR_INVALID`,`request() ${JSON.stringify(n)}`);throw Error(e)}if(!wc(a,r,n.method)){let{message:e}=V(`MISSING_OR_INVALID`,`request() method: ${n.method}`);throw Error(e)}if(i&&!Ac(i,vm)){let{message:e}=V(`MISSING_OR_INVALID`,`request() expiry: ${i}. Expiry must be a number (in seconds) between ${vm.min} and ${vm.max}`);throw Error(e)}}),Z(this,`isValidRespond`,async e=>{var t;if(!vc(e)){let{message:t}=V(`MISSING_OR_INVALID`,`respond() params: ${e}`);throw Error(t)}let{topic:n,response:r}=e;try{await this.isValidSessionTopic(n)}catch(n){throw(t=e?.response)!=null&&t.id&&this.cleanupAfterResponse(e),n}if(!xc(r)){let{message:e}=V(`MISSING_OR_INVALID`,`respond() response: ${JSON.stringify(r)}`);throw Error(e)}}),Z(this,`isValidPing`,async e=>{if(!vc(e)){let{message:t}=V(`MISSING_OR_INVALID`,`ping() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),Z(this,`isValidEmit`,async e=>{if(!vc(e)){let{message:t}=V(`MISSING_OR_INVALID`,`emit() params: ${e}`);throw Error(t)}let{topic:t,event:n,chainId:r}=e;await this.isValidSessionTopic(t);let{namespaces:i}=this.client.session.get(t);if(!Cc(i,r)){let{message:e}=V(`MISSING_OR_INVALID`,`emit() chainId: ${r}`);throw Error(e)}if(!Sc(n)){let{message:e}=V(`MISSING_OR_INVALID`,`emit() event: ${JSON.stringify(n)}`);throw Error(e)}if(!Tc(i,r,n.name)){let{message:e}=V(`MISSING_OR_INVALID`,`emit() event: ${JSON.stringify(n)}`);throw Error(e)}}),Z(this,`isValidDisconnect`,async e=>{if(!vc(e)){let{message:t}=V(`MISSING_OR_INVALID`,`disconnect() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),Z(this,`isValidAuthenticate`,e=>{let{chains:t,uri:n,domain:r,nonce:i}=e;if(!Array.isArray(t)||t.length===0)throw Error(`chains is required and must be a non-empty array`);if(!Zs(n,!1))throw Error(`uri is required parameter`);if(!Zs(r,!1))throw Error(`domain is required parameter`);if(!Zs(i,!1))throw Error(`nonce is required parameter`);if([...new Set(t.map(e=>Ct(e).namespace))].length>1)throw Error(`Multi-namespace requests are not supported. Please request single namespace only.`);let{namespace:a}=Ct(t[0]);if(a!==`eip155`)throw Error(`Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.`)}),Z(this,`getVerifyContext`,async e=>{let{attestationId:t,hash:n,encryptedId:r,metadata:i,transportType:a}=e,o={verified:{verifyUrl:i.verifyUrl||`https://verify.walletconnect.org`,validation:`UNKNOWN`,origin:i.url||``}};try{if(a===W.link_mode){let e=this.getAppLinkIfEnabled(i,a);return o.verified.validation=e&&new URL(e).origin===new URL(i.url).origin?`VALID`:`INVALID`,o}let e=await this.client.core.verify.resolve({attestationId:t,hash:n,encryptedId:r,verifyUrl:i.verifyUrl});e&&(o.verified.origin=e.origin,o.verified.isScam=e.isScam,o.verified.validation=e.origin===new URL(i.url).origin?`VALID`:`INVALID`)}catch(e){this.client.logger.warn(e)}return this.client.logger.debug(`Verify context: ${JSON.stringify(o)}`),o}),Z(this,`validateSessionProps`,(e,t)=>{Object.values(e).forEach((n,r)=>{if(n==null){let{message:i}=V(`MISSING_OR_INVALID`,`${t} must contain an existing value for each key. Received: ${n} for key ${Object.keys(e)[r]}`);throw Error(i)}})}),Z(this,`getPendingAuthRequest`,e=>{let t=this.client.auth.requests.get(e);return typeof t==`object`?t:void 0}),Z(this,`addToRecentlyDeleted`,(e,t)=>{if(this.recentlyDeletedMap.set(e,t),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let e=0,t=this.recentlyDeletedLimit/2;for(let n of this.recentlyDeletedMap.keys()){if(e++>=t)break;this.recentlyDeletedMap.delete(n)}}}),Z(this,`checkRecentlyDeleted`,e=>{let t=this.recentlyDeletedMap.get(e);if(t){let{message:n}=V(`MISSING_OR_INVALID`,`Record was recently deleted - ${t}: ${e}`);throw Error(n)}}),Z(this,`isLinkModeEnabled`,(e,t)=>!e||t!==W.link_mode?!1:this.client.metadata?.redirect?.linkMode===!0&&this.client.metadata?.redirect?.universal!==void 0&&this.client.metadata?.redirect?.universal!==``&&e?.redirect?.universal!==void 0&&e?.redirect?.universal!==``&&e?.redirect?.linkMode===!0&&this.client.core.linkModeSupportedApps.includes(e.redirect.universal)&&typeof(global==null?void 0:global.Linking)<`u`),Z(this,`getAppLinkIfEnabled`,(e,t)=>this.isLinkModeEnabled(e,t)?e?.redirect?.universal:void 0),Z(this,`handleLinkModeMessage`,({url:e})=>{if(!e||!e.includes(`wc_ev`)||!e.includes(`topic`))return;let t=pn(e,`topic`)||``,n=decodeURIComponent(pn(e,`wc_ev`)||``),r=this.client.session.keys.includes(t);r&&this.client.session.update(t,{transportType:W.link_mode}),this.client.core.dispatchEnvelope({topic:t,message:n,sessionExists:r})}),Z(this,`registerLinkModeListeners`,async()=>{var e;if(hn()||Lt()&&(e=this.client.metadata.redirect)!=null&&e.linkMode){let e=global==null?void 0:global.Linking;if(typeof e<`u`){e.addEventListener(`url`,this.handleLinkModeMessage,this.client.name);let t=await e.getInitialURL();t&&setTimeout(()=>{this.handleLinkModeMessage({url:t})},50)}}}),Z(this,`shouldSetTVF`,(e,t)=>{if(!t||e!==`wc_sessionRequest`)return!1;let{request:n}=t;return Object.keys(bm).includes(n.method)}),Z(this,`getTVFParams`,(e,t,n)=>{try{let r=t.request.method,i=this.extractTxHashesFromResult(r,n);return Im(X({correlationId:e,rpcMethods:[r],chainId:t.chainId},this.isValidContractData(t.request.params)&&{contractAddresses:[t.request.params?.[0]?.to]}),{txHashes:i})}catch(e){this.client.logger.warn(`Error getting TVF params`,e)}return{}}),Z(this,`isValidContractData`,e=>{if(!e)return!1;try{let t=e?.data||e?.[0]?.data;if(!t.startsWith(`0x`))return!1;let n=t.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2==0:!1}catch{}return!1}),Z(this,`extractTxHashesFromResult`,(e,t)=>{try{let n=bm[e];if(typeof t==`string`)return[t];let r=t[n.key];if(Js(r))return e===`solana_signAllTransactions`?r.map(e=>gr(e)):r;if(typeof r==`string`)return[r]}catch(e){this.client.logger.warn(`Error extracting tx hashes from result`,e)}return[]})}async processPendingMessageEvents(){try{let e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(let[e,n]of Object.entries(t))for(let t of n)try{await this.onProviderMessageEvent({topic:e,message:t,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${e}, message: ${t}`)}}catch(e){this.client.logger.warn(`processPendingMessageEvents failed`,e)}}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Cl.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){let{topic:t,message:n,attestation:r,transportType:i}=e,{publicKey:a}=this.client.auth.authKeys.keys.includes(Om)?this.client.auth.authKeys.get(Om):{responseTopic:void 0,publicKey:void 0};try{let e=await this.client.core.crypto.decode(t,n,{receiverPublicKey:a,encoding:i===W.link_mode?Ko:Go});S(e)?(this.client.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e,attestation:r,transportType:i,encryptedId:ns(n)})):A(e)?(await this.client.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e,transportType:i}),this.client.core.history.delete(t,e.id)):await this.onRelayEventUnknownPayload({topic:t,payload:e,transportType:i}),await this.client.core.relayer.messages.ack(t,n)}catch(e){this.client.logger.error(e)}}registerExpirerEvents(){this.client.core.expirer.on(Il.expired,async e=>{let{topic:t,id:n}=an(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,V(`EXPIRED`),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,V(`EXPIRED`),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit(`session_expire`,{topic:t})):n&&(await this.deleteProposal(n,!0),this.client.events.emit(`proposal_expire`,{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Ml.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Ml.delete,e=>{this.addToRecentlyDeleted(e.topic,`pairing`)})}isValidPairingTopic(e){if(!Zs(e,!1)){let{message:t}=V(`MISSING_OR_INVALID`,`pairing topic should be a string: ${e}`);throw Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:t}=V(`NO_MATCHING_KEY`,`pairing topic doesn't exist: ${e}`);throw Error(t)}if(sn(this.client.core.pairing.pairings.get(e).expiry)){let{message:t}=V(`EXPIRED`,`pairing topic: ${e}`);throw Error(t)}}async isValidSessionTopic(e){if(!Zs(e,!1)){let{message:t}=V(`MISSING_OR_INVALID`,`session topic should be a string: ${e}`);throw Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:t}=V(`NO_MATCHING_KEY`,`session topic doesn't exist: ${e}`);throw Error(t)}if(sn(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});let{message:t}=V(`EXPIRED`,`session topic: ${e}`);throw Error(t)}if(!this.client.core.crypto.keychain.has(e)){let{message:t}=V(`MISSING_OR_INVALID`,`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Zs(e,!1)){let{message:t}=V(`NO_MATCHING_KEY`,`session or pairing topic doesn't exist: ${e}`);throw Error(t)}else{let{message:t}=V(`MISSING_OR_INVALID`,`session or pairing topic should be a string: ${e}`);throw Error(t)}}async isValidProposalId(e){if(!_c(e)){let{message:t}=V(`MISSING_OR_INVALID`,`proposal id should be a number: ${e}`);throw Error(t)}if(!this.client.proposal.keys.includes(e)){let{message:t}=V(`NO_MATCHING_KEY`,`proposal id doesn't exist: ${e}`);throw Error(t)}if(sn(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);let{message:t}=V(`EXPIRED`,`proposal id: ${e}`);throw Error(t)}}},Rm=class extends Ep{constructor(e,t){super(e,t,fm,lm),this.core=e,this.logger=t}},zm=class extends Ep{constructor(e,t){super(e,t,mm,lm),this.core=e,this.logger=t}},Bm=class extends Ep{constructor(e,t){super(e,t,xm,lm,e=>e.id),this.core=e,this.logger=t}},Vm=class extends Ep{constructor(e,t){super(e,t,wm,Dm,()=>Om),this.core=e,this.logger=t}},Hm=class extends Ep{constructor(e,t){super(e,t,Tm,Dm),this.core=e,this.logger=t}},Um=class extends Ep{constructor(e,t){super(e,t,Em,Dm,e=>e.id),this.core=e,this.logger=t}},Wm=Object.defineProperty,Gm=(e,t,n)=>t in e?Wm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Km=(e,t,n)=>Gm(e,typeof t==`symbol`?t:t+``,n),qm=class{constructor(e,t){this.core=e,this.logger=t,Km(this,`authKeys`),Km(this,`pairingTopics`),Km(this,`requests`),this.authKeys=new Vm(this.core,this.logger),this.pairingTopics=new Hm(this.core,this.logger),this.requests=new Um(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}},Jm=Object.defineProperty,Ym=(e,t,n)=>t in e?Jm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Q=(e,t,n)=>Ym(e,typeof t==`symbol`?t:t+``,n),Xm=class e extends sl{constructor(e){super(e),Q(this,`protocol`,`wc`),Q(this,`version`,2),Q(this,`name`,um.name),Q(this,`metadata`),Q(this,`core`),Q(this,`logger`),Q(this,`events`,new sm.EventEmitter),Q(this,`engine`),Q(this,`session`),Q(this,`proposal`),Q(this,`pendingRequest`),Q(this,`auth`),Q(this,`signConfig`),Q(this,`on`,(e,t)=>this.events.on(e,t)),Q(this,`once`,(e,t)=>this.events.once(e,t)),Q(this,`off`,(e,t)=>this.events.off(e,t)),Q(this,`removeListener`,(e,t)=>this.events.removeListener(e,t)),Q(this,`removeAllListeners`,e=>this.events.removeAllListeners(e)),Q(this,`connect`,async e=>{try{return await this.engine.connect(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`pair`,async e=>{try{return await this.engine.pair(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`approve`,async e=>{try{return await this.engine.approve(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`reject`,async e=>{try{return await this.engine.reject(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`update`,async e=>{try{return await this.engine.update(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`extend`,async e=>{try{return await this.engine.extend(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`request`,async e=>{try{return await this.engine.request(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`respond`,async e=>{try{return await this.engine.respond(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`ping`,async e=>{try{return await this.engine.ping(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`emit`,async e=>{try{return await this.engine.emit(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`disconnect`,async e=>{try{return await this.engine.disconnect(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`find`,e=>{try{return this.engine.find(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`getPendingSessionRequests`,()=>{try{return this.engine.getPendingSessionRequests()}catch(e){throw this.logger.error(e.message),e}}),Q(this,`authenticate`,async(e,t)=>{try{return await this.engine.authenticate(e,t)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`formatAuthMessage`,e=>{try{return this.engine.formatAuthMessage(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`approveSessionAuthenticate`,async e=>{try{return await this.engine.approveSessionAuthenticate(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`rejectSessionAuthenticate`,async e=>{try{return await this.engine.rejectSessionAuthenticate(e)}catch(e){throw this.logger.error(e.message),e}}),this.name=e?.name||um.name,this.metadata=Wt(e?.metadata),this.signConfig=e?.signConfig;let t=typeof e?.logger<`u`&&typeof e?.logger!=`string`?e.logger:(0,F.default)(L({level:e?.logger||um.logger}));this.core=e?.core||new om(e),this.logger=x(t,this.name),this.session=new zm(this.core,this.logger),this.proposal=new Rm(this.core,this.logger),this.pendingRequest=new Bm(this.core,this.logger),this.engine=new Lm(this),this.auth=new qm(this.core,this.logger)}static async init(t){let n=new e(t);return await n.initialize(),n}get context(){return C(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace(`Initialized`);try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info(`SignClient Initialization Success`),setTimeout(()=>{this.engine.processRelayMessageCache()},(0,Y.toMiliseconds)(Y.ONE_SECOND))}catch(e){throw this.logger.info(`SignClient Initialization Failure`),this.logger.error(e.message),e}}},Zm=t(n()),Qm=`error`,$m=`wss://relay.walletconnect.org`,eh=`wc@2:universal_provider:`,th=`https://rpc.walletconnect.org/v1/`,nh=`generic`,rh=`${th}bundler`,ih={DEFAULT_CHAIN_CHANGED:`default_chain_changed`};function ah(){}function oh(e){return e==null||typeof e!=`object`&&typeof e!=`function`}function sh(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ch(e){if(oh(e))return e;if(Array.isArray(e)||sh(e)||e instanceof ArrayBuffer||typeof SharedArrayBuffer<`u`&&e instanceof SharedArrayBuffer)return e.slice(0);let t=Object.getPrototypeOf(e),n=t.constructor;if(e instanceof Date||e instanceof Map||e instanceof Set)return new n(e);if(e instanceof RegExp){let t=new n(e);return t.lastIndex=e.lastIndex,t}if(e instanceof DataView)return new n(e.buffer.slice(0));if(e instanceof Error){let t=new n(e.message);return t.stack=e.stack,t.name=e.name,t.cause=e.cause,t}if(typeof File<`u`&&e instanceof File)return new n([e],e.name,{type:e.type,lastModified:e.lastModified});if(typeof e==`object`){let n=Object.create(t);return Object.assign(n,e)}return e}function lh(e){return typeof e==`object`&&!!e}function uh(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function dh(e){return e==null?e===void 0?`[object Undefined]`:`[object Null]`:Object.prototype.toString.call(e)}var fh=`[object RegExp]`,ph=`[object String]`,mh=`[object Number]`,hh=`[object Boolean]`,gh=`[object Arguments]`,_h=`[object Symbol]`,vh=`[object Date]`,yh=`[object Map]`,bh=`[object Set]`,xh=`[object Array]`,Sh=`[object ArrayBuffer]`,Ch=`[object Object]`,wh=`[object DataView]`,Th=`[object Uint8Array]`,Eh=`[object Uint8ClampedArray]`,Dh=`[object Uint16Array]`,Oh=`[object Uint32Array]`,kh=`[object Int8Array]`,Ah=`[object Int16Array]`,jh=`[object Int32Array]`,Mh=`[object Float32Array]`,Nh=`[object Float64Array]`;function Ph(e,t){return Fh(e,void 0,e,new Map,t)}function Fh(e,t,n,r=new Map,i=void 0){let a=i?.(e,t,n,r);if(a!=null)return a;if(oh(e))return e;if(r.has(e))return r.get(e);if(Array.isArray(e)){let t=Array(e.length);r.set(e,t);for(let a=0;a<e.length;a++)t[a]=Fh(e[a],a,n,r,i);return Object.hasOwn(e,`index`)&&(t.index=e.index),Object.hasOwn(e,`input`)&&(t.input=e.input),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){let t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}if(e instanceof Map){let t=new Map;r.set(e,t);for(let[a,o]of e)t.set(a,Fh(o,a,n,r,i));return t}if(e instanceof Set){let t=new Set;r.set(e,t);for(let a of e)t.add(Fh(a,void 0,n,r,i));return t}if(typeof Buffer<`u`&&Buffer.isBuffer(e))return e.subarray();if(sh(e)){let t=new(Object.getPrototypeOf(e)).constructor(e.length);r.set(e,t);for(let a=0;a<e.length;a++)t[a]=Fh(e[a],a,n,r,i);return t}if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<`u`&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){let t=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return r.set(e,t),Ih(t,e,n,r,i),t}if(typeof File<`u`&&e instanceof File){let t=new File([e],e.name,{type:e.type});return r.set(e,t),Ih(t,e,n,r,i),t}if(e instanceof Blob){let t=new Blob([e],{type:e.type});return r.set(e,t),Ih(t,e,n,r,i),t}if(e instanceof Error){let t=new e.constructor;return r.set(e,t),t.message=e.message,t.name=e.name,t.stack=e.stack,t.cause=e.cause,Ih(t,e,n,r,i),t}if(typeof e==`object`&&Lh(e)){let t=Object.create(Object.getPrototypeOf(e));return r.set(e,t),Ih(t,e,n,r,i),t}return e}function Ih(e,t,n=e,r,i){let a=[...Object.keys(t),...uh(t)];for(let o=0;o<a.length;o++){let s=a[o],c=Object.getOwnPropertyDescriptor(e,s);(c==null||c.writable)&&(e[s]=Fh(t[s],s,n,r,i))}}function Lh(e){switch(dh(e)){case gh:case xh:case Sh:case wh:case hh:case vh:case Mh:case Nh:case kh:case Ah:case jh:case yh:case mh:case Ch:case fh:case bh:case ph:case _h:case Th:case Eh:case Dh:case Oh:return!0;default:return!1}}function Rh(e,t){return Ph(e,(n,r,i,a)=>{let o=t?.(n,r,i,a);if(o!=null)return o;if(typeof e==`object`)switch(Object.prototype.toString.call(e)){case mh:case ph:case hh:{let t=new e.constructor(e?.valueOf());return Ih(t,e),t}case gh:{let t={};return Ih(t,e),t.length=e.length,t[Symbol.iterator]=e[Symbol.iterator],t}default:return}})}function zh(e){return Rh(e)}function Bh(e){return typeof e==`object`&&!!e&&dh(e)===`[object Arguments]`}function Vh(e){return sh(e)}function Hh(e){if(typeof e!=`object`||!e)return!1;if(Object.getPrototypeOf(e)===null)return!0;if(Object.prototype.toString.call(e)!==`[object Object]`){let t=e[Symbol.toStringTag];return t==null||!Object.getOwnPropertyDescriptor(e,Symbol.toStringTag)?.writable?!1:e.toString()===`[object ${t}]`}let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Uh(e,...t){let n=t.slice(0,-1),r=t[t.length-1],i=e;for(let e=0;e<n.length;e++){let t=n[e];i=Wh(i,t,r,new Map)}return i}function Wh(e,t,n,r){if(oh(e)&&(e=Object(e)),typeof t!=`object`||!t)return e;if(r.has(t))return ch(r.get(t));if(r.set(t,e),Array.isArray(t)){t=t.slice();for(let e=0;e<t.length;e++)t[e]=t[e]??void 0}let i=[...Object.keys(t),...uh(t)];for(let a=0;a<i.length;a++){let o=i[a],s=t[o],c=e[o];if(Bh(s)&&(s={...s}),Bh(c)&&(c={...c}),typeof Buffer<`u`&&Buffer.isBuffer(s)&&(s=zh(s)),Array.isArray(s))if(typeof c==`object`&&c){let e=[],t=Reflect.ownKeys(c);for(let n=0;n<t.length;n++){let r=t[n];e[r]=c[r]}c=e}else c=[];let l=n(c,s,o,e,t,r);l==null?Array.isArray(s)||lh(c)&&lh(s)?e[o]=Wh(c,s,n,r):c==null&&Hh(s)?e[o]=Wh({},s,n,r):c==null&&Vh(s)?e[o]=zh(s):(c===void 0||s!==void 0)&&(e[o]=s):e[o]=l}return e}function Gh(e,...t){return Uh(e,...t,ah)}var Kh=Object.defineProperty,qh=Object.defineProperties,Jh=Object.getOwnPropertyDescriptors,Yh=Object.getOwnPropertySymbols,Xh=Object.prototype.hasOwnProperty,Zh=Object.prototype.propertyIsEnumerable,Qh=(e,t,n)=>t in e?Kh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,$h=(e,t)=>{for(var n in t||={})Xh.call(t,n)&&Qh(e,n,t[n]);if(Yh)for(var n of Yh(t))Zh.call(t,n)&&Qh(e,n,t[n]);return e},eg=(e,t)=>qh(e,Jh(t));function tg(e,t,n){let r=Ct(e);return t.rpcMap?.[r.reference]||`${th}?chainId=${r.namespace}:${r.reference}&projectId=${n}`}function ng(e){return e.includes(`:`)?e.split(`:`)[1]:e}function rg(e){return e.map(e=>`${e.split(`:`)[0]}:${e.split(`:`)[1]}`)}function ig(e,t){let n=Object.keys(t.namespaces).filter(t=>t.includes(e));if(!n.length)return[];let r=[];return n.forEach(e=>{let n=t.namespaces[e].accounts;r.push(...n)}),r}function ag(e={},t={}){return Gh(og(e),og(t))}function og(e){let t={};if(!Ys(e))return t;for(let[n,r]of Object.entries(e)){let e=Bs(n)?[n]:r.chains,i=r.methods||[],a=r.events||[],o=r.rpcMap||{},s=Vs(n);t[s]=eg($h($h({},t[s]),r),{chains:cn(e,t[s]?.chains),methods:cn(i,t[s]?.methods),events:cn(a,t[s]?.events)}),(Ys(o)||Ys(t[s]?.rpcMap||{}))&&(t[s].rpcMap=$h($h({},o),t[s]?.rpcMap))}return t}function sg(e){return e.includes(`:`)?e.split(`:`)[2]:e}function cg(e){let t={};for(let[n,r]of Object.entries(e)){let e=r.methods||[],i=r.events||[],a=r.accounts||[];t[n]={chains:Bs(n)?[n]:r.chains?r.chains:rg(r.accounts),methods:e,events:i,accounts:a}}return t}function lg(e){return typeof e==`number`?e:e.includes(`0x`)?parseInt(e,16):(e=e.includes(`:`)?e.split(`:`)[1]:e,isNaN(Number(e))?e:Number(e))}var ug={},$=e=>ug[e],dg=(e,t)=>{ug[e]=t},fg=Object.defineProperty,pg=(e,t,n)=>t in e?fg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,mg=(e,t,n)=>pg(e,typeof t==`symbol`?t:t+``,n),hg=class{constructor(e){mg(this,`name`,`polkadot`),mg(this,`client`),mg(this,`httpProviders`),mg(this,`events`),mg(this,`namespace`),mg(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(ih.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){let e=this.namespace.accounts;return e&&e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2])||[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let n=ng(t);e[n]=this.createHttpProvider(n,this.namespace.rpcMap?.[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||tg(e,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new k(new N(n,$(`disableProviderPing`)))}},gg=Object.defineProperty,_g=Object.defineProperties,vg=Object.getOwnPropertyDescriptors,yg=Object.getOwnPropertySymbols,bg=Object.prototype.hasOwnProperty,xg=Object.prototype.propertyIsEnumerable,Sg=(e,t,n)=>t in e?gg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Cg=(e,t)=>{for(var n in t||={})bg.call(t,n)&&Sg(e,n,t[n]);if(yg)for(var n of yg(t))xg.call(t,n)&&Sg(e,n,t[n]);return e},wg=(e,t)=>_g(e,vg(t)),Tg=(e,t,n)=>Sg(e,typeof t==`symbol`?t:t+``,n),Eg=class{constructor(e){Tg(this,`name`,`eip155`),Tg(this,`client`),Tg(this,`chainId`),Tg(this,`namespace`),Tg(this,`httpProviders`),Tg(this,`events`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case`eth_requestAccounts`:return this.getAccounts();case`eth_accounts`:return this.getAccounts();case`wallet_switchEthereumChain`:return await this.handleSwitchChain(e);case`eth_chainId`:return parseInt(this.getDefaultChain());case`wallet_getCapabilities`:return await this.getCapabilities(e);case`wallet_getCallsStatus`:return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(ih.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}createHttpProvider(e,t){let n=t||tg(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new k(new N(n,$(`disableProviderPing`)))}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let n=parseInt(ng(t));e[n]=this.createHttpProvider(n,this.namespace.rpcMap?.[t])}),e}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}getHttpProvider(){let e=this.chainId,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){let t=e.request.params?e.request.params[0]?.chainId:`0x0`;t=t.startsWith(`0x`)?t:`0x${t}`;let n=parseInt(t,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes(`wallet_switchEthereumChain`))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:t}]},chainId:this.namespace.chains?.[0]}),this.setDefaultChain(`${n}`);else throw Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){let t=e.request?.params?.[0],n=`${t}${(e.request?.params?.[1]||[]).join(`,`)}`;if(!t)throw Error("Missing address parameter in `wallet_getCapabilities` request");let r=this.client.session.get(e.topic),i=r?.sessionProperties?.capabilities||{};if(i!=null&&i[n])return i?.[n];let a=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:wg(Cg({},r.sessionProperties||{}),{capabilities:wg(Cg({},i||{}),{[n]:a})})})}catch(e){console.warn(`Failed to update session with capabilities`,e)}return a}async getCallStatus(e){let t=this.client.session.get(e.topic),n=t.sessionProperties?.bundler_name;if(n){let t=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(t,e)}catch(e){console.warn(`Failed to fetch call status from bundler`,e,t)}}let r=t.sessionProperties?.bundler_url;if(r)try{return await this.getUserOperationReceipt(r,e)}catch(e){console.warn(`Failed to fetch call status from custom bundler`,e,r)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw Error(`Fetching call status not approved by the wallet.`)}async getUserOperationReceipt(e,t){let n=new URL(e),r=await fetch(n,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(w(`eth_getUserOperationReceipt`,[t.request.params?.[0]]))});if(!r.ok)throw Error(`Failed to fetch user operation receipt - ${r.status}`);return await r.json()}getBundlerUrl(e,t){return`${rh}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}},Dg=Object.defineProperty,Og=(e,t,n)=>t in e?Dg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,kg=(e,t,n)=>Og(e,typeof t==`symbol`?t:t+``,n),Ag=class{constructor(e){kg(this,`name`,`solana`),kg(this,`client`),kg(this,`httpProviders`),kg(this,`events`),kg(this,`namespace`),kg(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(ih.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let n=ng(t);e[n]=this.createHttpProvider(n,this.namespace.rpcMap?.[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||tg(e,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new k(new N(n,$(`disableProviderPing`)))}},jg=Object.defineProperty,Mg=(e,t,n)=>t in e?jg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ng=(e,t,n)=>Mg(e,typeof t==`symbol`?t:t+``,n),Pg=class{constructor(e){Ng(this,`name`,`cosmos`),Ng(this,`client`),Ng(this,`httpProviders`),Ng(this,`events`),Ng(this,`namespace`),Ng(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(ih.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let n=ng(t);e[n]=this.createHttpProvider(n,this.namespace.rpcMap?.[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||tg(e,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new k(new N(n,$(`disableProviderPing`)))}},Fg=Object.defineProperty,Ig=(e,t,n)=>t in e?Fg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Lg=(e,t,n)=>Ig(e,typeof t==`symbol`?t:t+``,n),Rg=class{constructor(e){Lg(this,`name`,`algorand`),Lg(this,`client`),Lg(this,`httpProviders`),Lg(this,`events`),Lg(this,`namespace`),Lg(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){let n=t||tg(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,n)}this.chainId=e,this.events.emit(ih.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t,this.namespace.rpcMap?.[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||tg(e,this.namespace,this.client.core.projectId);return typeof n>`u`?void 0:new k(new N(n,$(`disableProviderPing`)))}},zg=Object.defineProperty,Bg=(e,t,n)=>t in e?zg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Vg=(e,t,n)=>Bg(e,typeof t==`symbol`?t:t+``,n),Hg=class{constructor(e){Vg(this,`name`,`cip34`),Vg(this,`client`),Vg(this,`httpProviders`),Vg(this,`events`),Vg(this,`namespace`),Vg(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(ih.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let n=this.getCardanoRPCUrl(t),r=ng(t);e[r]=this.createHttpProvider(r,n)}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){let t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||this.getCardanoRPCUrl(e);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new k(new N(n,$(`disableProviderPing`)))}},Ug=Object.defineProperty,Wg=(e,t,n)=>t in e?Ug(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Gg=(e,t,n)=>Wg(e,typeof t==`symbol`?t:t+``,n),Kg=class{constructor(e){Gg(this,`name`,`elrond`),Gg(this,`client`),Gg(this,`httpProviders`),Gg(this,`events`),Gg(this,`namespace`),Gg(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(ih.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let n=ng(t);e[n]=this.createHttpProvider(n,this.namespace.rpcMap?.[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||tg(e,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new k(new N(n,$(`disableProviderPing`)))}},qg=Object.defineProperty,Jg=(e,t,n)=>t in e?qg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Yg=(e,t,n)=>Jg(e,typeof t==`symbol`?t:t+``,n),Xg=class{constructor(e){Yg(this,`name`,`multiversx`),Yg(this,`client`),Yg(this,`httpProviders`),Yg(this,`events`),Yg(this,`namespace`),Yg(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(ih.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let n=ng(t);e[n]=this.createHttpProvider(n,this.namespace.rpcMap?.[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||tg(e,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new k(new N(n,$(`disableProviderPing`)))}},Zg=Object.defineProperty,Qg=(e,t,n)=>t in e?Zg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,$g=(e,t,n)=>Qg(e,typeof t==`symbol`?t:t+``,n),e_=class{constructor(e){$g(this,`name`,`near`),$g(this,`client`),$g(this,`httpProviders`),$g(this,`events`),$g(this,`namespace`),$g(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){let n=t||tg(`${this.name}:${e}`,this.namespace);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,n)}this.events.emit(ih.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e&&e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2])||[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t,this.namespace.rpcMap?.[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||tg(e,this.namespace);return typeof n>`u`?void 0:new k(new N(n,$(`disableProviderPing`)))}},t_=Object.defineProperty,n_=(e,t,n)=>t in e?t_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,r_=(e,t,n)=>n_(e,typeof t==`symbol`?t:t+``,n),i_=class{constructor(e){r_(this,`name`,`tezos`),r_(this,`client`),r_(this,`httpProviders`),r_(this,`events`),r_(this,`namespace`),r_(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){let n=t||tg(`${this.name}:${e}`,this.namespace);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,n)}this.events.emit(ih.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e&&e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2])||[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||tg(e,this.namespace);return typeof n>`u`?void 0:new k(new N(n))}},a_=Object.defineProperty,o_=(e,t,n)=>t in e?a_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,s_=(e,t,n)=>o_(e,typeof t==`symbol`?t:t+``,n),c_=class{constructor(e){s_(this,`name`,nh),s_(this,`client`),s_(this,`httpProviders`),s_(this,`events`),s_(this,`namespace`),s_(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(ih.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}createHttpProviders(){var e;let t={};return(e=this.namespace?.accounts)==null||e.forEach(e=>{let n=Ct(e);t[`${n.namespace}:${n.reference}`]=this.createHttpProvider(e)}),t}getHttpProvider(e){let t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||tg(e,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new k(new N(n,$(`disableProviderPing`)))}},l_=Object.defineProperty,u_=Object.defineProperties,d_=Object.getOwnPropertyDescriptors,f_=Object.getOwnPropertySymbols,p_=Object.prototype.hasOwnProperty,m_=Object.prototype.propertyIsEnumerable,h_=(e,t,n)=>t in e?l_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,g_=(e,t)=>{for(var n in t||={})p_.call(t,n)&&h_(e,n,t[n]);if(f_)for(var n of f_(t))m_.call(t,n)&&h_(e,n,t[n]);return e},__=(e,t)=>u_(e,d_(t)),v_=(e,t,n)=>h_(e,typeof t==`symbol`?t:t+``,n),y_=class e{constructor(e){v_(this,`client`),v_(this,`namespaces`),v_(this,`optionalNamespaces`),v_(this,`sessionProperties`),v_(this,`scopedProperties`),v_(this,`events`,new Zm.default),v_(this,`rpcProviders`,{}),v_(this,`session`),v_(this,`providerOpts`),v_(this,`logger`),v_(this,`uri`),v_(this,`disableProviderPing`,!1),this.providerOpts=e,this.logger=typeof e?.logger<`u`&&typeof e?.logger!=`string`?e.logger:(0,F.default)(L({level:e?.logger||Qm})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(t){let n=new e(t);return await n.initialize(),n}async request(e,t,n){let[r,i]=this.validateChain(t);if(!this.session)throw Error(`Please call connect() before request()`);return await this.getProvider(r).request({request:g_({},e),chainId:`${r}:${i}`,topic:this.session.topic,expiry:n})}sendAsync(e,t,n,r){let i=new Date().getTime();this.request(e,n,r).then(e=>t(null,T(i,e))).catch(e=>t(e,void 0))}async enable(){if(!this.client)throw Error(`Sign Client not initialized`);return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){if(!this.session)throw Error(`Please call connect() before enable()`);await this.client.disconnect({topic:this.session?.topic,reason:H(`USER_DISCONNECTED`)}),await this.cleanup()}async connect(e){if(!this.client)throw Error(`Sign Client not initialized`);if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw Error(`Sign Client not initialized`);this.setNamespaces(e),await this.cleanupPendingPairings();let{uri:n,response:r}=await this.client.authenticate(e,t);n&&(this.uri=n,this.events.emit(`display_uri`,n));let i=await r();if(this.session=i.session,this.session){let e=cg(this.session.namespaces);this.namespaces=ag(this.namespaces,e),await this.persist(`namespaces`,this.namespaces),this.onConnect()}return i}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){let{uri:t,approval:n}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit(`display_uri`,t));let r=await n();this.session=r;let i=cg(r.namespaces);return this.namespaces=ag(this.namespaces,i),await this.persist(`namespaces`,this.namespaces),await this.persist(`optionalNamespaces`,this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;let[n,r]=this.validateChain(e),i=this.getProvider(n);i.name===nh?i.setDefaultChain(`${n}:${r}`,t):i.setDefaultChain(r,t)}catch(e){if(!/Please call connect/.test(e.message))throw e}}async cleanupPendingPairings(e={}){this.logger.info(`Cleaning up inactive pairings...`);let t=this.client.pairing.getAll();if(Js(t)){for(let n of t)e.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn(`abortPairingAttempt is deprecated. This is now a no-op.`)}async checkStorage(){this.namespaces=await this.getFromStore(`namespaces`)||{},this.optionalNamespaces=await this.getFromStore(`optionalNamespaces`)||{},this.session&&this.createProviders()}async initialize(){this.logger.trace(`Initialized`),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){if(this.client=this.providerOpts.client||await Xm.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Qm,relayUrl:this.providerOpts.relayUrl||$m,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(e){throw this.logger.error(`Failed to get session`,e),Error(`The provided session: ${this.providerOpts?.session?.topic} doesn't exist in the Sign client`)}else this.session=this.client.session.getAll()[0];this.logger.trace(`SignClient Initialized`)}createProviders(){if(!this.client)throw Error(`Sign Client not initialized`);if(!this.session)throw Error(`Session not initialized. Please call connect() before enable()`);let e=[...new Set(Object.keys(this.session.namespaces).map(e=>Vs(e)))];dg(`client`,this.client),dg(`events`,this.events),dg(`disableProviderPing`,this.disableProviderPing),e.forEach(e=>{if(!this.session)return;let t=ig(e,this.session),n=rg(t),r=__(g_({},ag(this.namespaces,this.optionalNamespaces)[e]),{accounts:t,chains:n});switch(e){case`eip155`:this.rpcProviders[e]=new Eg({namespace:r});break;case`algorand`:this.rpcProviders[e]=new Rg({namespace:r});break;case`solana`:this.rpcProviders[e]=new Ag({namespace:r});break;case`cosmos`:this.rpcProviders[e]=new Pg({namespace:r});break;case`polkadot`:this.rpcProviders[e]=new hg({namespace:r});break;case`cip34`:this.rpcProviders[e]=new Hg({namespace:r});break;case`elrond`:this.rpcProviders[e]=new Kg({namespace:r});break;case`multiversx`:this.rpcProviders[e]=new Xg({namespace:r});break;case`near`:this.rpcProviders[e]=new e_({namespace:r});break;case`tezos`:this.rpcProviders[e]=new i_({namespace:r});break;default:this.rpcProviders[nh]?this.rpcProviders[nh].updateNamespace(r):this.rpcProviders[nh]=new c_({namespace:r})}})}registerEventListeners(){if(typeof this.client>`u`)throw Error(`Sign Client is not initialized`);this.client.on(`session_ping`,e=>{let{topic:t}=e;t===this.session?.topic&&this.events.emit(`session_ping`,e)}),this.client.on(`session_event`,e=>{let{params:t,topic:n}=e;if(n!==this.session?.topic)return;let{event:r}=t;if(r.name===`accountsChanged`){let e=r.data;e&&Js(e)&&this.events.emit(`accountsChanged`,e.map(sg))}else if(r.name===`chainChanged`){let e=t.chainId,n=t.event.data,r=Vs(e),i=lg(e)===lg(n)?e:`${r}:${lg(n)}`;this.onChainChanged(i)}else this.events.emit(r.name,r.data);this.events.emit(`session_event`,e)}),this.client.on(`session_update`,({topic:e,params:t})=>{if(e!==this.session?.topic)return;let{namespaces:n}=t;this.session=__(g_({},this.client?.session.get(e)),{namespaces:n}),this.onSessionUpdate(),this.events.emit(`session_update`,{topic:e,params:t})}),this.client.on(`session_delete`,async e=>{e.topic===this.session?.topic&&(await this.cleanup(),this.events.emit(`session_delete`,e),this.events.emit(`disconnect`,__(g_({},H(`USER_DISCONNECTED`)),{data:e.topic})))}),this.on(ih.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[nh]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{this.getProvider(e).updateNamespace(this.session?.namespaces[e])})}setNamespaces(e){let{namespaces:t={},optionalNamespaces:n={},sessionProperties:r,scopedProperties:i}=e;this.optionalNamespaces=ag(t,n),this.sessionProperties=r,this.scopedProperties=i}validateChain(e){let[t,n]=e?.split(`:`)||[``,``];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,n];if(t&&!Object.keys(this.namespaces||{}).map(e=>Vs(e)).includes(t))throw Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&n)return[t,n];let r=Vs(Object.keys(this.namespaces)[0]);return[r,this.rpcProviders[r].getDefaultChain()]}async requestAccounts(){let[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,t=!1){if(!this.namespaces)return;let[n,r]=this.validateChain(e);if(!r)return;this.updateNamespaceChain(n,r),this.events.emit(`chainChanged`,r);let i=this.getProvider(n).getDefaultChain();t||this.getProvider(n).setDefaultChain(r),this.emitAccountsChangedOnChainChange({namespace:n,previousChainId:i,newChainId:e}),await this.persist(`namespaces`,this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:n}){try{if(t===n)return;let r=this.session?.namespaces[e]?.accounts;if(!r)return;let i=r.filter(e=>e.includes(`${n}:`)).map(sg);if(!Js(i))return;this.events.emit(`accountsChanged`,i)}catch(e){this.logger.warn(`Failed to emit accountsChanged on chain change`,e)}}updateNamespaceChain(e,t){if(!this.namespaces)return;let n=this.namespaces[e]?e:`${e}:${t}`,r={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[n]?this.namespaces[n]&&(this.namespaces[n].defaultChain=t):this.namespaces[n]=r}onConnect(){this.createProviders(),this.events.emit(`connect`,{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore(`namespaces`),await this.deleteFromStore(`optionalNamespaces`),await this.deleteFromStore(`sessionProperties`),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){let n=this.session?.topic||``;await this.client.core.storage.setItem(`${eh}/${e}${n}`,t)}async getFromStore(e){let t=this.session?.topic||``;return await this.client.core.storage.getItem(`${eh}/${e}${t}`)}async deleteFromStore(e){let t=this.session?.topic||``;await this.client.core.storage.removeItem(`${eh}/${e}${t}`)}async cleanupStorage(){try{if(this.client?.session.length>0)return;let e=await this.client.core.storage.getKeys();for(let t of e)t.startsWith(eh)&&await this.client.core.storage.removeItem(t)}catch(e){this.logger.warn(`Failed to cleanup storage`,e)}}},b_=n(),x_=`wc@2:ethereum_provider:`,S_=`https://rpc.walletconnect.org/v1/`,C_=[`eth_sendTransaction`,`personal_sign`],w_=[`eth_accounts`,`eth_requestAccounts`,`eth_sendRawTransaction`,`eth_sign`,`eth_signTransaction`,`eth_signTypedData`,`eth_signTypedData_v3`,`eth_signTypedData_v4`,`eth_sendTransaction`,`personal_sign`,`wallet_switchEthereumChain`,`wallet_addEthereumChain`,`wallet_getPermissions`,`wallet_requestPermissions`,`wallet_registerOnboarding`,`wallet_watchAsset`,`wallet_scanQRCode`,`wallet_sendCalls`,`wallet_getCapabilities`,`wallet_getCallsStatus`,`wallet_showCallsStatus`],T_=[`chainChanged`,`accountsChanged`],E_=[`chainChanged`,`accountsChanged`,`message`,`disconnect`,`connect`],D_=async()=>{let{createAppKit:t}=await e(async()=>{let{createAppKit:e}=await import(`./core-C2ho7ETH.js`);return{createAppKit:e}},__vite__mapDeps([4,1,2,5,6,7,8,9,10,11,12]));return t},O_=Object.defineProperty,k_=Object.defineProperties,A_=Object.getOwnPropertyDescriptors,j_=Object.getOwnPropertySymbols,M_=Object.prototype.hasOwnProperty,N_=Object.prototype.propertyIsEnumerable,P_=(e,t,n)=>t in e?O_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,F_=(e,t)=>{for(var n in t||={})M_.call(t,n)&&P_(e,n,t[n]);if(j_)for(var n of j_(t))N_.call(t,n)&&P_(e,n,t[n]);return e},I_=(e,t)=>k_(e,A_(t)),L_=(e,t,n)=>P_(e,typeof t==`symbol`?t:t+``,n);function R_(e){return Number(e[0].split(`:`)[1])}function z_(e){return`0x${e.toString(16)}`}function B_(e){let{chains:t,optionalChains:n,methods:r,optionalMethods:i,events:a,optionalEvents:o,rpcMap:s}=e;if(!Js(t))throw Error(`Invalid chains`);let c={chains:t,methods:r||C_,events:a||T_,rpcMap:F_({},t.length?{[R_(t)]:s[R_(t)]}:{})},l=a?.filter(e=>!T_.includes(e)),u=r?.filter(e=>!C_.includes(e));if(!n&&!o&&!i&&!(l!=null&&l.length)&&!(u!=null&&u.length))return{required:t.length?c:void 0};let d=l?.length&&u?.length||!n,f={chains:[...new Set(d?c.chains.concat(n||[]):n)],methods:[...new Set(c.methods.concat(i!=null&&i.length?i:w_))],events:[...new Set(c.events.concat(o!=null&&o.length?o:E_))],rpcMap:s};return{required:t.length?c:void 0,optional:n.length?f:void 0}}var V_=class e{constructor(){L_(this,`events`,new b_.EventEmitter),L_(this,`namespace`,`eip155`),L_(this,`accounts`,[]),L_(this,`signer`),L_(this,`chainId`,1),L_(this,`modal`),L_(this,`rpc`),L_(this,`STORAGE_KEY`,x_),L_(this,`on`,(e,t)=>(this.events.on(e,t),this)),L_(this,`once`,(e,t)=>(this.events.once(e,t),this)),L_(this,`removeListener`,(e,t)=>(this.events.removeListener(e,t),this)),L_(this,`off`,(e,t)=>(this.events.off(e,t),this)),L_(this,`parseAccount`,e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(t){let n=new e;return await n.initialize(t),n}async request(e,t){return await this.signer.request(e,this.formatChainId(this.chainId),t)}sendAsync(e,t,n){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),n)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:`eth_requestAccounts`})}async connect(e){var t;if(!this.signer.client)throw Error(`Provider not initialized. Call init() first`);this.loadConnectOpts(e);let{required:n,optional:r}=B_(this.rpc);try{let t=await new Promise(async(t,i)=>{var a,o;this.rpc.showQrModal&&((a=this.modal)==null||a.open(),(o=this.modal)==null||o.subscribeState(e=>{!e.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),i(Error(`Connection request reset. Please try again.`)))}));let s=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(I_(F_({namespaces:F_({},n&&{[this.namespace]:n})},r&&{optionalNamespaces:{[this.namespace]:r}}),{pairingTopic:e?.pairingTopic,scopedProperties:s})).then(e=>{t(e)}).catch(e=>{var t;(t=this.modal)==null||t.showErrorMessage(`Unable to connect`),i(Error(e.message))})});if(!t)return;let i=wt(t.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:i),this.setAccounts(i),this.events.emit(`connect`,{chainId:z_(this.chainId)})}catch(e){throw this.signer.logger.error(e),e}finally{(t=this.modal)==null||t.close()}}async authenticate(e,t){var n;if(!this.signer.client)throw Error(`Provider not initialized. Call init() first`);this.loadConnectOpts({chains:e?.chains});try{let n=await new Promise(async(n,r)=>{var i,a;this.rpc.showQrModal&&((i=this.modal)==null||i.open(),(a=this.modal)==null||a.subscribeState(e=>{!e.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),r(Error(`Connection request reset. Please try again.`)))})),await this.signer.authenticate(I_(F_({},e),{chains:this.rpc.chains}),t).then(e=>{n(e)}).catch(e=>{var t;(t=this.modal)==null||t.showErrorMessage(`Unable to connect`),r(Error(e.message))})}),r=n.session;if(r){let e=wt(r.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:e),this.setAccounts(e),this.events.emit(`connect`,{chainId:z_(this.chainId)})}return n}catch(e){throw this.signer.logger.error(e),e}finally{(n=this.modal)==null||n.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on(`session_event`,e=>{let{params:t}=e,{event:n}=t;n.name===`accountsChanged`?(this.accounts=this.parseAccounts(n.data),this.events.emit(`accountsChanged`,this.accounts)):n.name===`chainChanged`?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit(`session_event`,e)}),this.signer.on(`accountsChanged`,e=>{this.accounts=this.parseAccounts(e),this.events.emit(`accountsChanged`,this.accounts)}),this.signer.on(`chainChanged`,e=>{this.chainId=parseInt(e),this.events.emit(`chainChanged`,z_(this.chainId)),this.persist()}),this.signer.on(`session_update`,e=>{this.events.emit(`session_update`,e)}),this.signer.on(`session_delete`,e=>{this.reset(),this.events.emit(`session_delete`,e),this.events.emit(`disconnect`,I_(F_({},H(`USER_DISCONNECTED`)),{data:e.topic,name:`USER_DISCONNECTED`}))}),this.signer.on(`display_uri`,e=>{this.events.emit(`display_uri`,e)})}switchEthereumChain(e){this.request({method:`wallet_switchEthereumChain`,params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e==`string`?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(`:`)[1])}setChainIds(e){let t=e.filter(e=>this.isCompatibleChainId(e)).map(e=>this.parseChainId(e));t.length&&(this.chainId=t[0],this.events.emit(`chainChanged`,z_(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){let t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){let[t,n,r]=e.split(`:`);return{chainId:`${t}:${n}`,address:r}}setAccounts(e){this.accounts=e.filter(e=>this.parseChainId(this.parseAccountId(e).chainId)===this.chainId).map(e=>this.parseAccountId(e).address),this.events.emit(`accountsChanged`,this.accounts)}getRpcConfig(e){let t=e?.chains??[],n=e?.optionalChains??[],r=t.concat(n);if(!r.length)throw Error("No chains specified in either `chains` or `optionalChains`");let i=t.length?e?.methods||C_:[],a=t.length?e?.events||T_:[],o=e?.optionalMethods||[],s=e?.optionalEvents||[],c=e?.rpcMap||this.buildRpcMap(r,e.projectId),l=e?.qrModalOptions||void 0;return{chains:t?.map(e=>this.formatChainId(e)),optionalChains:n.map(e=>this.formatChainId(e)),methods:i,events:a,optionalMethods:o,optionalEvents:s,rpcMap:c,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:l,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){let n={};return e.forEach(e=>{n[e]=this.getRpcUrl(e,t)}),n}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?R_(this.rpc.chains):R_(this.rpc.optionalChains),this.signer=await y_.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let e;try{let t=await D_(),{convertWCMToAppKitOptions:n}=await Promise.resolve().then(function(){return tv}),r=n(I_(F_({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!r.networks.length)throw Error(`No networks found for WalletConnect`);e=t(I_(F_({},r),{universalProvider:this.signer,manualWCControl:!0}))}catch(e){throw console.warn(e),Error(`To use QR modal, please install @reown/appkit package`)}if(e)try{this.modal=e}catch(e){throw this.signer.logger.error(e),Error(`Could not generate WalletConnectModal Instance`)}}}loadConnectOpts(e){if(!e)return;let{chains:t,optionalChains:n,rpcMap:r}=e;t&&Js(t)&&(this.rpc.chains=t.map(e=>this.formatChainId(e)),t.forEach(e=>{this.rpc.rpcMap[e]=r?.[e]||this.getRpcUrl(e)})),n&&Js(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n?.map(e=>this.formatChainId(e)),n.forEach(e=>{this.rpc.rpcMap[e]=r?.[e]||this.getRpcUrl(e)}))}getRpcUrl(e,t){return this.rpc.rpcMap?.[e]||`${S_}?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{let e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:t?.accounts),this.setAccounts(t?.accounts)}catch(e){this.signer.logger.error(`Failed to load persisted session, clearing state...`),this.signer.logger.error(e),await this.disconnect().catch(e=>this.signer.logger.warn(e))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e==`string`||e instanceof String?[this.parseAccount(e)]:e.map(e=>this.parseAccount(e))}},H_=Object.defineProperty,U_=Object.defineProperties,W_=Object.getOwnPropertyDescriptors,G_=Object.getOwnPropertySymbols,K_=Object.prototype.hasOwnProperty,q_=Object.prototype.propertyIsEnumerable,J_=(e,t,n)=>t in e?H_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Y_=(e,t)=>{for(var n in t||={})K_.call(t,n)&&J_(e,n,t[n]);if(G_)for(var n of G_(t))q_.call(t,n)&&J_(e,n,t[n]);return e},X_=(e,t)=>U_(e,W_(t));function Z_(e){if(e)return{"--w3m-font-family":e[`--wcm-font-family`],"--w3m-accent":e[`--wcm-accent-color`],"--w3m-color-mix":e[`--wcm-background-color`],"--w3m-z-index":e[`--wcm-z-index`]?Number(e[`--wcm-z-index`]):void 0,"--w3m-qr-color":e[`--wcm-accent-color`],"--w3m-font-size-master":e[`--wcm-text-medium-regular-size`],"--w3m-border-radius-master":e[`--wcm-container-border-radius`],"--w3m-color-mix-strength":0}}var Q_=e=>{let[t,n]=e.split(`:`);return ev({id:n,caipNetworkId:e,chainNamespace:t,name:``,nativeCurrency:{name:``,symbol:``,decimals:8},rpcUrls:{default:{http:[`https://rpc.walletconnect.org/v1`]}}})};function $_(e){var t,n;let r=e.chains?.map(Q_).filter(Boolean);if(r.length===0)throw Error(`At least one chain must be specified`);let i=r.find(t=>t.id===e.defaultChain?.id),a={projectId:e.projectId,networks:r,themeMode:e.themeMode,themeVariables:Z_(e.themeVariables),chainImages:e.chainImages,connectorImages:e.walletImages,defaultNetwork:i,metadata:X_(Y_({},e.metadata),{name:e.metadata?.name||`WalletConnect`,description:e.metadata?.description||`Connect to WalletConnect-compatible wallets`,url:e.metadata?.url||`https://walletconnect.org`,icons:e.metadata?.icons||[`https://walletconnect.org/walletconnect-logo.png`]}),showWallets:!0,featuredWalletIds:e.explorerRecommendedWalletIds===`NONE`?[]:Array.isArray(e.explorerRecommendedWalletIds)?e.explorerRecommendedWalletIds:[],excludeWalletIds:e.explorerExcludedWalletIds===`ALL`?[]:Array.isArray(e.explorerExcludedWalletIds)?e.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((t=e.mobileWallets)!=null&&t.length||(n=e.desktopWallets)!=null&&n.length){let t=[...(e.mobileWallets||[]).map(e=>({id:e.id,name:e.name,links:e.links})),...(e.desktopWallets||[]).map(e=>({id:e.id,name:e.name,links:{native:e.links.native,universal:e.links.universal}}))],n=[...a.featuredWalletIds||[],...a.excludeWalletIds||[]],r=t.filter(e=>!n.includes(e.id));r.length&&(a.customWallets=r)}return a}function ev(e){return Y_({formatters:void 0,fees:void 0,serializers:void 0},e)}var tv=Object.freeze({__proto__:null,convertWCMToAppKitOptions:$_,defineChain:ev});export{V_ as EthereumProvider};