import{$t as e}from"./index-CALDYd03.js";import{c as t,f as n,g as r,i,m as a,o,p as s,r as c,s as l,t as u,u as d}from"./utils-C3w0p1k9.js";function f(e,t,n,r){if(typeof e.setBigUint64==`function`)return e.setBigUint64(t,n,r);let i=BigInt(32),a=BigInt(4294967295),o=Number(n>>i&a),s=Number(n&a),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,s,r)}function p(e,t,n){return e&t^~e&n}function m(e,t,n){return e&t^e&n^t&n}var h=class extends u{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=i(this.buffer)}update(e){s(this);let{view:n,buffer:r,blockLen:a}=this;e=t(e);let o=e.length;for(let t=0;t<o;){let s=Math.min(a-this.pos,o-t);if(s===a){let n=i(e);for(;a<=o-t;t+=a)this.process(n,t);continue}r.set(e.subarray(t,t+s),this.pos),this.pos+=s,t+=s,this.pos===a&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){s(this),r(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:a,isLE:o}=this,{pos:c}=this;t[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>a-c&&(this.process(n,0),c=0);for(let e=c;e<a;e++)t[e]=0;f(n,a-8,BigInt(this.length*8),o),this.process(n,0);let l=i(e),u=this.outputLen;if(u%4)throw Error(`_sha2: outputLen should be aligned to 32bit`);let d=u/4,p=this.get();if(d>p.length)throw Error(`_sha2: outputLen bigger than state`);for(let e=0;e<d;e++)l.setUint32(4*e,p[e],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||=new this.constructor,e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:i,destroyed:a,pos:o}=this;return e.length=r,e.pos=o,e.finished=i,e.destroyed=a,r%t&&e.buffer.set(n),e}},g=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),_=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),v=new Uint32Array(64),y=class extends h{constructor(){super(64,32,8,!1),this.A=_[0]|0,this.B=_[1]|0,this.C=_[2]|0,this.D=_[3]|0,this.E=_[4]|0,this.F=_[5]|0,this.G=_[6]|0,this.H=_[7]|0}get(){let{A:e,B:t,C:n,D:r,E:i,F:a,G:o,H:s}=this;return[e,t,n,r,i,a,o,s]}set(e,t,n,r,i,a,o,s){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=i|0,this.F=a|0,this.G=o|0,this.H=s|0}process(e,t){for(let n=0;n<16;n++,t+=4)v[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=v[e-15],n=v[e-2],r=l(t,7)^l(t,18)^t>>>3;v[e]=(l(n,17)^l(n,19)^n>>>10)+v[e-7]+r+v[e-16]|0}let{A:n,B:r,C:i,D:a,E:o,F:s,G:c,H:u}=this;for(let e=0;e<64;e++){let t=l(o,6)^l(o,11)^l(o,25),d=u+t+p(o,s,c)+g[e]+v[e]|0,f=(l(n,2)^l(n,13)^l(n,22))+m(n,r,i)|0;u=c,c=s,s=o,o=a+d|0,a=i,i=r,r=n,n=d+f|0}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,a=a+this.D|0,o=o+this.E|0,s=s+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(n,r,i,a,o,s,c,u)}roundClean(){v.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const b=d(()=>new y);var x=class extends u{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,a(e);let r=t(n);if(this.iHash=e.create(),typeof this.iHash.update!=`function`)throw Error(`Expected instance of class which extends utils.Hash`);this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let i=this.blockLen,o=new Uint8Array(i);o.set(r.length>i?e.create().update(r).digest():r);for(let e=0;e<o.length;e++)o[e]^=54;this.iHash.update(o),this.oHash=e.create();for(let e=0;e<o.length;e++)o[e]^=106;this.oHash.update(o),o.fill(0)}update(e){return s(this),this.iHash.update(e),this}digestInto(e){s(this),n(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});let{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:a,outputLen:o}=this;return e=e,e.finished=r,e.destroyed=i,e.blockLen=a,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const S=(e,t,n)=>new x(e,t).update(n).digest();S.create=(e,t)=>new x(e,t);var C=e({aInRange:()=>V,abool:()=>k,abytes:()=>O,bitGet:()=>ce,bitLen:()=>se,bitMask:()=>H,bitSet:()=>le,bytesToHex:()=>A,bytesToNumberBE:()=>P,bytesToNumberLE:()=>re,concatBytes:()=>R,createHmacDrbg:()=>de,ensureBytes:()=>L,equalBytes:()=>ae,hexToBytes:()=>N,hexToNumber:()=>te,inRange:()=>B,isBytes:()=>D,memoized:()=>me,notImplemented:()=>pe,numberToBytesBE:()=>F,numberToBytesLE:()=>I,numberToHexUnpadded:()=>j,numberToVarBytesBE:()=>ie,utf8ToBytes:()=>oe,validateObject:()=>W}),w=BigInt(0),T=BigInt(1),E=BigInt(2);function D(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name===`Uint8Array`}function O(e){if(!D(e))throw Error(`Uint8Array expected`)}function k(e,t){if(typeof t!=`boolean`)throw Error(e+` boolean expected, got `+t)}var ee=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,`0`));function A(e){O(e);let t=``;for(let n=0;n<e.length;n++)t+=ee[e[n]];return t}function j(e){let t=e.toString(16);return t.length&1?`0`+t:t}function te(e){if(typeof e!=`string`)throw Error(`hex string expected, got `+typeof e);return e===``?w:BigInt(`0x`+e)}var M={_0:48,_9:57,A:65,F:70,a:97,f:102};function ne(e){if(e>=M._0&&e<=M._9)return e-M._0;if(e>=M.A&&e<=M.F)return e-(M.A-10);if(e>=M.a&&e<=M.f)return e-(M.a-10)}function N(e){if(typeof e!=`string`)throw Error(`hex string expected, got `+typeof e);let t=e.length,n=t/2;if(t%2)throw Error(`hex string expected, got unpadded hex of length `+t);let r=new Uint8Array(n);for(let t=0,i=0;t<n;t++,i+=2){let n=ne(e.charCodeAt(i)),a=ne(e.charCodeAt(i+1));if(n===void 0||a===void 0){let t=e[i]+e[i+1];throw Error(`hex string expected, got non-hex character "`+t+`" at index `+i)}r[t]=n*16+a}return r}function P(e){return te(A(e))}function re(e){return O(e),te(A(Uint8Array.from(e).reverse()))}function F(e,t){return N(e.toString(16).padStart(t*2,`0`))}function I(e,t){return F(e,t).reverse()}function ie(e){return N(j(e))}function L(e,t,n){let r;if(typeof t==`string`)try{r=N(t)}catch(t){throw Error(e+` must be hex string or Uint8Array, cause: `+t)}else if(D(t))r=Uint8Array.from(t);else throw Error(e+` must be hex string or Uint8Array`);let i=r.length;if(typeof n==`number`&&i!==n)throw Error(e+` of length `+n+` expected, got `+i);return r}function R(...e){let t=0;for(let n=0;n<e.length;n++){let r=e[n];O(r),t+=r.length}let n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){let i=e[t];n.set(i,r),r+=i.length}return n}function ae(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}function oe(e){if(typeof e!=`string`)throw Error(`string expected`);return new Uint8Array(new TextEncoder().encode(e))}var z=e=>typeof e==`bigint`&&w<=e;function B(e,t,n){return z(e)&&z(t)&&z(n)&&t<=e&&e<n}function V(e,t,n,r){if(!B(t,n,r))throw Error(`expected valid `+e+`: `+n+` <= n < `+r+`, got `+t)}function se(e){let t;for(t=0;e>w;e>>=T,t+=1);return t}function ce(e,t){return e>>BigInt(t)&T}function le(e,t,n){return e|(n?T:w)<<BigInt(t)}const H=e=>(E<<BigInt(e-1))-T;var U=e=>new Uint8Array(e),ue=e=>Uint8Array.from(e);function de(e,t,n){if(typeof e!=`number`||e<2)throw Error(`hashLen must be a number`);if(typeof t!=`number`||t<2)throw Error(`qByteLen must be a number`);if(typeof n!=`function`)throw Error(`hmacFn must be a function`);let r=U(e),i=U(e),a=0,o=()=>{r.fill(1),i.fill(0),a=0},s=(...e)=>n(i,r,...e),c=(e=U())=>{i=s(ue([0]),e),r=s(),e.length!==0&&(i=s(ue([1]),e),r=s())},l=()=>{if(a++>=1e3)throw Error(`drbg: tried 1000 values`);let e=0,n=[];for(;e<t;){r=s();let t=r.slice();n.push(t),e+=r.length}return R(...n)};return(e,t)=>{o(),c(e);let n;for(;!(n=t(l()));)c();return o(),n}}var fe={bigint:e=>typeof e==`bigint`,function:e=>typeof e==`function`,boolean:e=>typeof e==`boolean`,string:e=>typeof e==`string`,stringOrUint8Array:e=>typeof e==`string`||D(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e==`function`&&Number.isSafeInteger(e.outputLen)};function W(e,t,n={}){let r=(t,n,r)=>{let i=fe[n];if(typeof i!=`function`)throw Error(`invalid validator function`);let a=e[t];if(!(r&&a===void 0)&&!i(a,e))throw Error(`param `+String(t)+` is invalid. Expected `+n+`, got `+a)};for(let[e,n]of Object.entries(t))r(e,n,!1);for(let[e,t]of Object.entries(n))r(e,t,!0);return e}const pe=()=>{throw Error(`not implemented`)};function me(e){let t=new WeakMap;return(n,...r)=>{let i=t.get(n);if(i!==void 0)return i;let a=e(n,...r);return t.set(n,a),a}}var G=BigInt(0),K=BigInt(1),q=BigInt(2),he=BigInt(3),ge=BigInt(4),_e=BigInt(5),ve=BigInt(8),ye=BigInt(16);function J(e,t){let n=e%t;return n>=G?n:t+n}function be(e,t,n){if(t<G)throw Error(`invalid exponent, negatives unsupported`);if(n<=G)throw Error(`invalid modulus`);if(n===K)return G;let r=K;for(;t>G;)t&K&&(r=r*e%n),e=e*e%n,t>>=K;return r}function Y(e,t,n){let r=e;for(;t-- >G;)r*=r,r%=n;return r}function xe(e,t){if(e===G)throw Error(`invert: expected non-zero number`);if(t<=G)throw Error(`invert: expected positive modulus, got `+t);let n=J(e,t),r=t,i=G,a=K,o=K,s=G;for(;n!==G;){let e=r/n,t=r%n,c=i-o*e,l=a-s*e;r=n,n=t,i=o,a=s,o=c,s=l}if(r!==K)throw Error(`invert: does not exist`);return J(i,t)}function Se(e){let t=(e-K)/q,n,r,i;for(n=e-K,r=0;n%q===G;n/=q,r++);for(i=q;i<e&&be(i,t,e)!==e-K;i++)if(i>1e3)throw Error(`Cannot find square root: likely non-prime P`);if(r===1){let t=(e+K)/ge;return function(e,n){let r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw Error(`Cannot find square root`);return r}}let a=(n+K)/q;return function(e,o){if(e.pow(o,t)===e.neg(e.ONE))throw Error(`Cannot find square root`);let s=r,c=e.pow(e.mul(e.ONE,i),n),l=e.pow(o,a),u=e.pow(o,n);for(;!e.eql(u,e.ONE);){if(e.eql(u,e.ZERO))return e.ZERO;let t=1;for(let n=e.sqr(u);t<s&&!e.eql(n,e.ONE);t++)n=e.sqr(n);let n=e.pow(c,K<<BigInt(s-t-1));c=e.sqr(n),l=e.mul(l,n),u=e.mul(u,c),s=t}return l}}function Ce(e){if(e%ge===he){let t=(e+K)/ge;return function(e,n){let r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw Error(`Cannot find square root`);return r}}if(e%ve===_e){let t=(e-_e)/ve;return function(e,n){let r=e.mul(n,q),i=e.pow(r,t),a=e.mul(n,i),o=e.mul(e.mul(a,q),i),s=e.mul(a,e.sub(o,e.ONE));if(!e.eql(e.sqr(s),n))throw Error(`Cannot find square root`);return s}}return e%ye,Se(e)}var we=[`create`,`isValid`,`is0`,`neg`,`inv`,`sqrt`,`sqr`,`eql`,`add`,`sub`,`mul`,`pow`,`div`,`addN`,`subN`,`mulN`,`sqrN`];function Te(e){return W(e,we.reduce((e,t)=>(e[t]=`function`,e),{ORDER:`bigint`,MASK:`bigint`,BYTES:`isSafeInteger`,BITS:`isSafeInteger`}))}function Ee(e,t,n){if(n<G)throw Error(`invalid exponent, negatives unsupported`);if(n===G)return e.ONE;if(n===K)return t;let r=e.ONE,i=t;for(;n>G;)n&K&&(r=e.mul(r,i)),i=e.sqr(i),n>>=K;return r}function De(e,t){let n=Array(t.length),r=t.reduce((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r)),e.ONE),i=e.inv(r);return t.reduceRight((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r)),i),n}function Oe(e,t){let n=t===void 0?e.toString(2).length:t;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function ke(e,t,n=!1,r={}){if(e<=G)throw Error(`invalid field: expected ORDER > 0, got `+e);let{nBitLength:i,nByteLength:a}=Oe(e,t);if(a>2048)throw Error(`invalid field: expected ORDER of <= 2048 bytes`);let o,s=Object.freeze({ORDER:e,isLE:n,BITS:i,BYTES:a,MASK:H(i),ZERO:G,ONE:K,create:t=>J(t,e),isValid:t=>{if(typeof t!=`bigint`)throw Error(`invalid field element: expected bigint, got `+typeof t);return G<=t&&t<e},is0:e=>e===G,isOdd:e=>(e&K)===K,neg:t=>J(-t,e),eql:(e,t)=>e===t,sqr:t=>J(t*t,e),add:(t,n)=>J(t+n,e),sub:(t,n)=>J(t-n,e),mul:(t,n)=>J(t*n,e),pow:(e,t)=>Ee(s,e,t),div:(t,n)=>J(t*xe(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>xe(t,e),sqrt:r.sqrt||(t=>(o||=Ce(e),o(s,t))),invertBatch:e=>De(s,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?I(e,a):F(e,a),fromBytes:e=>{if(e.length!==a)throw Error(`Field.fromBytes: expected `+a+` bytes, got `+e.length);return n?re(e):P(e)}});return Object.freeze(s)}function Ae(e){if(typeof e!=`bigint`)throw Error(`field order must be bigint`);let t=e.toString(2).length;return Math.ceil(t/8)}function je(e){let t=Ae(e);return t+Math.ceil(t/2)}function Me(e,t,n=!1){let r=e.length,i=Ae(t),a=je(t);if(r<16||r<a||r>1024)throw Error(`expected `+a+`-1024 bytes of input, got `+r);let o=J(n?re(e):P(e),t-K)+K;return n?I(o,i):F(o,i)}var Ne=BigInt(0),X=BigInt(1);function Pe(e,t){let n=t.negate();return e?n:t}function Fe(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error(`invalid window size, expected [1..`+t+`], got W=`+e)}function Ie(e,t){return Fe(e,t),{windows:Math.ceil(t/e)+1,windowSize:2**(e-1)}}function Le(e,t){if(!Array.isArray(e))throw Error(`array expected`);e.forEach((e,n)=>{if(!(e instanceof t))throw Error(`invalid point at index `+n)})}function Re(e,t){if(!Array.isArray(e))throw Error(`array of scalars expected`);e.forEach((e,n)=>{if(!t.isValid(e))throw Error(`invalid scalar at index `+n)})}var ze=new WeakMap,Be=new WeakMap;function Ve(e){return Be.get(e)||1}function He(e,t){return{constTimeNegate:Pe,hasPrecomputes(e){return Ve(e)!==1},unsafeLadder(t,n,r=e.ZERO){let i=t;for(;n>Ne;)n&X&&(r=r.add(i)),i=i.double(),n>>=X;return r},precomputeWindow(e,n){let{windows:r,windowSize:i}=Ie(n,t),a=[],o=e,s=o;for(let e=0;e<r;e++){s=o,a.push(s);for(let e=1;e<i;e++)s=s.add(o),a.push(s);o=s.double()}return a},wNAF(n,r,i){let{windows:a,windowSize:o}=Ie(n,t),s=e.ZERO,c=e.BASE,l=BigInt(2**n-1),u=2**n,d=BigInt(n);for(let e=0;e<a;e++){let t=e*o,n=Number(i&l);i>>=d,n>o&&(n-=u,i+=X);let a=t,f=t+Math.abs(n)-1,p=e%2!=0,m=n<0;n===0?c=c.add(Pe(p,r[a])):s=s.add(Pe(m,r[f]))}return{p:s,f:c}},wNAFUnsafe(n,r,i,a=e.ZERO){let{windows:o,windowSize:s}=Ie(n,t),c=BigInt(2**n-1),l=2**n,u=BigInt(n);for(let e=0;e<o;e++){let t=e*s;if(i===Ne)break;let n=Number(i&c);if(i>>=u,n>s&&(n-=l,i+=X),n===0)continue;let o=r[t+Math.abs(n)-1];n<0&&(o=o.negate()),a=a.add(o)}return a},getPrecomputes(e,t,n){let r=ze.get(t);return r||(r=this.precomputeWindow(t,e),e!==1&&ze.set(t,n(r))),r},wNAFCached(e,t,n){let r=Ve(e);return this.wNAF(r,this.getPrecomputes(r,e,n),t)},wNAFCachedUnsafe(e,t,n,r){let i=Ve(e);return i===1?this.unsafeLadder(e,t,r):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),t,r)},setWindowSize(e,n){Fe(n,t),Be.set(e,n),ze.delete(e)}}}function Ue(e,t,n,r){if(Le(n,e),Re(r,t),n.length!==r.length)throw Error(`arrays of points and scalars must have equal length`);let i=e.ZERO,a=se(BigInt(n.length)),o=a>12?a-3:a>4?a-2:a?2:1,s=(1<<o)-1,c=Array(s+1).fill(i),l=Math.floor((t.BITS-1)/o)*o,u=i;for(let e=l;e>=0;e-=o){c.fill(i);for(let t=0;t<r.length;t++){let i=r[t],a=Number(i>>BigInt(e)&BigInt(s));c[a]=c[a].add(n[t])}let t=i;for(let e=c.length-1,n=i;e>0;e--)n=n.add(c[e]),t=t.add(n);if(u=u.add(t),e!==0)for(let e=0;e<o;e++)u=u.double()}return u}function We(e){return Te(e.Fp),W(e,{n:`bigint`,h:`bigint`,Gx:`field`,Gy:`field`},{nBitLength:`isSafeInteger`,nByteLength:`isSafeInteger`}),Object.freeze({...Oe(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}function Ge(e){e.lowS!==void 0&&k(`lowS`,e.lowS),e.prehash!==void 0&&k(`prehash`,e.prehash)}function Ke(e){let t=We(e);W(t,{a:`field`,b:`field`},{allowedPrivateKeyLengths:`array`,wrapPrivateKey:`boolean`,isTorsionFree:`function`,clearCofactor:`function`,allowInfinityPoint:`boolean`,fromBytes:`function`,toBytes:`function`});let{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw Error(`invalid endomorphism, can only be defined for Koblitz curves that have a=0`);if(typeof n!=`object`||typeof n.beta!=`bigint`||typeof n.splitScalar!=`function`)throw Error(`invalid endomorphism, expected beta: bigint and splitScalar: function`)}return Object.freeze({...t})}var{bytesToNumberBE:qe,hexToBytes:Je}=C;const Z={Err:class extends Error{constructor(e=``){super(e)}},_tlv:{encode:(e,t)=>{let{Err:n}=Z;if(e<0||e>256)throw new n(`tlv.encode: wrong tag`);if(t.length&1)throw new n(`tlv.encode: unpadded data`);let r=t.length/2,i=j(r);if(i.length/2&128)throw new n(`tlv.encode: long form length too big`);let a=r>127?j(i.length/2|128):``;return j(e)+a+i+t},decode(e,t){let{Err:n}=Z,r=0;if(e<0||e>256)throw new n(`tlv.encode: wrong tag`);if(t.length<2||t[r++]!==e)throw new n(`tlv.decode: wrong tlv`);let i=t[r++],a=!!(i&128),o=0;if(!a)o=i;else{let e=i&127;if(!e)throw new n(`tlv.decode(long): indefinite length not supported`);if(e>4)throw new n(`tlv.decode(long): byte length is too big`);let a=t.subarray(r,r+e);if(a.length!==e)throw new n(`tlv.decode: length bytes not complete`);if(a[0]===0)throw new n(`tlv.decode(long): zero leftmost byte`);for(let e of a)o=o<<8|e;if(r+=e,o<128)throw new n(`tlv.decode(long): not minimal encoding`)}let s=t.subarray(r,r+o);if(s.length!==o)throw new n(`tlv.decode: wrong value length`);return{v:s,l:t.subarray(r+o)}}},_int:{encode(e){let{Err:t}=Z;if(e<Q)throw new t(`integer: negative integers are not allowed`);let n=j(e);if(Number.parseInt(n[0],16)&8&&(n=`00`+n),n.length&1)throw new t(`unexpected DER parsing assertion: unpadded hex`);return n},decode(e){let{Err:t}=Z;if(e[0]&128)throw new t(`invalid signature integer: negative`);if(e[0]===0&&!(e[1]&128))throw new t(`invalid signature integer: unnecessary leading zero`);return qe(e)}},toSig(e){let{Err:t,_int:n,_tlv:r}=Z,i=typeof e==`string`?Je(e):e;O(i);let{v:a,l:o}=r.decode(48,i);if(o.length)throw new t(`invalid signature: left bytes after parsing`);let{v:s,l:c}=r.decode(2,a),{v:l,l:u}=r.decode(2,c);if(u.length)throw new t(`invalid signature: left bytes after parsing`);return{r:n.decode(s),s:n.decode(l)}},hexFromSig(e){let{_tlv:t,_int:n}=Z,r=t.encode(2,n.encode(e.r))+t.encode(2,n.encode(e.s));return t.encode(48,r)}};var Q=BigInt(0),$=BigInt(1);BigInt(2);var Ye=BigInt(3);BigInt(4);function Xe(e){let t=Ke(e),{Fp:n}=t,r=ke(t.n,t.nBitLength),i=t.toBytes||((e,t,r)=>{let i=t.toAffine();return R(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),a=t.fromBytes||(e=>{let t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function o(e){let{a:r,b:i}=t,a=n.sqr(e),o=n.mul(a,e);return n.add(n.add(o,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),o(t.Gx)))throw Error(`bad generator point: equation left != right`);function s(e){return B(e,$,t.n)}function c(e){let{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:a}=t;if(n&&typeof e!=`bigint`){if(D(e)&&(e=A(e)),typeof e!=`string`||!n.includes(e.length))throw Error(`invalid private key`);e=e.padStart(r*2,`0`)}let o;try{o=typeof e==`bigint`?e:P(L(`private key`,e,r))}catch{throw Error(`invalid private key, expected hex or `+r+` bytes, got `+typeof e)}return i&&(o=J(o,a)),V(`private key`,o,$,a),o}function l(e){if(!(e instanceof f))throw Error(`ProjectivePoint expected`)}let u=me((e,t)=>{let{px:r,py:i,pz:a}=e;if(n.eql(a,n.ONE))return{x:r,y:i};let o=e.is0();t??=o?n.ONE:n.inv(a);let s=n.mul(r,t),c=n.mul(i,t),l=n.mul(a,t);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(l,n.ONE))throw Error(`invZ was invalid`);return{x:s,y:c}}),d=me(e=>{if(e.is0()){if(t.allowInfinityPoint&&!n.is0(e.py))return;throw Error(`bad point: ZERO`)}let{x:r,y:i}=e.toAffine();if(!n.isValid(r)||!n.isValid(i))throw Error(`bad point: x or y not FE`);let a=n.sqr(i),s=o(r);if(!n.eql(a,s))throw Error(`bad point: equation left != right`);if(!e.isTorsionFree())throw Error(`bad point: not in prime-order subgroup`);return!0});class f{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,e==null||!n.isValid(e))throw Error(`x required`);if(t==null||!n.isValid(t))throw Error(`y required`);if(r==null||!n.isValid(r))throw Error(`z required`);Object.freeze(this)}static fromAffine(e){let{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw Error(`invalid affine point`);if(e instanceof f)throw Error(`projective point not allowed`);let i=e=>n.eql(e,n.ZERO);return i(t)&&i(r)?f.ZERO:new f(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){let t=n.invertBatch(e.map(e=>e.pz));return e.map((e,n)=>e.toAffine(t[n])).map(f.fromAffine)}static fromHex(e){let t=f.fromAffine(a(L(`pointHex`,e)));return t.assertValidity(),t}static fromPrivateKey(e){return f.BASE.multiply(c(e))}static msm(e,t){return Ue(f,r,e,t)}_setWindowSize(e){m.setWindowSize(this,e)}assertValidity(){d(this)}hasEvenY(){let{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw Error(`Field doesn't support isOdd`)}equals(e){l(e);let{px:t,py:r,pz:i}=this,{px:a,py:o,pz:s}=e,c=n.eql(n.mul(t,s),n.mul(a,i)),u=n.eql(n.mul(r,s),n.mul(o,i));return c&&u}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){let{a:e,b:r}=t,i=n.mul(r,Ye),{px:a,py:o,pz:s}=this,c=n.ZERO,l=n.ZERO,u=n.ZERO,d=n.mul(a,a),p=n.mul(o,o),m=n.mul(s,s),h=n.mul(a,o);return h=n.add(h,h),u=n.mul(a,s),u=n.add(u,u),c=n.mul(e,u),l=n.mul(i,m),l=n.add(c,l),c=n.sub(p,l),l=n.add(p,l),l=n.mul(c,l),c=n.mul(h,c),u=n.mul(i,u),m=n.mul(e,m),h=n.sub(d,m),h=n.mul(e,h),h=n.add(h,u),u=n.add(d,d),d=n.add(u,d),d=n.add(d,m),d=n.mul(d,h),l=n.add(l,d),m=n.mul(o,s),m=n.add(m,m),d=n.mul(m,h),c=n.sub(c,d),u=n.mul(m,p),u=n.add(u,u),u=n.add(u,u),new f(c,l,u)}add(e){l(e);let{px:r,py:i,pz:a}=this,{px:o,py:s,pz:c}=e,u=n.ZERO,d=n.ZERO,p=n.ZERO,m=t.a,h=n.mul(t.b,Ye),g=n.mul(r,o),_=n.mul(i,s),v=n.mul(a,c),y=n.add(r,i),b=n.add(o,s);y=n.mul(y,b),b=n.add(g,_),y=n.sub(y,b),b=n.add(r,a);let x=n.add(o,c);return b=n.mul(b,x),x=n.add(g,v),b=n.sub(b,x),x=n.add(i,a),u=n.add(s,c),x=n.mul(x,u),u=n.add(_,v),x=n.sub(x,u),p=n.mul(m,b),u=n.mul(h,v),p=n.add(u,p),u=n.sub(_,p),p=n.add(_,p),d=n.mul(u,p),_=n.add(g,g),_=n.add(_,g),v=n.mul(m,v),b=n.mul(h,b),_=n.add(_,v),v=n.sub(g,v),v=n.mul(m,v),b=n.add(b,v),g=n.mul(_,b),d=n.add(d,g),g=n.mul(x,b),u=n.mul(y,u),u=n.sub(u,g),g=n.mul(y,_),p=n.mul(x,p),p=n.add(p,g),new f(u,d,p)}subtract(e){return this.add(e.negate())}is0(){return this.equals(f.ZERO)}wNAF(e){return m.wNAFCached(this,e,f.normalizeZ)}multiplyUnsafe(e){let{endo:r,n:i}=t;V(`scalar`,e,Q,i);let a=f.ZERO;if(e===Q)return a;if(this.is0()||e===$)return this;if(!r||m.hasPrecomputes(this))return m.wNAFCachedUnsafe(this,e,f.normalizeZ);let{k1neg:o,k1:s,k2neg:c,k2:l}=r.splitScalar(e),u=a,d=a,p=this;for(;s>Q||l>Q;)s&$&&(u=u.add(p)),l&$&&(d=d.add(p)),p=p.double(),s>>=$,l>>=$;return o&&(u=u.negate()),c&&(d=d.negate()),d=new f(n.mul(d.px,r.beta),d.py,d.pz),u.add(d)}multiply(e){let{endo:r,n:i}=t;V(`scalar`,e,$,i);let a,o;if(r){let{k1neg:t,k1:i,k2neg:s,k2:c}=r.splitScalar(e),{p:l,f:u}=this.wNAF(i),{p:d,f:p}=this.wNAF(c);l=m.constTimeNegate(t,l),d=m.constTimeNegate(s,d),d=new f(n.mul(d.px,r.beta),d.py,d.pz),a=l.add(d),o=u.add(p)}else{let{p:t,f:n}=this.wNAF(e);a=t,o=n}return f.normalizeZ([a,o])[0]}multiplyAndAddUnsafe(e,t,n){let r=f.BASE,i=(e,t)=>t===Q||t===$||!e.equals(r)?e.multiplyUnsafe(t):e.multiply(t),a=i(this,t).add(i(e,n));return a.is0()?void 0:a}toAffine(e){return u(this,e)}isTorsionFree(){let{h:e,isTorsionFree:n}=t;if(e===$)return!0;if(n)return n(f,this);throw Error(`isTorsionFree() has not been declared for the elliptic curve`)}clearCofactor(){let{h:e,clearCofactor:n}=t;return e===$?this:n?n(f,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return k(`isCompressed`,e),this.assertValidity(),i(f,this,e)}toHex(e=!0){return k(`isCompressed`,e),A(this.toRawBytes(e))}}f.BASE=new f(t.Gx,t.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);let p=t.nBitLength,m=He(f,t.endo?Math.ceil(p/2):p);return{CURVE:t,ProjectivePoint:f,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:s}}function Ze(e){let t=We(e);return W(t,{hash:`hash`,hmac:`function`,randomBytes:`function`},{bits2int:`function`,bits2int_modN:`function`,lowS:`boolean`}),Object.freeze({lowS:!0,...t})}function Qe(e){let t=Ze(e),{Fp:n,n:r}=t,i=n.BYTES+1,a=2*n.BYTES+1;function o(e){return J(e,r)}function s(e){return xe(e,r)}let{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:d}=Xe({...t,toBytes(e,t,r){let i=t.toAffine(),a=n.toBytes(i.x),o=R;return k(`isCompressed`,r),r?o(Uint8Array.from([t.hasEvenY()?2:3]),a):o(Uint8Array.from([4]),a,n.toBytes(i.y))},fromBytes(e){let t=e.length,r=e[0],o=e.subarray(1);if(t===i&&(r===2||r===3)){let e=P(o);if(!B(e,$,n.ORDER))throw Error(`Point is not on curve`);let t=u(e),i;try{i=n.sqrt(t)}catch(e){let t=e instanceof Error?`: `+e.message:``;throw Error(`Point is not on curve`+t)}let a=(i&$)===$;return(r&1)==1!==a&&(i=n.neg(i)),{x:e,y:i}}else if(t===a&&r===4)return{x:n.fromBytes(o.subarray(0,n.BYTES)),y:n.fromBytes(o.subarray(n.BYTES,2*n.BYTES))};else{let e=i,n=a;throw Error(`invalid Point, expected length of `+e+`, or uncompressed `+n+`, got `+t)}}}),f=e=>A(F(e,t.nByteLength));function p(e){return e>r>>$}function m(e){return p(e)?o(-e):e}let h=(e,t,n)=>P(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){let n=t.nByteLength;return e=L(`compactSignature`,e,n*2),new g(h(e,0,n),h(e,n,2*n))}static fromDER(e){let{r:t,s:n}=Z.toSig(L(`DER`,e));return new g(t,n)}assertValidity(){V(`r`,this.r,$,r),V(`s`,this.s,$,r)}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){let{r,s:i,recovery:a}=this,l=S(L(`msgHash`,e));if(a==null||![0,1,2,3].includes(a))throw Error(`recovery id invalid`);let u=a===2||a===3?r+t.n:r;if(u>=n.ORDER)throw Error(`recovery id 2 or 3 invalid`);let d=a&1?`03`:`02`,p=c.fromHex(d+f(u)),m=s(u),h=o(-l*m),g=o(i*m),_=c.BASE.multiplyAndAddUnsafe(p,h,g);if(!_)throw Error(`point at infinify`);return _.assertValidity(),_}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return N(this.toDERHex())}toDERHex(){return Z.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return N(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}let _={isValidPrivateKey(e){try{return l(e),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{let e=je(t.n);return Me(t.randomBytes(e),t.n)},precompute(e=8,t=c.BASE){return t._setWindowSize(e),t.multiply(BigInt(3)),t}};function v(e,t=!0){return c.fromPrivateKey(e).toRawBytes(t)}function y(e){let t=D(e),n=typeof e==`string`,r=(t||n)&&e.length;return t?r===i||r===a:n?r===2*i||r===2*a:e instanceof c}function b(e,t,n=!0){if(y(e))throw Error(`first arg must be private key`);if(!y(t))throw Error(`second arg must be public key`);return c.fromHex(t).multiply(l(e)).toRawBytes(n)}let x=t.bits2int||function(e){if(e.length>8192)throw Error(`input is too large`);let n=P(e),r=e.length*8-t.nBitLength;return r>0?n>>BigInt(r):n},S=t.bits2int_modN||function(e){return o(x(e))},C=H(t.nBitLength);function w(e){return V(`num < 2^`+t.nBitLength,e,Q,C),F(e,t.nByteLength)}function T(e,r,i=E){if([`recovered`,`canonical`].some(e=>e in i))throw Error(`sign() legacy options not supported`);let{hash:a,randomBytes:u}=t,{lowS:f,prehash:h,extraEntropy:_}=i;f??=!0,e=L(`msgHash`,e),Ge(i),h&&(e=L(`prehashed msgHash`,a(e)));let v=S(e),y=l(r),b=[w(y),w(v)];if(_!=null&&_!==!1){let e=_===!0?u(n.BYTES):_;b.push(L(`extraEntropy`,e))}let C=R(...b),T=v;function D(e){let t=x(e);if(!d(t))return;let n=s(t),r=c.BASE.multiply(t).toAffine(),i=o(r.x);if(i===Q)return;let a=o(n*o(T+i*y));if(a===Q)return;let l=(r.x===i?0:2)|Number(r.y&$),u=a;return f&&p(a)&&(u=m(a),l^=1),new g(i,u,l)}return{seed:C,k2sig:D}}let E={lowS:t.lowS,prehash:!1},O={lowS:t.lowS,prehash:!1};function ee(e,n,r=E){let{seed:i,k2sig:a}=T(e,n,r),o=t;return de(o.hash.outputLen,o.nByteLength,o.hmac)(i,a)}c.BASE._setWindowSize(8);function j(e,n,r,i=O){let a=e;n=L(`msgHash`,n),r=L(`publicKey`,r);let{lowS:l,prehash:u,format:d}=i;if(Ge(i),`strict`in i)throw Error(`options.strict was renamed to lowS`);if(d!==void 0&&d!==`compact`&&d!==`der`)throw Error(`format must be compact or der`);let f=typeof a==`string`||D(a),p=!f&&!d&&typeof a==`object`&&!!a&&typeof a.r==`bigint`&&typeof a.s==`bigint`;if(!f&&!p)throw Error(`invalid signature, expected Uint8Array, hex string or Signature instance`);let m,h;try{if(p&&(m=new g(a.r,a.s)),f){try{d!==`compact`&&(m=g.fromDER(a))}catch(e){if(!(e instanceof Z.Err))throw e}!m&&d!==`der`&&(m=g.fromCompact(a))}h=c.fromHex(r)}catch{return!1}if(!m||l&&m.hasHighS())return!1;u&&(n=t.hash(n));let{r:_,s:v}=m,y=S(n),b=s(v),x=o(y*b),C=o(_*b),w=c.BASE.multiplyAndAddUnsafe(h,x,C)?.toAffine();return w?o(w.x)===_:!1}return{CURVE:t,getPublicKey:v,getSharedSecret:b,sign:ee,verify:j,ProjectivePoint:c,Signature:g,utils:_}}function $e(e){return{hash:e,hmac:(t,...n)=>S(e,t,c(...n)),randomBytes:o}}function et(e,t){let n=t=>Qe({...e,...$e(t)});return{...n(t),create:n}}var tt=BigInt(`0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f`),nt=BigInt(`0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141`),rt=BigInt(1),it=BigInt(2),at=(e,t)=>(e+t/it)/t;function ot(e){let t=tt,n=BigInt(3),r=BigInt(6),i=BigInt(11),a=BigInt(22),o=BigInt(23),s=BigInt(44),c=BigInt(88),l=e*e*e%t,u=l*l*e%t,d=Y(Y(Y(u,n,t)*u%t,n,t)*u%t,it,t)*l%t,f=Y(d,i,t)*d%t,p=Y(f,a,t)*f%t,m=Y(p,s,t)*p%t,h=Y(Y(Y(Y(Y(Y(m,c,t)*m%t,s,t)*p%t,n,t)*u%t,o,t)*f%t,r,t)*l%t,it,t);if(!st.eql(st.sqr(h),e))throw Error(`Cannot find square root`);return h}var st=ke(tt,void 0,void 0,{sqrt:ot});const ct=et({a:BigInt(0),b:BigInt(7),Fp:st,n:nt,Gx:BigInt(`55066263022277343669578718895168534326250603453777594175500187360389116729240`),Gy:BigInt(`32670510020758816978083085130507043184471273380659243275938904335757337482424`),h:BigInt(1),lowS:!0,endo:{beta:BigInt(`0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee`),splitScalar:e=>{let t=nt,n=BigInt(`0x3086d221a7d46bcde86c90e49284eb15`),r=-rt*BigInt(`0xe4437ed6010e88286f547fa90abfe4c3`),i=BigInt(`0x114ca50f7a8e2f3f657c1108d9d44cfd8`),a=n,o=BigInt(`0x100000000000000000000000000000000`),s=at(a*e,t),c=at(-r*e,t),l=J(e-s*n-c*i,t),u=J(-s*r-c*a,t),d=l>o,f=u>o;if(d&&(l=t-l),f&&(u=t-u),l>o||u>o)throw Error(`splitScalar: Endomorphism failed, k=`+e);return{k1neg:d,k1:l,k2neg:f,k2:u}}}},b);ct.ProjectivePoint;export{ct as secp256k1};