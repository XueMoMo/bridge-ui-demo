const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/secp256k1-Dl17Rbwc.js","assets/index-Ekc_aguv.js","assets/index-BU9e6r_p.css","assets/utils-BsQXckoc.js","assets/basic-CgPjOpNb.js","assets/lit-BezCDHqd.js","assets/wui-text-DpiOyhDw.js","assets/ConstantsUtil-BOo-5IWw.js","assets/ConnectorUtil-BZ79fZlV.js","assets/w3m-modal-fM2-z4gU.js","assets/SIWXUtil-C-CCDgr0.js","assets/events-Muq4AJeu.js","assets/index.es-3nCA_oBP.js"])))=>i.map(i=>d[i]);
import{$ as e,K as t,Lt as n,Q as r,Y as i,a,i as o,rn as s,x as c}from"./index-Ekc_aguv.js";import"./lit-BezCDHqd.js";import{A as l,C as u,D as d,F as f,I as p,L as m,M as h,N as g,O as _,P as v,R as y,S as b,T as x,_ as ee,b as S,c as C,d as w,f as T,g as E,h as D,j as O,k,l as A,m as j,p as M,u as N,w as P,x as F,y as I,z as L}from"./ConstantsUtil-BOo-5IWw.js";import{t as te}from"./events-Muq4AJeu.js";import{_ as ne,a as re,c as ie,d as ae,f as oe,g as se,h as ce,i as le,l as ue,m as de,n as fe,o as pe,p as me,r as he,s as ge,t as _e,u as ve}from"./index.es-DktWrKJk.js";import{S as ye,_ as be,a as xe,b as Se,d as Ce,f as we,g as Te,i as Ee,m as De,n as Oe,o as ke,p as Ae,s as je,t as Me,u as Ne,v as Pe,x as Fe,y as Ie}from"./index.es-3nCA_oBP.js";import{t as Le}from"./SIWXUtil-C-CCDgr0.js";import{i as Re,n as ze,r as Be}from"./ConnectorUtil-BZ79fZlV.js";import{a as Ve,c as He,d as Ue,f as We,g as Ge,h as Ke,l as qe,n as Je,p as Ye,t as Xe,u as Ze}from"./utils-BsQXckoc.js";function Qe(e,t={}){let{key:n=`fallback`,name:r=`Fallback`,rank:i=!1,shouldThrow:o=$e,retryCount:s,retryDelay:c}=t;return(({chain:t,pollingInterval:l=4e3,timeout:u,...d})=>{let f=e,p=()=>{},m=a({key:n,name:r,async request({method:e,params:n}){let r,i=async(a=0)=>{let s=f[a]({...d,chain:t,retryCount:0,timeout:u});try{let t=await s.request({method:e,params:n});return p({method:e,params:n,response:t,transport:s,status:`success`}),t}catch(c){if(p({error:c,method:e,params:n,transport:s,status:`error`}),o(c)||a===f.length-1||(r??=f.slice(a+1).some(n=>{let{include:r,exclude:i}=n({chain:t}).config.methods||{};return r?r.includes(e):i?!i.includes(e):!0}),!r))throw c;return i(a+1)}};return i()},retryCount:s,retryDelay:c,type:`fallback`},{onResponse:e=>p=e,transports:f.map(e=>e({chain:t,retryCount:0}))});if(i){let e=typeof i==`object`?i:{};et({chain:t,interval:e.interval??l,onTransports:e=>f=e,ping:e.ping,sampleCount:e.sampleCount,timeout:e.timeout,transports:f,weights:e.weights})}return m})}function $e(t){return!!(`code`in t&&typeof t.code==`number`&&(t.code===r.code||t.code===e.code||i.nodeMessage.test(t.message)||t.code===5e3))}function et({chain:e,interval:t=4e3,onTransports:n,ping:r,sampleCount:i=10,timeout:a=1e3,transports:o,weights:s={}}){let{stability:l=.7,latency:u=.3}=s,d=[],f=async()=>{let s=await Promise.all(o.map(async t=>{let n=t({chain:e,retryCount:0,timeout:a}),i=Date.now(),o,s;try{await(r?r({transport:n}):n.request({method:`net_listening`})),s=1}catch{s=0}finally{o=Date.now()}return{latency:o-i,success:s}}));d.push(s),d.length>i&&d.shift();let p=Math.max(...d.map(e=>Math.max(...e.map(({latency:e})=>e))));n(o.map((e,t)=>{let n=d.map(e=>e[t].latency),r=1-n.reduce((e,t)=>e+t,0)/n.length/p,i=d.map(e=>e[t].success),a=i.reduce((e,t)=>e+t,0)/i.length;return a===0?[0,t]:[u*r+l*a,t]}).sort((e,t)=>t[0]-e[0]).map(([,e])=>o[e])),await c(t),f()};f()}const tt={validateCaipAddress(e){if(e.split(`:`)?.length!==3)throw Error(`Invalid CAIP Address`);return e},parseCaipAddress(e){let t=e.split(`:`);if(t.length!==3)throw Error(`Invalid CAIP-10 address: ${e}`);let[n,r,i]=t;if(!n||!r||!i)throw Error(`Invalid CAIP-10 address: ${e}`);return{chainNamespace:n,chainId:r,address:i}},parseCaipNetworkId(e){let t=e.split(`:`);if(t.length!==2)throw Error(`Invalid CAIP-2 network id: ${e}`);let[n,r]=t;if(!n||!r)throw Error(`Invalid CAIP-2 network id: ${e}`);return{chainNamespace:n,chainId:r}}},nt={id:`2b92315d-eab7-5bef-84fa-089a131333f5`,name:`USD Coin`,symbol:`USDC`,networks:[{name:`ethereum-mainnet`,display_name:`Ethereum`,chain_id:`1`,contract_address:`0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48`},{name:`polygon-mainnet`,display_name:`Polygon`,chain_id:`137`,contract_address:`0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174`}]},rt={id:`USD`,payment_method_limits:[{id:`card`,min:`10.00`,max:`7500.00`},{id:`ach_bank_account`,min:`10.00`,max:`25000.00`}]};var R=m({providers:g,selectedProvider:null,error:null,purchaseCurrency:nt,paymentCurrency:rt,purchaseCurrencies:[nt],paymentCurrencies:[],quotesLoading:!1});const it=d({state:R,subscribe(e){return L(R,()=>e(R))},subscribeKey(e,t){return p(R,e,t)},setSelectedProvider(e){if(e&&e.name===`meld`){let t=M.state.activeChain===f.CHAIN.SOLANA?`SOL`:`USDC`,n=w.state.address??``,r=new URL(e.url);r.searchParams.append(`publicKey`,h),r.searchParams.append(`destinationCurrencyCode`,t),r.searchParams.append(`walletAddress`,n),r.searchParams.append(`externalCustomerId`,_.state.projectId),R.selectedProvider={...e,url:r.toString()}}else R.selectedProvider=e},setOnrampProviders(e){if(Array.isArray(e)&&e.every(e=>typeof e==`string`)){let t=e;R.providers=g.filter(e=>t.includes(e.name))}else R.providers=[]},setPurchaseCurrency(e){R.purchaseCurrency=e},setPaymentCurrency(e){R.paymentCurrency=e},setPurchaseAmount(e){it.state.purchaseAmount=e},setPaymentAmount(e){it.state.paymentAmount=e},async getAvailableCurrencies(){let e=await T.getOnrampOptions();R.purchaseCurrencies=e.purchaseCurrencies,R.paymentCurrencies=e.paymentCurrencies,R.paymentCurrency=e.paymentCurrencies[0]||rt,R.purchaseCurrency=e.purchaseCurrencies[0]||nt,await b.fetchCurrencyImages(e.paymentCurrencies.map(e=>e.id)),await b.fetchTokenImages(e.purchaseCurrencies.map(e=>e.symbol))},async getQuote(){R.quotesLoading=!0;try{let e=await T.getOnrampQuote({purchaseCurrency:R.purchaseCurrency,paymentCurrency:R.paymentCurrency,amount:R.paymentAmount?.toString()||`0`,network:R.purchaseCurrency?.symbol});return R.quotesLoading=!1,R.purchaseAmount=Number(e?.purchaseAmount.amount),e}catch(e){return R.error=e.message,R.quotesLoading=!1,null}finally{R.quotesLoading=!1}},resetState(){R.selectedProvider=null,R.error=null,R.purchaseCurrency=nt,R.paymentCurrency=rt,R.purchaseCurrencies=[nt],R.paymentCurrencies=[],R.paymentAmount=void 0,R.purchaseAmount=void 0,R.quotesLoading=!1}});var at=2147483648;const ot={convertEVMChainIdToCoinType(e){if(e>=at)throw Error(`Invalid chainId`);return(at|e)>>>0}};var st=m({suggestions:[],loading:!1});const ct=d({state:st,subscribe(e){return L(st,()=>e(st))},subscribeKey(e,t){return p(st,e,t)},async resolveName(e){try{return await T.lookupEnsName(e)}catch(e){let t=e;throw Error(t?.reasons?.[0]?.description||`Error resolving name`)}},async isNameRegistered(e){try{return await T.lookupEnsName(e),!0}catch{return!1}},async getSuggestions(e){try{return st.loading=!0,st.suggestions=[],st.suggestions=(await T.getEnsNameSuggestions(e)).suggestions.map(e=>({...e,name:e.name}))||[],st.suggestions}catch(e){let t=ct.parseEnsApiError(e,`Error fetching name suggestions`);throw Error(t)}finally{st.loading=!1}},async getNamesForAddress(e){try{if(!M.state.activeCaipNetwork)return[];let t=l.getEnsFromCacheForAddress(e);if(t)return t;let n=await T.reverseLookupEnsName({address:e});return l.updateEnsCache({address:e,ens:n,timestamp:Date.now()}),n}catch(e){let t=ct.parseEnsApiError(e,`Error fetching names for address`);throw Error(t)}},async registerName(e){let t=M.state.activeCaipNetwork;if(!t)throw Error(`Network not found`);let n=w.state.address,r=I.getAuthConnector();if(!n||!r)throw Error(`Address or auth connector not found`);st.loading=!0;try{let r=JSON.stringify({name:e,attributes:{},timestamp:Math.floor(Date.now()/1e3)});F.pushTransactionStack({onCancel(){F.replace(`RegisterAccountName`)}});let i=await E.signMessage(r);st.loading=!1;let a=t.id;if(!a)throw Error(`Network not found`);let o=ot.convertEVMChainIdToCoinType(Number(a));await T.registerEnsName({coinType:o,address:n,signature:i,message:r}),w.setProfileName(e,t.chainNamespace),F.replace(`RegisterAccountNameSuccess`)}catch(t){let n=ct.parseEnsApiError(t,`Error registering name ${e}`);throw F.replace(`RegisterAccountName`),Error(n)}finally{st.loading=!1}},validateName(e){return/^[a-zA-Z0-9-]{4,}$/u.test(e)},parseEnsApiError(e,t){return e?.reasons?.[0]?.description||t}}),lt={ConnectorExplorerIds:{[f.CONNECTOR_ID.COINBASE]:`fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa`,[f.CONNECTOR_ID.COINBASE_SDK]:`fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa`,[f.CONNECTOR_ID.SAFE]:`225affb176778569276e484e1b92637ad061b01e13a048b35a9d280c3b58970f`,[f.CONNECTOR_ID.LEDGER]:`19177a98252e07ddfc9af2083ba8e07ef627cb6103467ffebb3f8f4205fd7927`,[f.CONNECTOR_ID.OKX]:`971e689d0a5be527bac79629b4ee9b925e82208e5168b733496a09c0faed0709`,[Re.METMASK_CONNECTOR_NAME]:`c57ca95b47569778a828d19178114f4db188b89b763c899ba0be274e97267d96`,[Re.TRUST_CONNECTOR_NAME]:`4622a2b2d6af1c9844944291e5e7351a6aa24cd7b23099efac1b2fd875da31a0`,[Re.SOLFLARE_CONNECTOR_NAME]:`1ca0bdd4747578705b1939af023d120677c64fe6ca76add81fda36e350605e79`,[Re.PHANTOM_CONNECTOR_NAME]:`a797aa35c0fadbfc1a53e7f675162ed5226968b44a19ee3d24385c64d1d3c393`,[Re.COIN98_CONNECTOR_NAME]:`2a3c89040ac3b723a1972a33a125b1db11e258a6975d3a61252cd64e6ea5ea01`,[Re.MAGIC_EDEN_CONNECTOR_NAME]:`8b830a2b724a9c3fbab63af6f55ed29c9dfa8a55e732dc88c80a196a2ba136c6`,[Re.BACKPACK_CONNECTOR_NAME]:`2bd8c14e035c2d48f184aaa168559e86b0e3433228d3c4075900a221785019b0`,[Re.BITGET_CONNECTOR_NAME]:`38f5d18bd8522c244bdd70cb4a68e0e718865155811c043f052fb9f1c51de662`,[Re.FRONTIER_CONNECTOR_NAME]:`85db431492aa2e8672e93f4ea7acf10c88b97b867b0d373107af63dc4880f041`,[Re.XVERSE_CONNECTOR_NAME]:`2a87d74ae02e10bdd1f51f7ce6c4e1cc53cd5f2c0b6b5ad0d7b3007d2b13de7b`,[Re.LEATHER_CONNECTOR_NAME]:`483afe1df1df63daf313109971ff3ef8356ddf1cc4e45877d205eee0b7893a13`},NetworkImageIds:{1:`ba0ba0cd-17c6-4806-ad93-f9d174f17900`,42161:`3bff954d-5cb0-47a0-9a23-d20192e74600`,43114:`30c46e53-e989-45fb-4549-be3bd4eb3b00`,56:`93564157-2e8e-4ce7-81df-b264dbee9b00`,250:`06b26297-fe0c-4733-5d6b-ffa5498aac00`,10:`ab9c186a-c52f-464b-2906-ca59d760a400`,137:`41d04d42-da3b-4453-8506-668cc0727900`,5e3:`e86fae9b-b770-4eea-e520-150e12c81100`,295:`6a97d510-cac8-4e58-c7ce-e8681b044c00`,11155111:`e909ea0a-f92a-4512-c8fc-748044ea6800`,84532:`a18a7ecd-e307-4360-4746-283182228e00`,1301:`4eeea7ef-0014-4649-5d1d-07271a80f600`,130:`2257980a-3463-48c6-cbac-a42d2a956e00`,10143:`0a728e83-bacb-46db-7844-948f05434900`,100:`02b53f6a-e3d4-479e-1cb4-21178987d100`,9001:`f926ff41-260d-4028-635e-91913fc28e00`,324:`b310f07f-4ef7-49f3-7073-2a0a39685800`,314:`5a73b3dd-af74-424e-cae0-0de859ee9400`,4689:`34e68754-e536-40da-c153-6ef2e7188a00`,1088:`3897a66d-40b9-4833-162f-a2c90531c900`,1284:`161038da-44ae-4ec7-1208-0ea569454b00`,1285:`f1d73bb6-5450-4e18-38f7-fb6484264a00`,7777777:`845c60df-d429-4991-e687-91ae45791600`,42220:`ab781bbc-ccc6-418d-d32d-789b15da1f00`,8453:`7289c336-3981-4081-c5f4-efc26ac64a00`,1313161554:`3ff73439-a619-4894-9262-4470c773a100`,2020:`b8101fc0-9c19-4b6f-ec65-f6dfff106e00`,2021:`b8101fc0-9c19-4b6f-ec65-f6dfff106e00`,80094:`e329c2c9-59b0-4a02-83e4-212ff3779900`,2741:`fc2427d1-5af9-4a9c-8da5-6f94627cd900`,"5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":`a1b58899-f671-4276-6a5e-56ca5bd59700`,"4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z":`a1b58899-f671-4276-6a5e-56ca5bd59700`,EtWTRABZaYq6iMfeYKouRu166VU2xqa1:`a1b58899-f671-4276-6a5e-56ca5bd59700`,"000000000019d6689c085ae165831e93":`0b4838db-0161-4ffe-022d-532bf03dba00`,"000000000933ea01ad0ee984209779ba":`39354064-d79b-420b-065d-f980c4b78200`},ConnectorImageIds:{[f.CONNECTOR_ID.COINBASE]:`0c2840c3-5b04-4c44-9661-fbd4b49e1800`,[f.CONNECTOR_ID.COINBASE_SDK]:`0c2840c3-5b04-4c44-9661-fbd4b49e1800`,[f.CONNECTOR_ID.SAFE]:`461db637-8616-43ce-035a-d89b8a1d5800`,[f.CONNECTOR_ID.LEDGER]:`54a1aa77-d202-4f8d-0fb2-5d2bb6db0300`,[f.CONNECTOR_ID.WALLET_CONNECT]:`ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400`,[f.CONNECTOR_ID.INJECTED]:`07ba87ed-43aa-4adf-4540-9e6a2b9cae00`},ConnectorNamesMap:{[f.CONNECTOR_ID.INJECTED]:`Browser Wallet`,[f.CONNECTOR_ID.WALLET_CONNECT]:`WalletConnect`,[f.CONNECTOR_ID.COINBASE]:`Coinbase`,[f.CONNECTOR_ID.COINBASE_SDK]:`Coinbase`,[f.CONNECTOR_ID.LEDGER]:`Ledger`,[f.CONNECTOR_ID.SAFE]:`Safe`},ConnectorTypesMap:{[f.CONNECTOR_ID.INJECTED]:`INJECTED`,[f.CONNECTOR_ID.WALLET_CONNECT]:`WALLET_CONNECT`,[f.CONNECTOR_ID.EIP6963]:`ANNOUNCED`,[f.CONNECTOR_ID.AUTH]:`AUTH`},WalletConnectRpcChainIds:[1,5,11155111,10,420,42161,421613,137,80001,42220,1313161554,1313161555,56,97,43114,43113,100,8453,84531,7777777,999,324,280]},ut={EmbeddedWalletAbortController:new AbortController,UniversalProviderErrors:{UNAUTHORIZED_DOMAIN_NOT_ALLOWED:{message:`Unauthorized: origin not allowed`,alertErrorKey:`INVALID_APP_CONFIGURATION`},JWT_VALIDATION_ERROR:{message:`JWT validation error: JWT Token is not yet valid`,alertErrorKey:`JWT_TOKEN_NOT_VALID`},INVALID_KEY:{message:`Unauthorized: invalid key`,alertErrorKey:`INVALID_PROJECT_ID`}},ALERT_ERRORS:{SWITCH_NETWORK_NOT_FOUND:{shortMessage:`Network Not Found`,longMessage:`Network not found - please make sure it is included in 'networks' array in createAppKit function`},INVALID_APP_CONFIGURATION:{shortMessage:`Invalid App Configuration`,longMessage:()=>`Origin ${dt()?window.origin:`unknown`} not found on Allowlist - update configuration on cloud.reown.com`},IFRAME_LOAD_FAILED:{shortMessage:`Network Error - Could not load embedded wallet`,longMessage:()=>`There was an issue loading the embedded wallet. Please try again later.`},IFRAME_REQUEST_TIMEOUT:{shortMessage:`Embedded Wallet Request Timed Out`,longMessage:()=>`There was an issue doing the request to the embedded wallet. Please try again later.`},UNVERIFIED_DOMAIN:{shortMessage:`Invalid App Configuration`,longMessage:()=>`There was an issue loading the embedded wallet. Please verify that your domain is allowed at cloud.reown.com`},JWT_TOKEN_NOT_VALID:{shortMessage:`Session Expired`,longMessage:`Invalid session found on UniversalProvider - please check your time settings and connect again`},INVALID_PROJECT_ID:{shortMessage:`Invalid App Configuration`,longMessage:`Invalid Project ID - update configuration`},PROJECT_ID_NOT_CONFIGURED:{shortMessage:`Project ID Not Configured`,longMessage:`Project ID Not Configured - update configuration on cloud.reown.com`}}};function dt(){return typeof window<`u`}const ft={createLogger(e,t=`error`){let{logger:n}=Te({opts:Ie({level:t})});return n.error=(...t)=>{for(let n of t)if(n instanceof Error){e(n,...t);return}e(void 0,...t)},n}};var pt=`rpc.walletconnect.org`;function mt(e,t){let n=new URL(`https://rpc.walletconnect.org/v1/`);return n.searchParams.set(`chainId`,e),n.searchParams.set(`projectId`,t),n.toString()}var ht=`near:mainnet.solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp.eip155:1101.eip155:56.eip155:42161.eip155:7777777.eip155:59144.eip155:324.solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1.eip155:5000.solana:4sgjmw1sunhzsxgspuhpqldx6wiyjntz.eip155:80084.eip155:5003.eip155:100.eip155:8453.eip155:42220.eip155:1313161555.eip155:17000.eip155:1.eip155:300.eip155:1313161554.eip155:1329.eip155:84532.eip155:421614.eip155:11155111.eip155:8217.eip155:43114.solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z.eip155:999999999.eip155:11155420.eip155:80002.eip155:97.eip155:43113.eip155:137.eip155:10.eip155:1301.bip122:000000000019d6689c085ae165831e93.bip122:000000000933ea01ad0ee984209779ba`.split(`.`);const gt={extendRpcUrlWithProjectId(e,t){let n=!1;try{n=new URL(e).host===pt}catch{n=!1}if(n){let n=new URL(e);return n.searchParams.has(`projectId`)||n.searchParams.set(`projectId`,t),n.toString()}return e},isCaipNetwork(e){return`chainNamespace`in e&&`caipNetworkId`in e},getChainNamespace(e){return this.isCaipNetwork(e)?e.chainNamespace:f.CHAIN.EVM},getCaipNetworkId(e){return this.isCaipNetwork(e)?e.caipNetworkId:`${f.CHAIN.EVM}:${e.id}`},getDefaultRpcUrl(e,t,n){let r=e.rpcUrls?.default?.http?.[0];return ht.includes(t)?mt(t,n):r||``},extendCaipNetwork(e,{customNetworkImageUrls:t,projectId:n,customRpcUrls:r}){let i=this.getChainNamespace(e),a=this.getCaipNetworkId(e),o=e.rpcUrls.default.http?.[0],s=this.getDefaultRpcUrl(e,a,n),c=e?.rpcUrls?.chainDefault?.http?.[0]||o,l=r?.[a]?.map(e=>e.url)||[],u=[...l,s],d=[...l];return c&&!d.includes(c)&&d.push(c),{...e,chainNamespace:i,caipNetworkId:a,assets:{imageId:lt.NetworkImageIds[e.id],imageUrl:t?.[e.id]},rpcUrls:{...e.rpcUrls,default:{http:u},chainDefault:{http:d}}}},extendCaipNetworks(e,{customNetworkImageUrls:t,projectId:n,customRpcUrls:r}){return e.map(e=>gt.extendCaipNetwork(e,{customNetworkImageUrls:t,customRpcUrls:r,projectId:n}))},getViemTransport(e,t,n){let r=[];return n?.forEach(e=>{r.push(o(e.url,e.config))}),ht.includes(e.caipNetworkId)&&r.push(o(mt(e.caipNetworkId,t),{fetchOptions:{headers:{"Content-Type":`text/plain`}}})),e?.rpcUrls?.default?.http?.forEach(e=>{r.push(o(e))}),Qe(r)},extendWagmiTransports(e,t,n){return ht.includes(e.caipNetworkId)?Qe([n,o(this.getDefaultRpcUrl(e,e.caipNetworkId,t))]):n},getUnsupportedNetwork(e){return{id:e.split(`:`)[1],caipNetworkId:e,name:f.UNSUPPORTED_NETWORK_NAME,chainNamespace:e.split(`:`)[0],nativeCurrency:{name:``,decimals:0,symbol:``},rpcUrls:{default:{http:[]}}}},getCaipNetworkFromStorage(e){let t=l.getActiveCaipNetworkId(),n=M.getAllRequestedCaipNetworks(),r=Array.from(M.state.chains?.keys()||[]),i=t?.split(`:`)[0],a=i?r.includes(i):!1,o=n?.find(e=>e.caipNetworkId===t);return a&&!o&&t?this.getUnsupportedNetwork(t):o||e||n?.[0]}};var _t={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0,cosmos:void 0},vt=m({providers:{..._t},providerIds:{..._t}});const yt={state:vt,subscribeKey(e,t){return p(vt,e,t)},subscribe(e){return L(vt,()=>{e(vt)})},subscribeProviders(e){return L(vt.providers,()=>e(vt.providers))},setProvider(e,t){t&&(vt.providers[e]=y(t))},getProvider(e){return vt.providers[e]},setProviderId(e,t){t&&(vt.providerIds[e]=t)},getProviderId(e){if(e)return vt.providerIds[e]},reset(){vt.providers={..._t},vt.providerIds={..._t}},resetChain(e){vt.providers[e]=void 0,vt.providerIds[e]=void 0}};te();var bt=Object.defineProperty,xt=(e,t,n)=>t in e?bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,St=(e,t,n)=>xt(e,typeof t==`symbol`?t:t+``,n),Ct=class extends se{constructor(e){super(),this.opts=e,St(this,`protocol`,`wc`),St(this,`version`,2)}},wt=Object.defineProperty,Tt=(e,t,n)=>t in e?wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Et=(e,t,n)=>Tt(e,typeof t==`symbol`?t:t+``,n),Dt=class extends se{constructor(e,t){super(),this.core=e,this.logger=t,Et(this,`records`,new Map)}},Ot=class{constructor(e,t){this.logger=e,this.core=t}},kt=class extends se{constructor(e,t){super(),this.relayer=e,this.logger=t}},At=class extends se{constructor(e){super()}},jt=class{constructor(e,t,n,r){this.core=e,this.logger=t,this.name=n}},Mt=class extends se{constructor(e,t){super(),this.relayer=e,this.logger=t}},Nt=class extends se{constructor(e,t){super(),this.core=e,this.logger=t}},Pt=class{constructor(e,t,n){this.core=e,this.logger=t,this.store=n}},Ft=class{constructor(e,t){this.projectId=e,this.logger=t}},It=class{constructor(e,t,n){this.core=e,this.logger=t,this.telemetryEnabled=n}},Lt=Object.defineProperty,Rt=(e,t,n)=>t in e?Lt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,zt=(e,t,n)=>Rt(e,typeof t==`symbol`?t:t+``,n),Bt=class{constructor(e){this.opts=e,zt(this,`protocol`,`wc`),zt(this,`version`,2)}},Vt=class{constructor(e){this.client=e}};function Ht(e,{strict:t=!0}={}){return!e||typeof e!=`string`?!1:t?/^0x[0-9a-fA-F]*$/.test(e):e.startsWith(`0x`)}function Ut(e){return Ht(e,{strict:!1})?Math.ceil((e.length-2)/2):e.length}const Wt=`2.23.2`;var Gt={getDocsUrl:({docsBaseUrl:e,docsPath:t=``,docsSlug:n})=>t?`${e??`https://viem.sh`}${t}${n?`#${n}`:``}`:void 0,version:`viem@${Wt}`},Kt=class e extends Error{constructor(t,n={}){let r=(()=>n.cause instanceof e?n.cause.details:n.cause?.message?n.cause.message:n.details)(),i=(()=>n.cause instanceof e&&n.cause.docsPath||n.docsPath)(),a=Gt.getDocsUrl?.({...n,docsPath:i}),o=[t||`An error occurred.`,``,...n.metaMessages?[...n.metaMessages,``]:[],...a?[`Docs: ${a}`]:[],...r?[`Details: ${r}`]:[],...Gt.version?[`Version: ${Gt.version}`]:[]].join(`
`);super(o,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,`details`,{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,`docsPath`,{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,`metaMessages`,{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,`shortMessage`,{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,`version`,{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,`name`,{enumerable:!0,configurable:!0,writable:!0,value:`BaseError`}),this.details=r,this.docsPath=i,this.metaMessages=n.metaMessages,this.name=n.name??this.name,this.shortMessage=t,this.version=Wt}walk(e){return qt(this,e)}};function qt(e,t){return t?.(e)?e:e&&typeof e==`object`&&`cause`in e&&e.cause!==void 0?qt(e.cause,t):t?null:e}var Jt=class extends Kt{constructor({size:e,targetSize:t,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:`SizeExceedsPaddingSizeError`})}};function Yt(e,{dir:t,size:n=32}={}){return typeof e==`string`?Xt(e,{dir:t,size:n}):Zt(e,{dir:t,size:n})}function Xt(e,{dir:t,size:n=32}={}){if(n===null)return e;let r=e.replace(`0x`,``);if(r.length>n*2)throw new Jt({size:Math.ceil(r.length/2),targetSize:n,type:`hex`});return`0x${r[t===`right`?`padEnd`:`padStart`](n*2,`0`)}`}function Zt(e,{dir:t,size:n=32}={}){if(n===null)return e;if(e.length>n)throw new Jt({size:e.length,targetSize:n,type:`bytes`});let r=new Uint8Array(n);for(let i=0;i<n;i++){let a=t===`right`;r[a?i:n-i-1]=e[a?i:e.length-i-1]}return r}var Qt=class extends Kt{constructor({max:e,min:t,signed:n,size:r,value:i}){super(`Number "${i}" is not in safe ${r?`${r*8}-bit ${n?`signed`:`unsigned`} `:``}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:`IntegerOutOfRangeError`})}},$t=class extends Kt{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:`SizeOverflowError`})}};function en(e,{size:t}){if(Ut(e)>t)throw new $t({givenSize:Ut(e),maxSize:t})}function tn(e,t={}){let{signed:n}=t;t.size&&en(e,{size:t.size});let r=BigInt(e);if(!n)return r;let i=(e.length-2)/2;return r<=(1n<<BigInt(i)*8n-1n)-1n?r:r-BigInt(`0x${`f`.padStart(i*2,`f`)}`)-1n}function nn(e,t={}){return Number(tn(e,t))}var rn=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,`0`));function an(e,t={}){return typeof e==`number`||typeof e==`bigint`?cn(e,t):typeof e==`string`?un(e,t):typeof e==`boolean`?on(e,t):sn(e,t)}function on(e,t={}){let n=`0x${Number(e)}`;return typeof t.size==`number`?(en(n,{size:t.size}),Yt(n,{size:t.size})):n}function sn(e,t={}){let n=``;for(let t=0;t<e.length;t++)n+=rn[e[t]];let r=`0x${n}`;return typeof t.size==`number`?(en(r,{size:t.size}),Yt(r,{dir:`right`,size:t.size})):r}function cn(e,t={}){let{signed:n,size:r}=t,i=BigInt(e),a;r?a=n?(1n<<BigInt(r)*8n-1n)-1n:2n**(BigInt(r)*8n)-1n:typeof e==`number`&&(a=BigInt(2**53-1));let o=typeof a==`bigint`&&n?-a-1n:0;if(a&&i>a||i<o){let t=typeof e==`bigint`?`n`:``;throw new Qt({max:a?`${a}${t}`:void 0,min:`${o}${t}`,signed:n,size:r,value:`${e}${t}`})}let s=`0x${(n&&i<0?(1n<<BigInt(r*8))+BigInt(i):i).toString(16)}`;return r?Yt(s,{size:r}):s}var ln=new TextEncoder;function un(e,t={}){return sn(ln.encode(e),t)}var dn=new TextEncoder;function fn(e,t={}){return typeof e==`number`||typeof e==`bigint`?_n(e,t):typeof e==`boolean`?pn(e,t):Ht(e)?gn(e,t):vn(e,t)}function pn(e,t={}){let n=new Uint8Array(1);return n[0]=Number(e),typeof t.size==`number`?(en(n,{size:t.size}),Yt(n,{size:t.size})):n}var mn={zero:48,nine:57,A:65,F:70,a:97,f:102};function hn(e){if(e>=mn.zero&&e<=mn.nine)return e-mn.zero;if(e>=mn.A&&e<=mn.F)return e-(mn.A-10);if(e>=mn.a&&e<=mn.f)return e-(mn.a-10)}function gn(e,t={}){let n=e;t.size&&(en(n,{size:t.size}),n=Yt(n,{dir:`right`,size:t.size}));let r=n.slice(2);r.length%2&&(r=`0${r}`);let i=r.length/2,a=new Uint8Array(i);for(let e=0,t=0;e<i;e++){let n=hn(r.charCodeAt(t++)),i=hn(r.charCodeAt(t++));if(n===void 0||i===void 0)throw new Kt(`Invalid byte sequence ("${r[t-2]}${r[t-1]}" in "${r}").`);a[e]=n*16+i}return a}function _n(e,t){return gn(cn(e,t))}function vn(e,t={}){let n=dn.encode(e);return typeof t.size==`number`?(en(n,{size:t.size}),Yt(n,{dir:`right`,size:t.size})):n}var yn=BigInt(2**32-1),bn=BigInt(32);function xn(e,t=!1){return t?{h:Number(e&yn),l:Number(e>>bn&yn)}:{h:Number(e>>bn&yn)|0,l:Number(e&yn)|0}}function Sn(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let i=0;i<e.length;i++){let{h:a,l:o}=xn(e[i],t);[n[i],r[i]]=[a,o]}return[n,r]}var Cn=(e,t,n)=>e<<n|t>>>32-n,wn=(e,t,n)=>t<<n|e>>>32-n,Tn=(e,t,n)=>t<<n-32|e>>>64-n,En=(e,t,n)=>e<<n-32|t>>>64-n,Dn=[],On=[],kn=[],An=BigInt(0),jn=BigInt(1),Mn=BigInt(2),Nn=BigInt(7),Pn=BigInt(256),Fn=BigInt(113);for(let e=0,t=jn,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],Dn.push(2*(5*r+n)),On.push((e+1)*(e+2)/2%64);let i=An;for(let e=0;e<7;e++)t=(t<<jn^(t>>Nn)*Fn)%Pn,t&Mn&&(i^=jn<<(jn<<BigInt(e))-jn);kn.push(i)}var[In,Ln]=Sn(kn,!0),Rn=(e,t,n)=>n>32?Tn(e,t,n):Cn(e,t,n),zn=(e,t,n)=>n>32?En(e,t,n):wn(e,t,n);function Bn(e,t=24){let n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let t=0;t<10;t++)n[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let r=(t+8)%10,i=(t+2)%10,a=n[i],o=n[i+1],s=Rn(a,o,1)^n[r],c=zn(a,o,1)^n[r+1];for(let n=0;n<50;n+=10)e[t+n]^=s,e[t+n+1]^=c}let t=e[2],i=e[3];for(let n=0;n<24;n++){let r=On[n],a=Rn(t,i,r),o=zn(t,i,r),s=Dn[n];t=e[s],i=e[s+1],e[s]=a,e[s+1]=o}for(let t=0;t<50;t+=10){for(let r=0;r<10;r++)n[r]=e[t+r];for(let r=0;r<10;r++)e[t+r]^=~n[(r+2)%10]&n[(r+4)%10]}e[0]^=In[r],e[1]^=Ln[r]}n.fill(0)}var Vn=class e extends Xe{constructor(e,t,n,r=!1,i=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=r,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Ke(n),0>=this.blockLen||this.blockLen>=200)throw Error(`Sha3 supports only keccak-f1600 function`);this.state=new Uint8Array(200),this.state32=qe(this.state)}keccak(){Ve||Je(this.state32),Bn(this.state32,this.rounds),Ve||Je(this.state32),this.posOut=0,this.pos=0}update(e){Ye(this);let{blockLen:t,state:n}=this;e=He(e);let r=e.length;for(let i=0;i<r;){let a=Math.min(t-this.pos,r-i);for(let t=0;t<a;t++)n[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:n,blockLen:r}=this;e[n]^=t,t&128&&n===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){Ye(this,!1),We(e),this.finish();let t=this.state,{blockLen:n}=this;for(let r=0,i=e.length;r<i;){this.posOut>=n&&this.keccak();let a=Math.min(n-this.posOut,i-r);e.set(t.subarray(this.posOut,this.posOut+a),r),this.posOut+=a,r+=a}return e}xofInto(e){if(!this.enableXOF)throw Error(`XOF is not possible for this instance`);return this.writeInto(e)}xof(e){return Ke(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Ge(e,this),this.finished)throw Error(`digest() was already called`);return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){let{blockLen:n,suffix:r,outputLen:i,rounds:a,enableXOF:o}=this;return t||=new e(n,r,i,o,a),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=a,t.suffix=r,t.outputLen=i,t.enableXOF=o,t.destroyed=this.destroyed,t}};const Hn=((e,t,n)=>Ze(()=>new Vn(t,e,n)))(1,136,256/8);function Un(e,t){let n=t||`hex`,r=Hn(Ht(e,{strict:!1})?fn(e):e);return n===`bytes`?r:an(r)}var Wn=new class extends Map{constructor(e){super(),Object.defineProperty(this,`maxSize`,{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){let t=super.get(e);return super.has(e)&&t!==void 0&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){let e=this.keys().next().value;e&&this.delete(e)}return this}}(8192);function Gn(e,t){if(Wn.has(`${e}.${t}`))return Wn.get(`${e}.${t}`);let n=t?`${t}${e.toLowerCase()}`:e.substring(2).toLowerCase(),r=Un(vn(n),`bytes`),i=(t?n.substring(`${t}0x`.length):n).split(``);for(let e=0;e<40;e+=2)r[e>>1]>>4>=8&&i[e]&&(i[e]=i[e].toUpperCase()),(r[e>>1]&15)>=8&&i[e+1]&&(i[e+1]=i[e+1].toUpperCase());let a=`0x${i.join(``)}`;return Wn.set(`${e}.${t}`,a),a}function Kn(e){return Gn(`0x${Un(`0x${e.substring(4)}`).substring(26)}`)}async function qn({hash:e,signature:n}){let r=Ht(e)?e:an(e),{secp256k1:i}=await t(async()=>{let{secp256k1:e}=await import(`./secp256k1-Dl17Rbwc.js`);return{secp256k1:e}},__vite__mapDeps([0,1,2,3]));return`0x${(()=>{if(typeof n==`object`&&`r`in n&&`s`in n){let{r:e,s:t,v:r,yParity:a}=n,o=Jn(Number(a??r));return new i.Signature(tn(e),tn(t)).addRecoveryBit(o)}let e=Ht(n)?n:an(n),t=Jn(nn(`0x${e.slice(130)}`));return i.Signature.fromCompact(e.substring(2,130)).addRecoveryBit(t)})().recoverPublicKey(r.substring(2)).toHex(!1)}`}function Jn(e){if(e===0||e===1)return e;if(e===27)return 0;if(e===28)return 1;throw Error(`Invalid yParityOrV value`)}async function Yn({hash:e,signature:t}){return Kn(await qn({hash:e,signature:t}))}var Xn=pe(),Zn=ge(),Qn=ne();function $n(e){if(e.length>=255)throw TypeError(`Alphabet too long`);let t=new Uint8Array(256);for(let e=0;e<t.length;e++)t[e]=255;for(let n=0;n<e.length;n++){let r=e.charAt(n),i=r.charCodeAt(0);if(t[i]!==255)throw TypeError(r+` is ambiguous`);t[i]=n}let n=e.length,r=e.charAt(0),i=Math.log(n)/Math.log(256),a=Math.log(256)/Math.log(n);function o(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError(`Expected Uint8Array`);if(t.length===0)return``;let i=0,o=0,s=0,c=t.length;for(;s!==c&&t[s]===0;)s++,i++;let l=(c-s)*a+1>>>0,u=new Uint8Array(l);for(;s!==c;){let e=t[s],r=0;for(let t=l-1;(e!==0||r<o)&&t!==-1;t--,r++)e+=256*u[t]>>>0,u[t]=e%n>>>0,e=e/n>>>0;if(e!==0)throw Error(`Non-zero carry`);o=r,s++}let d=l-o;for(;d!==l&&u[d]===0;)d++;let f=r.repeat(i);for(;d<l;++d)f+=e.charAt(u[d]);return f}function s(e){if(typeof e!=`string`)throw TypeError(`Expected String`);if(e.length===0)return new Uint8Array;let a=0,o=0,s=0;for(;e[a]===r;)o++,a++;let c=(e.length-a)*i+1>>>0,l=new Uint8Array(c);for(;a<e.length;){let r=e.charCodeAt(a);if(r>255)return;let i=t[r];if(i===255)return;let o=0;for(let e=c-1;(i!==0||o<s)&&e!==-1;e--,o++)i+=n*l[e]>>>0,l[e]=i%256>>>0,i=i/256>>>0;if(i!==0)throw Error(`Non-zero carry`);s=o,a++}let u=c-s;for(;u!==c&&l[u]===0;)u++;let d=new Uint8Array(o+(c-u)),f=o;for(;u!==c;)d[f++]=l[u++];return d}function c(e){let t=s(e);if(t)return t;throw Error(`Non-base`+n+` character`)}return{encode:o,decodeUnsafe:s,decode:c}}var er=$n(`123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz`),tr=`:`;function nr(e){let[t,n]=e.split(tr);return{namespace:t,reference:n}}function rr(e,t){return e.includes(`:`)?[e]:t.chains||[]}var ir=Object.defineProperty,ar=Object.defineProperties,or=Object.getOwnPropertyDescriptors,sr=Object.getOwnPropertySymbols,cr=Object.prototype.hasOwnProperty,lr=Object.prototype.propertyIsEnumerable,ur=(e,t,n)=>t in e?ir(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,dr=(e,t)=>{for(var n in t||={})cr.call(t,n)&&ur(e,n,t[n]);if(sr)for(var n of sr(t))lr.call(t,n)&&ur(e,n,t[n]);return e},fr=(e,t)=>ar(e,or(t)),pr={reactNative:`react-native`,node:`node`,browser:`browser`,unknown:`unknown`};function mr(){return typeof process<`u`&&typeof process.versions<`u`&&typeof process.versions.node<`u`}function hr(){return!(0,Zn.getDocument)()&&!!(0,Zn.getNavigator)()&&navigator.product===`ReactNative`}function gr(){return hr()&&typeof global<`u`&&typeof(global==null?void 0:global.Platform)<`u`&&(global==null?void 0:global.Platform.OS)===`android`}function _r(){return hr()&&typeof global<`u`&&typeof(global==null?void 0:global.Platform)<`u`&&(global==null?void 0:global.Platform.OS)===`ios`}function vr(){return!mr()&&!!(0,Zn.getNavigator)()&&!!(0,Zn.getDocument)()}function yr(){return hr()?pr.reactNative:mr()?pr.node:vr()?pr.browser:pr.unknown}function br(){try{return hr()&&typeof global<`u`&&typeof(global==null?void 0:global.Application)<`u`?global.Application?.applicationId:void 0}catch{return}}function xr(e,t){let n=new URLSearchParams(e);for(let e of Object.keys(t).sort())if(t.hasOwnProperty(e)){let r=t[e];r!==void 0&&n.set(e,r)}return n.toString()}function Sr(e){var t,n;let r=Cr();try{return e!=null&&e.url&&r.url&&new URL(e.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${e.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),e.url=r.url),(t=e?.icons)!=null&&t.length&&e.icons.length>0&&(e.icons=e.icons.filter(e=>e!==``)),fr(dr(dr({},r),e),{url:e?.url||r.url,name:e?.name||r.name,description:e?.description||r.description,icons:(n=e?.icons)!=null&&n.length&&e.icons.length>0?e.icons:r.icons})}catch(t){return console.warn(`Error populating app metadata`,t),e||r}}function Cr(){return(0,Xn.getWindowMetadata)()||{name:``,description:``,url:``,icons:[``]}}function wr(){if(yr()===pr.reactNative&&typeof global<`u`&&typeof(global==null?void 0:global.Platform)<`u`){let{OS:e,Version:t}=global.Platform;return[e,t].join(`-`)}let e=ie();if(e===null)return`unknown`;let t=e.os?e.os.replace(` `,``).toLowerCase():`unknown`;return e.type===`browser`?[t,e.name,e.version].join(`-`):[t,e.version].join(`-`)}function Tr(){let e=yr();return e===pr.browser?[e,(0,Zn.getLocation)()?.host||`unknown`].join(`:`):e}function Er(e,t,n){let r=wr(),i=Tr();return[[e,t].join(`-`),[`js`,n].join(`-`),r,i].join(`/`)}function Dr({protocol:e,version:t,relayUrl:n,sdkVersion:r,auth:i,projectId:a,useOnCloseEvent:o,bundleId:s,packageName:c}){let l=n.split(`?`),u={auth:i,ua:Er(e,t,r),projectId:a,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:s||void 0},d=xr(l[1]||``,u);return l[0]+`?`+d}function Or(e,t){return e.filter(e=>t.includes(e)).length===e.length}function kr(e){return Object.fromEntries(e.entries())}function Ar(e){return new Map(Object.entries(e))}function jr(e=Qn.FIVE_MINUTES,t){let n=(0,Qn.toMiliseconds)(e||Qn.FIVE_MINUTES),r,i,a,o;return{resolve:e=>{a&&r&&(clearTimeout(a),r(e),o=Promise.resolve(e))},reject:e=>{a&&i&&(clearTimeout(a),i(e))},done:()=>new Promise((e,s)=>{if(o)return e(o);a=setTimeout(()=>{let e=Error(t);o=Promise.reject(e),s(e)},n),r=e,i=s})}}function Mr(e,t,n){return new Promise(async(r,i)=>{let a=setTimeout(()=>i(Error(n)),t);try{r(await e)}catch(e){i(e)}clearTimeout(a)})}function Nr(e,t){if(typeof t==`string`&&t.startsWith(`${e}:`))return t;if(e.toLowerCase()===`topic`){if(typeof t!=`string`)throw Error(`Value must be "string" for expirer target type: topic`);return`topic:${t}`}else if(e.toLowerCase()===`id`){if(typeof t!=`number`)throw Error(`Value must be "number" for expirer target type: id`);return`id:${t}`}throw Error(`Unknown expirer target type: ${e}`)}function Pr(e){return Nr(`topic`,e)}function Fr(e){return Nr(`id`,e)}function Ir(e){let[t,n]=e.split(`:`),r={id:void 0,topic:void 0};if(t===`topic`&&typeof n==`string`)r.topic=n;else if(t===`id`&&Number.isInteger(Number(n)))r.id=Number(n);else throw Error(`Invalid target, expected id:number or topic:string, got ${t}:${n}`);return r}function Lr(e,t){return(0,Qn.fromMiliseconds)((t||Date.now())+(0,Qn.toMiliseconds)(e))}function Rr(e){return Date.now()>=(0,Qn.toMiliseconds)(e)}function z(e,t){return`${e}${t?`:${t}`:``}`}function zr(e=[],t=[]){return[...new Set([...e,...t])]}async function Br({id:e,topic:t,wcDeepLink:n}){var r;try{if(!n)return;let i=(typeof n==`string`?JSON.parse(n):n)?.href;if(typeof i!=`string`)return;let a=Vr(i,e,t),o=yr();if(o===pr.browser){if(!((r=(0,Zn.getDocument)())!=null&&r.hasFocus())){console.warn(`Document does not have focus, skipping deeplink.`);return}Hr(a)}else o===pr.reactNative&&typeof(global==null?void 0:global.Linking)<`u`&&await global.Linking.openURL(a)}catch(e){console.error(e)}}function Vr(e,t,n){let r=`requestId=${t}&sessionTopic=${n}`;e.endsWith(`/`)&&(e=e.slice(0,-1));let i=`${e}`;if(e.startsWith(`https://t.me`)){let t=e.includes(`?`)?`&startapp=`:`?startapp=`;i=`${i}${t}${Yr(r,!0)}`}else i=`${i}/wc?${r}`;return i}function Hr(e){let t=`_self`;Jr()?t=`_top`:(qr()||e.startsWith(`https://`)||e.startsWith(`http://`))&&(t=`_blank`),window.open(e,t,`noreferrer noopener`)}async function Ur(e,t){let n=``;try{if(vr()&&(n=localStorage.getItem(t),n))return n;n=await e.getItem(t)}catch(e){console.error(e)}return n}function Wr(e,t){if(!e.includes(t))return null;let n=e.split(/([&,?,=])/);return n[n.indexOf(t)+2]}function Gr(){return typeof crypto<`u`&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():`xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx`.replace(/[xy]/gu,e=>{let t=Math.random()*16|0;return(e===`x`?t:t&3|8).toString(16)})}function Kr(){return typeof process<`u`&&{}.IS_VITEST===`true`}function qr(){return typeof window<`u`&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function Jr(){try{return window.self!==window.top}catch{return!1}}function Yr(e,t=!1){let n=Buffer.from(e).toString(`base64`);return t?n.replace(/[=]/g,``):n}function Xr(e){return Buffer.from(e,`base64`).toString(`utf-8`)}function Zr(e){return new Promise(t=>setTimeout(t,e))}function Qr(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`positive integer expected, got `+e)}function $r(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name===`Uint8Array`}function ei(e,...t){if(!$r(e))throw Error(`Uint8Array expected`);if(t.length>0&&!t.includes(e.length))throw Error(`Uint8Array expected of length `+t+`, got length=`+e.length)}function ti(e){if(typeof e!=`function`||typeof e.create!=`function`)throw Error(`Hash should be wrapped by utils.wrapConstructor`);Qr(e.outputLen),Qr(e.blockLen)}function ni(e,t=!0){if(e.destroyed)throw Error(`Hash instance has been destroyed`);if(t&&e.finished)throw Error(`Hash#digest() has already been called`)}function ri(e,t){ei(e);let n=t.outputLen;if(e.length<n)throw Error(`digestInto() expects output buffer of length at least `+n)}var ii=BigInt(2**32-1),ai=BigInt(32);function oi(e,t=!1){return t?{h:Number(e&ii),l:Number(e>>ai&ii)}:{h:Number(e>>ai&ii)|0,l:Number(e&ii)|0}}function si(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let i=0;i<e.length;i++){let{h:a,l:o}=oi(e[i],t);[n[i],r[i]]=[a,o]}return[n,r]}var ci=(e,t,n)=>e<<n|t>>>32-n,li=(e,t,n)=>t<<n|e>>>32-n,ui=(e,t,n)=>t<<n-32|e>>>64-n,di=(e,t,n)=>e<<n-32|t>>>64-n,fi=typeof globalThis==`object`&&`crypto`in globalThis?globalThis.crypto:void 0;function pi(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function mi(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function hi(e,t){return e<<32-t|e>>>t}var gi=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function _i(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function vi(e){for(let t=0;t<e.length;t++)e[t]=_i(e[t])}function yi(e){if(typeof e!=`string`)throw Error(`utf8ToBytes expected string, got `+typeof e);return new Uint8Array(new TextEncoder().encode(e))}function bi(e){return typeof e==`string`&&(e=yi(e)),ei(e),e}function xi(...e){let t=0;for(let n=0;n<e.length;n++){let r=e[n];ei(r),t+=r.length}let n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){let i=e[t];n.set(i,r),r+=i.length}return n}var Si=class{clone(){return this._cloneInto()}};function Ci(e){let t=t=>e().update(bi(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function wi(e=32){if(fi&&typeof fi.getRandomValues==`function`)return fi.getRandomValues(new Uint8Array(e));if(fi&&typeof fi.randomBytes==`function`)return fi.randomBytes(e);throw Error(`crypto.getRandomValues must be defined`)}var Ti=[],Ei=[],Di=[],Oi=BigInt(0),ki=BigInt(1),Ai=BigInt(2),ji=BigInt(7),Mi=BigInt(256),Ni=BigInt(113);for(let e=0,t=ki,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],Ti.push(2*(5*r+n)),Ei.push((e+1)*(e+2)/2%64);let i=Oi;for(let e=0;e<7;e++)t=(t<<ki^(t>>ji)*Ni)%Mi,t&Ai&&(i^=ki<<(ki<<BigInt(e))-ki);Di.push(i)}var[Pi,Fi]=si(Di,!0),Ii=(e,t,n)=>n>32?ui(e,t,n):ci(e,t,n),Li=(e,t,n)=>n>32?di(e,t,n):li(e,t,n);function Ri(e,t=24){let n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let t=0;t<10;t++)n[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let r=(t+8)%10,i=(t+2)%10,a=n[i],o=n[i+1],s=Ii(a,o,1)^n[r],c=Li(a,o,1)^n[r+1];for(let n=0;n<50;n+=10)e[t+n]^=s,e[t+n+1]^=c}let t=e[2],i=e[3];for(let n=0;n<24;n++){let r=Ei[n],a=Ii(t,i,r),o=Li(t,i,r),s=Ti[n];t=e[s],i=e[s+1],e[s]=a,e[s+1]=o}for(let t=0;t<50;t+=10){for(let r=0;r<10;r++)n[r]=e[t+r];for(let r=0;r<10;r++)e[t+r]^=~n[(r+2)%10]&n[(r+4)%10]}e[0]^=Pi[r],e[1]^=Fi[r]}n.fill(0)}var zi=class e extends Si{constructor(e,t,n,r=!1,i=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=r,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Qr(n),0>=this.blockLen||this.blockLen>=200)throw Error(`Sha3 supports only keccak-f1600 function`);this.state=new Uint8Array(200),this.state32=pi(this.state)}keccak(){gi||vi(this.state32),Ri(this.state32,this.rounds),gi||vi(this.state32),this.posOut=0,this.pos=0}update(e){ni(this);let{blockLen:t,state:n}=this;e=bi(e);let r=e.length;for(let i=0;i<r;){let a=Math.min(t-this.pos,r-i);for(let t=0;t<a;t++)n[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:n,blockLen:r}=this;e[n]^=t,t&128&&n===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){ni(this,!1),ei(e),this.finish();let t=this.state,{blockLen:n}=this;for(let r=0,i=e.length;r<i;){this.posOut>=n&&this.keccak();let a=Math.min(n-this.posOut,i-r);e.set(t.subarray(this.posOut,this.posOut+a),r),this.posOut+=a,r+=a}return e}xofInto(e){if(!this.enableXOF)throw Error(`XOF is not possible for this instance`);return this.writeInto(e)}xof(e){return Qr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(ri(e,this),this.finished)throw Error(`digest() was already called`);return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){let{blockLen:n,suffix:r,outputLen:i,rounds:a,enableXOF:o}=this;return t||=new e(n,r,i,o,a),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=a,t.suffix=r,t.outputLen=i,t.enableXOF=o,t.destroyed=this.destroyed,t}},Bi=((e,t,n)=>Ci(()=>new zi(t,e,n)))(1,136,256/8),Vi=`https://rpc.walletconnect.org/v1`;function Hi(e){let t=`Ethereum Signed Message:
${e.length}`,n=new TextEncoder().encode(t+e);return`0x`+Buffer.from(Bi(n)).toString(`hex`)}async function Ui(e,t,n,r,i,a){switch(n.t){case`eip191`:return await Wi(e,t,n.s);case`eip1271`:return await Gi(e,t,n.s,r,i,a);default:throw Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}async function Wi(e,t,n){return(await Yn({hash:Hi(t),signature:n})).toLowerCase()===e.toLowerCase()}async function Gi(e,t,n,r,i,a){let o=nr(r);if(!o.namespace||!o.reference)throw Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{let o=n.substring(2),s=`0x1626ba7e`+Hi(t).substring(2)+`00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000041`+o,{result:c}=await(await fetch(`${a||Vi}/?chainId=${r}&projectId=${i}`,{method:`POST`,body:JSON.stringify({id:Ki(),jsonrpc:`2.0`,method:`eth_call`,params:[{to:e,data:s},`latest`]})})).json();return c?c.slice(0,10).toLowerCase()===`0x1626ba7e`:!1}catch(e){return console.error(`isValidEip1271Signature: `,e),!1}}function Ki(){return Date.now()+Math.floor(Math.random()*1e3)}function qi(e){let t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);let r=n[0];if(r===0)throw Error(`No signatures found`);let i=1+r*64;if(n.length<i)throw Error(`Transaction data too short for claimed signature count`);if(n.length<100)throw Error(`Transaction too short`);let a=Buffer.from(e,`base64`).slice(1,65);return er.encode(a)}var Ji=Object.defineProperty,Yi=Object.defineProperties,Xi=Object.getOwnPropertyDescriptors,Zi=Object.getOwnPropertySymbols,Qi=Object.prototype.hasOwnProperty,$i=Object.prototype.propertyIsEnumerable,ea=(e,t,n)=>t in e?Ji(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ta=(e,t)=>{for(var n in t||={})Qi.call(t,n)&&ea(e,n,t[n]);if(Zi)for(var n of Zi(t))$i.call(t,n)&&ea(e,n,t[n]);return e},na=(e,t)=>Yi(e,Xi(t)),ra=`did:pkh:`,ia=e=>e?.split(`:`),aa=e=>{let t=e&&ia(e);if(t)return e.includes(ra)?t[3]:t[1]},oa=e=>{let t=e&&ia(e);if(t)return t[2]+`:`+t[3]},sa=e=>{let t=e&&ia(e);if(t)return t.pop()};async function ca(e){let{cacao:t,projectId:n}=e,{s:r,p:i}=t,a=la(i,i.iss);return await Ui(sa(i.iss),a,r,oa(i.iss),n)}var la=(e,t)=>{let n=`${e.domain} wants you to sign in with your Ethereum account:`,r=sa(t);if(!e.aud&&!e.uri)throw Error("Either `aud` or `uri` is required to construct the message");let i=e.statement||void 0,a=`URI: ${e.aud||e.uri}`,o=`Version: ${e.version}`,s=`Chain ID: ${aa(t)}`,c=`Nonce: ${e.nonce}`,l=`Issued At: ${e.iat}`,u=e.exp?`Expiration Time: ${e.exp}`:void 0,d=e.nbf?`Not Before: ${e.nbf}`:void 0,f=e.requestId?`Request ID: ${e.requestId}`:void 0,p=e.resources?`Resources:${e.resources.map(e=>`
- ${e}`).join(``)}`:void 0,m=wa(e.resources);if(m){let e=ga(m);i=xa(i,e)}return[n,r,``,i,``,a,o,s,c,l,u,d,f,p].filter(e=>e!=null).join(`
`)};function ua(e){return Buffer.from(JSON.stringify(e)).toString(`base64`)}function da(e){return JSON.parse(Buffer.from(e,`base64`).toString(`utf-8`))}function fa(e){if(!e)throw Error(`No recap provided, value is undefined`);if(!e.att)throw Error("No `att` property found");let t=Object.keys(e.att);if(!(t!=null&&t.length))throw Error("No resources found in `att` property");t.forEach(t=>{let n=e.att[t];if(Array.isArray(n)||typeof n!=`object`)throw Error(`Resource must be an object: ${t}`);if(!Object.keys(n).length)throw Error(`Resource object is empty: ${t}`);Object.keys(n).forEach(e=>{let t=n[e];if(!Array.isArray(t))throw Error(`Ability limits ${e} must be an array of objects, found: ${t}`);if(!t.length)throw Error(`Value of ${e} is empty array, must be an array with objects`);t.forEach(t=>{if(typeof t!=`object`)throw Error(`Ability limits (${e}) must be an array of objects, found: ${t}`)})})})}function pa(e,t,n,r={}){return n?.sort((e,t)=>e.localeCompare(t)),{att:{[e]:ma(t,n,r)}}}function ma(e,t,n={}){t=t?.sort((e,t)=>e.localeCompare(t));let r=t.map(t=>({[`${e}/${t}`]:[n]}));return Object.assign({},...r)}function ha(e){return fa(e),`urn:recap:${ua(e).replace(/=/g,``)}`}function ga(e){let t=da(e.replace(`urn:recap:`,``));return fa(t),t}function _a(e,t,n){return ha(pa(e,t,n))}function va(e){return e&&e.includes(`urn:recap:`)}function ya(e,t){return ha(ba(ga(e),ga(t)))}function ba(e,t){fa(e),fa(t);let n=Object.keys(e.att).concat(Object.keys(t.att)).sort((e,t)=>e.localeCompare(t)),r={att:{}};return n.forEach(n=>{Object.keys(e.att?.[n]||{}).concat(Object.keys(t.att?.[n]||{})).sort((e,t)=>e.localeCompare(t)).forEach(i=>{r.att[n]=na(ta({},r.att[n]),{[i]:e.att[n]?.[i]||t.att[n]?.[i]})})}),r}function xa(e=``,t){fa(t);let n=`I further authorize the stated URI to perform the following actions on my behalf: `;if(e.includes(n))return e;let r=[],i=0;Object.keys(t.att).forEach(e=>{let n=Object.keys(t.att[e]).map(e=>({ability:e.split(`/`)[0],action:e.split(`/`)[1]}));n.sort((e,t)=>e.action.localeCompare(t.action));let a={};n.forEach(e=>{a[e.ability]||(a[e.ability]=[]),a[e.ability].push(e.action)});let o=Object.keys(a).map(t=>(i++,`(${i}) '${t}': '${a[t].join(`', '`)}' for '${e}'.`));r.push(o.join(`, `).replace(`.,`,`.`))});let a=`${n}${r.join(` `)}`;return`${e?e+` `:``}${a}`}function Sa(e){let t=ga(e);fa(t);let n=t.att?.eip155;return n?Object.keys(n).map(e=>e.split(`/`)[1]):[]}function Ca(e){let t=ga(e);fa(t);let n=[];return Object.values(t.att).forEach(e=>{Object.values(e).forEach(e=>{var t;(t=e?.[0])!=null&&t.chains&&n.push(e[0].chains)})}),[...new Set(n.flat())]}function wa(e){if(!e)return;let t=e?.[e.length-1];return va(t)?t:void 0}function Ta(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`positive integer expected, got `+e)}function Ea(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name===`Uint8Array`}function Da(e,...t){if(!Ea(e))throw Error(`Uint8Array expected`);if(t.length>0&&!t.includes(e.length))throw Error(`Uint8Array expected of length `+t+`, got length=`+e.length)}function Oa(e,t=!0){if(e.destroyed)throw Error(`Hash instance has been destroyed`);if(t&&e.finished)throw Error(`Hash#digest() has already been called`)}function ka(e,t){Da(e);let n=t.outputLen;if(e.length<n)throw Error(`digestInto() expects output buffer of length at least `+n)}function Aa(e){if(typeof e!=`boolean`)throw Error(`boolean expected, not ${e}`)}var ja=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Ma=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw Error(`Non little-endian hardware is not supported`);function Na(e){if(typeof e!=`string`)throw Error(`string expected`);return new Uint8Array(new TextEncoder().encode(e))}function Pa(e){if(typeof e==`string`)e=Na(e);else if(Ea(e))e=Va(e);else throw Error(`Uint8Array expected, got `+typeof e);return e}function Fa(e,t){if(typeof t!=`object`||!t)throw Error(`options must be defined`);return Object.assign(e,t)}function Ia(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}var La=(e,t)=>{function n(n,...r){if(Da(n),e.nonceLength!==void 0){let t=r[0];if(!t)throw Error(`nonce / iv required`);e.varSizeNonce?Da(t):Da(t,e.nonceLength)}let i=e.tagLength;i&&r[1]!==void 0&&Da(r[1]);let a=t(n,...r),o=(e,t)=>{if(t!==void 0){if(e!==2)throw Error(`cipher output not supported`);Da(t)}},s=!1;return{encrypt(e,t){if(s)throw Error(`cannot encrypt() twice with same key + nonce`);return s=!0,Da(e),o(a.encrypt.length,t),a.encrypt(e,t)},decrypt(e,t){if(Da(e),i&&e.length<i)throw Error(`invalid ciphertext length: smaller than tagLength=`+i);return o(a.decrypt.length,t),a.decrypt(e,t)}}}return Object.assign(n,e),n};function Ra(e,t,n=!0){if(t===void 0)return new Uint8Array(e);if(t.length!==e)throw Error(`invalid output length, expected `+e+`, got: `+t.length);if(n&&!Ba(t))throw Error(`invalid output, must be aligned`);return t}function za(e,t,n,r){if(typeof e.setBigUint64==`function`)return e.setBigUint64(t,n,r);let i=BigInt(32),a=BigInt(4294967295),o=Number(n>>i&a),s=Number(n&a),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,s,r)}function Ba(e){return e.byteOffset%4==0}function Va(e){return Uint8Array.from(e)}function Ha(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}var Ua=e=>Uint8Array.from(e.split(``).map(e=>e.charCodeAt(0))),Wa=Ua(`expand 16-byte k`),Ga=Ua(`expand 32-byte k`),Ka=ja(Wa),qa=ja(Ga);function B(e,t){return e<<t|e>>>32-t}function Ja(e){return e.byteOffset%4==0}var Ya=64,Xa=16,Za=2**32-1,Qa=new Uint32Array;function $a(e,t,n,r,i,a,o,s){let c=i.length,l=new Uint8Array(Ya),u=ja(l),d=Ja(i)&&Ja(a),f=d?ja(i):Qa,p=d?ja(a):Qa;for(let m=0;m<c;o++){if(e(t,n,r,u,o,s),o>=Za)throw Error(`arx: counter overflow`);let h=Math.min(Ya,c-m);if(d&&h===Ya){let e=m/4;if(m%4!=0)throw Error(`arx: invalid block position`);for(let t=0,n;t<Xa;t++)n=e+t,p[n]=f[n]^u[t];m+=Ya;continue}for(let e=0,t;e<h;e++)t=m+e,a[t]=i[t]^l[e];m+=h}}function eo(e,t){let{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:a,rounds:o}=Fa({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!=`function`)throw Error(`core must be a function`);return Ta(i),Ta(o),Aa(a),Aa(n),(t,s,c,l,u=0)=>{Da(t),Da(s),Da(c);let d=c.length;if(l===void 0&&(l=new Uint8Array(d)),Da(l),Ta(u),u<0||u>=Za)throw Error(`arx: counter overflow`);if(l.length<d)throw Error(`arx: output (${l.length}) is shorter than data (${d})`);let f=[],p=t.length,m,h;if(p===32)f.push(m=Va(t)),h=qa;else if(p===16&&n)m=new Uint8Array(32),m.set(t),m.set(t,16),h=Ka,f.push(m);else throw Error(`arx: invalid 32-byte key, got length=${p}`);Ja(s)||f.push(s=Va(s));let g=ja(m);if(r){if(s.length!==24)throw Error(`arx: extended nonce must be 24 bytes`);r(h,g,ja(s.subarray(0,16)),g),s=s.subarray(16)}let _=16-i;if(_!==s.length)throw Error(`arx: nonce must be ${_} or 16 bytes`);if(_!==12){let e=new Uint8Array(12);e.set(s,a?0:12-s.length),s=e,f.push(s)}let v=ja(s);return $a(e,h,g,v,c,l,u,o),Ha(...f),l}}var to=(e,t)=>e[t++]&255|(e[t++]&255)<<8,no=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Pa(e),Da(e,32);let t=to(e,0),n=to(e,2),r=to(e,4),i=to(e,6),a=to(e,8),o=to(e,10),s=to(e,12),c=to(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|r<<6)&7939,this.r[3]=(r>>>7|i<<9)&8191,this.r[4]=(i>>>4|a<<12)&255,this.r[5]=a>>>1&8190,this.r[6]=(a>>>14|o<<2)&8191,this.r[7]=(o>>>11|s<<5)&8065,this.r[8]=(s>>>8|c<<8)&8191,this.r[9]=c>>>5&127;for(let t=0;t<8;t++)this.pad[t]=to(e,16+2*t)}process(e,t,n=!1){let r=n?0:2048,{h:i,r:a}=this,o=a[0],s=a[1],c=a[2],l=a[3],u=a[4],d=a[5],f=a[6],p=a[7],m=a[8],h=a[9],g=to(e,t+0),_=to(e,t+2),v=to(e,t+4),y=to(e,t+6),b=to(e,t+8),x=to(e,t+10),ee=to(e,t+12),S=to(e,t+14),C=i[0]+(g&8191),w=i[1]+((g>>>13|_<<3)&8191),T=i[2]+((_>>>10|v<<6)&8191),E=i[3]+((v>>>7|y<<9)&8191),D=i[4]+((y>>>4|b<<12)&8191),O=i[5]+(b>>>1&8191),k=i[6]+((b>>>14|x<<2)&8191),A=i[7]+((x>>>11|ee<<5)&8191),j=i[8]+((ee>>>8|S<<8)&8191),M=i[9]+(S>>>5|r),N=0,P=N+C*o+w*(5*h)+T*(5*m)+E*(5*p)+D*(5*f);N=P>>>13,P&=8191,P+=O*(5*d)+k*(5*u)+A*(5*l)+j*(5*c)+M*(5*s),N+=P>>>13,P&=8191;let F=N+C*s+w*o+T*(5*h)+E*(5*m)+D*(5*p);N=F>>>13,F&=8191,F+=O*(5*f)+k*(5*d)+A*(5*u)+j*(5*l)+M*(5*c),N+=F>>>13,F&=8191;let I=N+C*c+w*s+T*o+E*(5*h)+D*(5*m);N=I>>>13,I&=8191,I+=O*(5*p)+k*(5*f)+A*(5*d)+j*(5*u)+M*(5*l),N+=I>>>13,I&=8191;let L=N+C*l+w*c+T*s+E*o+D*(5*h);N=L>>>13,L&=8191,L+=O*(5*m)+k*(5*p)+A*(5*f)+j*(5*d)+M*(5*u),N+=L>>>13,L&=8191;let te=N+C*u+w*l+T*c+E*s+D*o;N=te>>>13,te&=8191,te+=O*(5*h)+k*(5*m)+A*(5*p)+j*(5*f)+M*(5*d),N+=te>>>13,te&=8191;let ne=N+C*d+w*u+T*l+E*c+D*s;N=ne>>>13,ne&=8191,ne+=O*o+k*(5*h)+A*(5*m)+j*(5*p)+M*(5*f),N+=ne>>>13,ne&=8191;let re=N+C*f+w*d+T*u+E*l+D*c;N=re>>>13,re&=8191,re+=O*s+k*o+A*(5*h)+j*(5*m)+M*(5*p),N+=re>>>13,re&=8191;let ie=N+C*p+w*f+T*d+E*u+D*l;N=ie>>>13,ie&=8191,ie+=O*c+k*s+A*o+j*(5*h)+M*(5*m),N+=ie>>>13,ie&=8191;let ae=N+C*m+w*p+T*f+E*d+D*u;N=ae>>>13,ae&=8191,ae+=O*l+k*c+A*s+j*o+M*(5*h),N+=ae>>>13,ae&=8191;let oe=N+C*h+w*m+T*p+E*f+D*d;N=oe>>>13,oe&=8191,oe+=O*u+k*l+A*c+j*s+M*o,N+=oe>>>13,oe&=8191,N=(N<<2)+N|0,N=N+P|0,P=N&8191,N>>>=13,F+=N,i[0]=P,i[1]=F,i[2]=I,i[3]=L,i[4]=te,i[5]=ne,i[6]=re,i[7]=ie,i[8]=ae,i[9]=oe}finalize(){let{h:e,pad:t}=this,n=new Uint16Array(10),r=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=r,r=e[t]>>>13,e[t]&=8191;e[0]+=r*5,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,n[0]=e[0]+5,r=n[0]>>>13,n[0]&=8191;for(let t=1;t<10;t++)n[t]=e[t]+r,r=n[t]>>>13,n[t]&=8191;n[9]-=8192;let i=(r^1)-1;for(let e=0;e<10;e++)n[e]&=i;i=~i;for(let t=0;t<10;t++)e[t]=e[t]&i|n[t];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let a=e[0]+t[0];e[0]=a&65535;for(let n=1;n<8;n++)a=(e[n]+t[n]|0)+(a>>>16)|0,e[n]=a&65535;Ha(n)}update(e){Oa(this);let{buffer:t,blockLen:n}=this;e=Pa(e);let r=e.length;for(let i=0;i<r;){let a=Math.min(n-this.pos,r-i);if(a===n){for(;n<=r-i;i+=n)this.process(e,i);continue}t.set(e.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Ha(this.h,this.r,this.buffer,this.pad)}digestInto(e){Oa(this),ka(e,this),this.finished=!0;let{buffer:t,h:n}=this,{pos:r}=this;if(r){for(t[r++]=1;r<16;r++)t[r]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let t=0;t<8;t++)e[i++]=n[t]>>>0,e[i++]=n[t]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}};function ro(e){let t=(t,n)=>e(n).update(Pa(t)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=t=>e(t),t}var io=ro(e=>new no(e));function ao(e,t,n,r,i,a=20){let o=e[0],s=e[1],c=e[2],l=e[3],u=t[0],d=t[1],f=t[2],p=t[3],m=t[4],h=t[5],g=t[6],_=t[7],v=i,y=n[0],b=n[1],x=n[2],ee=o,S=s,C=c,w=l,T=u,E=d,D=f,O=p,k=m,A=h,j=g,M=_,N=v,P=y,F=b,I=x;for(let e=0;e<a;e+=2)ee=ee+T|0,N=B(N^ee,16),k=k+N|0,T=B(T^k,12),ee=ee+T|0,N=B(N^ee,8),k=k+N|0,T=B(T^k,7),S=S+E|0,P=B(P^S,16),A=A+P|0,E=B(E^A,12),S=S+E|0,P=B(P^S,8),A=A+P|0,E=B(E^A,7),C=C+D|0,F=B(F^C,16),j=j+F|0,D=B(D^j,12),C=C+D|0,F=B(F^C,8),j=j+F|0,D=B(D^j,7),w=w+O|0,I=B(I^w,16),M=M+I|0,O=B(O^M,12),w=w+O|0,I=B(I^w,8),M=M+I|0,O=B(O^M,7),ee=ee+E|0,I=B(I^ee,16),j=j+I|0,E=B(E^j,12),ee=ee+E|0,I=B(I^ee,8),j=j+I|0,E=B(E^j,7),S=S+D|0,N=B(N^S,16),M=M+N|0,D=B(D^M,12),S=S+D|0,N=B(N^S,8),M=M+N|0,D=B(D^M,7),C=C+O|0,P=B(P^C,16),k=k+P|0,O=B(O^k,12),C=C+O|0,P=B(P^C,8),k=k+P|0,O=B(O^k,7),w=w+T|0,F=B(F^w,16),A=A+F|0,T=B(T^A,12),w=w+T|0,F=B(F^w,8),A=A+F|0,T=B(T^A,7);let L=0;r[L++]=o+ee|0,r[L++]=s+S|0,r[L++]=c+C|0,r[L++]=l+w|0,r[L++]=u+T|0,r[L++]=d+E|0,r[L++]=f+D|0,r[L++]=p+O|0,r[L++]=m+k|0,r[L++]=h+A|0,r[L++]=g+j|0,r[L++]=_+M|0,r[L++]=v+N|0,r[L++]=y+P|0,r[L++]=b+F|0,r[L++]=x+I|0}var oo=eo(ao,{counterRight:!1,counterLength:4,allowShortKeys:!1}),so=new Uint8Array(16),co=(e,t)=>{e.update(t);let n=t.length%16;n&&e.update(so.subarray(n))},lo=new Uint8Array(32);function uo(e,t,n,r,i){let a=e(t,n,lo),o=io.create(a);i&&co(o,i),co(o,r);let s=new Uint8Array(16),c=Ma(s);za(c,0,BigInt(i?i.length:0),!0),za(c,8,BigInt(r.length),!0),o.update(s);let l=o.digest();return Ha(a,s),l}var fo=La({blockSize:64,nonceLength:12,tagLength:16},(e=>(t,n,r)=>({encrypt(i,a){let o=i.length;a=Ra(o+16,a,!1),a.set(i);let s=a.subarray(0,-16);e(t,n,s,s,1);let c=uo(e,t,n,s,r);return a.set(c,o),Ha(c),a},decrypt(i,a){a=Ra(i.length-16,a,!1);let o=i.subarray(0,-16),s=i.subarray(-16),c=uo(e,t,n,o,r);if(!Ia(s,c))throw Error(`invalid tag`);return a.set(i.subarray(0,-16)),e(t,n,a,a,1),Ha(c),a}}))(oo)),po=class extends Si{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,ti(e);let n=bi(t);if(this.iHash=e.create(),typeof this.iHash.update!=`function`)throw Error(`Expected instance of class which extends utils.Hash`);this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return ni(this),this.iHash.update(e),this}digestInto(e){ni(this),ei(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});let{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:a,outputLen:o}=this;return e=e,e.finished=r,e.destroyed=i,e.blockLen=a,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},mo=(e,t,n)=>new po(e,t).update(n).digest();mo.create=(e,t)=>new po(e,t);function ho(e,t,n){return ti(e),n===void 0&&(n=new Uint8Array(e.outputLen)),mo(e,bi(n),bi(t))}var go=new Uint8Array([0]),_o=new Uint8Array;function vo(e,t,n,r=32){if(ti(e),Qr(r),r>255*e.outputLen)throw Error(`Length should be <= 255*HashLen`);let i=Math.ceil(r/e.outputLen);n===void 0&&(n=_o);let a=new Uint8Array(i*e.outputLen),o=mo.create(e,t),s=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let t=0;t<i;t++)go[0]=t+1,s.update(t===0?_o:c).update(n).update(go).digestInto(c),a.set(c,e.outputLen*t),o._cloneInto(s);return o.destroy(),s.destroy(),c.fill(0),go.fill(0),a.slice(0,r)}var yo=(e,t,n,r,i)=>vo(e,ho(e,t,n),r,i);function bo(e,t,n,r){if(typeof e.setBigUint64==`function`)return e.setBigUint64(t,n,r);let i=BigInt(32),a=BigInt(4294967295),o=Number(n>>i&a),s=Number(n&a),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,s,r)}function xo(e,t,n){return e&t^~e&n}function So(e,t,n){return e&t^e&n^t&n}var Co=class extends Si{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=mi(this.buffer)}update(e){ni(this);let{view:t,buffer:n,blockLen:r}=this;e=bi(e);let i=e.length;for(let a=0;a<i;){let o=Math.min(r-this.pos,i-a);if(o===r){let t=mi(e);for(;r<=i-a;a+=r)this.process(t,a);continue}n.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ni(this),ri(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:i}=this,{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>r-a&&(this.process(n,0),a=0);for(let e=a;e<r;e++)t[e]=0;bo(n,r-8,BigInt(this.length*8),i),this.process(n,0);let o=mi(e),s=this.outputLen;if(s%4)throw Error(`_sha2: outputLen should be aligned to 32bit`);let c=s/4,l=this.get();if(c>l.length)throw Error(`_sha2: outputLen bigger than state`);for(let e=0;e<c;e++)o.setUint32(4*e,l[e],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||=new this.constructor,e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:i,destroyed:a,pos:o}=this;return e.length=r,e.pos=o,e.finished=i,e.destroyed=a,r%t&&e.buffer.set(n),e}},wo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),To=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Eo=new Uint32Array(64),Do=class extends Co{constructor(){super(64,32,8,!1),this.A=To[0]|0,this.B=To[1]|0,this.C=To[2]|0,this.D=To[3]|0,this.E=To[4]|0,this.F=To[5]|0,this.G=To[6]|0,this.H=To[7]|0}get(){let{A:e,B:t,C:n,D:r,E:i,F:a,G:o,H:s}=this;return[e,t,n,r,i,a,o,s]}set(e,t,n,r,i,a,o,s){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=i|0,this.F=a|0,this.G=o|0,this.H=s|0}process(e,t){for(let n=0;n<16;n++,t+=4)Eo[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=Eo[e-15],n=Eo[e-2],r=hi(t,7)^hi(t,18)^t>>>3;Eo[e]=(hi(n,17)^hi(n,19)^n>>>10)+Eo[e-7]+r+Eo[e-16]|0}let{A:n,B:r,C:i,D:a,E:o,F:s,G:c,H:l}=this;for(let e=0;e<64;e++){let t=hi(o,6)^hi(o,11)^hi(o,25),u=l+t+xo(o,s,c)+wo[e]+Eo[e]|0,d=(hi(n,2)^hi(n,13)^hi(n,22))+So(n,r,i)|0;l=c,c=s,s=o,o=a+u|0,a=i,i=r,r=n,n=u+d|0}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,a=a+this.D|0,o=o+this.E|0,s=s+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,i,a,o,s,c,l)}roundClean(){Eo.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},Oo=Ci(()=>new Do),ko=BigInt(0),Ao=BigInt(1),jo=BigInt(2);function Mo(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name===`Uint8Array`}function No(e){if(!Mo(e))throw Error(`Uint8Array expected`)}function Po(e,t){if(typeof t!=`boolean`)throw Error(e+` boolean expected, got `+t)}var Fo=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,`0`));function Io(e){No(e);let t=``;for(let n=0;n<e.length;n++)t+=Fo[e[n]];return t}function Lo(e){let t=e.toString(16);return t.length&1?`0`+t:t}function Ro(e){if(typeof e!=`string`)throw Error(`hex string expected, got `+typeof e);return e===``?ko:BigInt(`0x`+e)}var zo={_0:48,_9:57,A:65,F:70,a:97,f:102};function Bo(e){if(e>=zo._0&&e<=zo._9)return e-zo._0;if(e>=zo.A&&e<=zo.F)return e-(zo.A-10);if(e>=zo.a&&e<=zo.f)return e-(zo.a-10)}function Vo(e){if(typeof e!=`string`)throw Error(`hex string expected, got `+typeof e);let t=e.length,n=t/2;if(t%2)throw Error(`hex string expected, got unpadded hex of length `+t);let r=new Uint8Array(n);for(let t=0,i=0;t<n;t++,i+=2){let n=Bo(e.charCodeAt(i)),a=Bo(e.charCodeAt(i+1));if(n===void 0||a===void 0){let t=e[i]+e[i+1];throw Error(`hex string expected, got non-hex character "`+t+`" at index `+i)}r[t]=n*16+a}return r}function Ho(e){return Ro(Io(e))}function Uo(e){return No(e),Ro(Io(Uint8Array.from(e).reverse()))}function Wo(e,t){return Vo(e.toString(16).padStart(t*2,`0`))}function Go(e,t){return Wo(e,t).reverse()}function Ko(e){return Vo(Lo(e))}function qo(e,t,n){let r;if(typeof t==`string`)try{r=Vo(t)}catch(t){throw Error(e+` must be hex string or Uint8Array, cause: `+t)}else if(Mo(t))r=Uint8Array.from(t);else throw Error(e+` must be hex string or Uint8Array`);let i=r.length;if(typeof n==`number`&&i!==n)throw Error(e+` of length `+n+` expected, got `+i);return r}function Jo(...e){let t=0;for(let n=0;n<e.length;n++){let r=e[n];No(r),t+=r.length}let n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){let i=e[t];n.set(i,r),r+=i.length}return n}function Yo(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}function Xo(e){if(typeof e!=`string`)throw Error(`string expected`);return new Uint8Array(new TextEncoder().encode(e))}var Zo=e=>typeof e==`bigint`&&ko<=e;function Qo(e,t,n){return Zo(e)&&Zo(t)&&Zo(n)&&t<=e&&e<n}function $o(e,t,n,r){if(!Qo(t,n,r))throw Error(`expected valid `+e+`: `+n+` <= n < `+r+`, got `+t)}function es(e){let t;for(t=0;e>ko;e>>=Ao,t+=1);return t}function ts(e,t){return e>>BigInt(t)&Ao}function ns(e,t,n){return e|(n?Ao:ko)<<BigInt(t)}var rs=e=>(jo<<BigInt(e-1))-Ao,is=e=>new Uint8Array(e),as=e=>Uint8Array.from(e);function os(e,t,n){if(typeof e!=`number`||e<2)throw Error(`hashLen must be a number`);if(typeof t!=`number`||t<2)throw Error(`qByteLen must be a number`);if(typeof n!=`function`)throw Error(`hmacFn must be a function`);let r=is(e),i=is(e),a=0,o=()=>{r.fill(1),i.fill(0),a=0},s=(...e)=>n(i,r,...e),c=(e=is())=>{i=s(as([0]),e),r=s(),e.length!==0&&(i=s(as([1]),e),r=s())},l=()=>{if(a++>=1e3)throw Error(`drbg: tried 1000 values`);let e=0,n=[];for(;e<t;){r=s();let t=r.slice();n.push(t),e+=r.length}return Jo(...n)};return(e,t)=>{o(),c(e);let n;for(;!(n=t(l()));)c();return o(),n}}var ss={bigint:e=>typeof e==`bigint`,function:e=>typeof e==`function`,boolean:e=>typeof e==`boolean`,string:e=>typeof e==`string`,stringOrUint8Array:e=>typeof e==`string`||Mo(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e==`function`&&Number.isSafeInteger(e.outputLen)};function cs(e,t,n={}){let r=(t,n,r)=>{let i=ss[n];if(typeof i!=`function`)throw Error(`invalid validator function`);let a=e[t];if(!(r&&a===void 0)&&!i(a,e))throw Error(`param `+String(t)+` is invalid. Expected `+n+`, got `+a)};for(let[e,n]of Object.entries(t))r(e,n,!1);for(let[e,t]of Object.entries(n))r(e,t,!0);return e}var ls=()=>{throw Error(`not implemented`)};function us(e){let t=new WeakMap;return(n,...r)=>{let i=t.get(n);if(i!==void 0)return i;let a=e(n,...r);return t.set(n,a),a}}var ds=Object.freeze({__proto__:null,isBytes:Mo,abytes:No,abool:Po,bytesToHex:Io,numberToHexUnpadded:Lo,hexToNumber:Ro,hexToBytes:Vo,bytesToNumberBE:Ho,bytesToNumberLE:Uo,numberToBytesBE:Wo,numberToBytesLE:Go,numberToVarBytesBE:Ko,ensureBytes:qo,concatBytes:Jo,equalBytes:Yo,utf8ToBytes:Xo,inRange:Qo,aInRange:$o,bitLen:es,bitGet:ts,bitSet:ns,bitMask:rs,createHmacDrbg:os,validateObject:cs,notImplemented:ls,memoized:us}),fs=BigInt(0),ps=BigInt(1),ms=BigInt(2),hs=BigInt(3),gs=BigInt(4),_s=BigInt(5),vs=BigInt(8);function ys(e,t){let n=e%t;return n>=fs?n:t+n}function bs(e,t,n){if(t<fs)throw Error(`invalid exponent, negatives unsupported`);if(n<=fs)throw Error(`invalid modulus`);if(n===ps)return fs;let r=ps;for(;t>fs;)t&ps&&(r=r*e%n),e=e*e%n,t>>=ps;return r}function xs(e,t,n){let r=e;for(;t-- >fs;)r*=r,r%=n;return r}function Ss(e,t){if(e===fs)throw Error(`invert: expected non-zero number`);if(t<=fs)throw Error(`invert: expected positive modulus, got `+t);let n=ys(e,t),r=t,i=fs,a=ps;for(;n!==fs;){let e=r/n,t=r%n,o=i-a*e;r=n,n=t,i=a,a=o}if(r!==ps)throw Error(`invert: does not exist`);return ys(i,t)}function Cs(e){let t=(e-ps)/ms,n,r,i;for(n=e-ps,r=0;n%ms===fs;n/=ms,r++);for(i=ms;i<e&&bs(i,t,e)!==e-ps;i++)if(i>1e3)throw Error(`Cannot find square root: likely non-prime P`);if(r===1){let t=(e+ps)/gs;return function(e,n){let r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw Error(`Cannot find square root`);return r}}let a=(n+ps)/ms;return function(e,o){if(e.pow(o,t)===e.neg(e.ONE))throw Error(`Cannot find square root`);let s=r,c=e.pow(e.mul(e.ONE,i),n),l=e.pow(o,a),u=e.pow(o,n);for(;!e.eql(u,e.ONE);){if(e.eql(u,e.ZERO))return e.ZERO;let t=1;for(let n=e.sqr(u);t<s&&!e.eql(n,e.ONE);t++)n=e.sqr(n);let n=e.pow(c,ps<<BigInt(s-t-1));c=e.sqr(n),l=e.mul(l,n),u=e.mul(u,c),s=t}return l}}function ws(e){if(e%gs===hs){let t=(e+ps)/gs;return function(e,n){let r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw Error(`Cannot find square root`);return r}}if(e%vs===_s){let t=(e-_s)/vs;return function(e,n){let r=e.mul(n,ms),i=e.pow(r,t),a=e.mul(n,i),o=e.mul(e.mul(a,ms),i),s=e.mul(a,e.sub(o,e.ONE));if(!e.eql(e.sqr(s),n))throw Error(`Cannot find square root`);return s}}return Cs(e)}var Ts=[`create`,`isValid`,`is0`,`neg`,`inv`,`sqrt`,`sqr`,`eql`,`add`,`sub`,`mul`,`pow`,`div`,`addN`,`subN`,`mulN`,`sqrN`];function Es(e){return cs(e,Ts.reduce((e,t)=>(e[t]=`function`,e),{ORDER:`bigint`,MASK:`bigint`,BYTES:`isSafeInteger`,BITS:`isSafeInteger`}))}function Ds(e,t,n){if(n<fs)throw Error(`invalid exponent, negatives unsupported`);if(n===fs)return e.ONE;if(n===ps)return t;let r=e.ONE,i=t;for(;n>fs;)n&ps&&(r=e.mul(r,i)),i=e.sqr(i),n>>=ps;return r}function Os(e,t){let n=Array(t.length),r=t.reduce((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r)),e.ONE),i=e.inv(r);return t.reduceRight((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r)),i),n}function ks(e,t){let n=t===void 0?e.toString(2).length:t;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function As(e,t,n=!1,r={}){if(e<=fs)throw Error(`invalid field: expected ORDER > 0, got `+e);let{nBitLength:i,nByteLength:a}=ks(e,t);if(a>2048)throw Error(`invalid field: expected ORDER of <= 2048 bytes`);let o,s=Object.freeze({ORDER:e,isLE:n,BITS:i,BYTES:a,MASK:rs(i),ZERO:fs,ONE:ps,create:t=>ys(t,e),isValid:t=>{if(typeof t!=`bigint`)throw Error(`invalid field element: expected bigint, got `+typeof t);return fs<=t&&t<e},is0:e=>e===fs,isOdd:e=>(e&ps)===ps,neg:t=>ys(-t,e),eql:(e,t)=>e===t,sqr:t=>ys(t*t,e),add:(t,n)=>ys(t+n,e),sub:(t,n)=>ys(t-n,e),mul:(t,n)=>ys(t*n,e),pow:(e,t)=>Ds(s,e,t),div:(t,n)=>ys(t*Ss(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>Ss(t,e),sqrt:r.sqrt||(t=>(o||=ws(e),o(s,t))),invertBatch:e=>Os(s,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?Go(e,a):Wo(e,a),fromBytes:e=>{if(e.length!==a)throw Error(`Field.fromBytes: expected `+a+` bytes, got `+e.length);return n?Uo(e):Ho(e)}});return Object.freeze(s)}function js(e){if(typeof e!=`bigint`)throw Error(`field order must be bigint`);let t=e.toString(2).length;return Math.ceil(t/8)}function Ms(e){let t=js(e);return t+Math.ceil(t/2)}function Ns(e,t,n=!1){let r=e.length,i=js(t),a=Ms(t);if(r<16||r<a||r>1024)throw Error(`expected `+a+`-1024 bytes of input, got `+r);let o=ys(n?Uo(e):Ho(e),t-ps)+ps;return n?Go(o,i):Wo(o,i)}var Ps=BigInt(0),Fs=BigInt(1);function Is(e,t){let n=t.negate();return e?n:t}function Ls(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error(`invalid window size, expected [1..`+t+`], got W=`+e)}function Rs(e,t){return Ls(e,t),{windows:Math.ceil(t/e)+1,windowSize:2**(e-1)}}function zs(e,t){if(!Array.isArray(e))throw Error(`array expected`);e.forEach((e,n)=>{if(!(e instanceof t))throw Error(`invalid point at index `+n)})}function Bs(e,t){if(!Array.isArray(e))throw Error(`array of scalars expected`);e.forEach((e,n)=>{if(!t.isValid(e))throw Error(`invalid scalar at index `+n)})}var Vs=new WeakMap,Hs=new WeakMap;function Us(e){return Hs.get(e)||1}function Ws(e,t){return{constTimeNegate:Is,hasPrecomputes(e){return Us(e)!==1},unsafeLadder(t,n,r=e.ZERO){let i=t;for(;n>Ps;)n&Fs&&(r=r.add(i)),i=i.double(),n>>=Fs;return r},precomputeWindow(e,n){let{windows:r,windowSize:i}=Rs(n,t),a=[],o=e,s=o;for(let e=0;e<r;e++){s=o,a.push(s);for(let e=1;e<i;e++)s=s.add(o),a.push(s);o=s.double()}return a},wNAF(n,r,i){let{windows:a,windowSize:o}=Rs(n,t),s=e.ZERO,c=e.BASE,l=BigInt(2**n-1),u=2**n,d=BigInt(n);for(let e=0;e<a;e++){let t=e*o,n=Number(i&l);i>>=d,n>o&&(n-=u,i+=Fs);let a=t,f=t+Math.abs(n)-1,p=e%2!=0,m=n<0;n===0?c=c.add(Is(p,r[a])):s=s.add(Is(m,r[f]))}return{p:s,f:c}},wNAFUnsafe(n,r,i,a=e.ZERO){let{windows:o,windowSize:s}=Rs(n,t),c=BigInt(2**n-1),l=2**n,u=BigInt(n);for(let e=0;e<o;e++){let t=e*s;if(i===Ps)break;let n=Number(i&c);if(i>>=u,n>s&&(n-=l,i+=Fs),n===0)continue;let o=r[t+Math.abs(n)-1];n<0&&(o=o.negate()),a=a.add(o)}return a},getPrecomputes(e,t,n){let r=Vs.get(t);return r||(r=this.precomputeWindow(t,e),e!==1&&Vs.set(t,n(r))),r},wNAFCached(e,t,n){let r=Us(e);return this.wNAF(r,this.getPrecomputes(r,e,n),t)},wNAFCachedUnsafe(e,t,n,r){let i=Us(e);return i===1?this.unsafeLadder(e,t,r):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),t,r)},setWindowSize(e,n){Ls(n,t),Hs.set(e,n),Vs.delete(e)}}}function Gs(e,t,n,r){if(zs(n,e),Bs(r,t),n.length!==r.length)throw Error(`arrays of points and scalars must have equal length`);let i=e.ZERO,a=es(BigInt(n.length)),o=a>12?a-3:a>4?a-2:a?2:1,s=(1<<o)-1,c=Array(s+1).fill(i),l=Math.floor((t.BITS-1)/o)*o,u=i;for(let e=l;e>=0;e-=o){c.fill(i);for(let t=0;t<r.length;t++){let i=r[t],a=Number(i>>BigInt(e)&BigInt(s));c[a]=c[a].add(n[t])}let t=i;for(let e=c.length-1,n=i;e>0;e--)n=n.add(c[e]),t=t.add(n);if(u=u.add(t),e!==0)for(let e=0;e<o;e++)u=u.double()}return u}function Ks(e){return Es(e.Fp),cs(e,{n:`bigint`,h:`bigint`,Gx:`field`,Gy:`field`},{nBitLength:`isSafeInteger`,nByteLength:`isSafeInteger`}),Object.freeze({...ks(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}var qs=BigInt(0),Js=BigInt(1);function Ys(e){return cs(e,{a:`bigint`},{montgomeryBits:`isSafeInteger`,nByteLength:`isSafeInteger`,adjustScalarBytes:`function`,domain:`function`,powPminus2:`function`,Gu:`bigint`}),Object.freeze({...e})}function Xs(e){let t=Ys(e),{P:n}=t,r=e=>ys(e,n),i=t.montgomeryBits,a=Math.ceil(i/8),o=t.nByteLength,s=t.adjustScalarBytes||(e=>e),c=t.powPminus2||(e=>bs(e,n-BigInt(2),n));function l(e,t,n){let i=r(e*(t-n));return t=r(t-i),n=r(n+i),[t,n]}let u=(t.a-BigInt(2))/BigInt(4);function d(e,t){$o(`u`,e,qs,n),$o(`scalar`,t,qs,n);let a=t,o=e,s=Js,d=qs,f=e,p=Js,m=qs,h;for(let e=BigInt(i-1);e>=qs;e--){let t=a>>e&Js;m^=t,h=l(m,s,f),s=h[0],f=h[1],h=l(m,d,p),d=h[0],p=h[1],m=t;let n=s+d,i=r(n*n),c=s-d,g=r(c*c),_=i-g,v=f+p,y=r((f-p)*n),b=r(v*c),x=y+b,ee=y-b;f=r(x*x),p=r(o*r(ee*ee)),s=r(i*g),d=r(_*(i+r(u*_)))}h=l(m,s,f),s=h[0],f=h[1],h=l(m,d,p),d=h[0],p=h[1];let g=c(d);return r(s*g)}function f(e){return Go(r(e),a)}function p(e){let t=qo(`u coordinate`,e,a);return o===32&&(t[31]&=127),Uo(t)}function m(e){let t=qo(`scalar`,e),n=t.length;if(n!==a&&n!==o){let e=``+a+` or `+o;throw Error(`invalid scalar, expected `+e+` bytes, got `+n)}return Uo(s(t))}function h(e,t){let n=d(p(t),m(e));if(n===qs)throw Error(`invalid private or public key received`);return f(n)}let g=f(t.Gu);function _(e){return h(e,g)}return{scalarMult:h,scalarMultBase:_,getSharedSecret:(e,t)=>h(e,t),getPublicKey:e=>_(e),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:g}}var Zs=BigInt(`57896044618658097711785492504343953926634992332820282019728792003956564819949`),Qs=BigInt(1),$s=BigInt(2),ec=BigInt(3),tc=BigInt(5);function nc(e){let t=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),a=Zs,o=e*e%a*e%a,s=xs(xs(o,$s,a)*o%a,Qs,a)*e%a,c=xs(s,tc,a)*s%a,l=xs(c,t,a)*c%a,u=xs(l,n,a)*l%a,d=xs(u,r,a)*u%a;return{pow_p_5_8:xs(xs(xs(xs(d,i,a)*d%a,i,a)*d%a,t,a)*c%a,$s,a)*e%a,b2:o}}function rc(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var ic=Xs({P:Zs,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{let t=Zs,{pow_p_5_8:n,b2:r}=nc(e);return ys(xs(n,ec,t)*r,t)},adjustScalarBytes:rc,randomBytes:wi});function ac(e){e.lowS!==void 0&&Po(`lowS`,e.lowS),e.prehash!==void 0&&Po(`prehash`,e.prehash)}function oc(e){let t=Ks(e);cs(t,{a:`field`,b:`field`},{allowedPrivateKeyLengths:`array`,wrapPrivateKey:`boolean`,isTorsionFree:`function`,clearCofactor:`function`,allowInfinityPoint:`boolean`,fromBytes:`function`,toBytes:`function`});let{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw Error(`invalid endomorphism, can only be defined for Koblitz curves that have a=0`);if(typeof n!=`object`||typeof n.beta!=`bigint`||typeof n.splitScalar!=`function`)throw Error(`invalid endomorphism, expected beta: bigint and splitScalar: function`)}return Object.freeze({...t})}var{bytesToNumberBE:sc,hexToBytes:cc}=ds,lc={Err:class extends Error{constructor(e=``){super(e)}},_tlv:{encode:(e,t)=>{let{Err:n}=lc;if(e<0||e>256)throw new n(`tlv.encode: wrong tag`);if(t.length&1)throw new n(`tlv.encode: unpadded data`);let r=t.length/2,i=Lo(r);if(i.length/2&128)throw new n(`tlv.encode: long form length too big`);let a=r>127?Lo(i.length/2|128):``;return Lo(e)+a+i+t},decode(e,t){let{Err:n}=lc,r=0;if(e<0||e>256)throw new n(`tlv.encode: wrong tag`);if(t.length<2||t[r++]!==e)throw new n(`tlv.decode: wrong tlv`);let i=t[r++],a=!!(i&128),o=0;if(!a)o=i;else{let e=i&127;if(!e)throw new n(`tlv.decode(long): indefinite length not supported`);if(e>4)throw new n(`tlv.decode(long): byte length is too big`);let a=t.subarray(r,r+e);if(a.length!==e)throw new n(`tlv.decode: length bytes not complete`);if(a[0]===0)throw new n(`tlv.decode(long): zero leftmost byte`);for(let e of a)o=o<<8|e;if(r+=e,o<128)throw new n(`tlv.decode(long): not minimal encoding`)}let s=t.subarray(r,r+o);if(s.length!==o)throw new n(`tlv.decode: wrong value length`);return{v:s,l:t.subarray(r+o)}}},_int:{encode(e){let{Err:t}=lc;if(e<uc)throw new t(`integer: negative integers are not allowed`);let n=Lo(e);if(Number.parseInt(n[0],16)&8&&(n=`00`+n),n.length&1)throw new t(`unexpected DER parsing assertion: unpadded hex`);return n},decode(e){let{Err:t}=lc;if(e[0]&128)throw new t(`invalid signature integer: negative`);if(e[0]===0&&!(e[1]&128))throw new t(`invalid signature integer: unnecessary leading zero`);return sc(e)}},toSig(e){let{Err:t,_int:n,_tlv:r}=lc,i=typeof e==`string`?cc(e):e;No(i);let{v:a,l:o}=r.decode(48,i);if(o.length)throw new t(`invalid signature: left bytes after parsing`);let{v:s,l:c}=r.decode(2,a),{v:l,l:u}=r.decode(2,c);if(u.length)throw new t(`invalid signature: left bytes after parsing`);return{r:n.decode(s),s:n.decode(l)}},hexFromSig(e){let{_tlv:t,_int:n}=lc,r=t.encode(2,n.encode(e.r))+t.encode(2,n.encode(e.s));return t.encode(48,r)}},uc=BigInt(0),dc=BigInt(1),fc=BigInt(3);function pc(e){let t=oc(e),{Fp:n}=t,r=As(t.n,t.nBitLength),i=t.toBytes||((e,t,r)=>{let i=t.toAffine();return Jo(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),a=t.fromBytes||(e=>{let t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function o(e){let{a:r,b:i}=t,a=n.sqr(e),o=n.mul(a,e);return n.add(n.add(o,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),o(t.Gx)))throw Error(`bad generator point: equation left != right`);function s(e){return Qo(e,dc,t.n)}function c(e){let{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:a}=t;if(n&&typeof e!=`bigint`){if(Mo(e)&&(e=Io(e)),typeof e!=`string`||!n.includes(e.length))throw Error(`invalid private key`);e=e.padStart(r*2,`0`)}let o;try{o=typeof e==`bigint`?e:Ho(qo(`private key`,e,r))}catch{throw Error(`invalid private key, expected hex or `+r+` bytes, got `+typeof e)}return i&&(o=ys(o,a)),$o(`private key`,o,dc,a),o}function l(e){if(!(e instanceof f))throw Error(`ProjectivePoint expected`)}let u=us((e,t)=>{let{px:r,py:i,pz:a}=e;if(n.eql(a,n.ONE))return{x:r,y:i};let o=e.is0();t??=o?n.ONE:n.inv(a);let s=n.mul(r,t),c=n.mul(i,t),l=n.mul(a,t);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(l,n.ONE))throw Error(`invZ was invalid`);return{x:s,y:c}}),d=us(e=>{if(e.is0()){if(t.allowInfinityPoint&&!n.is0(e.py))return;throw Error(`bad point: ZERO`)}let{x:r,y:i}=e.toAffine();if(!n.isValid(r)||!n.isValid(i))throw Error(`bad point: x or y not FE`);let a=n.sqr(i),s=o(r);if(!n.eql(a,s))throw Error(`bad point: equation left != right`);if(!e.isTorsionFree())throw Error(`bad point: not in prime-order subgroup`);return!0});class f{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,e==null||!n.isValid(e))throw Error(`x required`);if(t==null||!n.isValid(t))throw Error(`y required`);if(r==null||!n.isValid(r))throw Error(`z required`);Object.freeze(this)}static fromAffine(e){let{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw Error(`invalid affine point`);if(e instanceof f)throw Error(`projective point not allowed`);let i=e=>n.eql(e,n.ZERO);return i(t)&&i(r)?f.ZERO:new f(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){let t=n.invertBatch(e.map(e=>e.pz));return e.map((e,n)=>e.toAffine(t[n])).map(f.fromAffine)}static fromHex(e){let t=f.fromAffine(a(qo(`pointHex`,e)));return t.assertValidity(),t}static fromPrivateKey(e){return f.BASE.multiply(c(e))}static msm(e,t){return Gs(f,r,e,t)}_setWindowSize(e){m.setWindowSize(this,e)}assertValidity(){d(this)}hasEvenY(){let{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw Error(`Field doesn't support isOdd`)}equals(e){l(e);let{px:t,py:r,pz:i}=this,{px:a,py:o,pz:s}=e,c=n.eql(n.mul(t,s),n.mul(a,i)),u=n.eql(n.mul(r,s),n.mul(o,i));return c&&u}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){let{a:e,b:r}=t,i=n.mul(r,fc),{px:a,py:o,pz:s}=this,c=n.ZERO,l=n.ZERO,u=n.ZERO,d=n.mul(a,a),p=n.mul(o,o),m=n.mul(s,s),h=n.mul(a,o);return h=n.add(h,h),u=n.mul(a,s),u=n.add(u,u),c=n.mul(e,u),l=n.mul(i,m),l=n.add(c,l),c=n.sub(p,l),l=n.add(p,l),l=n.mul(c,l),c=n.mul(h,c),u=n.mul(i,u),m=n.mul(e,m),h=n.sub(d,m),h=n.mul(e,h),h=n.add(h,u),u=n.add(d,d),d=n.add(u,d),d=n.add(d,m),d=n.mul(d,h),l=n.add(l,d),m=n.mul(o,s),m=n.add(m,m),d=n.mul(m,h),c=n.sub(c,d),u=n.mul(m,p),u=n.add(u,u),u=n.add(u,u),new f(c,l,u)}add(e){l(e);let{px:r,py:i,pz:a}=this,{px:o,py:s,pz:c}=e,u=n.ZERO,d=n.ZERO,p=n.ZERO,m=t.a,h=n.mul(t.b,fc),g=n.mul(r,o),_=n.mul(i,s),v=n.mul(a,c),y=n.add(r,i),b=n.add(o,s);y=n.mul(y,b),b=n.add(g,_),y=n.sub(y,b),b=n.add(r,a);let x=n.add(o,c);return b=n.mul(b,x),x=n.add(g,v),b=n.sub(b,x),x=n.add(i,a),u=n.add(s,c),x=n.mul(x,u),u=n.add(_,v),x=n.sub(x,u),p=n.mul(m,b),u=n.mul(h,v),p=n.add(u,p),u=n.sub(_,p),p=n.add(_,p),d=n.mul(u,p),_=n.add(g,g),_=n.add(_,g),v=n.mul(m,v),b=n.mul(h,b),_=n.add(_,v),v=n.sub(g,v),v=n.mul(m,v),b=n.add(b,v),g=n.mul(_,b),d=n.add(d,g),g=n.mul(x,b),u=n.mul(y,u),u=n.sub(u,g),g=n.mul(y,_),p=n.mul(x,p),p=n.add(p,g),new f(u,d,p)}subtract(e){return this.add(e.negate())}is0(){return this.equals(f.ZERO)}wNAF(e){return m.wNAFCached(this,e,f.normalizeZ)}multiplyUnsafe(e){let{endo:r,n:i}=t;$o(`scalar`,e,uc,i);let a=f.ZERO;if(e===uc)return a;if(this.is0()||e===dc)return this;if(!r||m.hasPrecomputes(this))return m.wNAFCachedUnsafe(this,e,f.normalizeZ);let{k1neg:o,k1:s,k2neg:c,k2:l}=r.splitScalar(e),u=a,d=a,p=this;for(;s>uc||l>uc;)s&dc&&(u=u.add(p)),l&dc&&(d=d.add(p)),p=p.double(),s>>=dc,l>>=dc;return o&&(u=u.negate()),c&&(d=d.negate()),d=new f(n.mul(d.px,r.beta),d.py,d.pz),u.add(d)}multiply(e){let{endo:r,n:i}=t;$o(`scalar`,e,dc,i);let a,o;if(r){let{k1neg:t,k1:i,k2neg:s,k2:c}=r.splitScalar(e),{p:l,f:u}=this.wNAF(i),{p:d,f:p}=this.wNAF(c);l=m.constTimeNegate(t,l),d=m.constTimeNegate(s,d),d=new f(n.mul(d.px,r.beta),d.py,d.pz),a=l.add(d),o=u.add(p)}else{let{p:t,f:n}=this.wNAF(e);a=t,o=n}return f.normalizeZ([a,o])[0]}multiplyAndAddUnsafe(e,t,n){let r=f.BASE,i=(e,t)=>t===uc||t===dc||!e.equals(r)?e.multiplyUnsafe(t):e.multiply(t),a=i(this,t).add(i(e,n));return a.is0()?void 0:a}toAffine(e){return u(this,e)}isTorsionFree(){let{h:e,isTorsionFree:n}=t;if(e===dc)return!0;if(n)return n(f,this);throw Error(`isTorsionFree() has not been declared for the elliptic curve`)}clearCofactor(){let{h:e,clearCofactor:n}=t;return e===dc?this:n?n(f,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return Po(`isCompressed`,e),this.assertValidity(),i(f,this,e)}toHex(e=!0){return Po(`isCompressed`,e),Io(this.toRawBytes(e))}}f.BASE=new f(t.Gx,t.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);let p=t.nBitLength,m=Ws(f,t.endo?Math.ceil(p/2):p);return{CURVE:t,ProjectivePoint:f,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:s}}function mc(e){let t=Ks(e);return cs(t,{hash:`hash`,hmac:`function`,randomBytes:`function`},{bits2int:`function`,bits2int_modN:`function`,lowS:`boolean`}),Object.freeze({lowS:!0,...t})}function hc(e){let t=mc(e),{Fp:n,n:r}=t,i=n.BYTES+1,a=2*n.BYTES+1;function o(e){return ys(e,r)}function s(e){return Ss(e,r)}let{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:d}=pc({...t,toBytes(e,t,r){let i=t.toAffine(),a=n.toBytes(i.x),o=Jo;return Po(`isCompressed`,r),r?o(Uint8Array.from([t.hasEvenY()?2:3]),a):o(Uint8Array.from([4]),a,n.toBytes(i.y))},fromBytes(e){let t=e.length,r=e[0],o=e.subarray(1);if(t===i&&(r===2||r===3)){let e=Ho(o);if(!Qo(e,dc,n.ORDER))throw Error(`Point is not on curve`);let t=u(e),i;try{i=n.sqrt(t)}catch(e){let t=e instanceof Error?`: `+e.message:``;throw Error(`Point is not on curve`+t)}let a=(i&dc)===dc;return(r&1)==1!==a&&(i=n.neg(i)),{x:e,y:i}}else if(t===a&&r===4)return{x:n.fromBytes(o.subarray(0,n.BYTES)),y:n.fromBytes(o.subarray(n.BYTES,2*n.BYTES))};else{let e=i,n=a;throw Error(`invalid Point, expected length of `+e+`, or uncompressed `+n+`, got `+t)}}}),f=e=>Io(Wo(e,t.nByteLength));function p(e){return e>r>>dc}function m(e){return p(e)?o(-e):e}let h=(e,t,n)=>Ho(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){let n=t.nByteLength;return e=qo(`compactSignature`,e,n*2),new g(h(e,0,n),h(e,n,2*n))}static fromDER(e){let{r:t,s:n}=lc.toSig(qo(`DER`,e));return new g(t,n)}assertValidity(){$o(`r`,this.r,dc,r),$o(`s`,this.s,dc,r)}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){let{r,s:i,recovery:a}=this,l=ee(qo(`msgHash`,e));if(a==null||![0,1,2,3].includes(a))throw Error(`recovery id invalid`);let u=a===2||a===3?r+t.n:r;if(u>=n.ORDER)throw Error(`recovery id 2 or 3 invalid`);let d=a&1?`03`:`02`,p=c.fromHex(d+f(u)),m=s(u),h=o(-l*m),g=o(i*m),_=c.BASE.multiplyAndAddUnsafe(p,h,g);if(!_)throw Error(`point at infinify`);return _.assertValidity(),_}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Vo(this.toDERHex())}toDERHex(){return lc.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Vo(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}let _={isValidPrivateKey(e){try{return l(e),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{let e=Ms(t.n);return Ns(t.randomBytes(e),t.n)},precompute(e=8,t=c.BASE){return t._setWindowSize(e),t.multiply(BigInt(3)),t}};function v(e,t=!0){return c.fromPrivateKey(e).toRawBytes(t)}function y(e){let t=Mo(e),n=typeof e==`string`,r=(t||n)&&e.length;return t?r===i||r===a:n?r===2*i||r===2*a:e instanceof c}function b(e,t,n=!0){if(y(e))throw Error(`first arg must be private key`);if(!y(t))throw Error(`second arg must be public key`);return c.fromHex(t).multiply(l(e)).toRawBytes(n)}let x=t.bits2int||function(e){if(e.length>8192)throw Error(`input is too large`);let n=Ho(e),r=e.length*8-t.nBitLength;return r>0?n>>BigInt(r):n},ee=t.bits2int_modN||function(e){return o(x(e))},S=rs(t.nBitLength);function C(e){return $o(`num < 2^`+t.nBitLength,e,uc,S),Wo(e,t.nByteLength)}function w(e,r,i=T){if([`recovered`,`canonical`].some(e=>e in i))throw Error(`sign() legacy options not supported`);let{hash:a,randomBytes:u}=t,{lowS:f,prehash:h,extraEntropy:_}=i;f??=!0,e=qo(`msgHash`,e),ac(i),h&&(e=qo(`prehashed msgHash`,a(e)));let v=ee(e),y=l(r),b=[C(y),C(v)];if(_!=null&&_!==!1){let e=_===!0?u(n.BYTES):_;b.push(qo(`extraEntropy`,e))}let S=Jo(...b),w=v;function E(e){let t=x(e);if(!d(t))return;let n=s(t),r=c.BASE.multiply(t).toAffine(),i=o(r.x);if(i===uc)return;let a=o(n*o(w+i*y));if(a===uc)return;let l=(r.x===i?0:2)|Number(r.y&dc),u=a;return f&&p(a)&&(u=m(a),l^=1),new g(i,u,l)}return{seed:S,k2sig:E}}let T={lowS:t.lowS,prehash:!1},E={lowS:t.lowS,prehash:!1};function D(e,n,r=T){let{seed:i,k2sig:a}=w(e,n,r),o=t;return os(o.hash.outputLen,o.nByteLength,o.hmac)(i,a)}c.BASE._setWindowSize(8);function O(e,n,r,i=E){let a=e;n=qo(`msgHash`,n),r=qo(`publicKey`,r);let{lowS:l,prehash:u,format:d}=i;if(ac(i),`strict`in i)throw Error(`options.strict was renamed to lowS`);if(d!==void 0&&d!==`compact`&&d!==`der`)throw Error(`format must be compact or der`);let f=typeof a==`string`||Mo(a),p=!f&&!d&&typeof a==`object`&&!!a&&typeof a.r==`bigint`&&typeof a.s==`bigint`;if(!f&&!p)throw Error(`invalid signature, expected Uint8Array, hex string or Signature instance`);let m,h;try{if(p&&(m=new g(a.r,a.s)),f){try{d!==`compact`&&(m=g.fromDER(a))}catch(e){if(!(e instanceof lc.Err))throw e}!m&&d!==`der`&&(m=g.fromCompact(a))}h=c.fromHex(r)}catch{return!1}if(!m||l&&m.hasHighS())return!1;u&&(n=t.hash(n));let{r:_,s:v}=m,y=ee(n),b=s(v),x=o(y*b),S=o(_*b),C=c.BASE.multiplyAndAddUnsafe(h,x,S)?.toAffine();return C?o(C.x)===_:!1}return{CURVE:t,getPublicKey:v,getSharedSecret:b,sign:D,verify:O,ProjectivePoint:c,Signature:g,utils:_}}function gc(e){return{hash:e,hmac:(t,...n)=>mo(e,t,xi(...n)),randomBytes:wi}}function _c(e,t){let n=t=>hc({...e,...gc(t)});return{...n(t),create:n}}var vc=As(BigInt(`0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff`)),yc=_c({a:vc.create(BigInt(`-3`)),b:BigInt(`0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b`),Fp:vc,n:BigInt(`0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551`),Gx:BigInt(`0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296`),Gy:BigInt(`0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5`),h:BigInt(1),lowS:!1},Oo),bc=`base10`,xc=`base16`,Sc=`base64pad`,Cc=`base64url`,wc=`utf8`,Tc=0,Ec=1,Dc=12,Oc=32;function kc(){let e=ic.utils.randomPrivateKey(),t=ic.getPublicKey(e);return{privateKey:he(e,xc),publicKey:he(t,xc)}}function Ac(){return he(wi(Oc),xc)}function jc(e,t){return he(yo(Oo,ic.getSharedSecret(le(e,xc),le(t,xc)),void 0,void 0,Oc),xc)}function Mc(e){return he(Oo(le(e,xc)),xc)}function Nc(e){return he(Oo(le(e,wc)),xc)}function Pc(e){return le(`${e}`,bc)}function Fc(e){return Number(he(e,bc))}function Ic(e){return e.replace(/\+/g,`-`).replace(/\//g,`_`).replace(/=/g,``)}function Lc(e){let t=e.replace(/-/g,`+`).replace(/_/g,`/`),n=(4-t.length%4)%4;return t+`=`.repeat(n)}function Rc(e){let t=Pc(typeof e.type<`u`?e.type:0);if(Fc(t)===1&&typeof e.senderPublicKey>`u`)throw Error(`Missing sender public key for type 1 envelope`);let n=typeof e.senderPublicKey<`u`?le(e.senderPublicKey,xc):void 0,r=typeof e.iv<`u`?le(e.iv,xc):wi(Dc),i=Hc({type:t,sealed:fo(le(e.symKey,xc),r).encrypt(le(e.message,wc)),iv:r,senderPublicKey:n});return e.encoding===`base64url`?Ic(i):i}function zc(e){let t=le(e.symKey,xc),{sealed:n,iv:r}=Uc({encoded:e.encoded,encoding:e.encoding}),i=fo(t,r).decrypt(n);if(i===null)throw Error(`Failed to decrypt`);return he(i,wc)}function Bc(e,t){let n=Pc(2),r=wi(Dc),i=Hc({type:n,sealed:le(e,wc),iv:r});return t===`base64url`?Ic(i):i}function Vc(e,t){let{sealed:n}=Uc({encoded:e,encoding:t});return he(n,wc)}function Hc(e){if(Fc(e.type)===2)return he(re([e.type,e.sealed]),Sc);if(Fc(e.type)===1){if(typeof e.senderPublicKey>`u`)throw Error(`Missing sender public key for type 1 envelope`);return he(re([e.type,e.senderPublicKey,e.iv,e.sealed]),Sc)}return he(re([e.type,e.iv,e.sealed]),Sc)}function Uc(e){let t=le((e.encoding||`base64pad`)===`base64url`?Lc(e.encoded):e.encoded,Sc),n=t.slice(Tc,Ec),r=Ec;if(Fc(n)===1){let e=r+Oc,i=e+Dc,a=t.slice(r,e),o=t.slice(e,i);return{type:n,sealed:t.slice(i),iv:o,senderPublicKey:a}}if(Fc(n)===2)return{type:n,sealed:t.slice(r),iv:wi(Dc)};let i=r+Dc,a=t.slice(r,i);return{type:n,sealed:t.slice(i),iv:a}}function Wc(e,t){let n=Uc({encoded:e,encoding:t?.encoding});return Gc({type:Fc(n.type),senderPublicKey:typeof n.senderPublicKey<`u`?he(n.senderPublicKey,xc):void 0,receiverPublicKey:t?.receiverPublicKey})}function Gc(e){let t=e?.type||0;if(t===1){if(typeof e?.senderPublicKey>`u`)throw Error(`missing sender public key`);if(typeof e?.receiverPublicKey>`u`)throw Error(`missing receiver public key`)}return{type:t,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function Kc(e){return e.type===1&&typeof e.senderPublicKey==`string`&&typeof e.receiverPublicKey==`string`}function qc(e){return e.type===2}function Jc(e){let t=Buffer.from(e.x,`base64`),n=Buffer.from(e.y,`base64`);return re([new Uint8Array([4]),t,n])}function Yc(e,t){let[n,r,i]=e.split(`.`),a=Buffer.from(Lc(i),`base64`);if(a.length!==64)throw Error(`Invalid signature length`);let o=a.slice(0,32),s=a.slice(32,64),c=Oo(`${n}.${r}`),l=Jc(t);if(!yc.verify(re([o,s]),c,l))throw Error(`Invalid signature`);return oe(e).payload}function Xc(e){return e?.relay||{protocol:`irn`}}function Zc(e){let t=fe[e];if(typeof t>`u`)throw Error(`Relay Protocol not supported: ${e}`);return t}function Qc(e,t=`-`){let n={},r=`relay`+t;return Object.keys(e).forEach(t=>{if(t.startsWith(r)){let i=t.replace(r,``);n[i]=e[t]}}),n}function $c(e){if(!e.includes(`wc:`)){let t=Xr(e);t!=null&&t.includes(`wc:`)&&(e=t)}e=e.includes(`wc://`)?e.replace(`wc://`,``):e,e=e.includes(`wc:`)?e.replace(`wc:`,``):e;let t=e.indexOf(`:`),n=e.indexOf(`?`)===-1?void 0:e.indexOf(`?`),r=e.substring(0,t),i=e.substring(t+1,n).split(`@`),a=typeof n<`u`?e.substring(n):``,o=new URLSearchParams(a),s={};o.forEach((e,t)=>{s[t]=e});let c=typeof s.methods==`string`?s.methods.split(`,`):void 0;return{protocol:r,topic:el(i[0]),version:parseInt(i[1],10),symKey:s.symKey,relay:Qc(s),methods:c,expiryTimestamp:s.expiryTimestamp?parseInt(s.expiryTimestamp,10):void 0}}function el(e){return e.startsWith(`//`)?e.substring(2):e}function tl(e,t=`-`){let n={};return Object.keys(e).forEach(r=>{let i=r,a=`relay`+t+i;e[i]&&(n[a]=e[i])}),n}function nl(e){let t=new URLSearchParams,n=tl(e.relay);Object.keys(n).sort().forEach(e=>{t.set(e,n[e])}),t.set(`symKey`,e.symKey),e.expiryTimestamp&&t.set(`expiryTimestamp`,e.expiryTimestamp.toString()),e.methods&&t.set(`methods`,e.methods.join(`,`));let r=t.toString();return`${e.protocol}:${e.topic}@${e.version}?${r}`}function rl(e,t,n){return`${e}?wc_ev=${n}&topic=${t}`}var il=Object.defineProperty,al=Object.defineProperties,ol=Object.getOwnPropertyDescriptors,sl=Object.getOwnPropertySymbols,cl=Object.prototype.hasOwnProperty,ll=Object.prototype.propertyIsEnumerable,ul=(e,t,n)=>t in e?il(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,dl=(e,t)=>{for(var n in t||={})cl.call(t,n)&&ul(e,n,t[n]);if(sl)for(var n of sl(t))ll.call(t,n)&&ul(e,n,t[n]);return e},fl=(e,t)=>al(e,ol(t));function pl(e){let t=[];return e.forEach(e=>{let[n,r]=e.split(`:`);t.push(`${n}:${r}`)}),t}function ml(e){let t=[];return Object.values(e).forEach(e=>{t.push(...pl(e.accounts))}),t}function hl(e,t){let n=[];return Object.values(e).forEach(e=>{pl(e.accounts).includes(t)&&n.push(...e.methods)}),n}function gl(e,t){let n=[];return Object.values(e).forEach(e=>{pl(e.accounts).includes(t)&&n.push(...e.events)}),n}function _l(e){return e.includes(`:`)}function vl(e){return _l(e)?e.split(`:`)[0]:e}function yl(e){let t={};if(!El(e))return t;for(let[n,r]of Object.entries(e)){let e=_l(n)?[n]:r.chains,i=r.methods||[],a=r.events||[],o=vl(n);t[o]=fl(dl({},t[o]),{chains:zr(e,t[o]?.chains),methods:zr(i,t[o]?.methods),events:zr(a,t[o]?.events)})}return t}function bl(e){let t={};return e?.forEach(e=>{var n;let[r,i]=e.split(`:`);t[r]||(t[r]={accounts:[],chains:[],events:[],methods:[]}),t[r].accounts.push(e),(n=t[r].chains)==null||n.push(`${r}:${i}`)}),t}function xl(e,t){t=t.map(e=>e.replace(`did:pkh:`,``));let n=bl(t);for(let[t,r]of Object.entries(n))r.methods?r.methods=zr(r.methods,e):r.methods=e,r.events=[`chainChanged`,`accountsChanged`];return n}function Sl(e,t){let n=yl(e),r=yl(t),i={},a=Object.keys(n).concat(Object.keys(r));for(let e of a)i[e]={chains:zr(n[e]?.chains,r[e]?.chains),methods:zr(n[e]?.methods,r[e]?.methods),events:zr(n[e]?.events,r[e]?.events)};return i}var Cl={INVALID_METHOD:{message:`Invalid method.`,code:1001},INVALID_EVENT:{message:`Invalid event.`,code:1002},INVALID_UPDATE_REQUEST:{message:`Invalid update request.`,code:1003},INVALID_EXTEND_REQUEST:{message:`Invalid extend request.`,code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:`Invalid session settle request.`,code:1005},UNAUTHORIZED_METHOD:{message:`Unauthorized method.`,code:3001},UNAUTHORIZED_EVENT:{message:`Unauthorized event.`,code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:`Unauthorized update request.`,code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:`Unauthorized extend request.`,code:3004},USER_REJECTED:{message:`User rejected.`,code:5e3},USER_REJECTED_CHAINS:{message:`User rejected chains.`,code:5001},USER_REJECTED_METHODS:{message:`User rejected methods.`,code:5002},USER_REJECTED_EVENTS:{message:`User rejected events.`,code:5003},UNSUPPORTED_CHAINS:{message:`Unsupported chains.`,code:5100},UNSUPPORTED_METHODS:{message:`Unsupported methods.`,code:5101},UNSUPPORTED_EVENTS:{message:`Unsupported events.`,code:5102},UNSUPPORTED_ACCOUNTS:{message:`Unsupported accounts.`,code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:`Unsupported namespace key.`,code:5104},USER_DISCONNECTED:{message:`User disconnected.`,code:6e3},SESSION_SETTLEMENT_FAILED:{message:`Session settlement failed.`,code:7e3},WC_METHOD_UNSUPPORTED:{message:`Unsupported wc_ method.`,code:10001}},wl={NOT_INITIALIZED:{message:`Not initialized.`,code:1},NO_MATCHING_KEY:{message:`No matching key.`,code:2},RESTORE_WILL_OVERRIDE:{message:`Restore will override.`,code:3},RESUBSCRIBED:{message:`Resubscribed.`,code:4},MISSING_OR_INVALID:{message:`Missing or invalid.`,code:5},EXPIRED:{message:`Expired.`,code:6},UNKNOWN_TYPE:{message:`Unknown type.`,code:7},MISMATCHED_TOPIC:{message:`Mismatched topic.`,code:8},NON_CONFORMING_NAMESPACES:{message:`Non conforming namespaces.`,code:9}};function V(e,t){let{message:n,code:r}=wl[e];return{message:t?`${n} ${t}`:n,code:r}}function H(e,t){let{message:n,code:r}=Cl[e];return{message:t?`${n} ${t}`:n,code:r}}function Tl(e,t){return Array.isArray(e)?typeof t<`u`&&e.length?e.every(t):!0:!1}function El(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function Dl(e){return typeof e>`u`}function Ol(e,t){return t&&Dl(e)?!0:typeof e==`string`&&!!e.trim().length}function kl(e,t){return t&&Dl(e)?!0:typeof e==`number`&&!isNaN(e)}function Al(e,t){let{requiredNamespaces:n}=t,r=Object.keys(e.namespaces),i=Object.keys(n),a=!0;return Or(i,r)?(r.forEach(t=>{let{accounts:r,methods:i,events:o}=e.namespaces[t],s=pl(r),c=n[t];(!Or(rr(t,c),s)||!Or(c.methods,i)||!Or(c.events,o))&&(a=!1)}),a):!1}function jl(e){return Ol(e,!1)&&e.includes(`:`)?e.split(`:`).length===2:!1}function Ml(e){if(Ol(e,!1)&&e.includes(`:`)){let t=e.split(`:`);if(t.length===3){let e=t[0]+`:`+t[1];return!!t[2]&&jl(e)}}return!1}function Nl(e){function t(e){try{return typeof new URL(e)<`u`}catch{return!1}}try{if(Ol(e,!1))return t(e)?!0:t(Xr(e))}catch{}return!1}function Pl(e){return e?.proposer?.publicKey}function Fl(e){return e?.topic}function Il(e,t){let n=null;return Ol(e?.publicKey,!1)||(n=V(`MISSING_OR_INVALID`,`${t} controller public key should be a string`)),n}function Ll(e){let t=!0;return Tl(e)?e.length&&(t=e.every(e=>Ol(e,!1))):t=!1,t}function Rl(e,t,n){let r=null;return Tl(t)&&t.length?t.forEach(e=>{r||jl(e)||(r=H(`UNSUPPORTED_CHAINS`,`${n}, chain ${e} should be a string and conform to "namespace:chainId" format`))}):jl(e)||(r=H(`UNSUPPORTED_CHAINS`,`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function zl(e,t,n){let r=null;return Object.entries(e).forEach(([e,i])=>{if(r)return;let a=Rl(e,rr(e,i),`${t} ${n}`);a&&(r=a)}),r}function Bl(e,t){let n=null;return Tl(e)?e.forEach(e=>{n||Ml(e)||(n=H(`UNSUPPORTED_ACCOUNTS`,`${t}, account ${e} should be a string and conform to "namespace:chainId:address" format`))}):n=H(`UNSUPPORTED_ACCOUNTS`,`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function Vl(e,t){let n=null;return Object.values(e).forEach(e=>{if(n)return;let r=Bl(e?.accounts,`${t} namespace`);r&&(n=r)}),n}function Hl(e,t){let n=null;return Ll(e?.methods)?Ll(e?.events)||(n=H(`UNSUPPORTED_EVENTS`,`${t}, events should be an array of strings or empty array for no events`)):n=H(`UNSUPPORTED_METHODS`,`${t}, methods should be an array of strings or empty array for no methods`),n}function Ul(e,t){let n=null;return Object.values(e).forEach(e=>{if(n)return;let r=Hl(e,`${t}, namespace`);r&&(n=r)}),n}function Wl(e,t,n){let r=null;if(e&&El(e)){let i=Ul(e,t);i&&(r=i);let a=zl(e,t,n);a&&(r=a)}else r=V(`MISSING_OR_INVALID`,`${t}, ${n} should be an object with data`);return r}function Gl(e,t){let n=null;if(e&&El(e)){let r=Ul(e,t);r&&(n=r);let i=Vl(e,t);i&&(n=i)}else n=V(`MISSING_OR_INVALID`,`${t}, namespaces should be an object with data`);return n}function Kl(e){return Ol(e.protocol,!0)}function ql(e,t){let n=!1;return t&&!e?n=!0:e&&Tl(e)&&e.length&&e.forEach(e=>{n=Kl(e)}),n}function Jl(e){return typeof e==`number`}function Yl(e){return typeof e<`u`&&!0}function Xl(e){return!(!e||typeof e!=`object`||!e.code||!kl(e.code,!1)||!e.message||!Ol(e.message,!1))}function Zl(e){return!(Dl(e)||!Ol(e.method,!1))}function Ql(e){return!(Dl(e)||Dl(e.result)&&Dl(e.error)||!kl(e.id,!1)||!Ol(e.jsonrpc,!1))}function $l(e){return!(Dl(e)||!Ol(e.name,!1))}function eu(e,t){return!(!jl(t)||!ml(e).includes(t))}function tu(e,t,n){return Ol(n,!1)?hl(e,t).includes(n):!1}function nu(e,t,n){return Ol(n,!1)?gl(e,t).includes(n):!1}function ru(e,t,n){let r=null,i=iu(e),a=ou(t),o=Object.keys(i),s=Object.keys(a),c=au(Object.keys(e)),l=au(Object.keys(t)),u=c.filter(e=>!l.includes(e));return u.length&&(r=V(`NON_CONFORMING_NAMESPACES`,`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(t).toString()}`)),Or(o,s)||(r=V(`NON_CONFORMING_NAMESPACES`,`${n} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${s.toString()}`)),Object.keys(t).forEach(e=>{if(!e.includes(`:`)||r)return;let i=pl(t[e].accounts);i.includes(e)||(r=V(`NON_CONFORMING_NAMESPACES`,`${n} namespaces accounts don't satisfy namespace accounts for ${e}
        Required: ${e}
        Approved: ${i.toString()}`))}),o.forEach(e=>{r||(Or(i[e].methods,a[e].methods)?Or(i[e].events,a[e].events)||(r=V(`NON_CONFORMING_NAMESPACES`,`${n} namespaces events don't satisfy namespace events for ${e}`)):r=V(`NON_CONFORMING_NAMESPACES`,`${n} namespaces methods don't satisfy namespace methods for ${e}`))}),r}function iu(e){let t={};return Object.keys(e).forEach(n=>{var r;n.includes(`:`)?t[n]=e[n]:(r=e[n].chains)==null||r.forEach(r=>{t[r]={methods:e[n].methods,events:e[n].events}})}),t}function au(e){return[...new Set(e.map(e=>e.includes(`:`)?e.split(`:`)[0]:e))]}function ou(e){let t={};return Object.keys(e).forEach(n=>{n.includes(`:`)?t[n]=e[n]:pl(e[n].accounts)?.forEach(r=>{t[r]={accounts:e[n].accounts.filter(e=>e.includes(`${r}:`)),methods:e[n].methods,events:e[n].events}})}),t}function su(e,t){return kl(e,!1)&&e<=t.max&&e>=t.min}function cu(){let e=yr();return new Promise(t=>{switch(e){case pr.browser:t(lu());break;case pr.reactNative:t(uu());break;case pr.node:t(du());break;default:t(!0)}})}function lu(){return vr()&&navigator?.onLine}async function uu(){return hr()&&typeof global<`u`&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function du(){return!0}function fu(e){switch(yr()){case pr.browser:pu(e);break;case pr.reactNative:mu(e);break;case pr.node:break}}function pu(e){!hr()&&vr()&&(window.addEventListener(`online`,()=>e(!0)),window.addEventListener(`offline`,()=>e(!1)))}function mu(e){hr()&&typeof global<`u`&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(t=>e(t?.isConnected))}function hu(){return vr()&&(0,Zn.getDocument)()?(0,Zn.getDocument)()?.visibilityState===`visible`:!0}var gu={},_u=class{static get(e){return gu[e]}static set(e,t){gu[e]=t}static delete(e){delete gu[e]}},vu=s(te()),U=ne(),yu=ge(),bu=`core`,xu=`wc@2:${bu}:`,Su={name:bu,logger:`error`},Cu={database:`:memory:`},wu=`crypto`,Tu=`client_ed25519_seed`,Eu=U.ONE_DAY,Du=`keychain`,Ou=`messages`,ku=U.SIX_HOURS,Au=`publisher`,ju=`relayer`,Mu={message:`relayer_message`,message_ack:`relayer_message_ack`,connect:`relayer_connect`,disconnect:`relayer_disconnect`,error:`relayer_error`,connection_stalled:`relayer_connection_stalled`,transport_closed:`relayer_transport_closed`,publish:`relayer_publish`},Nu={payload:`payload`,connect:`connect`,disconnect:`disconnect`,error:`error`},Pu=`2.21.0`,W={link_mode:`link_mode`,relay:`relay`},Fu={inbound:`inbound`,outbound:`outbound`},Iu=`WALLETCONNECT_CLIENT_ID`,Lu={created:`subscription_created`,deleted:`subscription_deleted`,expired:`subscription_expired`,disabled:`subscription_disabled`,sync:`subscription_sync`,resubscribed:`subscription_resubscribed`};U.THIRTY_DAYS;var Ru=`subscription`;U.FIVE_SECONDS*1e3;var zu=`pairing`;U.THIRTY_DAYS;var Bu={wc_pairingDelete:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:U.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:U.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:U.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:U.ONE_DAY,prompt:!1,tag:0},res:{ttl:U.ONE_DAY,prompt:!1,tag:0}}},Vu={create:`pairing_create`,expire:`pairing_expire`,delete:`pairing_delete`,ping:`pairing_ping`},Hu={created:`history_created`,updated:`history_updated`,deleted:`history_deleted`,sync:`history_sync`},Uu=`history`,Wu=`expirer`,Gu={created:`expirer_created`,deleted:`expirer_deleted`,expired:`expirer_expired`,sync:`expirer_sync`};U.ONE_DAY;var Ku=`verify-api`,qu=`https://verify.walletconnect.com`,Ju=`https://verify.walletconnect.org`,Yu=`${Ju}/v3`,Xu=[qu,Ju],Zu=`echo`,Qu=`https://echo.walletconnect.com`,$u={pairing_started:`pairing_started`,pairing_uri_validation_success:`pairing_uri_validation_success`,pairing_uri_not_expired:`pairing_uri_not_expired`,store_new_pairing:`store_new_pairing`,subscribing_pairing_topic:`subscribing_pairing_topic`,subscribe_pairing_topic_success:`subscribe_pairing_topic_success`,existing_pairing:`existing_pairing`,pairing_not_expired:`pairing_not_expired`,emit_inactive_pairing:`emit_inactive_pairing`,emit_session_proposal:`emit_session_proposal`,subscribing_to_pairing_topic:`subscribing_to_pairing_topic`},ed={no_wss_connection:`no_wss_connection`,no_internet_connection:`no_internet_connection`,malformed_pairing_uri:`malformed_pairing_uri`,active_pairing_already_exists:`active_pairing_already_exists`,subscribe_pairing_topic_failure:`subscribe_pairing_topic_failure`,pairing_expired:`pairing_expired`,proposal_expired:`proposal_expired`,proposal_listener_not_found:`proposal_listener_not_found`},td={session_approve_started:`session_approve_started`,proposal_not_expired:`proposal_not_expired`,session_namespaces_validation_success:`session_namespaces_validation_success`,create_session_topic:`create_session_topic`,subscribing_session_topic:`subscribing_session_topic`,subscribe_session_topic_success:`subscribe_session_topic_success`,publishing_session_approve:`publishing_session_approve`,session_approve_publish_success:`session_approve_publish_success`,store_session:`store_session`,publishing_session_settle:`publishing_session_settle`,session_settle_publish_success:`session_settle_publish_success`},nd={no_internet_connection:`no_internet_connection`,no_wss_connection:`no_wss_connection`,proposal_expired:`proposal_expired`,subscribe_session_topic_failure:`subscribe_session_topic_failure`,session_approve_publish_failure:`session_approve_publish_failure`,session_settle_publish_failure:`session_settle_publish_failure`,session_approve_namespace_validation_failure:`session_approve_namespace_validation_failure`,proposal_not_found:`proposal_not_found`},rd={authenticated_session_approve_started:`authenticated_session_approve_started`,authenticated_session_not_expired:`authenticated_session_not_expired`,chains_caip2_compliant:`chains_caip2_compliant`,chains_evm_compliant:`chains_evm_compliant`,create_authenticated_session_topic:`create_authenticated_session_topic`,cacaos_verified:`cacaos_verified`,store_authenticated_session:`store_authenticated_session`,subscribing_authenticated_session_topic:`subscribing_authenticated_session_topic`,subscribe_authenticated_session_topic_success:`subscribe_authenticated_session_topic_success`,publishing_authenticated_session_approve:`publishing_authenticated_session_approve`,authenticated_session_approve_publish_success:`authenticated_session_approve_publish_success`},id={no_internet_connection:`no_internet_connection`,no_wss_connection:`no_wss_connection`,missing_session_authenticate_request:`missing_session_authenticate_request`,session_authenticate_request_expired:`session_authenticate_request_expired`,chains_caip2_compliant_failure:`chains_caip2_compliant_failure`,chains_evm_compliant_failure:`chains_evm_compliant_failure`,invalid_cacao:`invalid_cacao`,subscribe_authenticated_session_topic_failure:`subscribe_authenticated_session_topic_failure`,authenticated_session_approve_publish_failure:`authenticated_session_approve_publish_failure`,authenticated_session_pending_request_not_found:`authenticated_session_pending_request_not_found`},ad=.1,od=`event-client`,sd=`https://pulse.walletconnect.org/batch`;function cd(e,t){if(e.length>=255)throw TypeError(`Alphabet too long`);for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var a=e.charAt(i),o=a.charCodeAt(0);if(n[o]!==255)throw TypeError(a+` is ambiguous`);n[o]=i}var s=e.length,c=e.charAt(0),l=Math.log(s)/Math.log(256),u=Math.log(256)/Math.log(s);function d(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError(`Expected Uint8Array`);if(t.length===0)return``;for(var n=0,r=0,i=0,a=t.length;i!==a&&t[i]===0;)i++,n++;for(var o=(a-i)*u+1>>>0,l=new Uint8Array(o);i!==a;){for(var d=t[i],f=0,p=o-1;(d!==0||f<r)&&p!==-1;p--,f++)d+=256*l[p]>>>0,l[p]=d%s>>>0,d=d/s>>>0;if(d!==0)throw Error(`Non-zero carry`);r=f,i++}for(var m=o-r;m!==o&&l[m]===0;)m++;for(var h=c.repeat(n);m<o;++m)h+=e.charAt(l[m]);return h}function f(e){if(typeof e!=`string`)throw TypeError(`Expected String`);if(e.length===0)return new Uint8Array;var t=0;if(e[t]!==` `){for(var r=0,i=0;e[t]===c;)r++,t++;for(var a=(e.length-t)*l+1>>>0,o=new Uint8Array(a);e[t];){var u=n[e.charCodeAt(t)];if(u===255)return;for(var d=0,f=a-1;(u!==0||d<i)&&f!==-1;f--,d++)u+=s*o[f]>>>0,o[f]=u%256>>>0,u=u/256>>>0;if(u!==0)throw Error(`Non-zero carry`);i=d,t++}if(e[t]!==` `){for(var p=a-i;p!==a&&o[p]===0;)p++;for(var m=new Uint8Array(r+(a-p)),h=r;p!==a;)m[h++]=o[p++];return m}}}function p(e){var n=f(e);if(n)return n;throw Error(`Non-${t} character`)}return{encode:d,decodeUnsafe:f,decode:p}}var ld=cd,ud=e=>{if(e instanceof Uint8Array&&e.constructor.name===`Uint8Array`)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error(`Unknown type, must be binary type`)},dd=e=>new TextEncoder().encode(e),fd=e=>new TextDecoder().decode(e),pd=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error(`Unknown type, must be binary type`)}},md=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw Error(`Invalid prefix character`);this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e==`string`){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error(`Can only multibase decode strings`)}or(e){return gd(this,e)}},hd=class{constructor(e){this.decoders=e}or(e){return gd(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},gd=(e,t)=>new hd({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}}),_d=class{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new pd(e,t,n),this.decoder=new md(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},vd=({name:e,prefix:t,encode:n,decode:r})=>new _d(e,t,n,r),yd=({prefix:e,name:t,alphabet:n})=>{let{encode:r,decode:i}=ld(n,t);return vd({prefix:e,name:t,encode:r,decode:e=>ud(i(e))})},bd=(e,t,n,r)=>{let i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let a=e.length;for(;e[a-1]===`=`;)--a;let o=new Uint8Array(a*n/8|0),s=0,c=0,l=0;for(let t=0;t<a;++t){let a=i[e[t]];if(a===void 0)throw SyntaxError(`Non-${r} character`);c=c<<n|a,s+=n,s>=8&&(s-=8,o[l++]=255&c>>s)}if(s>=n||255&c<<8-s)throw SyntaxError(`Unexpected end of data`);return o},xd=(e,t,n)=>{let r=t[t.length-1]===`=`,i=(1<<n)-1,a=``,o=0,s=0;for(let r=0;r<e.length;++r)for(s=s<<8|e[r],o+=8;o>n;)o-=n,a+=t[i&s>>o];if(o&&(a+=t[i&s<<n-o]),r)for(;a.length*n&7;)a+=`=`;return a},Sd=({name:e,prefix:t,bitsPerChar:n,alphabet:r})=>vd({prefix:t,name:e,encode(e){return xd(e,r,n)},decode(t){return bd(t,r,n,e)}}),Cd=vd({prefix:`\0`,name:`identity`,encode:e=>fd(e),decode:e=>dd(e)}),wd=Object.freeze({__proto__:null,identity:Cd}),Td=Sd({prefix:`0`,name:`base2`,alphabet:`01`,bitsPerChar:1}),Ed=Object.freeze({__proto__:null,base2:Td}),Dd=Sd({prefix:`7`,name:`base8`,alphabet:`01234567`,bitsPerChar:3}),Od=Object.freeze({__proto__:null,base8:Dd}),kd=yd({prefix:`9`,name:`base10`,alphabet:`0123456789`}),Ad=Object.freeze({__proto__:null,base10:kd}),jd=Sd({prefix:`f`,name:`base16`,alphabet:`0123456789abcdef`,bitsPerChar:4}),Md=Sd({prefix:`F`,name:`base16upper`,alphabet:`0123456789ABCDEF`,bitsPerChar:4}),Nd=Object.freeze({__proto__:null,base16:jd,base16upper:Md}),Pd=Sd({prefix:`b`,name:`base32`,alphabet:`abcdefghijklmnopqrstuvwxyz234567`,bitsPerChar:5}),Fd=Sd({prefix:`B`,name:`base32upper`,alphabet:`ABCDEFGHIJKLMNOPQRSTUVWXYZ234567`,bitsPerChar:5}),Id=Sd({prefix:`c`,name:`base32pad`,alphabet:`abcdefghijklmnopqrstuvwxyz234567=`,bitsPerChar:5}),Ld=Sd({prefix:`C`,name:`base32padupper`,alphabet:`ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=`,bitsPerChar:5}),Rd=Sd({prefix:`v`,name:`base32hex`,alphabet:`0123456789abcdefghijklmnopqrstuv`,bitsPerChar:5}),zd=Sd({prefix:`V`,name:`base32hexupper`,alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUV`,bitsPerChar:5}),Bd=Sd({prefix:`t`,name:`base32hexpad`,alphabet:`0123456789abcdefghijklmnopqrstuv=`,bitsPerChar:5}),Vd=Sd({prefix:`T`,name:`base32hexpadupper`,alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUV=`,bitsPerChar:5}),Hd=Sd({prefix:`h`,name:`base32z`,alphabet:`ybndrfg8ejkmcpqxot1uwisza345h769`,bitsPerChar:5}),Ud=Object.freeze({__proto__:null,base32:Pd,base32upper:Fd,base32pad:Id,base32padupper:Ld,base32hex:Rd,base32hexupper:zd,base32hexpad:Bd,base32hexpadupper:Vd,base32z:Hd}),Wd=yd({prefix:`k`,name:`base36`,alphabet:`0123456789abcdefghijklmnopqrstuvwxyz`}),Gd=yd({prefix:`K`,name:`base36upper`,alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ`}),Kd=Object.freeze({__proto__:null,base36:Wd,base36upper:Gd}),qd=yd({name:`base58btc`,prefix:`z`,alphabet:`123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz`}),Jd=yd({name:`base58flickr`,prefix:`Z`,alphabet:`123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ`}),Yd=Object.freeze({__proto__:null,base58btc:qd,base58flickr:Jd}),Xd=Sd({prefix:`m`,name:`base64`,alphabet:`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`,bitsPerChar:6}),Zd=Sd({prefix:`M`,name:`base64pad`,alphabet:`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=`,bitsPerChar:6}),Qd=Sd({prefix:`u`,name:`base64url`,alphabet:`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_`,bitsPerChar:6}),$d=Sd({prefix:`U`,name:`base64urlpad`,alphabet:`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=`,bitsPerChar:6}),ef=Object.freeze({__proto__:null,base64:Xd,base64pad:Zd,base64url:Qd,base64urlpad:$d}),tf=Array.from(``),nf=tf.reduce((e,t,n)=>(e[n]=t,e),[]),rf=tf.reduce((e,t,n)=>(e[t.codePointAt(0)]=n,e),[]);function af(e){return e.reduce((e,t)=>(e+=nf[t],e),``)}function of(e){let t=[];for(let n of e){let e=rf[n.codePointAt(0)];if(e===void 0)throw Error(`Non-base256emoji character: ${n}`);t.push(e)}return new Uint8Array(t)}var sf=vd({prefix:``,name:`base256emoji`,encode:af,decode:of}),cf=Object.freeze({__proto__:null,base256emoji:sf}),lf=pf,uf=128,df=-128,ff=2**31;function pf(e,t,n){t||=[],n||=0;for(var r=n;e>=ff;)t[n++]=e&255|uf,e/=128;for(;e&df;)t[n++]=e&255|uf,e>>>=7;return t[n]=e|0,pf.bytes=n-r+1,t}var mf=_f,hf=128,gf=127;function _f(e,t){var n=0,t=t||0,r=0,i=t,a,o=e.length;do{if(i>=o)throw _f.bytes=0,RangeError(`Could not decode varint`);a=e[i++],n+=r<28?(a&gf)<<r:(a&gf)*2**r,r+=7}while(a>=hf);return _f.bytes=i-t,n}var vf=2**7,yf=2**14,bf=2**21,xf=2**28,Sf=2**35,Cf=2**42,wf=2**49,Tf=2**56,Ef=2**63,Df={encode:lf,decode:mf,encodingLength:function(e){return e<vf?1:e<yf?2:e<bf?3:e<xf?4:e<Sf?5:e<Cf?6:e<wf?7:e<Tf?8:e<Ef?9:10}},Of=(e,t,n=0)=>(Df.encode(e,t,n),t),kf=e=>Df.encodingLength(e),Af=(e,t)=>{let n=t.byteLength,r=kf(e),i=r+kf(n),a=new Uint8Array(i+n);return Of(e,a,0),Of(n,a,r),a.set(t,i),new jf(e,n,t,a)},jf=class{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}},Mf=({name:e,code:t,encode:n})=>new Nf(e,t,n),Nf=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Af(this.code,t):t.then(e=>Af(this.code,e))}else throw Error(`Unknown type, must be binary type`)}},Pf=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Ff=Mf({name:`sha2-256`,code:18,encode:Pf(`SHA-256`)}),If=Mf({name:`sha2-512`,code:19,encode:Pf(`SHA-512`)}),Lf=Object.freeze({__proto__:null,sha256:Ff,sha512:If}),Rf=0,zf=`identity`,Bf=ud,Vf={code:Rf,name:zf,encode:Bf,digest:e=>Af(Rf,Bf(e))},Hf=Object.freeze({__proto__:null,identity:Vf});new TextEncoder,new TextDecoder;var Uf={...wd,...Ed,...Od,...Ad,...Nd,...Ud,...Kd,...Yd,...ef,...cf};({...Lf,...Hf});function Wf(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}function Gf(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}var Kf=Gf(`utf8`,`u`,e=>`u`+new TextDecoder(`utf8`).decode(e),e=>new TextEncoder().encode(e.substring(1))),qf=Gf(`ascii`,`a`,e=>{let t=`a`;for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},e=>{e=e.substring(1);let t=Wf(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}),Jf={utf8:Kf,"utf-8":Kf,hex:Uf.base16,latin1:qf,ascii:qf,binary:qf,...Uf};function Yf(e,t=`utf8`){let n=Jf[t];if(!n)throw Error(`Unsupported encoding "${t}"`);return(t===`utf8`||t===`utf-8`)&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e,`utf8`):n.decoder.decode(`${n.prefix}${e}`)}var Xf=Object.defineProperty,Zf=(e,t,n)=>t in e?Xf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Qf=(e,t,n)=>Zf(e,typeof t==`symbol`?t:t+``,n),$f=class{constructor(e,t){this.core=e,this.logger=t,Qf(this,`keychain`,new Map),Qf(this,`name`,Du),Qf(this,`version`,`0.3`),Qf(this,`initialized`,!1),Qf(this,`storagePrefix`,xu),Qf(this,`init`,async()=>{if(!this.initialized){let e=await this.getKeyChain();typeof e<`u`&&(this.keychain=e),this.initialized=!0}}),Qf(this,`has`,e=>(this.isInitialized(),this.keychain.has(e))),Qf(this,`set`,async(e,t)=>{this.isInitialized(),this.keychain.set(e,t),await this.persist()}),Qf(this,`get`,e=>{this.isInitialized();let t=this.keychain.get(e);if(typeof t>`u`){let{message:t}=V(`NO_MATCHING_KEY`,`${this.name}: ${e}`);throw Error(t)}return t}),Qf(this,`del`,async e=>{this.isInitialized(),this.keychain.delete(e),await this.persist()}),this.core=e,this.logger=be(t,this.name)}get context(){return Se(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+`//`+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,kr(e))}async getKeyChain(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<`u`?Ar(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}},ep=Object.defineProperty,tp=(e,t,n)=>t in e?ep(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,np=(e,t,n)=>tp(e,typeof t==`symbol`?t:t+``,n),rp=class{constructor(e,t,n){this.core=e,this.logger=t,np(this,`name`,wu),np(this,`keychain`),np(this,`randomSessionIdentifier`,Ac()),np(this,`initialized`,!1),np(this,`init`,async()=>{this.initialized||=(await this.keychain.init(),!0)}),np(this,`hasKeys`,e=>(this.isInitialized(),this.keychain.has(e))),np(this,`getClientId`,async()=>(this.isInitialized(),ve(ue(await this.getClientSeed()).publicKey))),np(this,`generateKeyPair`,()=>{this.isInitialized();let e=kc();return this.setPrivateKey(e.publicKey,e.privateKey)}),np(this,`signJWT`,async e=>{this.isInitialized();let t=ue(await this.getClientSeed()),n=this.randomSessionIdentifier;return await ae(n,e,Eu,t)}),np(this,`generateSharedKey`,(e,t,n)=>{this.isInitialized();let r=jc(this.getPrivateKey(e),t);return this.setSymKey(r,n)}),np(this,`setSymKey`,async(e,t)=>{this.isInitialized();let n=t||Mc(e);return await this.keychain.set(n,e),n}),np(this,`deleteKeyPair`,async e=>{this.isInitialized(),await this.keychain.del(e)}),np(this,`deleteSymKey`,async e=>{this.isInitialized(),await this.keychain.del(e)}),np(this,`encode`,async(e,t,n)=>{this.isInitialized();let r=Gc(n),i=ye(t);if(qc(r))return Bc(i,n?.encoding);if(Kc(r)){let t=r.senderPublicKey,n=r.receiverPublicKey;e=await this.generateSharedKey(t,n)}let a=this.getSymKey(e),{type:o,senderPublicKey:s}=r;return Rc({type:o,symKey:a,message:i,senderPublicKey:s,encoding:n?.encoding})}),np(this,`decode`,async(e,t,n)=>{this.isInitialized();let r=Wc(t,n);if(qc(r))return Fe(Vc(t,n?.encoding));if(Kc(r)){let t=r.receiverPublicKey,n=r.senderPublicKey;e=await this.generateSharedKey(t,n)}try{return Fe(zc({symKey:this.getSymKey(e),encoded:t,encoding:n?.encoding}))}catch(t){this.logger.error(`Failed to decode message from topic: '${e}', clientId: '${await this.getClientId()}'`),this.logger.error(t)}}),np(this,`getPayloadType`,(e,t=Sc)=>Fc(Uc({encoded:e,encoding:t}).type)),np(this,`getPayloadSenderPublicKey`,(e,t=Sc)=>{let n=Uc({encoded:e,encoding:t});return n.senderPublicKey?he(n.senderPublicKey,xc):void 0}),this.core=e,this.logger=be(t,this.name),this.keychain=n||new $f(this.core,this.logger)}get context(){return Se(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e=``;try{e=this.keychain.get(Tu)}catch{e=Ac(),await this.keychain.set(Tu,e)}return Yf(e,`base16`)}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}},ip=Object.defineProperty,ap=Object.defineProperties,op=Object.getOwnPropertyDescriptors,sp=Object.getOwnPropertySymbols,cp=Object.prototype.hasOwnProperty,lp=Object.prototype.propertyIsEnumerable,up=(e,t,n)=>t in e?ip(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,dp=(e,t)=>{for(var n in t||={})cp.call(t,n)&&up(e,n,t[n]);if(sp)for(var n of sp(t))lp.call(t,n)&&up(e,n,t[n]);return e},fp=(e,t)=>ap(e,op(t)),pp=(e,t,n)=>up(e,typeof t==`symbol`?t:t+``,n),mp=class extends Ot{constructor(e,t){super(e,t),this.logger=e,this.core=t,pp(this,`messages`,new Map),pp(this,`messagesWithoutClientAck`,new Map),pp(this,`name`,Ou),pp(this,`version`,`0.3`),pp(this,`initialized`,!1),pp(this,`storagePrefix`,xu),pp(this,`init`,async()=>{if(!this.initialized){this.logger.trace(`Initialized`);try{let e=await this.getRelayerMessages();typeof e<`u`&&(this.messages=e);let t=await this.getRelayerMessagesWithoutClientAck();typeof t<`u`&&(this.messagesWithoutClientAck=t),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:`method`,method:`restore`,size:this.messages.size})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}finally{this.initialized=!0}}}),pp(this,`set`,async(e,t,n)=>{this.isInitialized();let r=Nc(t),i=this.messages.get(e);if(typeof i>`u`&&(i={}),typeof i[r]<`u`)return r;if(i[r]=t,this.messages.set(e,i),n===Fu.inbound){let n=this.messagesWithoutClientAck.get(e)||{};this.messagesWithoutClientAck.set(e,fp(dp({},n),{[r]:t}))}return await this.persist(),r}),pp(this,`get`,e=>{this.isInitialized();let t=this.messages.get(e);return typeof t>`u`&&(t={}),t}),pp(this,`getWithoutAck`,e=>{this.isInitialized();let t={};for(let n of e){let e=this.messagesWithoutClientAck.get(n)||{};t[n]=Object.values(e)}return t}),pp(this,`has`,(e,t)=>(this.isInitialized(),typeof this.get(e)[Nc(t)]<`u`)),pp(this,`ack`,async(e,t)=>{this.isInitialized();let n=this.messagesWithoutClientAck.get(e);if(typeof n>`u`)return;let r=Nc(t);delete n[r],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(e):this.messagesWithoutClientAck.set(e,n),await this.persist()}),pp(this,`del`,async e=>{this.isInitialized(),this.messages.delete(e),this.messagesWithoutClientAck.delete(e),await this.persist()}),this.logger=be(e,this.name),this.core=t}get context(){return Se(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+`//`+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+`//`+this.name+`_withoutClientAck`}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,kr(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,kr(e))}async getRelayerMessages(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<`u`?Ar(e):void 0}async getRelayerMessagesWithoutClientAck(){let e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<`u`?Ar(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}},hp=Object.defineProperty,gp=Object.defineProperties,_p=Object.getOwnPropertyDescriptors,vp=Object.getOwnPropertySymbols,yp=Object.prototype.hasOwnProperty,bp=Object.prototype.propertyIsEnumerable,xp=(e,t,n)=>t in e?hp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Sp=(e,t)=>{for(var n in t||={})yp.call(t,n)&&xp(e,n,t[n]);if(vp)for(var n of vp(t))bp.call(t,n)&&xp(e,n,t[n]);return e},Cp=(e,t)=>gp(e,_p(t)),wp=(e,t,n)=>xp(e,typeof t==`symbol`?t:t+``,n),Tp=class extends kt{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,wp(this,`events`,new vu.EventEmitter),wp(this,`name`,Au),wp(this,`queue`,new Map),wp(this,`publishTimeout`,(0,U.toMiliseconds)(U.ONE_MINUTE)),wp(this,`initialPublishTimeout`,(0,U.toMiliseconds)(U.ONE_SECOND*15)),wp(this,`needsTransportRestart`,!1),wp(this,`publish`,async(e,t,n)=>{var r;this.logger.debug(`Publishing Payload`),this.logger.trace({type:`method`,method:`publish`,params:{topic:e,message:t,opts:n}});let i=n?.ttl||ku,a=Xc(n),o=n?.prompt||!1,s=n?.tag||0,c=n?.id||Ae().toString(),l={topic:e,message:t,opts:{ttl:i,relay:a,prompt:o,tag:s,id:c,attestation:n?.attestation,tvf:n?.tvf}},u=`Failed to publish payload, please try again. id:${c} tag:${s}`;try{let r=new Promise(async r=>{let a=({id:e})=>{l.opts.id===e&&(this.removeRequestFromQueue(e),this.relayer.events.removeListener(Mu.publish,a),r(l))};this.relayer.events.on(Mu.publish,a);let u=Mr(new Promise((r,a)=>{this.rpcPublish({topic:e,message:t,ttl:i,prompt:o,tag:s,id:c,attestation:n?.attestation,tvf:n?.tvf}).then(r).catch(e=>{this.logger.warn(e,e?.message),a(e)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${c} tag:${s}`);try{await u,this.events.removeListener(Mu.publish,a)}catch(e){this.queue.set(c,Cp(Sp({},l),{attempt:1})),this.logger.warn(e,e?.message)}});this.logger.trace({type:`method`,method:`publish`,params:{id:c,topic:e,message:t,opts:n}}),await Mr(r,this.publishTimeout,u)}catch(e){if(this.logger.debug(`Failed to Publish Payload`),this.logger.error(e),(r=n?.internal)!=null&&r.throwOnFailedPublish)throw e}finally{this.queue.delete(c)}}),wp(this,`on`,(e,t)=>{this.events.on(e,t)}),wp(this,`once`,(e,t)=>{this.events.once(e,t)}),wp(this,`off`,(e,t)=>{this.events.off(e,t)}),wp(this,`removeListener`,(e,t)=>{this.events.removeListener(e,t)}),this.relayer=e,this.logger=be(t,this.name),this.registerEventListeners()}get context(){return Se(this.logger)}async rpcPublish(e){var t,n;let{topic:r,message:i,ttl:a=ku,prompt:o,tag:s,id:c,attestation:l,tvf:u}=e,d={method:Zc(Xc().protocol).publish,params:Sp({topic:r,message:i,ttl:a,prompt:o,tag:s,attestation:l},u),id:c};Dl(d.params?.prompt)&&((t=d.params)==null||delete t.prompt),Dl(d.params?.tag)&&((n=d.params)==null||delete n.tag),this.logger.debug(`Outgoing Relay Payload`),this.logger.trace({type:`message`,direction:`outgoing`,request:d});let f=await this.relayer.request(d);return this.relayer.events.emit(Mu.publish,e),this.logger.debug(`Successfully Published Payload`),f}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{let n=e.attempt+1;this.queue.set(t,Cp(Sp({},e),{attempt:n}));let{topic:r,message:i,opts:a,attestation:o}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${n}`),await this.rpcPublish(Cp(Sp({},e),{topic:r,message:i,ttl:a.ttl,prompt:a.prompt,tag:a.tag,id:a.id,attestation:o,tvf:a.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(ce.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Mu.connection_stalled);return}this.checkQueue()}),this.relayer.on(Mu.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}},Ep=Object.defineProperty,Dp=(e,t,n)=>t in e?Ep(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Op=(e,t,n)=>Dp(e,typeof t==`symbol`?t:t+``,n),kp=class{constructor(){Op(this,`map`,new Map),Op(this,`set`,(e,t)=>{let n=this.get(e);this.exists(e,t)||this.map.set(e,[...n,t])}),Op(this,`get`,e=>this.map.get(e)||[]),Op(this,`exists`,(e,t)=>this.get(e).includes(t)),Op(this,`delete`,(e,t)=>{if(typeof t>`u`){this.map.delete(e);return}if(!this.map.has(e))return;let n=this.get(e);if(!this.exists(e,t))return;let r=n.filter(e=>e!==t);if(!r.length){this.map.delete(e);return}this.map.set(e,r)}),Op(this,`clear`,()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}},Ap=Object.defineProperty,jp=Object.defineProperties,Mp=Object.getOwnPropertyDescriptors,Np=Object.getOwnPropertySymbols,Pp=Object.prototype.hasOwnProperty,Fp=Object.prototype.propertyIsEnumerable,Ip=(e,t,n)=>t in e?Ap(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Lp=(e,t)=>{for(var n in t||={})Pp.call(t,n)&&Ip(e,n,t[n]);if(Np)for(var n of Np(t))Fp.call(t,n)&&Ip(e,n,t[n]);return e},Rp=(e,t)=>jp(e,Mp(t)),G=(e,t,n)=>Ip(e,typeof t==`symbol`?t:t+``,n),zp=class extends Mt{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,G(this,`subscriptions`,new Map),G(this,`topicMap`,new kp),G(this,`events`,new vu.EventEmitter),G(this,`name`,Ru),G(this,`version`,`0.3`),G(this,`pending`,new Map),G(this,`cached`,[]),G(this,`initialized`,!1),G(this,`storagePrefix`,xu),G(this,`subscribeTimeout`,(0,U.toMiliseconds)(U.ONE_MINUTE)),G(this,`initialSubscribeTimeout`,(0,U.toMiliseconds)(U.ONE_SECOND*15)),G(this,`clientId`),G(this,`batchSubscribeTopicsLimit`,500),G(this,`init`,async()=>{this.initialized||(this.logger.trace(`Initialized`),this.registerEventListeners(),await this.restore()),this.initialized=!0}),G(this,`subscribe`,async(e,t)=>{this.isInitialized(),this.logger.debug(`Subscribing Topic`),this.logger.trace({type:`method`,method:`subscribe`,params:{topic:e,opts:t}});try{let n=Xc(t),r={topic:e,relay:n,transportType:t?.transportType};this.pending.set(e,r);let i=await this.rpcSubscribe(e,n,t);return typeof i==`string`&&(this.onSubscribe(i,r),this.logger.debug(`Successfully Subscribed Topic`),this.logger.trace({type:`method`,method:`subscribe`,params:{topic:e,opts:t}})),i}catch(e){throw this.logger.debug(`Failed to Subscribe Topic`),this.logger.error(e),e}}),G(this,`unsubscribe`,async(e,t)=>{this.isInitialized(),typeof t?.id<`u`?await this.unsubscribeById(e,t.id,t):await this.unsubscribeByTopic(e,t)}),G(this,`isSubscribed`,e=>new Promise(t=>{t(this.topicMap.topics.includes(e))})),G(this,`isKnownTopic`,e=>new Promise(t=>{t(this.topicMap.topics.includes(e)||this.pending.has(e)||this.cached.some(t=>t.topic===e))})),G(this,`on`,(e,t)=>{this.events.on(e,t)}),G(this,`once`,(e,t)=>{this.events.once(e,t)}),G(this,`off`,(e,t)=>{this.events.off(e,t)}),G(this,`removeListener`,(e,t)=>{this.events.removeListener(e,t)}),G(this,`start`,async()=>{await this.onConnect()}),G(this,`stop`,async()=>{await this.onDisconnect()}),G(this,`restart`,async()=>{await this.restore(),await this.onRestart()}),G(this,`checkPending`,async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;let e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}),G(this,`registerEventListeners`,()=>{this.relayer.core.heartbeat.on(ce.pulse,async()=>{await this.checkPending()}),this.events.on(Lu.created,async e=>{let t=Lu.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,data:e}),await this.persist()}),this.events.on(Lu.deleted,async e=>{let t=Lu.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,data:e}),await this.persist()})}),this.relayer=e,this.logger=be(t,this.name),this.clientId=``}get context(){return Se(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+`//`+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let n=!1;try{n=this.getSubscription(e).topic===t}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){let n=this.topicMap.get(e);await Promise.all(n.map(async n=>await this.unsubscribeById(e,n,t)))}async unsubscribeById(e,t,n){this.logger.debug(`Unsubscribing Topic`),this.logger.trace({type:`method`,method:`unsubscribe`,params:{topic:e,id:t,opts:n}});try{let r=Xc(n);await this.restartToComplete({topic:e,id:t,relay:r}),await this.rpcUnsubscribe(e,t,r);let i=H(`USER_DISCONNECTED`,`${this.name}, ${e}`);await this.onUnsubscribe(e,t,i),this.logger.debug(`Successfully Unsubscribed Topic`),this.logger.trace({type:`method`,method:`unsubscribe`,params:{topic:e,id:t,opts:n}})}catch(e){throw this.logger.debug(`Failed to Unsubscribe Topic`),this.logger.error(e),e}}async rpcSubscribe(e,t,n){(!n||n?.transportType===W.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});let r={method:Zc(t.protocol).subscribe,params:{topic:e}};this.logger.debug(`Outgoing Relay Payload`),this.logger.trace({type:`payload`,direction:`outgoing`,request:r});let i=n?.internal?.throwOnFailedPublish;try{let t=await this.getSubscriptionId(e);if(n?.transportType===W.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(r).catch(e=>this.logger.warn(e))},(0,U.toMiliseconds)(U.ONE_SECOND)),t;let a=await Mr(new Promise(async t=>{let n=r=>{r.topic===e&&(this.events.removeListener(Lu.created,n),t(r.id))};this.events.on(Lu.created,n);try{let i=await Mr(new Promise((e,t)=>{this.relayer.request(r).catch(e=>{this.logger.warn(e,e?.message),t(e)}).then(e)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Lu.created,n),t(i)}catch{}}),this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!a&&i)throw Error(`Subscribing to ${e} failed, please try again`);return a?t:null}catch(e){if(this.logger.debug(`Outgoing Relay Subscribe Payload stalled`),this.relayer.events.emit(Mu.connection_stalled),i)throw e}return null}async rpcBatchSubscribe(e){if(!e.length)return;let t=e[0].relay,n={method:Zc(t.protocol).batchSubscribe,params:{topics:e.map(e=>e.topic)}};this.logger.debug(`Outgoing Relay Payload`),this.logger.trace({type:`payload`,direction:`outgoing`,request:n});try{await await Mr(new Promise(e=>{this.relayer.request(n).catch(e=>this.logger.warn(e)).then(e)}),this.subscribeTimeout,`rpcBatchSubscribe failed, please try again`)}catch{this.relayer.events.emit(Mu.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;let t=e[0].relay,n={method:Zc(t.protocol).batchFetchMessages,params:{topics:e.map(e=>e.topic)}};this.logger.debug(`Outgoing Relay Payload`),this.logger.trace({type:`payload`,direction:`outgoing`,request:n});let r;try{r=await await Mr(new Promise((e,t)=>{this.relayer.request(n).catch(e=>{this.logger.warn(e),t(e)}).then(e)}),this.subscribeTimeout,`rpcBatchFetchMessages failed, please try again`)}catch{this.relayer.events.emit(Mu.connection_stalled)}return r}rpcUnsubscribe(e,t,n){let r={method:Zc(n.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug(`Outgoing Relay Payload`),this.logger.trace({type:`payload`,direction:`outgoing`,request:r}),this.relayer.request(r)}onSubscribe(e,t){this.setSubscription(e,Rp(Lp({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(e=>{this.setSubscription(e.id,Lp({},e)),this.pending.delete(e.topic)})}async onUnsubscribe(e,t,n){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug(`Setting subscription`),this.logger.trace({type:`method`,method:`setSubscription`,id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,Lp({},t)),this.topicMap.set(t.topic,e),this.events.emit(Lu.created,t)}getSubscription(e){this.logger.debug(`Getting subscription`),this.logger.trace({type:`method`,method:`getSubscription`,id:e});let t=this.subscriptions.get(e);if(!t){let{message:t}=V(`NO_MATCHING_KEY`,`${this.name}: ${e}`);throw Error(t)}return t}deleteSubscription(e,t){this.logger.debug(`Deleting subscription`),this.logger.trace({type:`method`,method:`deleteSubscription`,id:e,reason:t});let n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(Lu.deleted,Rp(Lp({},n),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Lu.sync)}async onRestart(){if(this.cached.length){let e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<t;n++){let t=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(t)}}this.events.emit(Lu.resubscribed)}async restore(){try{let e=await this.getRelayerSubscriptions();if(typeof e>`u`||!e.length)return;if(this.subscriptions.size){let{message:e}=V(`RESTORE_WILL_OVERRIDE`,this.name);throw this.logger.error(e),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:`method`,method:`restore`,subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async e=>Rp(Lp({},e),{id:await this.getSubscriptionId(e.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await Zr((0,U.toMiliseconds)(U.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||=await this.relayer.core.crypto.getClientId(),this.clientId}async getSubscriptionId(e){return Nc(e+await this.getClientId())}},Bp=Object.defineProperty,Vp=Object.getOwnPropertySymbols,Hp=Object.prototype.hasOwnProperty,Up=Object.prototype.propertyIsEnumerable,Wp=(e,t,n)=>t in e?Bp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Gp=(e,t)=>{for(var n in t||={})Hp.call(t,n)&&Wp(e,n,t[n]);if(Vp)for(var n of Vp(t))Up.call(t,n)&&Wp(e,n,t[n]);return e},K=(e,t,n)=>Wp(e,typeof t==`symbol`?t:t+``,n),Kp=class extends At{constructor(e){super(e),K(this,`protocol`,`wc`),K(this,`version`,2),K(this,`core`),K(this,`logger`),K(this,`events`,new vu.EventEmitter),K(this,`provider`),K(this,`messages`),K(this,`subscriber`),K(this,`publisher`),K(this,`name`,ju),K(this,`transportExplicitlyClosed`,!1),K(this,`initialized`,!1),K(this,`connectionAttemptInProgress`,!1),K(this,`relayUrl`),K(this,`projectId`),K(this,`packageName`),K(this,`bundleId`),K(this,`hasExperiencedNetworkDisruption`,!1),K(this,`pingTimeout`),K(this,`heartBeatTimeout`,(0,U.toMiliseconds)(U.THIRTY_SECONDS+U.FIVE_SECONDS)),K(this,`reconnectTimeout`),K(this,`connectPromise`),K(this,`reconnectInProgress`,!1),K(this,`requestsInFlight`,[]),K(this,`connectTimeout`,(0,U.toMiliseconds)(U.ONE_SECOND*15)),K(this,`request`,async e=>{this.logger.debug(`Publishing Request Payload`);let t=e.id||Ae().toString();await this.toEstablishConnection();try{this.logger.trace({id:t,method:e.method,topic:e.params?.topic},`relayer.request - publishing...`);let n=`${t}:${e.params?.tag||``}`;this.requestsInFlight.push(n);let r=await this.provider.request(e);return this.requestsInFlight=this.requestsInFlight.filter(e=>e!==n),r}catch(e){throw this.logger.debug(`Failed to Publish Request: ${t}`),e}}),K(this,`resetPingTimeout`,()=>{mr()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var e,t;try{this.logger.debug({},`pingTimeout: Connection stalled, terminating...`),(t=(e=this.provider?.connection?.socket)?.terminate)==null||t.call(e)}catch(e){this.logger.warn(e,e?.message)}},this.heartBeatTimeout))}),K(this,`onPayloadHandler`,e=>{this.onProviderPayload(e),this.resetPingTimeout()}),K(this,`onConnectHandler`,()=>{this.logger.warn({},`Relayer connected `),this.startPingTimeout(),this.events.emit(Mu.connect)}),K(this,`onDisconnectHandler`,()=>{this.logger.warn({},`Relayer disconnected `),this.requestsInFlight=[],this.onProviderDisconnect()}),K(this,`onProviderErrorHandler`,e=>{this.logger.fatal(`Fatal socket error: ${e.message}`),this.events.emit(Mu.error,e),this.logger.fatal(`Fatal socket error received, closing transport`),this.transportClose()}),K(this,`registerProviderListeners`,()=>{this.provider.on(Nu.payload,this.onPayloadHandler),this.provider.on(Nu.connect,this.onConnectHandler),this.provider.on(Nu.disconnect,this.onDisconnectHandler),this.provider.on(Nu.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<`u`&&typeof e.logger!=`string`?be(e.logger,this.name):(0,Pe.default)(Ie({level:e.logger||`error`})),this.messages=new mp(this.logger,e.core),this.subscriber=new zp(this,this.logger),this.publisher=new Tp(this,this.logger),this.relayUrl=e?.relayUrl||`wss://relay.walletconnect.org`,this.projectId=e.projectId,gr()?this.packageName=br():_r()&&(this.bundleId=br()),this.provider={}}async init(){if(this.logger.trace(`Initialized`),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}}get context(){return Se(this.logger)}get connected(){return this.provider?.connection?.socket?.readyState===1||!1}get connecting(){return this.provider?.connection?.socket?.readyState===0||this.connectPromise!==void 0||!1}async publish(e,t,n){this.isInitialized(),await this.publisher.publish(e,t,n),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:W.relay},Fu.outbound)}async subscribe(e,t){this.isInitialized(),(!(t!=null&&t.transportType)||t?.transportType===`relay`)&&await this.toEstablishConnection();let n=typeof t?.internal?.throwOnFailedPublish>`u`?!0:t?.internal?.throwOnFailedPublish,r=this.subscriber.topicMap.get(e)?.[0]||``,i,a=t=>{t.topic===e&&(this.subscriber.off(Lu.created,a),i())};return await Promise.all([new Promise(e=>{i=e,this.subscriber.on(Lu.created,a)}),new Promise(async(i,a)=>{r=await this.subscriber.subscribe(e,Gp({internal:{throwOnFailedPublish:n}},t)).catch(e=>{n&&a(e)})||r,i()})]),r}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Mr(this.provider.disconnect(),2e3,`provider.disconnect()`).catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn(`Starting WS connection skipped because the client has no topics to work with.`);return}if(this.connectPromise?(this.logger.debug({},`Waiting for existing connection attempt to resolve...`),await this.connectPromise,this.logger.debug({},`Existing connection attempt resolved`)):(this.connectPromise=new Promise(async(t,n)=>{await this.connect(e).then(t).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},`Restarting transport...`),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await cu())throw Error(`No internet connection detected. Please restart your network and try again.`)}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace(`Batch message events is empty. Ignoring...`);return}let t=e.sort((e,t)=>e.publishedAt-t.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(let e of t)try{await this.onMessageEvent(e)}catch(e){this.logger.warn(e,`Error while processing batch message event: `+e?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){let{topic:n}=e;if(!t.sessionExists){let e={topic:n,expiry:Lr(U.FIVE_MINUTES),relay:{protocol:`irn`},active:!1};await this.core.pairing.pairings.set(n,e)}this.events.emit(Mu.message,e),await this.recordMessageEvent(e,Fu.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(e,t)=>{let n=()=>{t(Error(`Connection interrupted while trying to subscribe`))};this.provider.once(Nu.disconnect,n),await Mr(new Promise((e,t)=>{this.provider.connect().then(e).catch(t)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(e=>{t(e)}).finally(()=>{this.provider.off(Nu.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(e,t)=>{let n=()=>{t(Error(`Connection interrupted while trying to subscribe`))};this.provider.once(Nu.disconnect,n),await this.subscriber.start().then(e).catch(t).finally(()=>{this.provider.off(Nu.disconnect,n)})}),this.hasExperiencedNetworkDisruption=!1,e()})}catch(e){await this.subscriber.stop();let t=e;this.logger.warn({},t.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(e=>setTimeout(e,(0,U.toMiliseconds)(t*1))),t++}}startPingTimeout(){var e,t;if(mr())try{(e=this.provider?.connection)!=null&&e.socket&&((t=this.provider?.connection?.socket)==null||t.on(`ping`,()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(e){this.logger.warn(e,e?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Oe(new _e(Dr({sdkVersion:Pu,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){let{topic:n,message:r}=e;await this.messages.set(n,r,t)}async shouldIgnoreMessageEvent(e){let{topic:t,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;let r=this.messages.has(t,n);return r&&this.logger.warn(`Ignoring duplicate message: ${n}`),r}async onProviderPayload(e){if(this.logger.debug(`Incoming Relay Payload`),this.logger.trace({type:`payload`,direction:`incoming`,payload:e}),xe(e)){if(!e.method.endsWith(`_subscription`))return;let t=e.params,{topic:n,message:r,publishedAt:i,attestation:a}=t.data,o={topic:n,message:r,publishedAt:i,transportType:W.relay,attestation:a};this.logger.debug(`Emitting Relayer Payload`),this.logger.trace(Gp({type:`event`,event:t.id},o)),this.events.emit(t.id,o),await this.acknowledgePayload(e),await this.onMessageEvent(o)}else ke(e)&&this.events.emit(Mu.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Fu.inbound),this.events.emit(Mu.message,e))}async acknowledgePayload(e){let t=we(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(Nu.payload,this.onPayloadHandler),this.provider.off(Nu.connect,this.onConnectHandler),this.provider.off(Nu.disconnect,this.onDisconnectHandler),this.provider.off(Nu.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await cu();fu(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(e=>this.logger.error(e,e?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(ce.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&hu())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(Mu.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,U.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}};function qp(){}function Jp(e){if(!e||typeof e!=`object`)return!1;let t=Object.getPrototypeOf(e);return t===null||t===Object.prototype||Object.getPrototypeOf(t)===null?Object.prototype.toString.call(e)===`[object Object]`:!1}function Yp(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function Xp(e){return e==null?e===void 0?`[object Undefined]`:`[object Null]`:Object.prototype.toString.call(e)}var Zp=`[object RegExp]`,Qp=`[object String]`,$p=`[object Number]`,em=`[object Boolean]`,tm=`[object Arguments]`,nm=`[object Symbol]`,rm=`[object Date]`,im=`[object Map]`,am=`[object Set]`,om=`[object Array]`,sm=`[object Function]`,cm=`[object ArrayBuffer]`,lm=`[object Object]`,um=`[object Error]`,dm=`[object DataView]`,fm=`[object Uint8Array]`,pm=`[object Uint8ClampedArray]`,mm=`[object Uint16Array]`,hm=`[object Uint32Array]`,gm=`[object BigUint64Array]`,_m=`[object Int8Array]`,vm=`[object Int16Array]`,ym=`[object Int32Array]`,bm=`[object BigInt64Array]`,xm=`[object Float32Array]`,Sm=`[object Float64Array]`;function Cm(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}function wm(e,t,n){return Tm(e,t,void 0,void 0,void 0,void 0,n)}function Tm(e,t,n,r,i,a,o){let s=o(e,t,n,r,i,a);if(s!==void 0)return s;if(typeof e==typeof t)switch(typeof e){case`bigint`:case`string`:case`boolean`:case`symbol`:case`undefined`:return e===t;case`number`:return e===t||Object.is(e,t);case`function`:return e===t;case`object`:return Em(e,t,a,o)}return Em(e,t,a,o)}function Em(e,t,n,r){if(Object.is(e,t))return!0;let i=Xp(e),a=Xp(t);if(i===tm&&(i=lm),a===tm&&(a=lm),i!==a)return!1;switch(i){case Qp:return e.toString()===t.toString();case $p:return Cm(e.valueOf(),t.valueOf());case em:case rm:case nm:return Object.is(e.valueOf(),t.valueOf());case Zp:return e.source===t.source&&e.flags===t.flags;case sm:return e===t}n??=new Map;let o=n.get(e),s=n.get(t);if(o!=null&&s!=null)return o===t;n.set(e,t),n.set(t,e);try{switch(i){case im:if(e.size!==t.size)return!1;for(let[i,a]of e.entries())if(!t.has(i)||!Tm(a,t.get(i),i,e,t,n,r))return!1;return!0;case am:{if(e.size!==t.size)return!1;let i=Array.from(e.values()),a=Array.from(t.values());for(let o=0;o<i.length;o++){let s=i[o],c=a.findIndex(i=>Tm(s,i,void 0,e,t,n,r));if(c===-1)return!1;a.splice(c,1)}return!0}case om:case fm:case pm:case mm:case hm:case gm:case _m:case vm:case ym:case bm:case xm:case Sm:if(typeof Buffer<`u`&&Buffer.isBuffer(e)!==Buffer.isBuffer(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Tm(e[i],t[i],i,e,t,n,r))return!1;return!0;case cm:return e.byteLength===t.byteLength?Em(new Uint8Array(e),new Uint8Array(t),n,r):!1;case dm:return e.byteLength!==t.byteLength||e.byteOffset!==t.byteOffset?!1:Em(new Uint8Array(e),new Uint8Array(t),n,r);case um:return e.name===t.name&&e.message===t.message;case lm:{if(!(Em(e.constructor,t.constructor,n,r)||Jp(e)&&Jp(t)))return!1;let i=[...Object.keys(e),...Yp(e)],a=[...Object.keys(t),...Yp(t)];if(i.length!==a.length)return!1;for(let a=0;a<i.length;a++){let o=i[a],s=e[o];if(!Object.hasOwn(t,o))return!1;let c=t[o];if(!Tm(s,c,o,e,t,n,r))return!1}return!0}default:return!1}}finally{n.delete(e),n.delete(t)}}function Dm(e,t){return wm(e,t,qp)}var Om=Object.defineProperty,km=Object.getOwnPropertySymbols,Am=Object.prototype.hasOwnProperty,jm=Object.prototype.propertyIsEnumerable,Mm=(e,t,n)=>t in e?Om(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Nm=(e,t)=>{for(var n in t||={})Am.call(t,n)&&Mm(e,n,t[n]);if(km)for(var n of km(t))jm.call(t,n)&&Mm(e,n,t[n]);return e},Pm=(e,t,n)=>Mm(e,typeof t==`symbol`?t:t+``,n),Fm=class extends jt{constructor(e,t,n,r=xu,i=void 0){super(e,t,n,r),this.core=e,this.logger=t,this.name=n,Pm(this,`map`,new Map),Pm(this,`version`,`0.3`),Pm(this,`cached`,[]),Pm(this,`initialized`,!1),Pm(this,`getKey`),Pm(this,`storagePrefix`,xu),Pm(this,`recentlyDeleted`,[]),Pm(this,`recentlyDeletedLimit`,200),Pm(this,`init`,async()=>{this.initialized||=(this.logger.trace(`Initialized`),await this.restore(),this.cached.forEach(e=>{this.getKey&&e!==null&&!Dl(e)?this.map.set(this.getKey(e),e):Pl(e)?this.map.set(e.id,e):Fl(e)&&this.map.set(e.topic,e)}),this.cached=[],!0)}),Pm(this,`set`,async(e,t)=>{this.isInitialized(),this.map.has(e)?await this.update(e,t):(this.logger.debug(`Setting value`),this.logger.trace({type:`method`,method:`set`,key:e,value:t}),this.map.set(e,t),await this.persist())}),Pm(this,`get`,e=>(this.isInitialized(),this.logger.debug(`Getting value`),this.logger.trace({type:`method`,method:`get`,key:e}),this.getData(e))),Pm(this,`getAll`,e=>(this.isInitialized(),e?this.values.filter(t=>Object.keys(e).every(n=>Dm(t[n],e[n]))):this.values)),Pm(this,`update`,async(e,t)=>{this.isInitialized(),this.logger.debug(`Updating value`),this.logger.trace({type:`method`,method:`update`,key:e,update:t});let n=Nm(Nm({},this.getData(e)),t);this.map.set(e,n),await this.persist()}),Pm(this,`delete`,async(e,t)=>{this.isInitialized(),this.map.has(e)&&(this.logger.debug(`Deleting value`),this.logger.trace({type:`method`,method:`delete`,key:e,reason:t}),this.map.delete(e),this.addToRecentlyDeleted(e),await this.persist())}),this.logger=be(t,this.name),this.storagePrefix=r,this.getKey=i}get context(){return Se(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+`//`+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){let t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){let{message:t}=V(`MISSING_OR_INVALID`,`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(t),Error(t)}let{message:t}=V(`NO_MATCHING_KEY`,`${this.name}: ${e}`);throw this.logger.error(t),Error(t)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{let e=await this.getDataStore();if(typeof e>`u`||!e.length)return;if(this.map.size){let{message:e}=V(`RESTORE_WILL_OVERRIDE`,this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:`method`,method:`restore`,value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}},Im=Object.defineProperty,Lm=(e,t,n)=>t in e?Im(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,q=(e,t,n)=>Lm(e,typeof t==`symbol`?t:t+``,n),Rm=class{constructor(e,t){this.core=e,this.logger=t,q(this,`name`,zu),q(this,`version`,`0.3`),q(this,`events`,new vu.default),q(this,`pairings`),q(this,`initialized`,!1),q(this,`storagePrefix`,xu),q(this,`ignoredPayloadTypes`,[1]),q(this,`registeredMethods`,[]),q(this,`init`,async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace(`Initialized`))}),q(this,`register`,({methods:e})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...e])]}),q(this,`create`,async e=>{this.isInitialized();let t=Ac(),n=await this.core.crypto.setSymKey(t),r=Lr(U.FIVE_MINUTES),i={protocol:`irn`},a={topic:n,expiry:r,relay:i,active:!1,methods:e?.methods},o=nl({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:t,relay:i,expiryTimestamp:r,methods:e?.methods});return this.events.emit(Vu.create,a),this.core.expirer.set(n,r),await this.pairings.set(n,a),await this.core.relayer.subscribe(n,{transportType:e?.transportType}),{topic:n,uri:o}}),q(this,`pair`,async e=>{this.isInitialized();let t=this.core.eventClient.createEvent({properties:{topic:e?.uri,trace:[$u.pairing_started]}});this.isValidPair(e,t);let{topic:n,symKey:r,relay:i,expiryTimestamp:a,methods:o}=$c(e.uri);t.props.properties.topic=n,t.addTrace($u.pairing_uri_validation_success),t.addTrace($u.pairing_uri_not_expired);let s;if(this.pairings.keys.includes(n)){if(s=this.pairings.get(n),t.addTrace($u.existing_pairing),s.active)throw t.setError(ed.active_pairing_already_exists),Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);t.addTrace($u.pairing_not_expired)}let c=a||Lr(U.FIVE_MINUTES),l={topic:n,relay:i,expiry:c,active:!1,methods:o};this.core.expirer.set(n,c),await this.pairings.set(n,l),t.addTrace($u.store_new_pairing),e.activatePairing&&await this.activate({topic:n}),this.events.emit(Vu.create,l),t.addTrace($u.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(r,n),t.addTrace($u.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{t.setError(ed.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:i})}catch(e){throw t.setError(ed.subscribe_pairing_topic_failure),e}return t.addTrace($u.subscribe_pairing_topic_success),l}),q(this,`activate`,async({topic:e})=>{this.isInitialized();let t=Lr(U.FIVE_MINUTES);this.core.expirer.set(e,t),await this.pairings.update(e,{active:!0,expiry:t})}),q(this,`ping`,async e=>{this.isInitialized(),await this.isValidPing(e),this.logger.warn(`ping() is deprecated and will be removed in the next major release.`);let{topic:t}=e;if(this.pairings.keys.includes(t)){let e=await this.sendRequest(t,`wc_pairingPing`,{}),{done:n,resolve:r,reject:i}=jr();this.events.once(z(`pairing_ping`,e),({error:e})=>{e?i(e):r()}),await n()}}),q(this,`updateExpiry`,async({topic:e,expiry:t})=>{this.isInitialized(),await this.pairings.update(e,{expiry:t})}),q(this,`updateMetadata`,async({topic:e,metadata:t})=>{this.isInitialized(),await this.pairings.update(e,{peerMetadata:t})}),q(this,`getPairings`,()=>(this.isInitialized(),this.pairings.values)),q(this,`disconnect`,async e=>{this.isInitialized(),await this.isValidDisconnect(e);let{topic:t}=e;this.pairings.keys.includes(t)&&(await this.sendRequest(t,`wc_pairingDelete`,H(`USER_DISCONNECTED`)),await this.deletePairing(t))}),q(this,`formatUriFromPairing`,e=>{this.isInitialized();let{topic:t,relay:n,expiry:r,methods:i}=e,a=this.core.crypto.keychain.get(t);return nl({protocol:this.core.protocol,version:this.core.version,topic:t,symKey:a,relay:n,expiryTimestamp:r,methods:i})}),q(this,`sendRequest`,async(e,t,n)=>{let r=Ce(t,n),i=await this.core.crypto.encode(e,r),a=Bu[t].req;return this.core.history.set(e,r),this.core.relayer.publish(e,i,a),r.id}),q(this,`sendResult`,async(e,t,n)=>{let r=we(e,n),i=await this.core.crypto.encode(t,r),a=Bu[(await this.core.history.get(t,e)).request.method].res;await this.core.relayer.publish(t,i,a),await this.core.history.resolve(r)}),q(this,`sendError`,async(e,t,n)=>{let r=Ne(e,n),i=await this.core.crypto.encode(t,r),a=(await this.core.history.get(t,e)).request.method,o=Bu[a]?Bu[a].res:Bu.unregistered_method.res;await this.core.relayer.publish(t,i,o),await this.core.history.resolve(r)}),q(this,`deletePairing`,async(e,t)=>{await this.core.relayer.unsubscribe(e),await Promise.all([this.pairings.delete(e,H(`USER_DISCONNECTED`)),this.core.crypto.deleteSymKey(e),t?Promise.resolve():this.core.expirer.del(e)])}),q(this,`cleanup`,async()=>{let e=this.pairings.getAll().filter(e=>Rr(e.expiry));await Promise.all(e.map(e=>this.deletePairing(e.topic)))}),q(this,`onRelayEventRequest`,async e=>{let{topic:t,payload:n}=e;switch(n.method){case`wc_pairingPing`:return await this.onPairingPingRequest(t,n);case`wc_pairingDelete`:return await this.onPairingDeleteRequest(t,n);default:return await this.onUnknownRpcMethodRequest(t,n)}}),q(this,`onRelayEventResponse`,async e=>{let{topic:t,payload:n}=e,r=(await this.core.history.get(t,n.id)).request.method;switch(r){case`wc_pairingPing`:return this.onPairingPingResponse(t,n);default:return this.onUnknownRpcMethodResponse(r)}}),q(this,`onPairingPingRequest`,async(e,t)=>{let{id:n}=t;try{this.isValidPing({topic:e}),await this.sendResult(n,e,!0),this.events.emit(Vu.ping,{id:n,topic:e})}catch(t){await this.sendError(n,e,t),this.logger.error(t)}}),q(this,`onPairingPingResponse`,(e,t)=>{let{id:n}=t;setTimeout(()=>{je(t)?this.events.emit(z(`pairing_ping`,n),{}):Ee(t)&&this.events.emit(z(`pairing_ping`,n),{error:t.error})},500)}),q(this,`onPairingDeleteRequest`,async(e,t)=>{let{id:n}=t;try{this.isValidDisconnect({topic:e}),await this.deletePairing(e),this.events.emit(Vu.delete,{id:n,topic:e})}catch(t){await this.sendError(n,e,t),this.logger.error(t)}}),q(this,`onUnknownRpcMethodRequest`,async(e,t)=>{let{id:n,method:r}=t;try{if(this.registeredMethods.includes(r))return;let t=H(`WC_METHOD_UNSUPPORTED`,r);await this.sendError(n,e,t),this.logger.error(t)}catch(t){await this.sendError(n,e,t),this.logger.error(t)}}),q(this,`onUnknownRpcMethodResponse`,e=>{this.registeredMethods.includes(e)||this.logger.error(H(`WC_METHOD_UNSUPPORTED`,e))}),q(this,`isValidPair`,(e,t)=>{var n;if(!Yl(e)){let{message:n}=V(`MISSING_OR_INVALID`,`pair() params: ${e}`);throw t.setError(ed.malformed_pairing_uri),Error(n)}if(!Nl(e.uri)){let{message:n}=V(`MISSING_OR_INVALID`,`pair() uri: ${e.uri}`);throw t.setError(ed.malformed_pairing_uri),Error(n)}let r=$c(e?.uri);if(!((n=r?.relay)!=null&&n.protocol)){let{message:e}=V(`MISSING_OR_INVALID`,`pair() uri#relay-protocol`);throw t.setError(ed.malformed_pairing_uri),Error(e)}if(!(r!=null&&r.symKey)){let{message:e}=V(`MISSING_OR_INVALID`,`pair() uri#symKey`);throw t.setError(ed.malformed_pairing_uri),Error(e)}if(r!=null&&r.expiryTimestamp&&(0,U.toMiliseconds)(r?.expiryTimestamp)<Date.now()){t.setError(ed.pairing_expired);let{message:e}=V(`EXPIRED`,`pair() URI has expired. Please try again with a new connection URI.`);throw Error(e)}}),q(this,`isValidPing`,async e=>{if(!Yl(e)){let{message:t}=V(`MISSING_OR_INVALID`,`ping() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidPairingTopic(t)}),q(this,`isValidDisconnect`,async e=>{if(!Yl(e)){let{message:t}=V(`MISSING_OR_INVALID`,`disconnect() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidPairingTopic(t)}),q(this,`isValidPairingTopic`,async e=>{if(!Ol(e,!1)){let{message:t}=V(`MISSING_OR_INVALID`,`pairing topic should be a string: ${e}`);throw Error(t)}if(!this.pairings.keys.includes(e)){let{message:t}=V(`NO_MATCHING_KEY`,`pairing topic doesn't exist: ${e}`);throw Error(t)}if(Rr(this.pairings.get(e).expiry)){await this.deletePairing(e);let{message:t}=V(`EXPIRED`,`pairing topic: ${e}`);throw Error(t)}}),this.core=e,this.logger=be(t,this.name),this.pairings=new Fm(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}registerRelayerEvents(){this.core.relayer.on(Mu.message,async e=>{let{topic:t,message:n,transportType:r}=e;if(this.pairings.keys.includes(t)&&r!==W.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{let e=await this.core.crypto.decode(t,n);xe(e)?(this.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e})):ke(e)&&(await this.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e}),this.core.history.delete(t,e.id)),await this.core.relayer.messages.ack(t,n)}catch(e){this.logger.error(e)}})}registerExpirerEvents(){this.core.expirer.on(Gu.expired,async e=>{let{topic:t}=Ir(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(Vu.expire,{topic:t}))})}},zm=Object.defineProperty,Bm=(e,t,n)=>t in e?zm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Vm=(e,t,n)=>Bm(e,typeof t==`symbol`?t:t+``,n),Hm=class extends Dt{constructor(e,t){super(e,t),this.core=e,this.logger=t,Vm(this,`records`,new Map),Vm(this,`events`,new vu.EventEmitter),Vm(this,`name`,Uu),Vm(this,`version`,`0.3`),Vm(this,`cached`,[]),Vm(this,`initialized`,!1),Vm(this,`storagePrefix`,xu),Vm(this,`init`,async()=>{this.initialized||=(this.logger.trace(`Initialized`),await this.restore(),this.cached.forEach(e=>this.records.set(e.id,e)),this.cached=[],this.registerEventListeners(),!0)}),Vm(this,`set`,(e,t,n)=>{if(this.isInitialized(),this.logger.debug(`Setting JSON-RPC request history record`),this.logger.trace({type:`method`,method:`set`,topic:e,request:t,chainId:n}),this.records.has(t.id))return;let r={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:n,expiry:Lr(U.THIRTY_DAYS)};this.records.set(r.id,r),this.persist(),this.events.emit(Hu.created,r)}),Vm(this,`resolve`,async e=>{if(this.isInitialized(),this.logger.debug(`Updating JSON-RPC response history record`),this.logger.trace({type:`method`,method:`update`,response:e}),!this.records.has(e.id))return;let t=await this.getRecord(e.id);typeof t.response>`u`&&(t.response=Ee(e)?{error:e.error}:{result:e.result},this.records.set(t.id,t),this.persist(),this.events.emit(Hu.updated,t))}),Vm(this,`get`,async(e,t)=>(this.isInitialized(),this.logger.debug(`Getting record`),this.logger.trace({type:`method`,method:`get`,topic:e,id:t}),await this.getRecord(t))),Vm(this,`delete`,(e,t)=>{this.isInitialized(),this.logger.debug(`Deleting record`),this.logger.trace({type:`method`,method:`delete`,id:t}),this.values.forEach(n=>{if(n.topic===e){if(typeof t<`u`&&n.id!==t)return;this.records.delete(n.id),this.events.emit(Hu.deleted,n)}}),this.persist()}),Vm(this,`exists`,async(e,t)=>(this.isInitialized(),this.records.has(t)?(await this.getRecord(t)).topic===e:!1)),Vm(this,`on`,(e,t)=>{this.events.on(e,t)}),Vm(this,`once`,(e,t)=>{this.events.once(e,t)}),Vm(this,`off`,(e,t)=>{this.events.off(e,t)}),Vm(this,`removeListener`,(e,t)=>{this.events.removeListener(e,t)}),this.logger=be(t,this.name)}get context(){return Se(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+`//`+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(t=>{if(typeof t.response<`u`)return;let n={topic:t.topic,request:Ce(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();let t=this.records.get(e);if(!t){let{message:t}=V(`NO_MATCHING_KEY`,`${this.name}: ${e}`);throw Error(t)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Hu.sync)}async restore(){try{let e=await this.getJsonRpcRecords();if(typeof e>`u`||!e.length)return;if(this.records.size){let{message:e}=V(`RESTORE_WILL_OVERRIDE`,this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:`method`,method:`restore`,records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Hu.created,e=>{let t=Hu.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,record:e})}),this.events.on(Hu.updated,e=>{let t=Hu.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,record:e})}),this.events.on(Hu.deleted,e=>{let t=Hu.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,record:e})}),this.core.heartbeat.on(ce.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{(0,U.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(Hu.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}},Um=Object.defineProperty,Wm=(e,t,n)=>t in e?Um(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Gm=(e,t,n)=>Wm(e,typeof t==`symbol`?t:t+``,n),Km=class extends Nt{constructor(e,t){super(e,t),this.core=e,this.logger=t,Gm(this,`expirations`,new Map),Gm(this,`events`,new vu.EventEmitter),Gm(this,`name`,Wu),Gm(this,`version`,`0.3`),Gm(this,`cached`,[]),Gm(this,`initialized`,!1),Gm(this,`storagePrefix`,xu),Gm(this,`init`,async()=>{this.initialized||=(this.logger.trace(`Initialized`),await this.restore(),this.cached.forEach(e=>this.expirations.set(e.target,e)),this.cached=[],this.registerEventListeners(),!0)}),Gm(this,`has`,e=>{try{let t=this.formatTarget(e);return typeof this.getExpiration(t)<`u`}catch{return!1}}),Gm(this,`set`,(e,t)=>{this.isInitialized();let n=this.formatTarget(e),r={target:n,expiry:t};this.expirations.set(n,r),this.checkExpiry(n,r),this.events.emit(Gu.created,{target:n,expiration:r})}),Gm(this,`get`,e=>{this.isInitialized();let t=this.formatTarget(e);return this.getExpiration(t)}),Gm(this,`del`,e=>{if(this.isInitialized(),this.has(e)){let t=this.formatTarget(e),n=this.getExpiration(t);this.expirations.delete(t),this.events.emit(Gu.deleted,{target:t,expiration:n})}}),Gm(this,`on`,(e,t)=>{this.events.on(e,t)}),Gm(this,`once`,(e,t)=>{this.events.once(e,t)}),Gm(this,`off`,(e,t)=>{this.events.off(e,t)}),Gm(this,`removeListener`,(e,t)=>{this.events.removeListener(e,t)}),this.logger=be(t,this.name)}get context(){return Se(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+`//`+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e==`string`)return Pr(e);if(typeof e==`number`)return Fr(e);let{message:t}=V(`UNKNOWN_TYPE`,`Target type: ${typeof e}`);throw Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Gu.sync)}async restore(){try{let e=await this.getExpirations();if(typeof e>`u`||!e.length)return;if(this.expirations.size){let{message:e}=V(`RESTORE_WILL_OVERRIDE`,this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:`method`,method:`restore`,expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){let t=this.expirations.get(e);if(!t){let{message:t}=V(`NO_MATCHING_KEY`,`${this.name}: ${e}`);throw this.logger.warn(t),Error(t)}return t}checkExpiry(e,t){let{expiry:n}=t;(0,U.toMiliseconds)(n)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Gu.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(ce.pulse,()=>this.checkExpirations()),this.events.on(Gu.created,e=>{let t=Gu.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,data:e}),this.persist()}),this.events.on(Gu.expired,e=>{let t=Gu.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,data:e}),this.persist()}),this.events.on(Gu.deleted,e=>{let t=Gu.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:`event`,event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}},qm=Object.defineProperty,Jm=(e,t,n)=>t in e?qm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ym=(e,t,n)=>Jm(e,typeof t==`symbol`?t:t+``,n),Xm=class extends Pt{constructor(e,t,n){super(e,t,n),this.core=e,this.logger=t,this.store=n,Ym(this,`name`,Ku),Ym(this,`abortController`),Ym(this,`isDevEnv`),Ym(this,`verifyUrlV3`,Yu),Ym(this,`storagePrefix`,xu),Ym(this,`version`,2),Ym(this,`publicKey`),Ym(this,`fetchPromise`),Ym(this,`init`,async()=>{this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,U.toMiliseconds)(this.publicKey?.expiresAt)<Date.now()&&(this.logger.debug(`verify v2 public key expired`),await this.removePublicKey()))}),Ym(this,`register`,async e=>{if(!vr()||this.isDevEnv)return;let t=window.location.origin,{id:n,decryptedId:r}=e,i=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${t}&id=${n}&decryptedId=${r}`;try{let e=(0,yu.getDocument)(),t=this.startAbortTimer(U.ONE_SECOND*5),r=await new Promise((r,a)=>{let o=()=>{window.removeEventListener(`message`,c),e.body.removeChild(s),a(`attestation aborted`)};this.abortController.signal.addEventListener(`abort`,o);let s=e.createElement(`iframe`);s.src=i,s.style.display=`none`,s.addEventListener(`error`,o,{signal:this.abortController.signal});let c=i=>{if(i.data&&typeof i.data==`string`)try{let a=JSON.parse(i.data);if(a.type===`verify_attestation`){if(oe(a.attestation).payload.id!==n)return;clearInterval(t),e.body.removeChild(s),this.abortController.signal.removeEventListener(`abort`,o),window.removeEventListener(`message`,c),r(a.attestation===null?``:a.attestation)}}catch(e){this.logger.warn(e)}};e.body.appendChild(s),window.addEventListener(`message`,c,{signal:this.abortController.signal})});return this.logger.debug(`jwt attestation`,r),r}catch(e){this.logger.warn(e)}return``}),Ym(this,`resolve`,async e=>{if(this.isDevEnv)return``;let{attestationId:t,hash:n,encryptedId:r}=e;if(t===``){this.logger.debug(`resolve: attestationId is empty, skipping`);return}if(t){if(oe(t).payload.id!==r)return;let e=await this.isValidJwtAttestation(t);if(e){if(!e.isVerified){this.logger.warn(`resolve: jwt attestation: origin url not verified`);return}return e}}if(!n)return;let i=this.getVerifyUrl(e?.verifyUrl);return this.fetchAttestation(n,i)}),Ym(this,`fetchAttestation`,async(e,t)=>{this.logger.debug(`resolving attestation: ${e} from url: ${t}`);let n=this.startAbortTimer(U.ONE_SECOND*5),r=await fetch(`${t}/attestation/${e}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(n),r.status===200?await r.json():void 0}),Ym(this,`getVerifyUrl`,e=>{let t=e||`https://verify.walletconnect.org`;return Xu.includes(t)||(this.logger.info(`verify url: ${t}, not included in trusted list, assigning default: https://verify.walletconnect.org`),t=`https://verify.walletconnect.org`),t}),Ym(this,`fetchPublicKey`,async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let e=this.startAbortTimer(U.FIVE_SECONDS),t=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(e),await t.json()}catch(e){this.logger.warn(e)}}),Ym(this,`persistPublicKey`,async e=>{this.logger.debug(`persisting public key to local storage`,e),await this.store.setItem(this.storeKey,e),this.publicKey=e}),Ym(this,`removePublicKey`,async()=>{this.logger.debug(`removing verify v2 public key from storage`),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Ym(this,`isValidJwtAttestation`,async e=>{let t=await this.getPublicKey();try{if(t)return this.validateAttestation(e,t)}catch(e){this.logger.error(e),this.logger.warn(`error validating attestation`)}let n=await this.fetchAndPersistPublicKey();try{if(n)return this.validateAttestation(e,n)}catch(e){this.logger.error(e),this.logger.warn(`error validating attestation`)}}),Ym(this,`getPublicKey`,async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Ym(this,`fetchAndPersistPublicKey`,async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async e=>{let t=await this.fetchPublicKey();t&&(await this.persistPublicKey(t),e(t))});let e=await this.fetchPromise;return this.fetchPromise=void 0,e}),Ym(this,`validateAttestation`,(e,t)=>{let n=Yc(e,t.publicKey),r={hasExpired:(0,U.toMiliseconds)(n.exp)<Date.now(),payload:n};if(r.hasExpired)throw this.logger.warn(`resolve: jwt attestation expired`),Error(`JWT attestation expired`);return{origin:r.payload.origin,isScam:r.payload.isScam,isVerified:r.payload.isVerified}}),this.logger=be(t,this.name),this.abortController=new AbortController,this.isDevEnv=Kr(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+`//verify:public:key`}get context(){return Se(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,U.toMiliseconds)(e))}},Zm=Object.defineProperty,Qm=(e,t,n)=>t in e?Zm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,$m=(e,t,n)=>Qm(e,typeof t==`symbol`?t:t+``,n),eh=class extends Ft{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,$m(this,`context`,Zu),$m(this,`registerDeviceToken`,async e=>{let{clientId:t,token:n,notificationType:r,enableEncrypted:i=!1}=e,a=`${Qu}/${this.projectId}/clients`;await fetch(a,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({client_id:t,type:r,token:n,always_raw:i})})}),this.logger=be(t,this.context)}},th=Object.defineProperty,nh=Object.getOwnPropertySymbols,rh=Object.prototype.hasOwnProperty,ih=Object.prototype.propertyIsEnumerable,ah=(e,t,n)=>t in e?th(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,oh=(e,t)=>{for(var n in t||={})rh.call(t,n)&&ah(e,n,t[n]);if(nh)for(var n of nh(t))ih.call(t,n)&&ah(e,n,t[n]);return e},sh=(e,t,n)=>ah(e,typeof t==`symbol`?t:t+``,n),ch=class extends It{constructor(e,t,n=!0){super(e,t,n),this.core=e,this.logger=t,sh(this,`context`,od),sh(this,`storagePrefix`,xu),sh(this,`storageVersion`,ad),sh(this,`events`,new Map),sh(this,`shouldPersist`,!1),sh(this,`init`,async()=>{if(!Kr())try{let e={eventId:Gr(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:`INIT`,type:``,properties:{client_id:await this.core.crypto.getClientId(),user_agent:Er(this.core.relayer.protocol,this.core.relayer.version,Pu)}}};await this.sendEvent([e])}catch(e){this.logger.warn(e)}}),sh(this,`createEvent`,e=>{let{event:t=`ERROR`,type:n=``,properties:{topic:r,trace:i}}=e,a=Gr(),o=this.core.projectId||``,s=oh({eventId:a,timestamp:Date.now(),props:{event:t,type:n,properties:{topic:r,trace:i}},bundleId:o,domain:this.getAppDomain()},this.setMethods(a));return this.telemetryEnabled&&(this.events.set(a,s),this.shouldPersist=!0),s}),sh(this,`getEvent`,e=>{let{eventId:t,topic:n}=e;if(t)return this.events.get(t);let r=Array.from(this.events.values()).find(e=>e.props.properties.topic===n);if(r)return oh(oh({},r),this.setMethods(r.eventId))}),sh(this,`deleteEvent`,e=>{let{eventId:t}=e;this.events.delete(t),this.shouldPersist=!0}),sh(this,`setEventListeners`,()=>{this.core.heartbeat.on(ce.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(e=>{(0,U.fromMiliseconds)(Date.now())-(0,U.fromMiliseconds)(e.timestamp)>86400&&(this.events.delete(e.eventId),this.shouldPersist=!0)})})}),sh(this,`setMethods`,e=>({addTrace:t=>this.addTrace(e,t),setError:t=>this.setError(e,t)})),sh(this,`addTrace`,(e,t)=>{let n=this.events.get(e);n&&(n.props.properties.trace.push(t),this.events.set(e,n),this.shouldPersist=!0)}),sh(this,`setError`,(e,t)=>{let n=this.events.get(e);n&&(n.props.type=t,n.timestamp=Date.now(),this.events.set(e,n),this.shouldPersist=!0)}),sh(this,`persist`,async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),sh(this,`restore`,async()=>{try{let e=await this.core.storage.getItem(this.storageKey)||[];if(!e.length)return;e.forEach(e=>{this.events.set(e.eventId,oh(oh({},e),this.setMethods(e.eventId)))})}catch(e){this.logger.warn(e)}}),sh(this,`submit`,async()=>{if(!this.telemetryEnabled||this.events.size===0)return;let e=[];for(let[t,n]of this.events)n.props.type&&e.push(n);if(e.length!==0)try{if((await this.sendEvent(e)).ok)for(let t of e)this.events.delete(t.eventId),this.shouldPersist=!0}catch(e){this.logger.warn(e)}}),sh(this,`sendEvent`,async e=>{let t=this.getAppDomain()?``:`&sp=desktop`;return await fetch(`${sd}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Pu}${t}`,{method:`POST`,body:JSON.stringify(e)})}),sh(this,`getAppDomain`,()=>Cr().url),this.logger=be(t,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+`//`+this.context}},lh=Object.defineProperty,uh=Object.getOwnPropertySymbols,dh=Object.prototype.hasOwnProperty,fh=Object.prototype.propertyIsEnumerable,ph=(e,t,n)=>t in e?lh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,mh=(e,t)=>{for(var n in t||={})dh.call(t,n)&&ph(e,n,t[n]);if(uh)for(var n of uh(t))fh.call(t,n)&&ph(e,n,t[n]);return e},J=(e,t,n)=>ph(e,typeof t==`symbol`?t:t+``,n),hh=class e extends Ct{constructor(e){var t;super(e),J(this,`protocol`,`wc`),J(this,`version`,2),J(this,`name`,bu),J(this,`relayUrl`),J(this,`projectId`),J(this,`customStoragePrefix`),J(this,`events`,new vu.EventEmitter),J(this,`logger`),J(this,`heartbeat`),J(this,`relayer`),J(this,`crypto`),J(this,`storage`),J(this,`history`),J(this,`expirer`),J(this,`pairing`),J(this,`verify`),J(this,`echoClient`),J(this,`linkModeSupportedApps`),J(this,`eventClient`),J(this,`initialized`,!1),J(this,`logChunkController`),J(this,`on`,(e,t)=>this.events.on(e,t)),J(this,`once`,(e,t)=>this.events.once(e,t)),J(this,`off`,(e,t)=>this.events.off(e,t)),J(this,`removeListener`,(e,t)=>this.events.removeListener(e,t)),J(this,`dispatchEnvelope`,({topic:e,message:t,sessionExists:n})=>{if(!e||!t)return;let r={topic:e,message:t,publishedAt:Date.now(),transportType:W.link_mode};this.relayer.onLinkMessageEvent(r,{sessionExists:n})});let n=this.getGlobalCore(e?.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(e){console.warn(`Failed to copy global core`,e)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||`wss://relay.walletconnect.org`,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:``;let{logger:r,chunkLoggerController:i}=Te({opts:Ie({level:typeof e?.logger==`string`&&e.logger?e.logger:Su.logger,name:bu}),maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=i,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var e,t;(e=this.logChunkController)!=null&&e.downloadLogsBlobInBrowser&&((t=this.logChunkController)==null||t.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=be(r,this.name),this.heartbeat=new de,this.crypto=new rp(this,this.logger,e?.keychain),this.history=new Hm(this,this.logger),this.expirer=new Km(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new me(mh(mh({},Cu),e?.storageOptions)),this.relayer=new Kp({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Rm(this,this.logger),this.verify=new Xm(this,this.logger,this.storage),this.echoClient=new eh(this.projectId||``,this.logger),this.linkModeSupportedApps=[],this.eventClient=new ch(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(t){let n=new e(t);await n.initialize();let r=await n.crypto.getClientId();return await n.storage.setItem(Iu,r),n}get context(){return Se(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){return this.logChunkController?.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(`WALLETCONNECT_LINK_MODE_APPS`,this.linkModeSupportedApps))}async initialize(){this.logger.trace(`Initialized`);try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(`WALLETCONNECT_LINK_MODE_APPS`)||[],this.initialized=!0,this.logger.info(`Core Initialization Success`)}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=``){try{if(this.isGlobalCoreDisabled())return;let t=`_walletConnectCore_${e}`,n=`${t}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[t]}catch(e){console.warn(`Failed to get global WalletConnect core`,e);return}}setGlobalCore(e){try{if(this.isGlobalCoreDisabled())return;let t=`_walletConnectCore_${e.opts?.customStoragePrefix||``}`;globalThis[t]=e}catch(e){console.warn(`Failed to set global WalletConnect core`,e)}}isGlobalCoreDisabled(){try{return typeof process<`u`&&{}.DISABLE_GLOBAL_CORE===`true`}catch{return!0}}},Y=ne(),gh=s(te()),_h=`client`,vh=`wc@2:${_h}:`,yh={name:_h,logger:`error`,controller:!1,relayUrl:`wss://relay.walletconnect.org`},bh=`WALLETCONNECT_DEEPLINK_CHOICE`,xh=`proposal`;Y.THIRTY_DAYS;var Sh=`Proposal expired`,Ch=`session`,wh=Y.SEVEN_DAYS,Th=`engine`,Eh={wc_sessionPropose:{req:{ttl:Y.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Y.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Y.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Y.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Y.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Y.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Y.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Y.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Y.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Y.ONE_DAY,prompt:!1,tag:1114},res:{ttl:Y.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:Y.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:Y.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:Y.FIVE_MINUTES,prompt:!1,tag:1119}}},Dh={min:Y.FIVE_MINUTES,max:Y.SEVEN_DAYS},Oh={idle:`IDLE`,active:`ACTIVE`},kh={eth_sendTransaction:{key:``},eth_sendRawTransaction:{key:``},wallet_sendCalls:{key:``},solana_signTransaction:{key:`signature`},solana_signAllTransactions:{key:`transactions`},solana_signAndSendTransaction:{key:`signature`}},Ah=`request`,jh=[`wc_sessionPropose`,`wc_sessionRequest`,`wc_authRequest`,`wc_sessionAuthenticate`],Mh=`auth`,Nh=`authKeys`,Ph=`pairingTopics`,Fh=`requests`,Ih=`wc@1.5:${Mh}:`,Lh=`${Ih}:PUB_KEY`,Rh=Object.defineProperty,zh=Object.defineProperties,Bh=Object.getOwnPropertyDescriptors,Vh=Object.getOwnPropertySymbols,Hh=Object.prototype.hasOwnProperty,Uh=Object.prototype.propertyIsEnumerable,Wh=(e,t,n)=>t in e?Rh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,X=(e,t)=>{for(var n in t||={})Hh.call(t,n)&&Wh(e,n,t[n]);if(Vh)for(var n of Vh(t))Uh.call(t,n)&&Wh(e,n,t[n]);return e},Gh=(e,t)=>zh(e,Bh(t)),Z=(e,t,n)=>Wh(e,typeof t==`symbol`?t:t+``,n),Kh=class extends Vt{constructor(e){super(e),Z(this,`name`,Th),Z(this,`events`,new gh.default),Z(this,`initialized`,!1),Z(this,`requestQueue`,{state:Oh.idle,queue:[]}),Z(this,`sessionRequestQueue`,{state:Oh.idle,queue:[]}),Z(this,`requestQueueDelay`,Y.ONE_SECOND),Z(this,`expectedPairingMethodMap`,new Map),Z(this,`recentlyDeletedMap`,new Map),Z(this,`recentlyDeletedLimit`,200),Z(this,`relayMessageCache`,[]),Z(this,`pendingSessions`,new Map),Z(this,`init`,async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Eh)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,Y.toMiliseconds)(this.requestQueueDelay)))}),Z(this,`connect`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let t=Gh(X({},e),{requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}});await this.isValidConnect(t),t.optionalNamespaces=Sl(t.requiredNamespaces,t.optionalNamespaces),t.requiredNamespaces={};let{pairingTopic:n,requiredNamespaces:r,optionalNamespaces:i,sessionProperties:a,scopedProperties:o,relays:s}=t,c=n,l,u=!1;try{if(c){let e=this.client.core.pairing.pairings.get(c);this.client.logger.warn(`connect() with existing pairing topic is deprecated and will be removed in the next major release.`),u=e.active}}catch(e){throw this.client.logger.error(`connect() -> pairing.get(${c}) failed`),e}if(!c||!u){let{topic:e,uri:t}=await this.client.core.pairing.create();c=e,l=t}if(!c){let{message:e}=V(`NO_MATCHING_KEY`,`connect() pairing topic: ${c}`);throw Error(e)}let d=await this.client.core.crypto.generateKeyPair(),f=Eh.wc_sessionPropose.req.ttl||Y.FIVE_MINUTES,p=Lr(f),m=Gh(X(X({requiredNamespaces:r,optionalNamespaces:i,relays:s??[{protocol:`irn`}],proposer:{publicKey:d,metadata:this.client.metadata},expiryTimestamp:p,pairingTopic:c},a&&{sessionProperties:a}),o&&{scopedProperties:o}),{id:De()}),h=z(`session_connect`,m.id),{reject:g,resolve:_,done:v}=jr(f,Sh),y=({id:e})=>{e===m.id&&(this.client.events.off(`proposal_expire`,y),this.pendingSessions.delete(m.id),this.events.emit(h,{error:{message:`Proposal expired`,code:0}}))};return this.client.events.on(`proposal_expire`,y),this.events.once(h,({error:e,session:t})=>{this.client.events.off(`proposal_expire`,y),e?g(e):t&&_(t)}),await this.sendRequest({topic:c,method:`wc_sessionPropose`,params:m,throwOnFailedPublish:!0,clientRpcId:m.id}),await this.setProposal(m.id,m),{uri:l,approval:v}}),Z(this,`pair`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(e)}catch(e){throw this.client.logger.error(`pair() failed`),e}}),Z(this,`approve`,async e=>{let t=this.client.core.eventClient.createEvent({properties:{topic:(e?.id)?.toString(),trace:[td.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(e){throw t.setError(nd.no_internet_connection),e}try{await this.isValidProposalId(e?.id)}catch(n){throw this.client.logger.error(`approve() -> proposal.get(${e?.id}) failed`),t.setError(nd.proposal_not_found),n}try{await this.isValidApprove(e)}catch(e){throw this.client.logger.error(`approve() -> isValidApprove() failed`),t.setError(nd.session_approve_namespace_validation_failure),e}let{id:n,relayProtocol:r,namespaces:i,sessionProperties:a,scopedProperties:o,sessionConfig:s}=e,c=this.client.proposal.get(n);this.client.core.eventClient.deleteEvent({eventId:t.eventId});let{pairingTopic:l,proposer:u,requiredNamespaces:d,optionalNamespaces:f}=c,p=this.client.core.eventClient?.getEvent({topic:l});p||=this.client.core.eventClient?.createEvent({type:td.session_approve_started,properties:{topic:l,trace:[td.session_approve_started,td.session_namespaces_validation_success]}});let m=await this.client.core.crypto.generateKeyPair(),h=u.publicKey,g=await this.client.core.crypto.generateSharedKey(m,h),_=X(X(X({relay:{protocol:r??`irn`},namespaces:i,controller:{publicKey:m,metadata:this.client.metadata},expiry:Lr(wh)},a&&{sessionProperties:a}),o&&{scopedProperties:o}),s&&{sessionConfig:s}),v=W.relay;p.addTrace(td.subscribing_session_topic);try{await this.client.core.relayer.subscribe(g,{transportType:v})}catch(e){throw p.setError(nd.subscribe_session_topic_failure),e}p.addTrace(td.subscribe_session_topic_success);let y=Gh(X({},_),{topic:g,requiredNamespaces:d,optionalNamespaces:f,pairingTopic:l,acknowledged:!1,self:_.controller,peer:{publicKey:u.publicKey,metadata:u.metadata},controller:m,transportType:W.relay});await this.client.session.set(g,y),p.addTrace(td.store_session);try{p.addTrace(td.publishing_session_settle),await this.sendRequest({topic:g,method:`wc_sessionSettle`,params:_,throwOnFailedPublish:!0}).catch(e=>{throw p?.setError(nd.session_settle_publish_failure),e}),p.addTrace(td.session_settle_publish_success),p.addTrace(td.publishing_session_approve),await this.sendResult({id:n,topic:l,result:{relay:{protocol:r??`irn`},responderPublicKey:m},throwOnFailedPublish:!0}).catch(e=>{throw p?.setError(nd.session_approve_publish_failure),e}),p.addTrace(td.session_approve_publish_success)}catch(e){throw this.client.logger.error(e),this.client.session.delete(g,H(`USER_DISCONNECTED`)),await this.client.core.relayer.unsubscribe(g),e}return this.client.core.eventClient.deleteEvent({eventId:p.eventId}),await this.client.core.pairing.updateMetadata({topic:l,metadata:u.metadata}),await this.client.proposal.delete(n,H(`USER_DISCONNECTED`)),await this.client.core.pairing.activate({topic:l}),await this.setExpiry(g,Lr(wh)),{topic:g,acknowledged:()=>Promise.resolve(this.client.session.get(g))}}),Z(this,`reject`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(e)}catch(e){throw this.client.logger.error(`reject() -> isValidReject() failed`),e}let{id:t,reason:n}=e,r;try{r=this.client.proposal.get(t).pairingTopic}catch(e){throw this.client.logger.error(`reject() -> proposal.get(${t}) failed`),e}r&&(await this.sendError({id:t,topic:r,error:n,rpcOpts:Eh.wc_sessionPropose.reject}),await this.client.proposal.delete(t,H(`USER_DISCONNECTED`)))}),Z(this,`update`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(e)}catch(e){throw this.client.logger.error(`update() -> isValidUpdate() failed`),e}let{topic:t,namespaces:n}=e,{done:r,resolve:i,reject:a}=jr(),o=De(),s=Ae().toString(),c=this.client.session.get(t).namespaces;return this.events.once(z(`session_update`,o),({error:e})=>{e?a(e):i()}),await this.client.session.update(t,{namespaces:n}),await this.sendRequest({topic:t,method:`wc_sessionUpdate`,params:{namespaces:n},throwOnFailedPublish:!0,clientRpcId:o,relayRpcId:s}).catch(e=>{this.client.logger.error(e),this.client.session.update(t,{namespaces:c}),a(e)}),{acknowledged:r}}),Z(this,`extend`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(e)}catch(e){throw this.client.logger.error(`extend() -> isValidExtend() failed`),e}let{topic:t}=e,n=De(),{done:r,resolve:i,reject:a}=jr();return this.events.once(z(`session_extend`,n),({error:e})=>{e?a(e):i()}),await this.setExpiry(t,Lr(wh)),this.sendRequest({topic:t,method:`wc_sessionExtend`,params:{},clientRpcId:n,throwOnFailedPublish:!0}).catch(e=>{a(e)}),{acknowledged:r}}),Z(this,`request`,async e=>{this.isInitialized();try{await this.isValidRequest(e)}catch(e){throw this.client.logger.error(`request() -> isValidRequest() failed`),e}let{chainId:t,request:n,topic:r,expiry:i=Eh.wc_sessionRequest.req.ttl}=e,a=this.client.session.get(r);a?.transportType===W.relay&&await this.confirmOnlineStateOrThrow();let o=De(),s=Ae().toString(),{done:c,resolve:l,reject:u}=jr(i,`Request expired. Please try again.`);this.events.once(z(`session_request`,o),({error:e,result:t})=>{e?u(e):l(t)});let d=`wc_sessionRequest`,f=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(f)return await this.sendRequest({clientRpcId:o,relayRpcId:s,topic:r,method:d,params:{request:Gh(X({},n),{expiryTimestamp:Lr(i)}),chainId:t},expiry:i,throwOnFailedPublish:!0,appLink:f}).catch(e=>u(e)),this.client.events.emit(`session_request_sent`,{topic:r,request:n,chainId:t,id:o}),await c();let p={request:Gh(X({},n),{expiryTimestamp:Lr(i)}),chainId:t},m=this.shouldSetTVF(d,p);return await Promise.all([new Promise(async e=>{await this.sendRequest(X({clientRpcId:o,relayRpcId:s,topic:r,method:d,params:p,expiry:i,throwOnFailedPublish:!0},m&&{tvf:this.getTVFParams(o,p)})).catch(e=>u(e)),this.client.events.emit(`session_request_sent`,{topic:r,request:n,chainId:t,id:o}),e()}),new Promise(async e=>{var t;(t=a.sessionConfig)!=null&&t.disableDeepLink||await Br({id:o,topic:r,wcDeepLink:await Ur(this.client.core.storage,bh)}),e()}),c()]).then(e=>e[2])}),Z(this,`respond`,async e=>{this.isInitialized(),await this.isValidRespond(e);let{topic:t,response:n}=e,{id:r}=n,i=this.client.session.get(t);i.transportType===W.relay&&await this.confirmOnlineStateOrThrow();let a=this.getAppLinkIfEnabled(i.peer.metadata,i.transportType);je(n)?await this.sendResult({id:r,topic:t,result:n.result,throwOnFailedPublish:!0,appLink:a}):Ee(n)&&await this.sendError({id:r,topic:t,error:n.error,appLink:a}),this.cleanupAfterResponse(e)}),Z(this,`ping`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(e)}catch(e){throw this.client.logger.error(`ping() -> isValidPing() failed`),e}let{topic:t}=e;if(this.client.session.keys.includes(t)){let e=De(),n=Ae().toString(),{done:r,resolve:i,reject:a}=jr();this.events.once(z(`session_ping`,e),({error:e})=>{e?a(e):i()}),await Promise.all([this.sendRequest({topic:t,method:`wc_sessionPing`,params:{},throwOnFailedPublish:!0,clientRpcId:e,relayRpcId:n}),r()])}else this.client.core.pairing.pairings.keys.includes(t)&&(this.client.logger.warn(`ping() on pairing topic is deprecated and will be removed in the next major release.`),await this.client.core.pairing.ping({topic:t}))}),Z(this,`emit`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(e);let{topic:t,event:n,chainId:r}=e,i=Ae().toString(),a=De();await this.sendRequest({topic:t,method:`wc_sessionEvent`,params:{event:n,chainId:r},throwOnFailedPublish:!0,relayRpcId:i,clientRpcId:a})}),Z(this,`disconnect`,async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(e);let{topic:t}=e;if(this.client.session.keys.includes(t))await this.sendRequest({topic:t,method:`wc_sessionDelete`,params:H(`USER_DISCONNECTED`),throwOnFailedPublish:!0}),await this.deleteSession({topic:t,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(t))await this.client.core.pairing.disconnect({topic:t});else{let{message:e}=V(`MISMATCHED_TOPIC`,`Session or pairing topic not found: ${t}`);throw Error(e)}}),Z(this,`find`,e=>(this.isInitialized(),this.client.session.getAll().filter(t=>Al(t,e)))),Z(this,`getPendingSessionRequests`,()=>this.client.pendingRequest.getAll()),Z(this,`authenticate`,async(e,t)=>{this.isInitialized(),this.isValidAuthenticate(e);let n=t&&this.client.core.linkModeSupportedApps.includes(t)&&this.client.metadata.redirect?.linkMode,r=n?W.link_mode:W.relay;r===W.relay&&await this.confirmOnlineStateOrThrow();let{chains:i,statement:a=``,uri:o,domain:s,nonce:c,type:l,exp:u,nbf:d,methods:f=[],expiry:p}=e,m=[...e.resources||[]],{topic:h,uri:g}=await this.client.core.pairing.create({methods:[`wc_sessionAuthenticate`],transportType:r});this.client.logger.info({message:`Generated new pairing`,pairing:{topic:h,uri:g}});let _=await this.client.core.crypto.generateKeyPair(),v=Mc(_);if(await Promise.all([this.client.auth.authKeys.set(Lh,{responseTopic:v,publicKey:_}),this.client.auth.pairingTopics.set(v,{topic:v,pairingTopic:h})]),await this.client.core.relayer.subscribe(v,{transportType:r}),this.client.logger.info(`sending request to new pairing topic: ${h}`),f.length>0){let{namespace:e}=nr(i[0]),t=_a(e,`request`,f);wa(m)&&(t=ya(t,m.pop())),m.push(t)}let y=p&&p>Eh.wc_sessionAuthenticate.req.ttl?p:Eh.wc_sessionAuthenticate.req.ttl,b={authPayload:{type:l??`caip122`,chains:i,statement:a,aud:o,domain:s,version:`1`,nonce:c,iat:new Date().toISOString(),exp:u,nbf:d,resources:m},requester:{publicKey:_,metadata:this.client.metadata},expiryTimestamp:Lr(y)},x={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:i,methods:[...new Set([`personal_sign`,...f])],events:[`chainChanged`,`accountsChanged`]}},relays:[{protocol:`irn`}],pairingTopic:h,proposer:{publicKey:_,metadata:this.client.metadata},expiryTimestamp:Lr(Eh.wc_sessionPropose.req.ttl),id:De()},{done:ee,resolve:S,reject:C}=jr(y,`Request expired`),w=De(),T=z(`session_connect`,x.id),E=z(`session_request`,w),D=async({error:e,session:t})=>{this.events.off(E,O),e?C(e):t&&S({session:t})},O=async e=>{var n,i,a;if(await this.deletePendingAuthRequest(w,{message:`fulfilled`,code:0}),e.error){let t=H(`WC_METHOD_UNSUPPORTED`,`wc_sessionAuthenticate`);return e.error.code===t.code?void 0:(this.events.off(T,D),C(e.error.message))}await this.deleteProposal(x.id),this.events.off(T,D);let{cacaos:o,responder:s}=e.result,c=[],l=[];for(let e of o){await ca({cacao:e,projectId:this.client.core.projectId})||(this.client.logger.error(e,`Signature verification failed`),C(H(`SESSION_SETTLEMENT_FAILED`,`Signature verification failed`)));let{p:t}=e,n=wa(t.resources),r=[oa(t.iss)],i=sa(t.iss);if(n){let e=Sa(n),t=Ca(n);c.push(...e),r.push(...t)}for(let e of r)l.push(`${e}:${i}`)}let u=await this.client.core.crypto.generateSharedKey(_,s.publicKey),d;c.length>0&&(d={topic:u,acknowledged:!0,self:{publicKey:_,metadata:this.client.metadata},peer:s,controller:s.publicKey,expiry:Lr(wh),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:`irn`},pairingTopic:h,namespaces:xl([...new Set(c)],[...new Set(l)]),transportType:r},await this.client.core.relayer.subscribe(u,{transportType:r}),await this.client.session.set(u,d),h&&await this.client.core.pairing.updateMetadata({topic:h,metadata:s.metadata}),d=this.client.session.get(u)),(n=this.client.metadata.redirect)!=null&&n.linkMode&&(i=s.metadata.redirect)!=null&&i.linkMode&&(a=s.metadata.redirect)!=null&&a.universal&&t&&(this.client.core.addLinkModeSupportedApp(s.metadata.redirect.universal),this.client.session.update(u,{transportType:W.link_mode})),S({auths:o,session:d})};this.events.once(T,D),this.events.once(E,O);let k;try{if(n){let e=Ce(`wc_sessionAuthenticate`,b,w);this.client.core.history.set(h,e),k=rl(t,h,await this.client.core.crypto.encode(``,e,{type:2,encoding:Cc}))}else await Promise.all([this.sendRequest({topic:h,method:`wc_sessionAuthenticate`,params:b,expiry:e.expiry,throwOnFailedPublish:!0,clientRpcId:w}),this.sendRequest({topic:h,method:`wc_sessionPropose`,params:x,expiry:Eh.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:x.id})])}catch(e){throw this.events.off(T,D),this.events.off(E,O),e}return await this.setProposal(x.id,x),await this.setAuthRequest(w,{request:Gh(X({},b),{verifyContext:{}}),pairingTopic:h,transportType:r}),{uri:k??g,response:ee}}),Z(this,`approveSessionAuthenticate`,async e=>{let{id:t,auths:n}=e,r=this.client.core.eventClient.createEvent({properties:{topic:t.toString(),trace:[rd.authenticated_session_approve_started]}});try{this.isInitialized()}catch(e){throw r.setError(id.no_internet_connection),e}let i=this.getPendingAuthRequest(t);if(!i)throw r.setError(id.authenticated_session_pending_request_not_found),Error(`Could not find pending auth request with id ${t}`);let a=i.transportType||W.relay;a===W.relay&&await this.confirmOnlineStateOrThrow();let o=i.requester.publicKey,s=await this.client.core.crypto.generateKeyPair(),c=Mc(o),l={type:1,receiverPublicKey:o,senderPublicKey:s},u=[],d=[];for(let e of n){if(!await ca({cacao:e,projectId:this.client.core.projectId})){r.setError(id.invalid_cacao);let e=H(`SESSION_SETTLEMENT_FAILED`,`Signature verification failed`);throw await this.sendError({id:t,topic:c,error:e,encodeOpts:l}),Error(e.message)}r.addTrace(rd.cacaos_verified);let{p:n}=e,i=wa(n.resources),a=[oa(n.iss)],o=sa(n.iss);if(i){let e=Sa(i),t=Ca(i);u.push(...e),a.push(...t)}for(let e of a)d.push(`${e}:${o}`)}let f=await this.client.core.crypto.generateSharedKey(s,o);r.addTrace(rd.create_authenticated_session_topic);let p;if(u?.length>0){p={topic:f,acknowledged:!0,self:{publicKey:s,metadata:this.client.metadata},peer:{publicKey:o,metadata:i.requester.metadata},controller:o,expiry:Lr(wh),authentication:n,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:`irn`},pairingTopic:i.pairingTopic,namespaces:xl([...new Set(u)],[...new Set(d)]),transportType:a},r.addTrace(rd.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(f,{transportType:a})}catch(e){throw r.setError(id.subscribe_authenticated_session_topic_failure),e}r.addTrace(rd.subscribe_authenticated_session_topic_success),await this.client.session.set(f,p),r.addTrace(rd.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:i.pairingTopic,metadata:i.requester.metadata})}r.addTrace(rd.publishing_authenticated_session_approve);try{await this.sendResult({topic:c,id:t,result:{cacaos:n,responder:{publicKey:s,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(i.requester.metadata,a)})}catch(e){throw r.setError(id.authenticated_session_approve_publish_failure),e}return await this.client.auth.requests.delete(t,{message:`fulfilled`,code:0}),await this.client.core.pairing.activate({topic:i.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:r.eventId}),{session:p}}),Z(this,`rejectSessionAuthenticate`,async e=>{this.isInitialized();let{id:t,reason:n}=e,r=this.getPendingAuthRequest(t);if(!r)throw Error(`Could not find pending auth request with id ${t}`);r.transportType===W.relay&&await this.confirmOnlineStateOrThrow();let i=r.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),o=Mc(i),s={type:1,receiverPublicKey:i,senderPublicKey:a};await this.sendError({id:t,topic:o,error:n,encodeOpts:s,rpcOpts:Eh.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(r.requester.metadata,r.transportType)}),await this.client.auth.requests.delete(t,{message:`rejected`,code:0}),await this.client.proposal.delete(t,H(`USER_DISCONNECTED`))}),Z(this,`formatAuthMessage`,e=>{this.isInitialized();let{request:t,iss:n}=e;return la(t,n)}),Z(this,`processRelayMessageCache`,()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{let e=this.relayMessageCache.shift();e&&await this.onRelayMessage(e)}catch(e){this.client.logger.error(e)}},50)}),Z(this,`cleanupDuplicatePairings`,async e=>{if(e.pairingTopic)try{let t=this.client.core.pairing.pairings.get(e.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(n=>n.peerMetadata?.url&&n.peerMetadata?.url===e.peer.metadata.url&&n.topic&&n.topic!==t.topic);if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(e=>this.client.core.pairing.disconnect({topic:e.topic}))),this.client.logger.info(`Duplicate pairings clean up finished`)}catch(e){this.client.logger.error(e)}}),Z(this,`deleteSession`,async e=>{let{topic:t,expirerHasDeleted:n=!1,emitEvent:r=!0,id:i=0}=e,{self:a}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),await this.client.session.delete(t,H(`USER_DISCONNECTED`)),this.addToRecentlyDeleted(t,`session`),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(t)&&await this.client.core.crypto.deleteSymKey(t),n||this.client.core.expirer.del(t),this.client.core.storage.removeItem(bh).catch(e=>this.client.logger.warn(e)),this.getPendingSessionRequests().forEach(e=>{e.topic===t&&this.deletePendingSessionRequest(e.id,H(`USER_DISCONNECTED`))}),t===this.sessionRequestQueue.queue[0]?.topic&&(this.sessionRequestQueue.state=Oh.idle),r&&this.client.events.emit(`session_delete`,{id:i,topic:t})}),Z(this,`deleteProposal`,async(e,t)=>{if(t)try{let t=this.client.proposal.get(e);this.client.core.eventClient.getEvent({topic:t.pairingTopic})?.setError(nd.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(e,H(`USER_DISCONNECTED`)),t?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,`proposal`)}),Z(this,`deletePendingSessionRequest`,async(e,t,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(e,t),n?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,`request`),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(t=>t.id!==e),n&&(this.sessionRequestQueue.state=Oh.idle,this.client.events.emit(`session_request_expire`,{id:e}))}),Z(this,`deletePendingAuthRequest`,async(e,t,n=!1)=>{await Promise.all([this.client.auth.requests.delete(e,t),n?Promise.resolve():this.client.core.expirer.del(e)])}),Z(this,`setExpiry`,async(e,t)=>{this.client.session.keys.includes(e)&&(this.client.core.expirer.set(e,t),await this.client.session.update(e,{expiry:t}))}),Z(this,`setProposal`,async(e,t)=>{this.client.core.expirer.set(e,Lr(Eh.wc_sessionPropose.req.ttl)),await this.client.proposal.set(e,t)}),Z(this,`setAuthRequest`,async(e,t)=>{let{request:n,pairingTopic:r,transportType:i=W.relay}=t;this.client.core.expirer.set(e,n.expiryTimestamp),await this.client.auth.requests.set(e,{authPayload:n.authPayload,requester:n.requester,expiryTimestamp:n.expiryTimestamp,id:e,pairingTopic:r,verifyContext:n.verifyContext,transportType:i})}),Z(this,`setPendingSessionRequest`,async e=>{let{id:t,topic:n,params:r,verifyContext:i}=e,a=r.request.expiryTimestamp||Lr(Eh.wc_sessionRequest.req.ttl);this.client.core.expirer.set(t,a),await this.client.pendingRequest.set(t,{id:t,topic:n,params:r,verifyContext:i})}),Z(this,`sendRequest`,async e=>{let{topic:t,method:n,params:r,expiry:i,relayRpcId:a,clientRpcId:o,throwOnFailedPublish:s,appLink:c,tvf:l}=e,u=Ce(n,r,o),d,f=!!c;try{let e=f?Cc:Sc;d=await this.client.core.crypto.encode(t,u,{encoding:e})}catch(e){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${t} failed`),e}let p;if(jh.includes(n)){let e=Nc(JSON.stringify(u)),t=Nc(d);p=await this.client.core.verify.register({id:t,decryptedId:e})}let m=Eh[n].req;if(m.attestation=p,i&&(m.ttl=i),a&&(m.id=a),this.client.core.history.set(t,u),f){let e=rl(c,t,d);await global.Linking.openURL(e,this.client.name)}else{let e=Eh[n].req;i&&(e.ttl=i),a&&(e.id=a),e.tvf=Gh(X({},l),{correlationId:u.id}),s?(e.internal=Gh(X({},e.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(t,d,e)):this.client.core.relayer.publish(t,d,e).catch(e=>this.client.logger.error(e))}return u.id}),Z(this,`sendResult`,async e=>{let{id:t,topic:n,result:r,throwOnFailedPublish:i,encodeOpts:a,appLink:o}=e,s=we(t,r),c,l=o&&typeof(global==null?void 0:global.Linking)<`u`;try{let e=l?Cc:Sc;c=await this.client.core.crypto.encode(n,s,Gh(X({},a||{}),{encoding:e}))}catch(e){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${n} failed`),e}let u,d;try{u=await this.client.core.history.get(n,t);let e=u.request;try{this.shouldSetTVF(e.method,e.params)&&(d=this.getTVFParams(t,e.params,r))}catch(e){this.client.logger.warn(`sendResult() -> getTVFParams() failed`,e)}}catch(e){throw this.client.logger.error(`sendResult() -> history.get(${n}, ${t}) failed`),e}if(l){let e=rl(o,n,c);await global.Linking.openURL(e,this.client.name)}else{let e=Eh[u.request.method].res;e.tvf=Gh(X({},d),{correlationId:t}),i?(e.internal=Gh(X({},e.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,c,e)):this.client.core.relayer.publish(n,c,e).catch(e=>this.client.logger.error(e))}await this.client.core.history.resolve(s)}),Z(this,`sendError`,async e=>{let{id:t,topic:n,error:r,encodeOpts:i,rpcOpts:a,appLink:o}=e,s=Ne(t,r),c,l=o&&typeof(global==null?void 0:global.Linking)<`u`;try{let e=l?Cc:Sc;c=await this.client.core.crypto.encode(n,s,Gh(X({},i||{}),{encoding:e}))}catch(e){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${n} failed`),e}let u;try{u=await this.client.core.history.get(n,t)}catch(e){throw this.client.logger.error(`sendError() -> history.get(${n}, ${t}) failed`),e}if(l){let e=rl(o,n,c);await global.Linking.openURL(e,this.client.name)}else{let e=u.request.method,t=a||Eh[e].res;this.client.core.relayer.publish(n,c,t)}await this.client.core.history.resolve(s)}),Z(this,`cleanup`,async()=>{let e=[],t=[];this.client.session.getAll().forEach(t=>{let n=!1;Rr(t.expiry)&&(n=!0),this.client.core.crypto.keychain.has(t.topic)||(n=!0),n&&e.push(t.topic)}),this.client.proposal.getAll().forEach(e=>{Rr(e.expiryTimestamp)&&t.push(e.id)}),await Promise.all([...e.map(e=>this.deleteSession({topic:e})),...t.map(e=>this.deleteProposal(e))])}),Z(this,`onProviderMessageEvent`,async e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):await this.onRelayMessage(e)}),Z(this,`onRelayEventRequest`,async e=>{this.requestQueue.queue.push(e),await this.processRequestsQueue()}),Z(this,`processRequestsQueue`,async()=>{if(this.requestQueue.state===Oh.active){this.client.logger.info(`Request queue already active, skipping...`);return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Oh.active;let e=this.requestQueue.queue.shift();if(e)try{await this.processRequest(e)}catch(e){this.client.logger.warn(e)}}this.requestQueue.state=Oh.idle}),Z(this,`processRequest`,async e=>{let{topic:t,payload:n,attestation:r,transportType:i,encryptedId:a}=e,o=n.method;if(!this.shouldIgnorePairingRequest({topic:t,requestMethod:o}))switch(o){case`wc_sessionPropose`:return await this.onSessionProposeRequest({topic:t,payload:n,attestation:r,encryptedId:a});case`wc_sessionSettle`:return await this.onSessionSettleRequest(t,n);case`wc_sessionUpdate`:return await this.onSessionUpdateRequest(t,n);case`wc_sessionExtend`:return await this.onSessionExtendRequest(t,n);case`wc_sessionPing`:return await this.onSessionPingRequest(t,n);case`wc_sessionDelete`:return await this.onSessionDeleteRequest(t,n);case`wc_sessionRequest`:return await this.onSessionRequest({topic:t,payload:n,attestation:r,encryptedId:a,transportType:i});case`wc_sessionEvent`:return await this.onSessionEventRequest(t,n);case`wc_sessionAuthenticate`:return await this.onSessionAuthenticateRequest({topic:t,payload:n,attestation:r,encryptedId:a,transportType:i});default:return this.client.logger.info(`Unsupported request method ${o}`)}}),Z(this,`onRelayEventResponse`,async e=>{let{topic:t,payload:n,transportType:r}=e,i=(await this.client.core.history.get(t,n.id)).request.method;switch(i){case`wc_sessionPropose`:return this.onSessionProposeResponse(t,n,r);case`wc_sessionSettle`:return this.onSessionSettleResponse(t,n);case`wc_sessionUpdate`:return this.onSessionUpdateResponse(t,n);case`wc_sessionExtend`:return this.onSessionExtendResponse(t,n);case`wc_sessionPing`:return this.onSessionPingResponse(t,n);case`wc_sessionRequest`:return this.onSessionRequestResponse(t,n);case`wc_sessionAuthenticate`:return this.onSessionAuthenticateResponse(t,n);default:return this.client.logger.info(`Unsupported response method ${i}`)}}),Z(this,`onRelayEventUnknownPayload`,e=>{let{topic:t}=e,{message:n}=V(`MISSING_OR_INVALID`,`Decoded payload on topic ${t} is not identifiable as a JSON-RPC request or a response.`);throw Error(n)}),Z(this,`shouldIgnorePairingRequest`,e=>{let{topic:t,requestMethod:n}=e,r=this.expectedPairingMethodMap.get(t);return!r||r.includes(n)?!1:!!(r.includes(`wc_sessionAuthenticate`)&&this.client.events.listenerCount(`session_authenticate`)>0)}),Z(this,`onSessionProposeRequest`,async e=>{let{topic:t,payload:n,attestation:r,encryptedId:i}=e,{params:a,id:o}=n;try{let e=this.client.core.eventClient.getEvent({topic:t});this.client.events.listenerCount(`session_proposal`)===0&&(console.warn(`No listener for session_proposal event`),e?.setError(ed.proposal_listener_not_found)),this.isValidConnect(X({},n.params));let s=X({id:o,pairingTopic:t,expiryTimestamp:a.expiryTimestamp||Lr(Eh.wc_sessionPropose.req.ttl)},a);await this.setProposal(o,s);let c=await this.getVerifyContext({attestationId:r,hash:Nc(JSON.stringify(n)),encryptedId:i,metadata:s.proposer.metadata});e?.addTrace($u.emit_session_proposal),this.client.events.emit(`session_proposal`,{id:o,params:s,verifyContext:c})}catch(e){await this.sendError({id:o,topic:t,error:e,rpcOpts:Eh.wc_sessionPropose.autoReject}),this.client.logger.error(e)}}),Z(this,`onSessionProposeResponse`,async(e,t,n)=>{let{id:r}=t;if(je(t)){let{result:i}=t;this.client.logger.trace({type:`method`,method:`onSessionProposeResponse`,result:i});let a=this.client.proposal.get(r);this.client.logger.trace({type:`method`,method:`onSessionProposeResponse`,proposal:a});let o=a.proposer.publicKey;this.client.logger.trace({type:`method`,method:`onSessionProposeResponse`,selfPublicKey:o});let s=i.responderPublicKey;this.client.logger.trace({type:`method`,method:`onSessionProposeResponse`,peerPublicKey:s});let c=await this.client.core.crypto.generateSharedKey(o,s);this.pendingSessions.set(r,{sessionTopic:c,pairingTopic:e,proposalId:r,publicKey:o});let l=await this.client.core.relayer.subscribe(c,{transportType:n});this.client.logger.trace({type:`method`,method:`onSessionProposeResponse`,subscriptionId:l}),await this.client.core.pairing.activate({topic:e})}else if(Ee(t)){await this.client.proposal.delete(r,H(`USER_DISCONNECTED`));let e=z(`session_connect`,r);if(this.events.listenerCount(e)===0)throw Error(`emitting ${e} without any listeners, 954`);this.events.emit(e,{error:t.error})}}),Z(this,`onSessionSettleRequest`,async(e,t)=>{let{id:n,params:r}=t;try{this.isValidSessionSettleRequest(r);let{relay:n,controller:i,expiry:a,namespaces:o,sessionProperties:s,scopedProperties:c,sessionConfig:l}=t.params,u=[...this.pendingSessions.values()].find(t=>t.sessionTopic===e);if(!u)return this.client.logger.error(`Pending session not found for topic ${e}`);let d=this.client.proposal.get(u.proposalId),f=Gh(X(X(X({topic:e,relay:n,expiry:a,namespaces:o,acknowledged:!0,pairingTopic:u.pairingTopic,requiredNamespaces:d.requiredNamespaces,optionalNamespaces:d.optionalNamespaces,controller:i.publicKey,self:{publicKey:u.publicKey,metadata:this.client.metadata},peer:{publicKey:i.publicKey,metadata:i.metadata}},s&&{sessionProperties:s}),c&&{scopedProperties:c}),l&&{sessionConfig:l}),{transportType:W.relay});await this.client.session.set(f.topic,f),await this.setExpiry(f.topic,f.expiry),await this.client.core.pairing.updateMetadata({topic:u.pairingTopic,metadata:f.peer.metadata}),this.client.events.emit(`session_connect`,{session:f}),this.events.emit(z(`session_connect`,u.proposalId),{session:f}),this.pendingSessions.delete(u.proposalId),this.deleteProposal(u.proposalId,!1),this.cleanupDuplicatePairings(f),await this.sendResult({id:t.id,topic:e,result:!0,throwOnFailedPublish:!0})}catch(t){await this.sendError({id:n,topic:e,error:t}),this.client.logger.error(t)}}),Z(this,`onSessionSettleResponse`,async(e,t)=>{let{id:n}=t;je(t)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(z(`session_approve`,n),{})):Ee(t)&&(await this.client.session.delete(e,H(`USER_DISCONNECTED`)),this.events.emit(z(`session_approve`,n),{error:t.error}))}),Z(this,`onSessionUpdateRequest`,async(e,t)=>{let{params:n,id:r}=t;try{let t=`${e}_session_update`,i=_u.get(t);if(i&&this.isRequestOutOfSync(i,r)){this.client.logger.warn(`Discarding out of sync request - ${r}`),this.sendError({id:r,topic:e,error:H(`INVALID_UPDATE_REQUEST`)});return}this.isValidUpdate(X({topic:e},n));try{_u.set(t,r),await this.client.session.update(e,{namespaces:n.namespaces}),await this.sendResult({id:r,topic:e,result:!0,throwOnFailedPublish:!0})}catch(e){throw _u.delete(t),e}this.client.events.emit(`session_update`,{id:r,topic:e,params:n})}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),Z(this,`isRequestOutOfSync`,(e,t)=>t.toString().slice(0,-3)<e.toString().slice(0,-3)),Z(this,`onSessionUpdateResponse`,(e,t)=>{let{id:n}=t,r=z(`session_update`,n);if(this.events.listenerCount(r)===0)throw Error(`emitting ${r} without any listeners`);je(t)?this.events.emit(z(`session_update`,n),{}):Ee(t)&&this.events.emit(z(`session_update`,n),{error:t.error})}),Z(this,`onSessionExtendRequest`,async(e,t)=>{let{id:n}=t;try{this.isValidExtend({topic:e}),await this.setExpiry(e,Lr(wh)),await this.sendResult({id:n,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit(`session_extend`,{id:n,topic:e})}catch(t){await this.sendError({id:n,topic:e,error:t}),this.client.logger.error(t)}}),Z(this,`onSessionExtendResponse`,(e,t)=>{let{id:n}=t,r=z(`session_extend`,n);if(this.events.listenerCount(r)===0)throw Error(`emitting ${r} without any listeners`);je(t)?this.events.emit(z(`session_extend`,n),{}):Ee(t)&&this.events.emit(z(`session_extend`,n),{error:t.error})}),Z(this,`onSessionPingRequest`,async(e,t)=>{let{id:n}=t;try{this.isValidPing({topic:e}),await this.sendResult({id:n,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit(`session_ping`,{id:n,topic:e})}catch(t){await this.sendError({id:n,topic:e,error:t}),this.client.logger.error(t)}}),Z(this,`onSessionPingResponse`,(e,t)=>{let{id:n}=t,r=z(`session_ping`,n);setTimeout(()=>{if(this.events.listenerCount(r)===0)throw Error(`emitting ${r} without any listeners 2176`);je(t)?this.events.emit(z(`session_ping`,n),{}):Ee(t)&&this.events.emit(z(`session_ping`,n),{error:t.error})},500)}),Z(this,`onSessionDeleteRequest`,async(e,t)=>{let{id:n}=t;try{this.isValidDisconnect({topic:e,reason:t.params}),Promise.all([new Promise(t=>{this.client.core.relayer.once(Mu.publish,async()=>{t(await this.deleteSession({topic:e,id:n}))})}),this.sendResult({id:n,topic:e,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:e,error:H(`USER_DISCONNECTED`)})]).catch(e=>this.client.logger.error(e))}catch(e){this.client.logger.error(e)}}),Z(this,`onSessionRequest`,async e=>{var t,n;let{topic:r,payload:i,attestation:a,encryptedId:o,transportType:s}=e,{id:c,params:l}=i;try{await this.isValidRequest(X({topic:r},l));let e=this.client.session.get(r),i={id:c,topic:r,params:l,verifyContext:await this.getVerifyContext({attestationId:a,hash:Nc(JSON.stringify(Ce(`wc_sessionRequest`,l,c))),encryptedId:o,metadata:e.peer.metadata,transportType:s})};await this.setPendingSessionRequest(i),s===W.link_mode&&(t=e.peer.metadata.redirect)!=null&&t.universal&&this.client.core.addLinkModeSupportedApp(e.peer.metadata.redirect?.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(i):(this.addSessionRequestToSessionRequestQueue(i),this.processSessionRequestQueue())}catch(e){await this.sendError({id:c,topic:r,error:e}),this.client.logger.error(e)}}),Z(this,`onSessionRequestResponse`,(e,t)=>{let{id:n}=t,r=z(`session_request`,n);if(this.events.listenerCount(r)===0)throw Error(`emitting ${r} without any listeners`);je(t)?this.events.emit(z(`session_request`,n),{result:t.result}):Ee(t)&&this.events.emit(z(`session_request`,n),{error:t.error})}),Z(this,`onSessionEventRequest`,async(e,t)=>{let{id:n,params:r}=t;try{let t=`${e}_session_event_${r.event.name}`,i=_u.get(t);if(i&&this.isRequestOutOfSync(i,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(X({topic:e},r)),this.client.events.emit(`session_event`,{id:n,topic:e,params:r}),_u.set(t,n)}catch(t){await this.sendError({id:n,topic:e,error:t}),this.client.logger.error(t)}}),Z(this,`onSessionAuthenticateResponse`,(e,t)=>{let{id:n}=t;this.client.logger.trace({type:`method`,method:`onSessionAuthenticateResponse`,topic:e,payload:t}),je(t)?this.events.emit(z(`session_request`,n),{result:t.result}):Ee(t)&&this.events.emit(z(`session_request`,n),{error:t.error})}),Z(this,`onSessionAuthenticateRequest`,async e=>{var t;let{topic:n,payload:r,attestation:i,encryptedId:a,transportType:o}=e;try{let{requester:e,authPayload:s,expiryTimestamp:c}=r.params,l=await this.getVerifyContext({attestationId:i,hash:Nc(JSON.stringify(r)),encryptedId:a,metadata:e.metadata,transportType:o}),u={requester:e,pairingTopic:n,id:r.id,authPayload:s,verifyContext:l,expiryTimestamp:c};await this.setAuthRequest(r.id,{request:u,pairingTopic:n,transportType:o}),o===W.link_mode&&(t=e.metadata.redirect)!=null&&t.universal&&this.client.core.addLinkModeSupportedApp(e.metadata.redirect.universal),this.client.events.emit(`session_authenticate`,{topic:n,params:r.params,id:r.id,verifyContext:l})}catch(e){this.client.logger.error(e);let t=r.params.requester.publicKey,i=await this.client.core.crypto.generateKeyPair(),a=this.getAppLinkIfEnabled(r.params.requester.metadata,o),s={type:1,receiverPublicKey:t,senderPublicKey:i};await this.sendError({id:r.id,topic:n,error:e,encodeOpts:s,rpcOpts:Eh.wc_sessionAuthenticate.autoReject,appLink:a})}}),Z(this,`addSessionRequestToSessionRequestQueue`,e=>{this.sessionRequestQueue.queue.push(e)}),Z(this,`cleanupAfterResponse`,e=>{this.deletePendingSessionRequest(e.response.id,{message:`fulfilled`,code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Oh.idle,this.processSessionRequestQueue()},(0,Y.toMiliseconds)(this.requestQueueDelay))}),Z(this,`cleanupPendingSentRequestsForTopic`,({topic:e,error:t})=>{let n=this.client.core.history.pending;n.length>0&&n.filter(t=>t.topic===e&&t.request.method===`wc_sessionRequest`).forEach(e=>{let n=e.request.id,r=z(`session_request`,n);if(this.events.listenerCount(r)===0)throw Error(`emitting ${r} without any listeners`);this.events.emit(z(`session_request`,e.request.id),{error:t})})}),Z(this,`processSessionRequestQueue`,()=>{if(this.sessionRequestQueue.state===Oh.active){this.client.logger.info(`session request queue is already active.`);return}let e=this.sessionRequestQueue.queue[0];if(!e){this.client.logger.info(`session request queue is empty.`);return}try{this.sessionRequestQueue.state=Oh.active,this.emitSessionRequest(e)}catch(e){this.client.logger.error(e)}}),Z(this,`emitSessionRequest`,e=>{this.client.events.emit(`session_request`,e)}),Z(this,`onPairingCreated`,e=>{if(e.methods&&this.expectedPairingMethodMap.set(e.topic,e.methods),e.active)return;let t=this.client.proposal.getAll().find(t=>t.pairingTopic===e.topic);t&&this.onSessionProposeRequest({topic:e.topic,payload:Ce(`wc_sessionPropose`,Gh(X({},t),{requiredNamespaces:t.requiredNamespaces,optionalNamespaces:t.optionalNamespaces,relays:t.relays,proposer:t.proposer,sessionProperties:t.sessionProperties,scopedProperties:t.scopedProperties}),t.id)})}),Z(this,`isValidConnect`,async e=>{if(!Yl(e)){let{message:t}=V(`MISSING_OR_INVALID`,`connect() params: ${JSON.stringify(e)}`);throw Error(t)}let{pairingTopic:t,requiredNamespaces:n,optionalNamespaces:r,sessionProperties:i,scopedProperties:a,relays:o}=e;if(Dl(t)||await this.isValidPairingTopic(t),!ql(o,!0)){let{message:e}=V(`MISSING_OR_INVALID`,`connect() relays: ${o}`);throw Error(e)}if(!Dl(n)&&El(n)!==0){let e=`requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces`;[`fatal`,`error`,`silent`].includes(this.client.logger.level)?console.warn(e):this.client.logger.warn(e),this.validateNamespaces(n,`requiredNamespaces`)}if(!Dl(r)&&El(r)!==0&&this.validateNamespaces(r,`optionalNamespaces`),Dl(i)||this.validateSessionProps(i,`sessionProperties`),!Dl(a)){this.validateSessionProps(a,`scopedProperties`);let e=Object.keys(n||{}).concat(Object.keys(r||{}));if(!Object.keys(a).every(t=>e.includes(t)))throw Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(e)}`)}}),Z(this,`validateNamespaces`,(e,t)=>{let n=Wl(e,`connect()`,t);if(n)throw Error(n.message)}),Z(this,`isValidApprove`,async e=>{if(!Yl(e))throw Error(V(`MISSING_OR_INVALID`,`approve() params: ${e}`).message);let{id:t,namespaces:n,relayProtocol:r,sessionProperties:i,scopedProperties:a}=e;this.checkRecentlyDeleted(t),await this.isValidProposalId(t);let o=this.client.proposal.get(t),s=Gl(n,`approve()`);if(s)throw Error(s.message);let c=ru(o.requiredNamespaces,n,`approve()`);if(c)throw Error(c.message);if(!Ol(r,!0)){let{message:e}=V(`MISSING_OR_INVALID`,`approve() relayProtocol: ${r}`);throw Error(e)}if(Dl(i)||this.validateSessionProps(i,`sessionProperties`),!Dl(a)){this.validateSessionProps(a,`scopedProperties`);let e=new Set(Object.keys(n));if(!Object.keys(a).every(t=>e.has(t)))throw Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(e).join(`, `)}`)}}),Z(this,`isValidReject`,async e=>{if(!Yl(e)){let{message:t}=V(`MISSING_OR_INVALID`,`reject() params: ${e}`);throw Error(t)}let{id:t,reason:n}=e;if(this.checkRecentlyDeleted(t),await this.isValidProposalId(t),!Xl(n)){let{message:e}=V(`MISSING_OR_INVALID`,`reject() reason: ${JSON.stringify(n)}`);throw Error(e)}}),Z(this,`isValidSessionSettleRequest`,e=>{if(!Yl(e)){let{message:t}=V(`MISSING_OR_INVALID`,`onSessionSettleRequest() params: ${e}`);throw Error(t)}let{relay:t,controller:n,namespaces:r,expiry:i}=e;if(!Kl(t)){let{message:e}=V(`MISSING_OR_INVALID`,`onSessionSettleRequest() relay protocol should be a string`);throw Error(e)}let a=Il(n,`onSessionSettleRequest()`);if(a)throw Error(a.message);let o=Gl(r,`onSessionSettleRequest()`);if(o)throw Error(o.message);if(Rr(i)){let{message:e}=V(`EXPIRED`,`onSessionSettleRequest()`);throw Error(e)}}),Z(this,`isValidUpdate`,async e=>{if(!Yl(e)){let{message:t}=V(`MISSING_OR_INVALID`,`update() params: ${e}`);throw Error(t)}let{topic:t,namespaces:n}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);let r=this.client.session.get(t),i=Gl(n,`update()`);if(i)throw Error(i.message);let a=ru(r.requiredNamespaces,n,`update()`);if(a)throw Error(a.message)}),Z(this,`isValidExtend`,async e=>{if(!Yl(e)){let{message:t}=V(`MISSING_OR_INVALID`,`extend() params: ${e}`);throw Error(t)}let{topic:t}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t)}),Z(this,`isValidRequest`,async e=>{if(!Yl(e)){let{message:t}=V(`MISSING_OR_INVALID`,`request() params: ${e}`);throw Error(t)}let{topic:t,request:n,chainId:r,expiry:i}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);let{namespaces:a}=this.client.session.get(t);if(!eu(a,r)){let{message:e}=V(`MISSING_OR_INVALID`,`request() chainId: ${r}`);throw Error(e)}if(!Zl(n)){let{message:e}=V(`MISSING_OR_INVALID`,`request() ${JSON.stringify(n)}`);throw Error(e)}if(!tu(a,r,n.method)){let{message:e}=V(`MISSING_OR_INVALID`,`request() method: ${n.method}`);throw Error(e)}if(i&&!su(i,Dh)){let{message:e}=V(`MISSING_OR_INVALID`,`request() expiry: ${i}. Expiry must be a number (in seconds) between ${Dh.min} and ${Dh.max}`);throw Error(e)}}),Z(this,`isValidRespond`,async e=>{var t;if(!Yl(e)){let{message:t}=V(`MISSING_OR_INVALID`,`respond() params: ${e}`);throw Error(t)}let{topic:n,response:r}=e;try{await this.isValidSessionTopic(n)}catch(n){throw(t=e?.response)!=null&&t.id&&this.cleanupAfterResponse(e),n}if(!Ql(r)){let{message:e}=V(`MISSING_OR_INVALID`,`respond() response: ${JSON.stringify(r)}`);throw Error(e)}}),Z(this,`isValidPing`,async e=>{if(!Yl(e)){let{message:t}=V(`MISSING_OR_INVALID`,`ping() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),Z(this,`isValidEmit`,async e=>{if(!Yl(e)){let{message:t}=V(`MISSING_OR_INVALID`,`emit() params: ${e}`);throw Error(t)}let{topic:t,event:n,chainId:r}=e;await this.isValidSessionTopic(t);let{namespaces:i}=this.client.session.get(t);if(!eu(i,r)){let{message:e}=V(`MISSING_OR_INVALID`,`emit() chainId: ${r}`);throw Error(e)}if(!$l(n)){let{message:e}=V(`MISSING_OR_INVALID`,`emit() event: ${JSON.stringify(n)}`);throw Error(e)}if(!nu(i,r,n.name)){let{message:e}=V(`MISSING_OR_INVALID`,`emit() event: ${JSON.stringify(n)}`);throw Error(e)}}),Z(this,`isValidDisconnect`,async e=>{if(!Yl(e)){let{message:t}=V(`MISSING_OR_INVALID`,`disconnect() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),Z(this,`isValidAuthenticate`,e=>{let{chains:t,uri:n,domain:r,nonce:i}=e;if(!Array.isArray(t)||t.length===0)throw Error(`chains is required and must be a non-empty array`);if(!Ol(n,!1))throw Error(`uri is required parameter`);if(!Ol(r,!1))throw Error(`domain is required parameter`);if(!Ol(i,!1))throw Error(`nonce is required parameter`);if([...new Set(t.map(e=>nr(e).namespace))].length>1)throw Error(`Multi-namespace requests are not supported. Please request single namespace only.`);let{namespace:a}=nr(t[0]);if(a!==`eip155`)throw Error(`Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.`)}),Z(this,`getVerifyContext`,async e=>{let{attestationId:t,hash:n,encryptedId:r,metadata:i,transportType:a}=e,o={verified:{verifyUrl:i.verifyUrl||`https://verify.walletconnect.org`,validation:`UNKNOWN`,origin:i.url||``}};try{if(a===W.link_mode){let e=this.getAppLinkIfEnabled(i,a);return o.verified.validation=e&&new URL(e).origin===new URL(i.url).origin?`VALID`:`INVALID`,o}let e=await this.client.core.verify.resolve({attestationId:t,hash:n,encryptedId:r,verifyUrl:i.verifyUrl});e&&(o.verified.origin=e.origin,o.verified.isScam=e.isScam,o.verified.validation=e.origin===new URL(i.url).origin?`VALID`:`INVALID`)}catch(e){this.client.logger.warn(e)}return this.client.logger.debug(`Verify context: ${JSON.stringify(o)}`),o}),Z(this,`validateSessionProps`,(e,t)=>{Object.values(e).forEach((n,r)=>{if(n==null){let{message:i}=V(`MISSING_OR_INVALID`,`${t} must contain an existing value for each key. Received: ${n} for key ${Object.keys(e)[r]}`);throw Error(i)}})}),Z(this,`getPendingAuthRequest`,e=>{let t=this.client.auth.requests.get(e);return typeof t==`object`?t:void 0}),Z(this,`addToRecentlyDeleted`,(e,t)=>{if(this.recentlyDeletedMap.set(e,t),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let e=0,t=this.recentlyDeletedLimit/2;for(let n of this.recentlyDeletedMap.keys()){if(e++>=t)break;this.recentlyDeletedMap.delete(n)}}}),Z(this,`checkRecentlyDeleted`,e=>{let t=this.recentlyDeletedMap.get(e);if(t){let{message:n}=V(`MISSING_OR_INVALID`,`Record was recently deleted - ${t}: ${e}`);throw Error(n)}}),Z(this,`isLinkModeEnabled`,(e,t)=>!e||t!==W.link_mode?!1:this.client.metadata?.redirect?.linkMode===!0&&this.client.metadata?.redirect?.universal!==void 0&&this.client.metadata?.redirect?.universal!==``&&e?.redirect?.universal!==void 0&&e?.redirect?.universal!==``&&e?.redirect?.linkMode===!0&&this.client.core.linkModeSupportedApps.includes(e.redirect.universal)&&typeof(global==null?void 0:global.Linking)<`u`),Z(this,`getAppLinkIfEnabled`,(e,t)=>this.isLinkModeEnabled(e,t)?e?.redirect?.universal:void 0),Z(this,`handleLinkModeMessage`,({url:e})=>{if(!e||!e.includes(`wc_ev`)||!e.includes(`topic`))return;let t=Wr(e,`topic`)||``,n=decodeURIComponent(Wr(e,`wc_ev`)||``),r=this.client.session.keys.includes(t);r&&this.client.session.update(t,{transportType:W.link_mode}),this.client.core.dispatchEnvelope({topic:t,message:n,sessionExists:r})}),Z(this,`registerLinkModeListeners`,async()=>{var e;if(Kr()||hr()&&(e=this.client.metadata.redirect)!=null&&e.linkMode){let e=global==null?void 0:global.Linking;if(typeof e<`u`){e.addEventListener(`url`,this.handleLinkModeMessage,this.client.name);let t=await e.getInitialURL();t&&setTimeout(()=>{this.handleLinkModeMessage({url:t})},50)}}}),Z(this,`shouldSetTVF`,(e,t)=>{if(!t||e!==`wc_sessionRequest`)return!1;let{request:n}=t;return Object.keys(kh).includes(n.method)}),Z(this,`getTVFParams`,(e,t,n)=>{try{let r=t.request.method,i=this.extractTxHashesFromResult(r,n);return Gh(X({correlationId:e,rpcMethods:[r],chainId:t.chainId},this.isValidContractData(t.request.params)&&{contractAddresses:[t.request.params?.[0]?.to]}),{txHashes:i})}catch(e){this.client.logger.warn(`Error getting TVF params`,e)}return{}}),Z(this,`isValidContractData`,e=>{if(!e)return!1;try{let t=e?.data||e?.[0]?.data;if(!t.startsWith(`0x`))return!1;let n=t.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2==0:!1}catch{}return!1}),Z(this,`extractTxHashesFromResult`,(e,t)=>{try{let n=kh[e];if(typeof t==`string`)return[t];let r=t[n.key];if(Tl(r))return e===`solana_signAllTransactions`?r.map(e=>qi(e)):r;if(typeof r==`string`)return[r]}catch(e){this.client.logger.warn(`Error extracting tx hashes from result`,e)}return[]})}async processPendingMessageEvents(){try{let e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(let[e,n]of Object.entries(t))for(let t of n)try{await this.onProviderMessageEvent({topic:e,message:t,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${e}, message: ${t}`)}}catch(e){this.client.logger.warn(`processPendingMessageEvents failed`,e)}}isInitialized(){if(!this.initialized){let{message:e}=V(`NOT_INITIALIZED`,this.name);throw Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Mu.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){let{topic:t,message:n,attestation:r,transportType:i}=e,{publicKey:a}=this.client.auth.authKeys.keys.includes(Lh)?this.client.auth.authKeys.get(Lh):{responseTopic:void 0,publicKey:void 0};try{let e=await this.client.core.crypto.decode(t,n,{receiverPublicKey:a,encoding:i===W.link_mode?Cc:Sc});xe(e)?(this.client.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e,attestation:r,transportType:i,encryptedId:Nc(n)})):ke(e)?(await this.client.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e,transportType:i}),this.client.core.history.delete(t,e.id)):await this.onRelayEventUnknownPayload({topic:t,payload:e,transportType:i}),await this.client.core.relayer.messages.ack(t,n)}catch(e){this.client.logger.error(e)}}registerExpirerEvents(){this.client.core.expirer.on(Gu.expired,async e=>{let{topic:t,id:n}=Ir(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,V(`EXPIRED`),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,V(`EXPIRED`),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit(`session_expire`,{topic:t})):n&&(await this.deleteProposal(n,!0),this.client.events.emit(`proposal_expire`,{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Vu.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Vu.delete,e=>{this.addToRecentlyDeleted(e.topic,`pairing`)})}isValidPairingTopic(e){if(!Ol(e,!1)){let{message:t}=V(`MISSING_OR_INVALID`,`pairing topic should be a string: ${e}`);throw Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:t}=V(`NO_MATCHING_KEY`,`pairing topic doesn't exist: ${e}`);throw Error(t)}if(Rr(this.client.core.pairing.pairings.get(e).expiry)){let{message:t}=V(`EXPIRED`,`pairing topic: ${e}`);throw Error(t)}}async isValidSessionTopic(e){if(!Ol(e,!1)){let{message:t}=V(`MISSING_OR_INVALID`,`session topic should be a string: ${e}`);throw Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:t}=V(`NO_MATCHING_KEY`,`session topic doesn't exist: ${e}`);throw Error(t)}if(Rr(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});let{message:t}=V(`EXPIRED`,`session topic: ${e}`);throw Error(t)}if(!this.client.core.crypto.keychain.has(e)){let{message:t}=V(`MISSING_OR_INVALID`,`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ol(e,!1)){let{message:t}=V(`NO_MATCHING_KEY`,`session or pairing topic doesn't exist: ${e}`);throw Error(t)}else{let{message:t}=V(`MISSING_OR_INVALID`,`session or pairing topic should be a string: ${e}`);throw Error(t)}}async isValidProposalId(e){if(!Jl(e)){let{message:t}=V(`MISSING_OR_INVALID`,`proposal id should be a number: ${e}`);throw Error(t)}if(!this.client.proposal.keys.includes(e)){let{message:t}=V(`NO_MATCHING_KEY`,`proposal id doesn't exist: ${e}`);throw Error(t)}if(Rr(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);let{message:t}=V(`EXPIRED`,`proposal id: ${e}`);throw Error(t)}}},qh=class extends Fm{constructor(e,t){super(e,t,xh,vh),this.core=e,this.logger=t}},Jh=class extends Fm{constructor(e,t){super(e,t,Ch,vh),this.core=e,this.logger=t}},Yh=class extends Fm{constructor(e,t){super(e,t,Ah,vh,e=>e.id),this.core=e,this.logger=t}},Xh=class extends Fm{constructor(e,t){super(e,t,Nh,Ih,()=>Lh),this.core=e,this.logger=t}},Zh=class extends Fm{constructor(e,t){super(e,t,Ph,Ih),this.core=e,this.logger=t}},Qh=class extends Fm{constructor(e,t){super(e,t,Fh,Ih,e=>e.id),this.core=e,this.logger=t}},$h=Object.defineProperty,eg=(e,t,n)=>t in e?$h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tg=(e,t,n)=>eg(e,typeof t==`symbol`?t:t+``,n),ng=class{constructor(e,t){this.core=e,this.logger=t,tg(this,`authKeys`),tg(this,`pairingTopics`),tg(this,`requests`),this.authKeys=new Xh(this.core,this.logger),this.pairingTopics=new Zh(this.core,this.logger),this.requests=new Qh(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}},rg=Object.defineProperty,ig=(e,t,n)=>t in e?rg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Q=(e,t,n)=>ig(e,typeof t==`symbol`?t:t+``,n),ag=class e extends Bt{constructor(e){super(e),Q(this,`protocol`,`wc`),Q(this,`version`,2),Q(this,`name`,yh.name),Q(this,`metadata`),Q(this,`core`),Q(this,`logger`),Q(this,`events`,new gh.EventEmitter),Q(this,`engine`),Q(this,`session`),Q(this,`proposal`),Q(this,`pendingRequest`),Q(this,`auth`),Q(this,`signConfig`),Q(this,`on`,(e,t)=>this.events.on(e,t)),Q(this,`once`,(e,t)=>this.events.once(e,t)),Q(this,`off`,(e,t)=>this.events.off(e,t)),Q(this,`removeListener`,(e,t)=>this.events.removeListener(e,t)),Q(this,`removeAllListeners`,e=>this.events.removeAllListeners(e)),Q(this,`connect`,async e=>{try{return await this.engine.connect(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`pair`,async e=>{try{return await this.engine.pair(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`approve`,async e=>{try{return await this.engine.approve(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`reject`,async e=>{try{return await this.engine.reject(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`update`,async e=>{try{return await this.engine.update(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`extend`,async e=>{try{return await this.engine.extend(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`request`,async e=>{try{return await this.engine.request(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`respond`,async e=>{try{return await this.engine.respond(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`ping`,async e=>{try{return await this.engine.ping(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`emit`,async e=>{try{return await this.engine.emit(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`disconnect`,async e=>{try{return await this.engine.disconnect(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`find`,e=>{try{return this.engine.find(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`getPendingSessionRequests`,()=>{try{return this.engine.getPendingSessionRequests()}catch(e){throw this.logger.error(e.message),e}}),Q(this,`authenticate`,async(e,t)=>{try{return await this.engine.authenticate(e,t)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`formatAuthMessage`,e=>{try{return this.engine.formatAuthMessage(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`approveSessionAuthenticate`,async e=>{try{return await this.engine.approveSessionAuthenticate(e)}catch(e){throw this.logger.error(e.message),e}}),Q(this,`rejectSessionAuthenticate`,async e=>{try{return await this.engine.rejectSessionAuthenticate(e)}catch(e){throw this.logger.error(e.message),e}}),this.name=e?.name||yh.name,this.metadata=Sr(e?.metadata),this.signConfig=e?.signConfig;let t=typeof e?.logger<`u`&&typeof e?.logger!=`string`?e.logger:(0,Pe.default)(Ie({level:e?.logger||yh.logger}));this.core=e?.core||new hh(e),this.logger=be(t,this.name),this.session=new Jh(this.core,this.logger),this.proposal=new qh(this.core,this.logger),this.pendingRequest=new Yh(this.core,this.logger),this.engine=new Kh(this),this.auth=new ng(this.core,this.logger)}static async init(t){let n=new e(t);return await n.initialize(),n}get context(){return Se(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace(`Initialized`);try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info(`SignClient Initialization Success`),setTimeout(()=>{this.engine.processRelayMessageCache()},(0,Y.toMiliseconds)(Y.ONE_SECOND))}catch(e){throw this.logger.info(`SignClient Initialization Failure`),this.logger.error(e.message),e}}},og=s(te()),sg=`error`,cg=`wss://relay.walletconnect.org`,lg=`wc@2:universal_provider:`,ug=`https://rpc.walletconnect.org/v1/`,dg=`generic`,fg=`${ug}bundler`,pg={DEFAULT_CHAIN_CHANGED:`default_chain_changed`};function mg(){}function hg(e){return e==null||typeof e!=`object`&&typeof e!=`function`}function gg(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function _g(e){if(hg(e))return e;if(Array.isArray(e)||gg(e)||e instanceof ArrayBuffer||typeof SharedArrayBuffer<`u`&&e instanceof SharedArrayBuffer)return e.slice(0);let t=Object.getPrototypeOf(e),n=t.constructor;if(e instanceof Date||e instanceof Map||e instanceof Set)return new n(e);if(e instanceof RegExp){let t=new n(e);return t.lastIndex=e.lastIndex,t}if(e instanceof DataView)return new n(e.buffer.slice(0));if(e instanceof Error){let t=new n(e.message);return t.stack=e.stack,t.name=e.name,t.cause=e.cause,t}if(typeof File<`u`&&e instanceof File)return new n([e],e.name,{type:e.type,lastModified:e.lastModified});if(typeof e==`object`){let n=Object.create(t);return Object.assign(n,e)}return e}function vg(e){return typeof e==`object`&&!!e}function yg(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function bg(e){return e==null?e===void 0?`[object Undefined]`:`[object Null]`:Object.prototype.toString.call(e)}var xg=`[object RegExp]`,Sg=`[object String]`,Cg=`[object Number]`,wg=`[object Boolean]`,Tg=`[object Arguments]`,Eg=`[object Symbol]`,Dg=`[object Date]`,Og=`[object Map]`,kg=`[object Set]`,Ag=`[object Array]`,jg=`[object ArrayBuffer]`,Mg=`[object Object]`,Ng=`[object DataView]`,Pg=`[object Uint8Array]`,Fg=`[object Uint8ClampedArray]`,Ig=`[object Uint16Array]`,Lg=`[object Uint32Array]`,Rg=`[object Int8Array]`,zg=`[object Int16Array]`,Bg=`[object Int32Array]`,Vg=`[object Float32Array]`,Hg=`[object Float64Array]`;function Ug(e,t){return Wg(e,void 0,e,new Map,t)}function Wg(e,t,n,r=new Map,i=void 0){let a=i?.(e,t,n,r);if(a!=null)return a;if(hg(e))return e;if(r.has(e))return r.get(e);if(Array.isArray(e)){let t=Array(e.length);r.set(e,t);for(let a=0;a<e.length;a++)t[a]=Wg(e[a],a,n,r,i);return Object.hasOwn(e,`index`)&&(t.index=e.index),Object.hasOwn(e,`input`)&&(t.input=e.input),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){let t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}if(e instanceof Map){let t=new Map;r.set(e,t);for(let[a,o]of e)t.set(a,Wg(o,a,n,r,i));return t}if(e instanceof Set){let t=new Set;r.set(e,t);for(let a of e)t.add(Wg(a,void 0,n,r,i));return t}if(typeof Buffer<`u`&&Buffer.isBuffer(e))return e.subarray();if(gg(e)){let t=new(Object.getPrototypeOf(e)).constructor(e.length);r.set(e,t);for(let a=0;a<e.length;a++)t[a]=Wg(e[a],a,n,r,i);return t}if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<`u`&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){let t=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return r.set(e,t),Gg(t,e,n,r,i),t}if(typeof File<`u`&&e instanceof File){let t=new File([e],e.name,{type:e.type});return r.set(e,t),Gg(t,e,n,r,i),t}if(e instanceof Blob){let t=new Blob([e],{type:e.type});return r.set(e,t),Gg(t,e,n,r,i),t}if(e instanceof Error){let t=new e.constructor;return r.set(e,t),t.message=e.message,t.name=e.name,t.stack=e.stack,t.cause=e.cause,Gg(t,e,n,r,i),t}if(typeof e==`object`&&Kg(e)){let t=Object.create(Object.getPrototypeOf(e));return r.set(e,t),Gg(t,e,n,r,i),t}return e}function Gg(e,t,n=e,r,i){let a=[...Object.keys(t),...yg(t)];for(let o=0;o<a.length;o++){let s=a[o],c=Object.getOwnPropertyDescriptor(e,s);(c==null||c.writable)&&(e[s]=Wg(t[s],s,n,r,i))}}function Kg(e){switch(bg(e)){case Tg:case Ag:case jg:case Ng:case wg:case Dg:case Vg:case Hg:case Rg:case zg:case Bg:case Og:case Cg:case Mg:case xg:case kg:case Sg:case Eg:case Pg:case Fg:case Ig:case Lg:return!0;default:return!1}}function qg(e,t){return Ug(e,(n,r,i,a)=>{let o=t?.(n,r,i,a);if(o!=null)return o;if(typeof e==`object`)switch(Object.prototype.toString.call(e)){case Cg:case Sg:case wg:{let t=new e.constructor(e?.valueOf());return Gg(t,e),t}case Tg:{let t={};return Gg(t,e),t.length=e.length,t[Symbol.iterator]=e[Symbol.iterator],t}default:return}})}function Jg(e){return qg(e)}function Yg(e){return typeof e==`object`&&!!e&&bg(e)===`[object Arguments]`}function Xg(e){return gg(e)}function Zg(e){if(typeof e!=`object`||!e)return!1;if(Object.getPrototypeOf(e)===null)return!0;if(Object.prototype.toString.call(e)!==`[object Object]`){let t=e[Symbol.toStringTag];return t==null||!Object.getOwnPropertyDescriptor(e,Symbol.toStringTag)?.writable?!1:e.toString()===`[object ${t}]`}let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Qg(e,...t){let n=t.slice(0,-1),r=t[t.length-1],i=e;for(let e=0;e<n.length;e++){let t=n[e];i=$g(i,t,r,new Map)}return i}function $g(e,t,n,r){if(hg(e)&&(e=Object(e)),typeof t!=`object`||!t)return e;if(r.has(t))return _g(r.get(t));if(r.set(t,e),Array.isArray(t)){t=t.slice();for(let e=0;e<t.length;e++)t[e]=t[e]??void 0}let i=[...Object.keys(t),...yg(t)];for(let a=0;a<i.length;a++){let o=i[a],s=t[o],c=e[o];if(Yg(s)&&(s={...s}),Yg(c)&&(c={...c}),typeof Buffer<`u`&&Buffer.isBuffer(s)&&(s=Jg(s)),Array.isArray(s))if(typeof c==`object`&&c){let e=[],t=Reflect.ownKeys(c);for(let n=0;n<t.length;n++){let r=t[n];e[r]=c[r]}c=e}else c=[];let l=n(c,s,o,e,t,r);l==null?Array.isArray(s)||vg(c)&&vg(s)?e[o]=$g(c,s,n,r):c==null&&Zg(s)?e[o]=$g({},s,n,r):c==null&&Xg(s)?e[o]=Jg(s):(c===void 0||s!==void 0)&&(e[o]=s):e[o]=l}return e}function e_(e,...t){return Qg(e,...t,mg)}var t_=Object.defineProperty,n_=Object.defineProperties,r_=Object.getOwnPropertyDescriptors,i_=Object.getOwnPropertySymbols,a_=Object.prototype.hasOwnProperty,o_=Object.prototype.propertyIsEnumerable,s_=(e,t,n)=>t in e?t_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,c_=(e,t)=>{for(var n in t||={})a_.call(t,n)&&s_(e,n,t[n]);if(i_)for(var n of i_(t))o_.call(t,n)&&s_(e,n,t[n]);return e},l_=(e,t)=>n_(e,r_(t));function u_(e,t,n){let r=nr(e);return t.rpcMap?.[r.reference]||`${ug}?chainId=${r.namespace}:${r.reference}&projectId=${n}`}function d_(e){return e.includes(`:`)?e.split(`:`)[1]:e}function f_(e){return e.map(e=>`${e.split(`:`)[0]}:${e.split(`:`)[1]}`)}function p_(e,t){let n=Object.keys(t.namespaces).filter(t=>t.includes(e));if(!n.length)return[];let r=[];return n.forEach(e=>{let n=t.namespaces[e].accounts;r.push(...n)}),r}function m_(e={},t={}){return e_(h_(e),h_(t))}function h_(e){let t={};if(!El(e))return t;for(let[n,r]of Object.entries(e)){let e=_l(n)?[n]:r.chains,i=r.methods||[],a=r.events||[],o=r.rpcMap||{},s=vl(n);t[s]=l_(c_(c_({},t[s]),r),{chains:zr(e,t[s]?.chains),methods:zr(i,t[s]?.methods),events:zr(a,t[s]?.events)}),(El(o)||El(t[s]?.rpcMap||{}))&&(t[s].rpcMap=c_(c_({},o),t[s]?.rpcMap))}return t}function g_(e){return e.includes(`:`)?e.split(`:`)[2]:e}function __(e){let t={};for(let[n,r]of Object.entries(e)){let e=r.methods||[],i=r.events||[],a=r.accounts||[];t[n]={chains:_l(n)?[n]:r.chains?r.chains:f_(r.accounts),methods:e,events:i,accounts:a}}return t}function v_(e){return typeof e==`number`?e:e.includes(`0x`)?parseInt(e,16):(e=e.includes(`:`)?e.split(`:`)[1]:e,isNaN(Number(e))?e:Number(e))}var y_={},$=e=>y_[e],b_=(e,t)=>{y_[e]=t},x_=Object.defineProperty,S_=(e,t,n)=>t in e?x_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,C_=(e,t,n)=>S_(e,typeof t==`symbol`?t:t+``,n),w_=class{constructor(e){C_(this,`name`,`polkadot`),C_(this,`client`),C_(this,`httpProviders`),C_(this,`events`),C_(this,`namespace`),C_(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(pg.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){let e=this.namespace.accounts;return e&&e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2])||[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let n=d_(t);e[n]=this.createHttpProvider(n,this.namespace.rpcMap?.[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||u_(e,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new Oe(new Me(n,$(`disableProviderPing`)))}},T_=Object.defineProperty,E_=Object.defineProperties,D_=Object.getOwnPropertyDescriptors,O_=Object.getOwnPropertySymbols,k_=Object.prototype.hasOwnProperty,A_=Object.prototype.propertyIsEnumerable,j_=(e,t,n)=>t in e?T_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,M_=(e,t)=>{for(var n in t||={})k_.call(t,n)&&j_(e,n,t[n]);if(O_)for(var n of O_(t))A_.call(t,n)&&j_(e,n,t[n]);return e},N_=(e,t)=>E_(e,D_(t)),P_=(e,t,n)=>j_(e,typeof t==`symbol`?t:t+``,n),F_=class{constructor(e){P_(this,`name`,`eip155`),P_(this,`client`),P_(this,`chainId`),P_(this,`namespace`),P_(this,`httpProviders`),P_(this,`events`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case`eth_requestAccounts`:return this.getAccounts();case`eth_accounts`:return this.getAccounts();case`wallet_switchEthereumChain`:return await this.handleSwitchChain(e);case`eth_chainId`:return parseInt(this.getDefaultChain());case`wallet_getCapabilities`:return await this.getCapabilities(e);case`wallet_getCallsStatus`:return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(pg.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}createHttpProvider(e,t){let n=t||u_(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new Oe(new Me(n,$(`disableProviderPing`)))}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let n=parseInt(d_(t));e[n]=this.createHttpProvider(n,this.namespace.rpcMap?.[t])}),e}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}getHttpProvider(){let e=this.chainId,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){let t=e.request.params?e.request.params[0]?.chainId:`0x0`;t=t.startsWith(`0x`)?t:`0x${t}`;let n=parseInt(t,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes(`wallet_switchEthereumChain`))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:t}]},chainId:this.namespace.chains?.[0]}),this.setDefaultChain(`${n}`);else throw Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){let t=e.request?.params?.[0],n=`${t}${(e.request?.params?.[1]||[]).join(`,`)}`;if(!t)throw Error("Missing address parameter in `wallet_getCapabilities` request");let r=this.client.session.get(e.topic),i=r?.sessionProperties?.capabilities||{};if(i!=null&&i[n])return i?.[n];let a=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:N_(M_({},r.sessionProperties||{}),{capabilities:N_(M_({},i||{}),{[n]:a})})})}catch(e){console.warn(`Failed to update session with capabilities`,e)}return a}async getCallStatus(e){let t=this.client.session.get(e.topic),n=t.sessionProperties?.bundler_name;if(n){let t=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(t,e)}catch(e){console.warn(`Failed to fetch call status from bundler`,e,t)}}let r=t.sessionProperties?.bundler_url;if(r)try{return await this.getUserOperationReceipt(r,e)}catch(e){console.warn(`Failed to fetch call status from custom bundler`,e,r)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw Error(`Fetching call status not approved by the wallet.`)}async getUserOperationReceipt(e,t){let n=new URL(e),r=await fetch(n,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(Ce(`eth_getUserOperationReceipt`,[t.request.params?.[0]]))});if(!r.ok)throw Error(`Failed to fetch user operation receipt - ${r.status}`);return await r.json()}getBundlerUrl(e,t){return`${fg}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}},I_=Object.defineProperty,L_=(e,t,n)=>t in e?I_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,R_=(e,t,n)=>L_(e,typeof t==`symbol`?t:t+``,n),z_=class{constructor(e){R_(this,`name`,`solana`),R_(this,`client`),R_(this,`httpProviders`),R_(this,`events`),R_(this,`namespace`),R_(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(pg.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let n=d_(t);e[n]=this.createHttpProvider(n,this.namespace.rpcMap?.[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||u_(e,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new Oe(new Me(n,$(`disableProviderPing`)))}},B_=Object.defineProperty,V_=(e,t,n)=>t in e?B_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,H_=(e,t,n)=>V_(e,typeof t==`symbol`?t:t+``,n),U_=class{constructor(e){H_(this,`name`,`cosmos`),H_(this,`client`),H_(this,`httpProviders`),H_(this,`events`),H_(this,`namespace`),H_(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(pg.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let n=d_(t);e[n]=this.createHttpProvider(n,this.namespace.rpcMap?.[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||u_(e,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new Oe(new Me(n,$(`disableProviderPing`)))}},W_=Object.defineProperty,G_=(e,t,n)=>t in e?W_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,K_=(e,t,n)=>G_(e,typeof t==`symbol`?t:t+``,n),q_=class{constructor(e){K_(this,`name`,`algorand`),K_(this,`client`),K_(this,`httpProviders`),K_(this,`events`),K_(this,`namespace`),K_(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){let n=t||u_(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,n)}this.chainId=e,this.events.emit(pg.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t,this.namespace.rpcMap?.[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||u_(e,this.namespace,this.client.core.projectId);return typeof n>`u`?void 0:new Oe(new Me(n,$(`disableProviderPing`)))}},J_=Object.defineProperty,Y_=(e,t,n)=>t in e?J_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,X_=(e,t,n)=>Y_(e,typeof t==`symbol`?t:t+``,n),Z_=class{constructor(e){X_(this,`name`,`cip34`),X_(this,`client`),X_(this,`httpProviders`),X_(this,`events`),X_(this,`namespace`),X_(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(pg.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let n=this.getCardanoRPCUrl(t),r=d_(t);e[r]=this.createHttpProvider(r,n)}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){let t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||this.getCardanoRPCUrl(e);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new Oe(new Me(n,$(`disableProviderPing`)))}},Q_=Object.defineProperty,$_=(e,t,n)=>t in e?Q_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ev=(e,t,n)=>$_(e,typeof t==`symbol`?t:t+``,n),tv=class{constructor(e){ev(this,`name`,`elrond`),ev(this,`client`),ev(this,`httpProviders`),ev(this,`events`),ev(this,`namespace`),ev(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(pg.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let n=d_(t);e[n]=this.createHttpProvider(n,this.namespace.rpcMap?.[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||u_(e,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new Oe(new Me(n,$(`disableProviderPing`)))}},nv=Object.defineProperty,rv=(e,t,n)=>t in e?nv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,iv=(e,t,n)=>rv(e,typeof t==`symbol`?t:t+``,n),av=class{constructor(e){iv(this,`name`,`multiversx`),iv(this,`client`),iv(this,`httpProviders`),iv(this,`events`),iv(this,`namespace`),iv(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(pg.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let n=d_(t);e[n]=this.createHttpProvider(n,this.namespace.rpcMap?.[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||u_(e,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new Oe(new Me(n,$(`disableProviderPing`)))}},ov=Object.defineProperty,sv=(e,t,n)=>t in e?ov(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,cv=(e,t,n)=>sv(e,typeof t==`symbol`?t:t+``,n),lv=class{constructor(e){cv(this,`name`,`near`),cv(this,`client`),cv(this,`httpProviders`),cv(this,`events`),cv(this,`namespace`),cv(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){let n=t||u_(`${this.name}:${e}`,this.namespace);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,n)}this.events.emit(pg.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e&&e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2])||[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t,this.namespace.rpcMap?.[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||u_(e,this.namespace);return typeof n>`u`?void 0:new Oe(new Me(n,$(`disableProviderPing`)))}},uv=Object.defineProperty,dv=(e,t,n)=>t in e?uv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,fv=(e,t,n)=>dv(e,typeof t==`symbol`?t:t+``,n),pv=class{constructor(e){fv(this,`name`,`tezos`),fv(this,`client`),fv(this,`httpProviders`),fv(this,`events`),fv(this,`namespace`),fv(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){let n=t||u_(`${this.name}:${e}`,this.namespace);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,n)}this.events.emit(pg.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e&&e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2])||[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||u_(e,this.namespace);return typeof n>`u`?void 0:new Oe(new Me(n))}},mv=Object.defineProperty,hv=(e,t,n)=>t in e?mv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,gv=(e,t,n)=>hv(e,typeof t==`symbol`?t:t+``,n),_v=class{constructor(e){gv(this,`name`,dg),gv(this,`client`),gv(this,`httpProviders`),gv(this,`events`),gv(this,`namespace`),gv(this,`chainId`),this.namespace=e.namespace,this.events=$(`events`),this.client=$(`client`),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(pg.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error(`ChainId not found`);return e.split(`:`)[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(`:`)[1]===this.chainId.toString()).map(e=>e.split(`:`)[2]))]:[]}createHttpProviders(){var e;let t={};return(e=this.namespace?.accounts)==null||e.forEach(e=>{let n=nr(e);t[`${n.namespace}:${n.reference}`]=this.createHttpProvider(e)}),t}getHttpProvider(e){let t=this.httpProviders[e];if(typeof t>`u`)throw Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){let n=t||u_(e,this.namespace,this.client.core.projectId);if(!n)throw Error(`No RPC url provided for chainId: ${e}`);return new Oe(new Me(n,$(`disableProviderPing`)))}},vv=Object.defineProperty,yv=Object.defineProperties,bv=Object.getOwnPropertyDescriptors,xv=Object.getOwnPropertySymbols,Sv=Object.prototype.hasOwnProperty,Cv=Object.prototype.propertyIsEnumerable,wv=(e,t,n)=>t in e?vv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Tv=(e,t)=>{for(var n in t||={})Sv.call(t,n)&&wv(e,n,t[n]);if(xv)for(var n of xv(t))Cv.call(t,n)&&wv(e,n,t[n]);return e},Ev=(e,t)=>yv(e,bv(t)),Dv=(e,t,n)=>wv(e,typeof t==`symbol`?t:t+``,n),Ov=class e{constructor(e){Dv(this,`client`),Dv(this,`namespaces`),Dv(this,`optionalNamespaces`),Dv(this,`sessionProperties`),Dv(this,`scopedProperties`),Dv(this,`events`,new og.default),Dv(this,`rpcProviders`,{}),Dv(this,`session`),Dv(this,`providerOpts`),Dv(this,`logger`),Dv(this,`uri`),Dv(this,`disableProviderPing`,!1),this.providerOpts=e,this.logger=typeof e?.logger<`u`&&typeof e?.logger!=`string`?e.logger:(0,Pe.default)(Ie({level:e?.logger||sg})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(t){let n=new e(t);return await n.initialize(),n}async request(e,t,n){let[r,i]=this.validateChain(t);if(!this.session)throw Error(`Please call connect() before request()`);return await this.getProvider(r).request({request:Tv({},e),chainId:`${r}:${i}`,topic:this.session.topic,expiry:n})}sendAsync(e,t,n,r){let i=new Date().getTime();this.request(e,n,r).then(e=>t(null,we(i,e))).catch(e=>t(e,void 0))}async enable(){if(!this.client)throw Error(`Sign Client not initialized`);return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){if(!this.session)throw Error(`Please call connect() before enable()`);await this.client.disconnect({topic:this.session?.topic,reason:H(`USER_DISCONNECTED`)}),await this.cleanup()}async connect(e){if(!this.client)throw Error(`Sign Client not initialized`);if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw Error(`Sign Client not initialized`);this.setNamespaces(e),await this.cleanupPendingPairings();let{uri:n,response:r}=await this.client.authenticate(e,t);n&&(this.uri=n,this.events.emit(`display_uri`,n));let i=await r();if(this.session=i.session,this.session){let e=__(this.session.namespaces);this.namespaces=m_(this.namespaces,e),await this.persist(`namespaces`,this.namespaces),this.onConnect()}return i}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){let{uri:t,approval:n}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit(`display_uri`,t));let r=await n();this.session=r;let i=__(r.namespaces);return this.namespaces=m_(this.namespaces,i),await this.persist(`namespaces`,this.namespaces),await this.persist(`optionalNamespaces`,this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;let[n,r]=this.validateChain(e),i=this.getProvider(n);i.name===dg?i.setDefaultChain(`${n}:${r}`,t):i.setDefaultChain(r,t)}catch(e){if(!/Please call connect/.test(e.message))throw e}}async cleanupPendingPairings(e={}){this.logger.info(`Cleaning up inactive pairings...`);let t=this.client.pairing.getAll();if(Tl(t)){for(let n of t)e.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn(`abortPairingAttempt is deprecated. This is now a no-op.`)}async checkStorage(){this.namespaces=await this.getFromStore(`namespaces`)||{},this.optionalNamespaces=await this.getFromStore(`optionalNamespaces`)||{},this.session&&this.createProviders()}async initialize(){this.logger.trace(`Initialized`),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){if(this.client=this.providerOpts.client||await ag.init({core:this.providerOpts.core,logger:this.providerOpts.logger||sg,relayUrl:this.providerOpts.relayUrl||cg,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(e){throw this.logger.error(`Failed to get session`,e),Error(`The provided session: ${this.providerOpts?.session?.topic} doesn't exist in the Sign client`)}else this.session=this.client.session.getAll()[0];this.logger.trace(`SignClient Initialized`)}createProviders(){if(!this.client)throw Error(`Sign Client not initialized`);if(!this.session)throw Error(`Session not initialized. Please call connect() before enable()`);let e=[...new Set(Object.keys(this.session.namespaces).map(e=>vl(e)))];b_(`client`,this.client),b_(`events`,this.events),b_(`disableProviderPing`,this.disableProviderPing),e.forEach(e=>{if(!this.session)return;let t=p_(e,this.session),n=f_(t),r=Ev(Tv({},m_(this.namespaces,this.optionalNamespaces)[e]),{accounts:t,chains:n});switch(e){case`eip155`:this.rpcProviders[e]=new F_({namespace:r});break;case`algorand`:this.rpcProviders[e]=new q_({namespace:r});break;case`solana`:this.rpcProviders[e]=new z_({namespace:r});break;case`cosmos`:this.rpcProviders[e]=new U_({namespace:r});break;case`polkadot`:this.rpcProviders[e]=new w_({namespace:r});break;case`cip34`:this.rpcProviders[e]=new Z_({namespace:r});break;case`elrond`:this.rpcProviders[e]=new tv({namespace:r});break;case`multiversx`:this.rpcProviders[e]=new av({namespace:r});break;case`near`:this.rpcProviders[e]=new lv({namespace:r});break;case`tezos`:this.rpcProviders[e]=new pv({namespace:r});break;default:this.rpcProviders[dg]?this.rpcProviders[dg].updateNamespace(r):this.rpcProviders[dg]=new _v({namespace:r})}})}registerEventListeners(){if(typeof this.client>`u`)throw Error(`Sign Client is not initialized`);this.client.on(`session_ping`,e=>{let{topic:t}=e;t===this.session?.topic&&this.events.emit(`session_ping`,e)}),this.client.on(`session_event`,e=>{let{params:t,topic:n}=e;if(n!==this.session?.topic)return;let{event:r}=t;if(r.name===`accountsChanged`){let e=r.data;e&&Tl(e)&&this.events.emit(`accountsChanged`,e.map(g_))}else if(r.name===`chainChanged`){let e=t.chainId,n=t.event.data,r=vl(e),i=v_(e)===v_(n)?e:`${r}:${v_(n)}`;this.onChainChanged(i)}else this.events.emit(r.name,r.data);this.events.emit(`session_event`,e)}),this.client.on(`session_update`,({topic:e,params:t})=>{if(e!==this.session?.topic)return;let{namespaces:n}=t;this.session=Ev(Tv({},this.client?.session.get(e)),{namespaces:n}),this.onSessionUpdate(),this.events.emit(`session_update`,{topic:e,params:t})}),this.client.on(`session_delete`,async e=>{e.topic===this.session?.topic&&(await this.cleanup(),this.events.emit(`session_delete`,e),this.events.emit(`disconnect`,Ev(Tv({},H(`USER_DISCONNECTED`)),{data:e.topic})))}),this.on(pg.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[dg]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{this.getProvider(e).updateNamespace(this.session?.namespaces[e])})}setNamespaces(e){let{namespaces:t={},optionalNamespaces:n={},sessionProperties:r,scopedProperties:i}=e;this.optionalNamespaces=m_(t,n),this.sessionProperties=r,this.scopedProperties=i}validateChain(e){let[t,n]=e?.split(`:`)||[``,``];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,n];if(t&&!Object.keys(this.namespaces||{}).map(e=>vl(e)).includes(t))throw Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&n)return[t,n];let r=vl(Object.keys(this.namespaces)[0]);return[r,this.rpcProviders[r].getDefaultChain()]}async requestAccounts(){let[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,t=!1){if(!this.namespaces)return;let[n,r]=this.validateChain(e);if(!r)return;this.updateNamespaceChain(n,r),this.events.emit(`chainChanged`,r);let i=this.getProvider(n).getDefaultChain();t||this.getProvider(n).setDefaultChain(r),this.emitAccountsChangedOnChainChange({namespace:n,previousChainId:i,newChainId:e}),await this.persist(`namespaces`,this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:n}){try{if(t===n)return;let r=this.session?.namespaces[e]?.accounts;if(!r)return;let i=r.filter(e=>e.includes(`${n}:`)).map(g_);if(!Tl(i))return;this.events.emit(`accountsChanged`,i)}catch(e){this.logger.warn(`Failed to emit accountsChanged on chain change`,e)}}updateNamespaceChain(e,t){if(!this.namespaces)return;let n=this.namespaces[e]?e:`${e}:${t}`,r={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[n]?this.namespaces[n]&&(this.namespaces[n].defaultChain=t):this.namespaces[n]=r}onConnect(){this.createProviders(),this.events.emit(`connect`,{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore(`namespaces`),await this.deleteFromStore(`optionalNamespaces`),await this.deleteFromStore(`sessionProperties`),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){let n=this.session?.topic||``;await this.client.core.storage.setItem(`${lg}/${e}${n}`,t)}async getFromStore(e){let t=this.session?.topic||``;return await this.client.core.storage.getItem(`${lg}/${e}${t}`)}async deleteFromStore(e){let t=this.session?.topic||``;await this.client.core.storage.removeItem(`${lg}/${e}${t}`)}async cleanupStorage(){try{if(this.client?.session.length>0)return;let e=await this.client.core.storage.getKeys();for(let t of e)t.startsWith(lg)&&await this.client.core.storage.removeItem(t)}catch(e){this.logger.warn(`Failed to cleanup storage`,e)}}};function kv(e,t){return I.getConnectorId(e)===t}function Av(e){let t=Array.from(M.state.chains.keys()),n=[];return e?(n.push([e,M.state.chains.get(e)]),kv(e,f.CONNECTOR_ID.WALLET_CONNECT)?t.forEach(t=>{t!==e&&kv(t,f.CONNECTOR_ID.WALLET_CONNECT)&&n.push([t,M.state.chains.get(t)])}):kv(e,f.CONNECTOR_ID.AUTH)&&t.forEach(t=>{t!==e&&kv(t,f.CONNECTOR_ID.AUTH)&&n.push([t,M.state.chains.get(t)])})):n=Array.from(M.state.chains.entries()),n}const jv={ERROR_CODE_UNRECOGNIZED_CHAIN_ID:4902,ERROR_CODE_DEFAULT:5e3,ERROR_INVALID_CHAIN_ID:32603,DEFAULT_ALLOWED_ANCESTORS:[`http://localhost:*`,`https://*.pages.dev`,`https://*.vercel.app`,`https://*.ngrok-free.app`,`https://secure-mobile.walletconnect.com`,`https://secure-mobile.walletconnect.org`]};function Mv(e){return{formatters:void 0,fees:void 0,serializers:void 0,...e}}const Nv=Mv({id:`5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp`,name:`Solana`,network:`solana-mainnet`,nativeCurrency:{name:`Solana`,symbol:`SOL`,decimals:9},rpcUrls:{default:{http:[`https://rpc.walletconnect.org/v1`]}},blockExplorers:{default:{name:`Solscan`,url:`https://solscan.io`}},testnet:!1,chainNamespace:`solana`,caipNetworkId:`solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp`,deprecatedCaipNetworkId:`solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ`}),Pv=Mv({id:`EtWTRABZaYq6iMfeYKouRu166VU2xqa1`,name:`Solana Devnet`,network:`solana-devnet`,nativeCurrency:{name:`Solana`,symbol:`SOL`,decimals:9},rpcUrls:{default:{http:[`https://rpc.walletconnect.org/v1`]}},blockExplorers:{default:{name:`Solscan`,url:`https://solscan.io`}},testnet:!0,chainNamespace:`solana`,caipNetworkId:`solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1`,deprecatedCaipNetworkId:`solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K`});Mv({id:`4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z`,name:`Solana Testnet`,network:`solana-testnet`,nativeCurrency:{name:`Solana`,symbol:`SOL`,decimals:9},rpcUrls:{default:{http:[`https://rpc.walletconnect.org/v1`]}},blockExplorers:{default:{name:`Solscan`,url:`https://solscan.io`}},testnet:!0,chainNamespace:`solana`,caipNetworkId:`solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z`}),Mv({id:`000000000019d6689c085ae165831e93`,caipNetworkId:`bip122:000000000019d6689c085ae165831e93`,chainNamespace:`bip122`,name:`Bitcoin`,nativeCurrency:{name:`Bitcoin`,symbol:`BTC`,decimals:8},rpcUrls:{default:{http:[`https://rpc.walletconnect.org/v1`]}}}),Mv({id:`000000000933ea01ad0ee984209779ba`,caipNetworkId:`bip122:000000000933ea01ad0ee984209779ba`,chainNamespace:`bip122`,name:`Bitcoin Testnet`,nativeCurrency:{name:`Bitcoin`,symbol:`BTC`,decimals:8},rpcUrls:{default:{http:[`https://rpc.walletconnect.org/v1`]}},testnet:!0});const Fv={solana:[`solana_signMessage`,`solana_signTransaction`,`solana_requestAccounts`,`solana_getAccounts`,`solana_signAllTransactions`,`solana_signAndSendTransaction`],eip155:[`eth_accounts`,`eth_requestAccounts`,`eth_sendRawTransaction`,`eth_sign`,`eth_signTransaction`,`eth_signTypedData`,`eth_signTypedData_v3`,`eth_signTypedData_v4`,`eth_sendTransaction`,`personal_sign`,`wallet_switchEthereumChain`,`wallet_addEthereumChain`,`wallet_getPermissions`,`wallet_requestPermissions`,`wallet_registerOnboarding`,`wallet_watchAsset`,`wallet_scanQRCode`,`wallet_getCallsStatus`,`wallet_showCallsStatus`,`wallet_sendCalls`,`wallet_getCapabilities`,`wallet_grantPermissions`,`wallet_revokePermissions`,`wallet_getAssets`],bip122:[`sendTransfer`,`signMessage`,`signPsbt`,`getAccountAddresses`]},Iv={getMethodsByChainNamespace(e){return Fv[e]||[]},createDefaultNamespace(e){return{methods:this.getMethodsByChainNamespace(e),events:[`accountsChanged`,`chainChanged`],chains:[],rpcMap:{}}},applyNamespaceOverrides(e,t){if(!t)return{...e};let n={...e},r=new Set;if(t.methods&&Object.keys(t.methods).forEach(e=>r.add(e)),t.chains&&Object.keys(t.chains).forEach(e=>r.add(e)),t.events&&Object.keys(t.events).forEach(e=>r.add(e)),t.rpcMap&&Object.keys(t.rpcMap).forEach(e=>{let[t]=e.split(`:`);t&&r.add(t)}),r.forEach(e=>{n[e]||(n[e]=this.createDefaultNamespace(e))}),t.methods&&Object.entries(t.methods).forEach(([e,t])=>{n[e]&&(n[e].methods=t)}),t.chains&&Object.entries(t.chains).forEach(([e,t])=>{n[e]&&(n[e].chains=t)}),t.events&&Object.entries(t.events).forEach(([e,t])=>{n[e]&&(n[e].events=t)}),t.rpcMap){let e=new Set;Object.entries(t.rpcMap).forEach(([t,r])=>{let[i,a]=t.split(`:`);!i||!a||!n[i]||(n[i].rpcMap||(n[i].rpcMap={}),e.has(i)||(n[i].rpcMap={},e.add(i)),n[i].rpcMap[a]=r)})}return n},createNamespaces(e,t){let n=e.reduce((e,t)=>{let{id:n,chainNamespace:r,rpcUrls:i}=t,a=i.default.http[0];e[r]||(e[r]=this.createDefaultNamespace(r));let o=`${r}:${n}`,s=e[r];switch(s.chains.push(o),o){case Nv.caipNetworkId:s.chains.push(Nv.deprecatedCaipNetworkId);break;case Pv.caipNetworkId:s.chains.push(Pv.deprecatedCaipNetworkId);break;default:}return s?.rpcMap&&a&&(s.rpcMap[n]=a),e},{});return this.applyNamespaceOverrides(n,t)},resolveReownName:async e=>{let t=await ct.resolveName(e);return(Object.values(t?.addresses)||[])[0]?.address||!1},getChainsFromNamespaces(e={}){return Object.values(e).flatMap(e=>{let t=e.chains||[],n=e.accounts.map(e=>{let[t,n]=e.split(`:`);return`${t}:${n}`});return Array.from(new Set([...t,...n]))})},isSessionEventData(e){return typeof e==`object`&&!!e&&`id`in e&&`topic`in e&&`params`in e&&typeof e.params==`object`&&e.params!==null&&`chainId`in e.params&&`event`in e.params&&typeof e.params.event==`object`&&e.params.event!==null},isOriginAllowed(e,t,n){for(let r of[...t,...n])if(r.includes(`*`)){let t=`^${r.replace(/[.*+?^${}()|[\]\\]/gu,`\\$&`).replace(/\\\*/gu,`.*`)}$`;if(new RegExp(t,`u`).test(e))return!0}else try{if(new URL(r).origin===e)return!0}catch{if(r===e)return!0}return!1}};var Lv=class{constructor({provider:e,namespace:t}){this.id=f.CONNECTOR_ID.WALLET_CONNECT,this.name=lt.ConnectorNamesMap[f.CONNECTOR_ID.WALLET_CONNECT],this.type=`WALLET_CONNECT`,this.imageId=lt.ConnectorImageIds[f.CONNECTOR_ID.WALLET_CONNECT],this.getCaipNetworks=M.getCaipNetworks.bind(M),this.caipNetworks=this.getCaipNetworks(),this.provider=e,this.chain=t}get chains(){return this.getCaipNetworks()}async connectWalletConnect(){if(!await this.authenticate()){let e=this.getCaipNetworks(),t=_.state.universalProviderConfigOverride,n=Iv.createNamespaces(e,t);await this.provider.connect({optionalNamespaces:n})}return{clientId:await this.provider.client.core.crypto.getClientId(),session:this.provider.session}}async disconnect(){await this.provider.disconnect()}async authenticate(){let e=this.chains.map(e=>e.caipNetworkId);return Le.universalProviderAuthenticate({universalProvider:this.provider,chains:e,methods:Rv})}},Rv=[`eth_accounts`,`eth_requestAccounts`,`eth_sendRawTransaction`,`eth_sign`,`eth_signTransaction`,`eth_signTypedData`,`eth_signTypedData_v3`,`eth_signTypedData_v4`,`eth_sendTransaction`,`personal_sign`,`wallet_switchEthereumChain`,`wallet_addEthereumChain`,`wallet_getPermissions`,`wallet_requestPermissions`,`wallet_registerOnboarding`,`wallet_watchAsset`,`wallet_scanQRCode`,`wallet_getCallsStatus`,`wallet_sendCalls`,`wallet_getCapabilities`,`wallet_grantPermissions`,`wallet_revokePermissions`,`wallet_getAssets`],zv=class{constructor(e){this.availableConnectors=[],this.eventListeners=new Map,this.getCaipNetworks=e=>M.getCaipNetworks(e),e&&this.construct(e)}construct(e){this.projectId=e.projectId,this.namespace=e.namespace,this.adapterType=e.adapterType}get connectors(){return this.availableConnectors}get networks(){return this.getCaipNetworks(this.namespace)}setAuthProvider(e){this.addConnector({id:f.CONNECTOR_ID.AUTH,type:`AUTH`,name:f.CONNECTOR_NAMES.AUTH,provider:e,imageId:lt.ConnectorImageIds[f.CONNECTOR_ID.AUTH],chain:this.namespace,chains:[]})}addConnector(...e){let t=new Set;this.availableConnectors=[...e,...this.availableConnectors].filter(e=>t.has(e.id)?!1:(t.add(e.id),!0)),this.emit(`connectors`,this.availableConnectors)}setStatus(e,t){w.setStatus(e,t)}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e)?.add(t)}off(e,t){let n=this.eventListeners.get(e);n&&n.delete(t)}removeAllEventListeners(){this.eventListeners.forEach(e=>{e.clear()})}emit(e,t){let n=this.eventListeners.get(e);n&&n.forEach(e=>e(t))}async connectWalletConnect(e){return{clientId:(await this.getWalletConnectConnector().connectWalletConnect()).clientId}}async switchNetwork(e){let{caipNetwork:t,providerType:n}=e;if(!e.provider)return;let r=`provider`in e.provider?e.provider.provider:e.provider;if(n===`WALLET_CONNECT`){r.setDefaultChain(t.caipNetworkId);return}if(r&&n===`AUTH`){let e=r,n=w.state.preferredAccountTypes?.[t.chainNamespace];await e.switchNetwork(t.caipNetworkId);let i=await e.getUser({chainId:t.caipNetworkId,preferredAccountType:n});this.emit(`switchNetwork`,i)}}getWalletConnectConnector(){let e=this.connectors.find(e=>e instanceof Lv);if(!e)throw Error(`WalletConnectConnector not found`);return e}},Bv=class extends zv{setUniversalProvider(e){this.addConnector(new Lv({provider:e,caipNetworks:this.getCaipNetworks(),namespace:this.namespace}))}async connect(e){return Promise.resolve({id:`WALLET_CONNECT`,type:`WALLET_CONNECT`,chainId:Number(e.chainId),provider:this.provider,address:``})}async disconnect(){try{await this.getWalletConnectConnector().disconnect()}catch(e){console.warn(`UniversalAdapter:disconnect - error`,e)}}async getAccounts({namespace:e}){let t=this.provider?.session?.namespaces?.[e]?.accounts?.map(e=>{let[,,t]=e.split(`:`);return t}).filter((e,t,n)=>n.indexOf(e)===t)||[];return Promise.resolve({accounts:t.map(t=>k.createAccount(e,t,e===`bip122`?`payment`:`eoa`))})}async syncConnectors(){return Promise.resolve()}async getBalance(e){if(!(e.caipNetwork&&O.BALANCE_SUPPORTED_CHAINS.includes(e.caipNetwork?.chainNamespace))||e.caipNetwork?.testnet)return{balance:`0.00`,symbol:e.caipNetwork?.nativeCurrency.symbol||``};if(w.state.balanceLoading&&e.chainId===M.state.activeCaipNetwork?.id)return{balance:w.state.balance||`0.00`,symbol:w.state.balanceSymbol||``};let t=(await w.fetchTokenBalance()).find(t=>t.chainId===`${e.caipNetwork?.chainNamespace}:${e.chainId}`&&t.symbol===e.caipNetwork?.nativeCurrency.symbol);return{balance:t?.quantity.numeric||`0.00`,symbol:t?.symbol||e.caipNetwork?.nativeCurrency.symbol||``}}async signMessage(e){let{provider:t,message:n,address:r}=e;if(!t)throw Error(`UniversalAdapter:signMessage - provider is undefined`);let i=``;return i=M.state.activeCaipNetwork?.chainNamespace===f.CHAIN.SOLANA?(await t.request({method:`solana_signMessage`,params:{message:er.encode(new TextEncoder().encode(n)),pubkey:r}},M.state.activeCaipNetwork?.caipNetworkId)).signature:await t.request({method:`personal_sign`,params:[n,r]},M.state.activeCaipNetwork?.caipNetworkId),{signature:i}}async estimateGas(){return Promise.resolve({gas:BigInt(0)})}async sendTransaction(){return Promise.resolve({hash:``})}walletGetAssets(e){return Promise.resolve({})}async writeContract(){return Promise.resolve({hash:``})}parseUnits(){return 0n}formatUnits(){return`0`}async getCapabilities(){return Promise.resolve({})}async grantPermissions(){return Promise.resolve({})}async revokePermissions(){return Promise.resolve(`0x`)}async syncConnection(){return Promise.resolve({id:`WALLET_CONNECT`,type:`WALLET_CONNECT`,chainId:1,provider:this.provider,address:``})}async switchNetwork(e){let{caipNetwork:t}=e,r=this.getWalletConnectConnector();if(t.chainNamespace===f.CHAIN.EVM)try{await r.provider?.request({method:`wallet_switchEthereumChain`,params:[{chainId:n(t.id)}]})}catch(e){if(e.code===jv.ERROR_CODE_UNRECOGNIZED_CHAIN_ID||e.code===jv.ERROR_INVALID_CHAIN_ID||e.code===jv.ERROR_CODE_DEFAULT||e?.data?.originalError?.code===jv.ERROR_CODE_UNRECOGNIZED_CHAIN_ID)try{await r.provider?.request({method:`wallet_addEthereumChain`,params:[{chainId:n(t.id),rpcUrls:[t?.rpcUrls.chainDefault?.http],chainName:t.name,nativeCurrency:t.nativeCurrency,blockExplorerUrls:[t.blockExplorers?.default.url]}]})}catch{throw Error(`Chain is not supported`)}}r.provider.setDefaultChain(t.caipNetworkId)}getWalletConnectProvider(){return this.connectors.find(e=>e.type===`WALLET_CONNECT`)?.provider}},Vv=[`email`,`socials`,`swaps`,`onramp`,`activity`,`reownBranding`],Hv={email:{apiFeatureName:`social_login`,localFeatureName:`email`,returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:e=>{if(!e?.config)return!1;let t=e.config;return!!e.isEnabled&&t.includes(`email`)},processFallback:e=>e===void 0?O.DEFAULT_REMOTE_FEATURES.email:!!e},socials:{apiFeatureName:`social_login`,localFeatureName:`socials`,returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:e=>{if(!e?.config)return!1;let t=e.config;return e.isEnabled&&t.length>0?t.filter(e=>e!==`email`):!1},processFallback:e=>e===void 0?O.DEFAULT_REMOTE_FEATURES.socials:typeof e==`boolean`?e?O.DEFAULT_REMOTE_FEATURES.socials:!1:e},swaps:{apiFeatureName:`swap`,localFeatureName:`swaps`,returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:e=>{if(!e?.config)return!1;let t=e.config;return e.isEnabled&&t.length>0?t:!1},processFallback:e=>e===void 0?O.DEFAULT_REMOTE_FEATURES.swaps:typeof e==`boolean`?e?O.DEFAULT_REMOTE_FEATURES.swaps:!1:e},onramp:{apiFeatureName:`onramp`,localFeatureName:`onramp`,returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:e=>{if(!e?.config)return!1;let t=e.config;return e.isEnabled&&t.length>0?t:!1},processFallback:e=>e===void 0?O.DEFAULT_REMOTE_FEATURES.onramp:typeof e==`boolean`?e?O.DEFAULT_REMOTE_FEATURES.onramp:!1:e},activity:{apiFeatureName:`activity`,localFeatureName:`history`,returnType:!1,isLegacy:!0,isAvailableOnBasic:!1,processApi:e=>!!e.isEnabled,processFallback:e=>e===void 0?O.DEFAULT_REMOTE_FEATURES.activity:!!e},reownBranding:{apiFeatureName:`reown_branding`,localFeatureName:`reownBranding`,returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:e=>!!e.isEnabled,processFallback:e=>e===void 0?O.DEFAULT_REMOTE_FEATURES.reownBranding:!!e}};const Uv={localSettingsOverridden:new Set,getApiConfig(e,t){return t?.find(t=>t.id===e)},addWarning(e,t){if(e!==void 0){let e=Hv[t],n=e.isLegacy?`"features.${e.localFeatureName}" (now "${t}")`:`"features.${t}"`;this.localSettingsOverridden.add(n)}},processFeature(e,t,n,r,i){let a=Hv[e],o=t[a.localFeatureName];if(i&&!a.isAvailableOnBasic)return!1;if(r){let t=this.getApiConfig(a.apiFeatureName,n);return t?.config===null?this.processFallbackFeature(e,o):t?.config?(o!==void 0&&this.addWarning(o,e),this.processApiFeature(e,t)):!1}return this.processFallbackFeature(e,o)},processApiFeature(e,t){return Hv[e].processApi(t)},processFallbackFeature(e,t){return Hv[e].processFallback(t)},async fetchRemoteFeatures(e){let t=e.basic??!1,n=e.features||{};this.localSettingsOverridden.clear();let r=null,i=!1;try{r=await b.fetchProjectConfig(),i=r!=null}catch(e){console.warn(`[Reown Config] Failed to fetch remote project configuration. Using local/default values.`,e)}let a=i&&!t?O.DEFAULT_REMOTE_FEATURES:O.DEFAULT_REMOTE_FEATURES_DISABLED;try{for(let e of Vv){let o=this.processFeature(e,n,r,i,t);Object.assign(a,{[e]:o})}}catch(e){return console.warn(`[Reown Config] Failed to process the configuration from Cloud. Using default values.`,e),O.DEFAULT_REMOTE_FEATURES}if(i&&this.localSettingsOverridden.size>0){let e=`Your local configuration for ${Array.from(this.localSettingsOverridden).join(`, `)} was ignored because a remote configuration was successfully fetched. Please manage these features via your project dashboard on dashboard.reown.com.`;P.open({shortMessage:`Local configuration ignored`,longMessage:`[Reown Config Notice] ${e}`},`warning`)}return a}};var Wv=class{constructor(e){this.chainNamespaces=[],this.remoteFeatures={},this.reportedAlertErrors={},this.getCaipNetwork=(e,t)=>e?M.getNetworkData(e)?.requestedCaipNetworks?.find(e=>e.id===t)||M.getNetworkData(e)?.caipNetwork||M.getRequestedCaipNetworks(e).filter(t=>t.chainNamespace===e)?.[0]:M.state.activeCaipNetwork||this.defaultCaipNetwork,this.getCaipNetworkId=()=>{let e=this.getCaipNetwork();if(e)return e.id},this.getCaipNetworks=e=>M.getCaipNetworks(e),this.getActiveChainNamespace=()=>M.state.activeChain,this.setRequestedCaipNetworks=(e,t)=>{M.setRequestedCaipNetworks(e,t)},this.getApprovedCaipNetworkIds=()=>M.getAllApprovedCaipNetworkIds(),this.getCaipAddress=e=>M.state.activeChain===e||!e?M.state.activeCaipAddress:M.getAccountProp(`caipAddress`,e),this.setClientId=e=>{T.setClientId(e)},this.getProvider=e=>yt.getProvider(e),this.getProviderType=e=>yt.getProviderId(e),this.getPreferredAccountType=e=>w.state.preferredAccountTypes?.[e],this.setCaipAddress=(e,t)=>{w.setCaipAddress(e,t),e&&_.state.enableEmbedded&&this.close()},this.setBalance=(e,t,n)=>{w.setBalance(e,t,n)},this.setProfileName=(e,t)=>{w.setProfileName(e,t)},this.setProfileImage=(e,t)=>{w.setProfileImage(e,t)},this.setUser=(e,t)=>{w.setUser(e,t)},this.resetAccount=e=>{w.resetAccount(e)},this.setCaipNetwork=e=>{M.setActiveCaipNetwork(e)},this.setCaipNetworkOfNamespace=(e,t)=>{M.setChainNetworkData(t,{caipNetwork:e})},this.setAllAccounts=(e,t)=>{w.setAllAccounts(e,t),_.setHasMultipleAddresses(e?.length>1)},this.setStatus=(e,t)=>{w.setStatus(e,t),I.isConnected()?l.setConnectionStatus(`connected`):l.setConnectionStatus(`disconnected`)},this.getAddressByChainNamespace=e=>M.getAccountProp(`address`,e),this.setConnectors=e=>{let t=[...I.state.allConnectors,...e];I.setConnectors(t)},this.setConnections=(e,t)=>{E.setConnections(e,t)},this.fetchIdentity=e=>T.fetchIdentity(e),this.getReownName=e=>ct.getNamesForAddress(e),this.getConnectors=()=>I.getConnectors(),this.getConnectorImage=e=>x.getConnectorImage(e),this.setConnectedWalletInfo=(e,t)=>{let n=yt.getProviderId(t),r=e?{...e,type:n}:void 0;w.setConnectedWalletInfo(r,t)},this.getIsConnectedState=()=>!!M.state.activeCaipAddress,this.addAddressLabel=(e,t,n)=>{w.addAddressLabel(e,t,n)},this.removeAddressLabel=(e,t)=>{w.removeAddressLabel(e,t)},this.getAddress=e=>M.state.activeChain===e||!e?w.state.address:M.getAccountProp(`address`,e),this.setApprovedCaipNetworksData=e=>M.setApprovedCaipNetworksData(e),this.resetNetwork=e=>{M.resetNetwork(e)},this.addConnector=e=>{I.addConnector(e)},this.resetWcConnection=()=>{E.resetWcConnection()},this.setAddressExplorerUrl=(e,t)=>{w.setAddressExplorerUrl(e,t)},this.setSmartAccountDeployed=(e,t)=>{w.setSmartAccountDeployed(e,t)},this.setSmartAccountEnabledNetworks=(e,t)=>{M.setSmartAccountEnabledNetworks(e,t)},this.setPreferredAccountType=(e,t)=>{w.setPreferredAccountType(e,t)},this.setEIP6963Enabled=e=>{_.setEIP6963Enabled(e)},this.handleUnsafeRPCRequest=()=>{if(this.isOpen()){if(this.isTransactionStackEmpty())return;this.redirect(`ApproveTransaction`)}else this.open({view:`ApproveTransaction`})},this.options=e,this.version=e.sdkVersion,this.caipNetworks=this.extendCaipNetworks(e),this.chainNamespaces=this.getChainNamespacesSet(e.adapters,this.caipNetworks),this.defaultCaipNetwork=this.extendDefaultCaipNetwork(e),this.chainAdapters=this.createAdapters(e.adapters),this.readyPromise=this.initialize(e)}getChainNamespacesSet(e,t){let n=e?.map(e=>e.namespace).filter(e=>!!e);if(n?.length)return[...new Set(n)];let r=t?.map(e=>e.chainNamespace);return[...new Set(r)]}async initialize(e){this.initializeProjectSettings(e),this.initControllers(e),await this.initChainAdapters(),this.sendInitializeEvent(e),await this.syncExistingConnection(),this.remoteFeatures=await Uv.fetchRemoteFeatures(e),_.setRemoteFeatures(this.remoteFeatures),this.remoteFeatures.onramp&&it.setOnrampProviders(this.remoteFeatures.onramp),(_.state.remoteFeatures?.email||Array.isArray(_.state.remoteFeatures?.socials)&&_.state.remoteFeatures?.socials.length>0)&&await this.checkAllowedOrigins()}async checkAllowedOrigins(){let e=await b.fetchAllowedOrigins();if(e&&k.isClient()){let t=window.location.origin;Iv.isOriginAllowed(t,e,jv.DEFAULT_ALLOWED_ANCESTORS)||P.open(ut.ALERT_ERRORS.INVALID_APP_CONFIGURATION,`error`)}else P.open(ut.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,`error`)}sendInitializeEvent(e){let{...t}=e;delete t.adapters,delete t.universalProvider,u.sendEvent({type:`track`,event:`INITIALIZE`,properties:{...t,networks:e.networks.map(e=>e.id),siweConfig:{options:e.siweConfig?.options||{}}}})}initControllers(e){this.initializeOptionsController(e),this.initializeChainController(e),this.initializeThemeController(e),this.initializeConnectionController(e),this.initializeConnectorController()}initializeThemeController(e){e.themeMode&&S.setThemeMode(e.themeMode),e.themeVariables&&S.setThemeVariables(e.themeVariables)}initializeChainController(e){if(!this.connectionControllerClient||!this.networkControllerClient)throw Error(`ConnectionControllerClient and NetworkControllerClient must be set`);M.initialize(e.adapters??[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient,networkControllerClient:this.networkControllerClient});let t=this.getDefaultNetwork();t&&M.setActiveCaipNetwork(t)}initializeConnectionController(e){E.setWcBasic(e.basic??!1)}initializeConnectorController(){I.initialize(this.chainNamespaces)}initializeProjectSettings(e){_.setProjectId(e.projectId),_.setSdkVersion(e.sdkVersion)}initializeOptionsController(e){_.setDebug(e.debug!==!1),_.setEnableWalletConnect(e.enableWalletConnect!==!1),_.setEnableWalletGuide(e.enableWalletGuide!==!1),_.setEnableWallets(e.enableWallets!==!1),_.setEIP6963Enabled(e.enableEIP6963!==!1),_.setEnableNetworkSwitch(e.enableNetworkSwitch!==!1),_.setEnableAuthLogger(e.enableAuthLogger!==!1),_.setCustomRpcUrls(e.customRpcUrls),_.setEnableEmbedded(e.enableEmbedded),_.setAllWallets(e.allWallets),_.setIncludeWalletIds(e.includeWalletIds),_.setExcludeWalletIds(e.excludeWalletIds),_.setFeaturedWalletIds(e.featuredWalletIds),_.setTokens(e.tokens),_.setTermsConditionsUrl(e.termsConditionsUrl),_.setPrivacyPolicyUrl(e.privacyPolicyUrl),_.setCustomWallets(e.customWallets),_.setFeatures(e.features),_.setAllowUnsupportedChain(e.allowUnsupportedChain),_.setUniversalProviderConfigOverride(e.universalProviderConfigOverride),_.setPreferUniversalLinks(e.experimental_preferUniversalLinks),_.setDefaultAccountTypes(e.defaultAccountTypes);let t=l.getPreferredAccountTypes()||{},n={..._.state.defaultAccountTypes,...t};w.setPreferredAccountTypes(n);let r=this.getDefaultMetaData();if(!e.metadata&&r&&(e.metadata=r),_.setMetadata(e.metadata),_.setDisableAppend(e.disableAppend),_.setEnableEmbedded(e.enableEmbedded),_.setSIWX(e.siwx),!e.projectId){P.open(ut.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,`error`);return}if(e.adapters?.find(e=>e.namespace===f.CHAIN.EVM)&&e.siweConfig){if(e.siwx)throw Error("Cannot set both `siweConfig` and `siwx` options");_.setSIWX(e.siweConfig.mapToSIWX())}}getDefaultMetaData(){return k.isClient()?{name:document.getElementsByTagName(`title`)?.[0]?.textContent||``,description:document.querySelector(`meta[property="og:description"]`)?.content||``,url:window.location.origin,icons:[document.querySelector(`link[rel~="icon"]`)?.href||``]}:null}setUnsupportedNetwork(e){let t=this.getActiveChainNamespace();if(t){let n=gt.getUnsupportedNetwork(`${t}:${e}`);M.setActiveCaipNetwork(n)}}getDefaultNetwork(){return gt.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(e,t){return gt.extendCaipNetwork(e,{customNetworkImageUrls:t.chainImages,projectId:t.projectId})}extendCaipNetworks(e){return gt.extendCaipNetworks(e.networks,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId})}extendDefaultCaipNetwork(e){let t=e.networks.find(t=>t.id===e.defaultNetwork?.id);return t?gt.extendCaipNetwork(t,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId}):void 0}async disconnectNamespace(e){try{let t=this.getAdapter(e),n=yt.getProvider(e),r=yt.getProviderId(e),{caipAddress:i}=M.getAccountData(e)||{};this.setLoading(!0,e),i&&t?.disconnect&&await t.disconnect({provider:n,providerType:r}),l.removeConnectedNamespace(e),yt.resetChain(e),this.setUser(void 0,e),this.setStatus(`disconnected`,e),this.setConnectedWalletInfo(void 0,e),I.removeConnectorId(e),M.resetAccount(e),M.resetNetwork(e),this.setLoading(!1,e)}catch(t){throw this.setLoading(!1,e),Error(`Failed to disconnect chain ${e}: ${t.message}`)}}createClients(){this.connectionControllerClient={connectWalletConnect:async()=>{let e=M.state.activeChain,t=this.getAdapter(e),n=this.getCaipNetwork(e)?.id;if(!t)throw Error(`Adapter not found`);let r=await t.connectWalletConnect(n);this.close(),this.setClientId(r?.clientId||null),l.setConnectedNamespaces([...M.state.chains.keys()]),this.chainNamespaces.forEach(e=>{I.setConnectorId(Re.CONNECTOR_TYPE_WALLET_CONNECT,e)}),await this.syncWalletConnectAccount()},connectExternal:async({id:e,info:t,type:n,provider:r,chain:i,caipNetwork:a,socialUri:o})=>{let s=M.state.activeChain,c=i||s,u=this.getAdapter(c);if(i&&i!==s&&!a){let e=this.getCaipNetworks().find(e=>e.chainNamespace===i);e&&this.setCaipNetwork(e)}if(!u)throw Error(`Adapter not found`);let d=this.getCaipNetwork(c),f=await u.connect({id:e,info:t,type:n,provider:r,socialUri:o,chainId:a?.id||d?.id,rpcUrl:a?.rpcUrls?.default?.http?.[0]||d?.rpcUrls?.default?.http?.[0]});if(!f)return;l.addConnectedNamespace(c),this.syncProvider({...f,chainNamespace:c});let p=w.state.allAccounts,{accounts:m}=p?.length>0?{accounts:[...p]}:await u.getAccounts({namespace:c,id:e});this.setAllAccounts(m,c),this.setStatus(`connected`,c),this.syncConnectedWalletInfo(c)},reconnectExternal:async({id:e,info:t,type:n,provider:r})=>{let i=M.state.activeChain,a=this.getAdapter(i);a?.reconnect&&(await a?.reconnect({id:e,info:t,type:n,provider:r,chainId:this.getCaipNetwork()?.id}),l.addConnectedNamespace(i),this.syncConnectedWalletInfo(i))},disconnect:async e=>{let t=Av(e);try{let n=await Promise.allSettled(t.map(async([e])=>this.disconnectNamespace(e)));j.resetSend(),E.resetWcConnection(),await Le.clearSessions(),I.setFilterByNamespace(void 0);let r=n.filter(e=>e.status===`rejected`);if(r.length>0)throw Error(r.map(e=>e.reason.message).join(`, `));l.deleteConnectedSocialProvider(),u.sendEvent({type:`track`,event:`DISCONNECT_SUCCESS`,properties:{namespace:e||`all`}})}catch(e){throw Error(`Failed to disconnect chains: ${e.message}`)}},checkInstalled:e=>e?e.some(e=>!!window.ethereum?.[String(e)]):!!window.ethereum,signMessage:async e=>(await this.getAdapter(M.state.activeChain)?.signMessage({message:e,address:w.state.address,provider:yt.getProvider(M.state.activeChain)}))?.signature||``,sendTransaction:async e=>{let t=e.chainNamespace;if(O.SEND_SUPPORTED_NAMESPACES.includes(t)){let n=this.getAdapter(M.state.activeChain),r=yt.getProvider(t);return(await n?.sendTransaction({...e,caipNetwork:this.getCaipNetwork(),provider:r}))?.hash||``}return``},estimateGas:async e=>{if(e.chainNamespace===f.CHAIN.EVM){let t=this.getAdapter(M.state.activeChain),n=yt.getProvider(M.state.activeChain),r=this.getCaipNetwork();if(!r)throw Error(`CaipNetwork is undefined`);return(await t?.estimateGas({...e,provider:n,caipNetwork:r}))?.gas||0n}return 0n},getEnsAvatar:async()=>(await this.syncIdentity({address:w.state.address,chainId:Number(this.getCaipNetwork()?.id),chainNamespace:M.state.activeChain}),w.state.profileImage||!1),getEnsAddress:async e=>await Iv.resolveReownName(e),writeContract:async e=>{let t=this.getAdapter(M.state.activeChain),n=this.getCaipNetwork(),r=this.getCaipAddress(),i=yt.getProvider(M.state.activeChain);if(!n||!r)throw Error(`CaipNetwork or CaipAddress is undefined`);return(await t?.writeContract({...e,caipNetwork:n,provider:i,caipAddress:r}))?.hash},parseUnits:(e,t)=>this.getAdapter(M.state.activeChain)?.parseUnits({value:e,decimals:t})??0n,formatUnits:(e,t)=>this.getAdapter(M.state.activeChain)?.formatUnits({value:e,decimals:t})??`0`,getCapabilities:async e=>await this.getAdapter(M.state.activeChain)?.getCapabilities(e),grantPermissions:async e=>await this.getAdapter(M.state.activeChain)?.grantPermissions(e),revokePermissions:async e=>{let t=this.getAdapter(M.state.activeChain);return t?.revokePermissions?await t.revokePermissions(e):`0x`},walletGetAssets:async e=>await this.getAdapter(M.state.activeChain)?.walletGetAssets(e)??{},updateBalance:e=>{let t=this.getCaipNetwork(e);!t||!w.state.address||this.updateNativeBalance(w.state.address,t?.id,e)}},this.networkControllerClient={switchCaipNetwork:async e=>await this.switchCaipNetwork(e),getApprovedCaipNetworksData:async()=>this.getApprovedCaipNetworksData()},E.setClient(this.connectionControllerClient)}getApprovedCaipNetworksData(){if(yt.getProviderId(M.state.activeChain)===Re.CONNECTOR_TYPE_WALLET_CONNECT){let e=this.universalProvider?.session?.namespaces;return{supportsAllNetworks:this.universalProvider?.session?.peer?.metadata.name===`MetaMask Wallet`,approvedCaipNetworkIds:this.getChainsFromNamespaces(e)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}async switchCaipNetwork(e){if(!e)return;let t=e.chainNamespace;if(this.getAddressByChainNamespace(e.chainNamespace)){let n=yt.getProvider(t),r=yt.getProviderId(t);if(e.chainNamespace===M.state.activeChain)await this.getAdapter(t)?.switchNetwork({caipNetwork:e,provider:n,providerType:r});else if(this.setCaipNetwork(e),r===Re.CONNECTOR_TYPE_WALLET_CONNECT)this.syncWalletConnectAccount();else{let n=this.getAddressByChainNamespace(t);n&&this.syncAccount({address:n,chainId:e.id,chainNamespace:t})}}else this.setCaipNetwork(e)}getChainsFromNamespaces(e={}){return Object.values(e).flatMap(e=>{let t=e.chains||[],n=e.accounts.map(e=>{let{chainId:t,chainNamespace:n}=tt.parseCaipAddress(e);return`${n}:${t}`});return Array.from(new Set([...t,...n]))})}createAdapters(e){return this.createClients(),this.chainNamespaces.reduce((t,n)=>{let r=e?.find(e=>e.namespace===n);return r?(r.construct({namespace:n,projectId:this.options?.projectId,networks:this.getCaipNetworks()}),t[n]=r):t[n]=new Bv({namespace:n,networks:this.getCaipNetworks()}),t},{})}async initChainAdapter(e){this.onConnectors(e),this.listenAdapter(e),await this.chainAdapters?.[e].syncConnectors(this.options,this),await this.createUniversalProviderForAdapter(e)}async initChainAdapters(){await Promise.all(this.chainNamespaces.map(async e=>{await this.initChainAdapter(e)}))}onConnectors(e){this.getAdapter(e)?.on(`connectors`,this.setConnectors.bind(this))}listenAdapter(e){let t=this.getAdapter(e);if(!t)return;let n=l.getConnectionStatus();n===`connected`?this.setStatus(`connecting`,e):(n===`disconnected`&&l.clearAddressCache(),this.setStatus(n,e)),t.on(`switchNetwork`,({address:t,chainId:n})=>{let r=this.getCaipNetworks().find(e=>e.id===n||e.caipNetworkId===n),i=M.state.activeChain===e,a=M.getAccountProp(`address`,e);if(r){let n=i&&t?t:a;n&&this.syncAccount({address:n,chainId:r.id,chainNamespace:e})}else this.setUnsupportedNetwork(n)}),t.on(`disconnect`,this.disconnect.bind(this,e)),t.on(`connections`,t=>{this.setConnections(t,e)}),t.on(`pendingTransactions`,()=>{let e=w.state.address,t=M.state.activeCaipNetwork;!e||!t?.id||this.updateNativeBalance(e,t.id,t.chainNamespace)}),t.on(`accountChanged`,({address:t,chainId:n})=>{let r=M.state.activeChain===e;r&&n?this.syncAccount({address:t,chainId:n,chainNamespace:e}):r&&M.state.activeCaipNetwork?.id?this.syncAccount({address:t,chainId:M.state.activeCaipNetwork?.id,chainNamespace:e}):this.syncAccountInfo(t,n,e),this.syncAllAccounts(e)})}async createUniversalProviderForAdapter(e){await this.getUniversalProvider(),this.universalProvider&&this.chainAdapters?.[e]?.setUniversalProvider?.(this.universalProvider)}async syncExistingConnection(){await Promise.allSettled(this.chainNamespaces.map(e=>this.syncNamespaceConnection(e)))}async syncNamespaceConnection(e){try{e===f.CHAIN.EVM&&k.isSafeApp()&&I.setConnectorId(f.CONNECTOR_ID.SAFE,e);let t=I.getConnectorId(e);switch(this.setStatus(`connecting`,e),t){case f.CONNECTOR_ID.WALLET_CONNECT:await this.syncWalletConnectAccount();break;case f.CONNECTOR_ID.AUTH:break;default:await this.syncAdapterConnection(e)}}catch(t){console.warn(`AppKit couldn't sync existing connection`,t),this.setStatus(`disconnected`,e)}}async syncAdapterConnection(e){let t=this.getAdapter(e),n=I.getConnectorId(e),r=this.getCaipNetwork(e),i=I.getConnectors(e).find(e=>e.id===n);try{if(!t||!i)throw Error(`Adapter or connector not found for namespace ${e}`);if(!r?.id)throw Error(`CaipNetwork not found`);let n=await t?.syncConnection({namespace:e,id:i.id,chainId:r.id,rpcUrl:r?.rpcUrls?.default?.http?.[0]});if(n){let r=await t?.getAccounts({namespace:e,id:i.id});r&&r.accounts.length>0?this.setAllAccounts(r.accounts,e):this.setAllAccounts([k.createAccount(e,n.address,`eoa`)],e),this.syncProvider({...n,chainNamespace:e}),await this.syncAccount({...n,chainNamespace:e}),this.setStatus(`connected`,e)}else this.setStatus(`disconnected`,e)}catch{this.setStatus(`disconnected`,e)}}async syncWalletConnectAccount(){let e=this.chainNamespaces.map(async e=>{let t=this.getAdapter(e),n=this.universalProvider?.session?.namespaces?.[e]?.accounts||[],r=M.state.activeCaipNetwork?.id,i=n.find(e=>{let{chainId:t}=tt.parseCaipAddress(e);return t===r?.toString()})||n[0];if(i){let n=tt.validateCaipAddress(i),{chainId:r,address:a}=tt.parseCaipAddress(n);if(yt.setProviderId(e,Re.CONNECTOR_TYPE_WALLET_CONNECT),this.caipNetworks&&M.state.activeCaipNetwork&&t?.namespace!==f.CHAIN.EVM){let n=t?.getWalletConnectProvider({caipNetworks:this.getCaipNetworks(),provider:this.universalProvider,activeCaipNetwork:M.state.activeCaipNetwork});yt.setProvider(e,n)}else yt.setProvider(e,this.universalProvider);I.setConnectorId(f.CONNECTOR_ID.WALLET_CONNECT,e),l.addConnectedNamespace(e),this.syncWalletConnectAccounts(e),await this.syncAccount({address:a,chainId:r,chainNamespace:e})}else this.setStatus(`disconnected`,e);this.syncConnectedWalletInfo(e),await M.setApprovedCaipNetworksData(e)});await Promise.all(e)}syncWalletConnectAccounts(e){let t=this.universalProvider?.session?.namespaces?.[e]?.accounts?.map(e=>{let{address:t}=tt.parseCaipAddress(e);return t}).filter((e,t,n)=>n.indexOf(e)===t);t&&this.setAllAccounts(t.map(t=>k.createAccount(e,t,e===`bip122`?`payment`:`eoa`)),e)}syncProvider({type:e,provider:t,id:n,chainNamespace:r}){yt.setProviderId(r,e),yt.setProvider(r,t),I.setConnectorId(n,r)}async syncAllAccounts(e){let t=I.getConnectorId(e);if(!t)return;let n=await this.getAdapter(e)?.getAccounts({namespace:e,id:t});n&&n.accounts.length>0&&this.setAllAccounts(n.accounts,e)}async syncAccount(e){let t=e.chainNamespace===M.state.activeChain,n=M.getCaipNetworkByNamespace(e.chainNamespace,e.chainId),{address:r,chainId:i,chainNamespace:a}=e,{chainId:o}=l.getActiveNetworkProps(),s=i||o,c=M.state.activeCaipNetwork?.name===f.UNSUPPORTED_NETWORK_NAME,u=M.getNetworkProp(`supportsAllNetworks`,a);if(this.setStatus(`connected`,a),!(c&&!u)&&s){let e=this.getCaipNetworks().find(e=>e.id.toString()===s.toString()),i=this.getCaipNetworks().find(e=>e.chainNamespace===a);if(!u&&!e&&!i){let t=this.getApprovedCaipNetworkIds()||[],n=t.find(e=>tt.parseCaipNetworkId(e)?.chainId===s.toString()),r=t.find(e=>tt.parseCaipNetworkId(e)?.chainNamespace===a);e=this.getCaipNetworks().find(e=>e.caipNetworkId===n),i=this.getCaipNetworks().find(e=>e.caipNetworkId===r||`deprecatedCaipNetworkId`in e&&e.deprecatedCaipNetworkId===r)}let o=e||i;o?.chainNamespace===M.state.activeChain?_.state.enableNetworkSwitch&&!_.state.allowUnsupportedChain&&M.state.activeCaipNetwork?.name===f.UNSUPPORTED_NETWORK_NAME?M.showUnsupportedChainUI():this.setCaipNetwork(o):t||n&&this.setCaipNetworkOfNamespace(n,a),this.syncConnectedWalletInfo(a),Be.isLowerCaseMatch(r,w.state.address)||this.syncAccountInfo(r,o?.id,a),t?await this.syncBalance({address:r,chainId:o?.id,chainNamespace:a}):await this.syncBalance({address:r,chainId:n?.id,chainNamespace:a})}}async syncAccountInfo(e,t,n){let r=this.getCaipAddress(n),i=t||r?.split(`:`)[1];if(!i)return;let a=`${n}:${i}:${e}`;this.setCaipAddress(a,n),await this.syncIdentity({address:e,chainId:i,chainNamespace:n})}async syncReownName(e,t){try{let n=await this.getReownName(e);if(n[0]){let e=n[0];this.setProfileName(e.name,t)}else this.setProfileName(null,t)}catch{this.setProfileName(null,t)}}syncConnectedWalletInfo(e){let t=I.getConnectorId(e),n=yt.getProviderId(e);if(n===Re.CONNECTOR_TYPE_ANNOUNCED||n===Re.CONNECTOR_TYPE_INJECTED){if(t){let n=this.getConnectors().find(e=>e.id===t);if(n){let{info:t,name:r,imageUrl:i}=n,a=i||this.getConnectorImage(n);this.setConnectedWalletInfo({name:r,icon:a,...t},e)}}}else if(n===Re.CONNECTOR_TYPE_WALLET_CONNECT){let t=yt.getProvider(e);t?.session&&this.setConnectedWalletInfo({...t.session.peer.metadata,name:t.session.peer.metadata.name,icon:t.session.peer.metadata.icons?.[0]},e)}else if(t&&t===f.CONNECTOR_ID.COINBASE){let t=this.getConnectors().find(e=>e.id===f.CONNECTOR_ID.COINBASE);this.setConnectedWalletInfo({name:`Coinbase Wallet`,icon:this.getConnectorImage(t)},e)}}async syncBalance(e){!v.getNetworksByNamespace(this.getCaipNetworks(),e.chainNamespace).find(t=>t.id.toString()===e.chainId?.toString())||!e.chainId||await this.updateNativeBalance(e.address,e.chainId,e.chainNamespace)}async ready(){await this.readyPromise}async updateNativeBalance(e,t,n){let r=this.getAdapter(n),i=M.getCaipNetworkByNamespace(n,t);if(r){let a=await r.getBalance({address:e,chainId:t,caipNetwork:i,tokens:this.options.tokens});return this.setBalance(a.balance,a.symbol,n),a}}async initializeUniversalAdapter(){let e=ft.createLogger((e,...t)=>{e&&this.handleAlertError(e),console.error(...t)}),t={projectId:this.options?.projectId,metadata:{name:this.options?.metadata?this.options?.metadata.name:``,description:this.options?.metadata?this.options?.metadata.description:``,url:this.options?.metadata?this.options?.metadata.url:``,icons:this.options?.metadata?this.options?.metadata.icons:[``]},logger:e};_.setManualWCControl(!!this.options?.manualWCControl),this.universalProvider=this.options.universalProvider??await Ov.init(t),this.listenWalletConnect()}listenWalletConnect(){this.universalProvider&&(this.universalProvider.on(`display_uri`,e=>{E.setUri(e)}),this.universalProvider.on(`connect`,E.finalizeWcConnection),this.universalProvider.on(`disconnect`,()=>{this.chainNamespaces.forEach(e=>{this.resetAccount(e)}),E.resetWcConnection()}),this.universalProvider.on(`chainChanged`,e=>{let t=this.getCaipNetworks().find(t=>t.id==e),n=this.getCaipNetwork();if(!t){this.setUnsupportedNetwork(e);return}n?.id!==t?.id&&this.setCaipNetwork(t)}),this.universalProvider.on(`session_event`,e=>{if(Iv.isSessionEventData(e)){let{name:t,data:n}=e.params.event;t===`accountsChanged`&&Array.isArray(n)&&k.isCaipAddress(n[0])&&this.syncAccount(tt.parseCaipAddress(n[0]))}}))}createUniversalProvider(){return!this.universalProviderInitPromise&&k.isClient()&&this.options?.projectId&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}async getUniversalProvider(){if(!this.universalProvider)try{await this.createUniversalProvider()}catch(e){u.sendEvent({type:`error`,event:`INTERNAL_SDK_ERROR`,properties:{errorType:`UniversalProviderInitError`,errorMessage:e instanceof Error?e.message:`Unknown`,uncaught:!1}}),console.error(`AppKit:getUniversalProvider - Cannot create provider`,e)}return this.universalProvider}handleAlertError(e){let[t,n]=Object.entries(ut.UniversalProviderErrors).find(([,{message:t}])=>e.message.includes(t))??[],{message:r,alertErrorKey:i}=n??{};if(t&&r&&!this.reportedAlertErrors[t]){let e=ut.ALERT_ERRORS[i];e&&(P.open(e,`error`),this.reportedAlertErrors[t]=!0)}}getAdapter(e){if(e)return this.chainAdapters?.[e]}createAdapter(e){if(!e)return;let t=e.namespace;if(!t)return;this.createClients();let n=e;n.namespace=t,n.construct({namespace:t,projectId:this.options?.projectId,networks:this.getCaipNetworks()}),this.chainNamespaces.includes(t)||this.chainNamespaces.push(t),this.chainAdapters&&(this.chainAdapters[t]=n)}async open(e){if(await this.injectModalUi(),e?.uri&&E.setUri(e.uri),e?.arguments)switch(e?.view){case`Swap`:return N.open({...e,data:{swap:e.arguments}});default:}return N.open(e)}async close(){await this.injectModalUi(),N.close()}setLoading(e,t){N.setLoading(e,t)}async disconnect(e){await E.disconnect(e)}getSIWX(){return _.state.siwx}getError(){return``}getChainId(){return M.state.activeCaipNetwork?.id}async switchNetwork(e){let t=this.getCaipNetworks().find(t=>t.id===e.id);if(!t){P.open(ut.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,`error`);return}await M.switchActiveNetwork(t)}getWalletProvider(){return M.state.activeChain?yt.state.providers[M.state.activeChain]:null}getWalletProviderType(){return yt.getProviderId(M.state.activeChain)}subscribeProviders(e){return yt.subscribeProviders(e)}getThemeMode(){return S.state.themeMode}getThemeVariables(){return S.state.themeVariables}setThemeMode(e){S.setThemeMode(e),C(S.state.themeMode)}setTermsConditionsUrl(e){_.setTermsConditionsUrl(e)}setPrivacyPolicyUrl(e){_.setPrivacyPolicyUrl(e)}setThemeVariables(e){S.setThemeVariables(e),A(S.state.themeVariables)}subscribeTheme(e){return S.subscribe(e)}getWalletInfo(){return w.state.connectedWalletInfo}getAccount(e){let t=I.getAuthConnector(e),n=M.getAccountData(e),r=M.state.activeChain,i=l.getConnectedConnectorId(e||r);if(n)return{allAccounts:n.allAccounts,caipAddress:n.caipAddress,address:k.getPlainAddress(n.caipAddress),isConnected:!!n.caipAddress,status:n.status,embeddedWalletInfo:t&&i===f.CONNECTOR_ID.AUTH?{user:n.user?{...n.user,username:l.getConnectedSocialUsername()}:void 0,authProvider:n.socialProvider||`email`,accountType:n.preferredAccountTypes?.[e||r],isSmartAccountDeployed:!!n.smartAccountDeployed}:void 0}}subscribeAccount(e,t){let n=()=>{let n=this.getAccount(t);n&&e(n)};t?M.subscribeChainProp(`accountState`,n,t):M.subscribe(n),I.subscribe(n)}subscribeNetwork(e){return M.subscribe(({activeCaipNetwork:t})=>{e({caipNetwork:t,chainId:t?.id,caipNetworkId:t?.caipNetworkId})})}subscribeWalletInfo(e){return w.subscribeKey(`connectedWalletInfo`,e)}subscribeShouldUpdateToAddress(e){w.subscribeKey(`shouldUpdateToAddress`,e)}subscribeCaipNetworkChange(e){M.subscribeKey(`activeCaipNetwork`,e)}getState(){return D.state}subscribeState(e){return D.subscribe(e)}showErrorMessage(e){ee.showError(e)}showSuccessMessage(e){ee.showSuccess(e)}getEvent(){return{...u.state}}subscribeEvents(e){return u.subscribe(e)}replace(e){F.replace(e)}redirect(e){F.push(e)}popTransactionStack(e){F.popTransactionStack(e)}isOpen(){return N.state.open}isTransactionStackEmpty(){return F.state.transactionStack.length===0}static getInstance(){return this.instance}updateFeatures(e){_.setFeatures(e)}updateRemoteFeatures(e){_.setRemoteFeatures(e)}updateOptions(e){let t={..._.state||{},...e};_.setOptions(t)}setConnectMethodsOrder(e){_.setConnectMethodsOrder(e)}setWalletFeaturesOrder(e){_.setWalletFeaturesOrder(e)}setCollapseWallets(e){_.setCollapseWallets(e)}setSocialsOrder(e){_.setSocialsOrder(e)}getConnectMethodsOrder(){return ze.getConnectOrderMethod(_.state.features,I.getConnectors())}addNetwork(e,t){if(this.chainAdapters&&!this.chainAdapters[e])throw Error(`Adapter for namespace ${e} doesn't exist`);let n=this.extendCaipNetwork(t,this.options);this.getCaipNetworks().find(e=>e.id===n.id)||M.addNetwork(n)}removeNetwork(e,t){if(this.chainAdapters&&!this.chainAdapters[e])throw Error(`Adapter for namespace ${e} doesn't exist`);this.getCaipNetworks().find(e=>e.id===t)&&M.removeNetwork(e,t)}},Gv=!1,Kv=class extends Wv{async open(e){I.isConnected()||await super.open(e)}async close(){await super.close(),this.options.manualWCControl&&E.finalizeWcConnection()}async syncIdentity(e){return Promise.resolve()}async syncBalance(e){return Promise.resolve()}async injectModalUi(){if(!Gv&&k.isClient()){if(await t(()=>import(`./basic-CgPjOpNb.js`),__vite__mapDeps([4,1,2,5,6,7,8])),await t(()=>import(`./w3m-modal-fM2-z4gU.js`),__vite__mapDeps([9,5,6,1,2,7,10,11,12])),!document.querySelector(`w3m-modal`)){let e=document.createElement(`w3m-modal`);!_.state.disableAppend&&!_.state.enableEmbedded&&document.body.insertAdjacentElement(`beforeend`,e)}Gv=!0}}};function qv(e){return new Kv({...e,basic:!0,sdkVersion:`html-core-1.7.8`})}export{qv as createAppKit};